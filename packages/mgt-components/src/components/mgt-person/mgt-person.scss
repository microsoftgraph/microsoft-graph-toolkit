/**
 * -------------------------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.
 * See License in the project root for license information.
 * -------------------------------------------------------------------------------------------
 */

@import '../../../../../node_modules/office-ui-fabric-core/dist/sass/References';
@import '../../styles/shared-styles.scss';
@import './mgt-person.theme.scss';

$avatar-size-s: var(--avatar-size-s, var(--avatar-size, 24px));
$avatar-size: var(--avatar-size, var(--avatar-size, 40px));
$avatar-size-3-lines: var(--avatar-size-3-lines, var(--avatar-size, 56px));
$avatar-size-4-lines: var(--avatar-size-4-lines, var(--avatar-size, 72px));
$avatar-border: var(--avatar-border, 0);
$avatar-border-radius: var(--avatar-border-radius, 50%);
$avatar-cursor: var(--avatar-cursor, inherit);

$initials-background-color: set-var(initials-background-color, $theme-default, $person-theme);

$font-family: var(--font-family, var(--default-font-family));
$font-size: var(--font-size, #{$ms-font-size-m});
$font-weight: var(--font-weight, #{$ms-font-weight-semibold});
$text-transform: var(text-transform, none);

$line1-font-weight: var(--line1-font-weight, 600);
$line1-font-size: var(--line1-font-size, $font-size);
$line1-line-height: var(--line1-line-height, 20px);

$line2-font-size: var(--line2-font-size, var(--email-font-size, #{$ms-font-size-s}));
$line2-font-weight: var(--line2-font-weight, 400);
$line2-text-transform: var(--line2-text-transform, #{$text-transform});
$line2-line-height: var(--line2-line-height, 16px);

$line3-font-size: var(--line3-font-size, var(--email-font-size, #{$ms-font-size-s}));
$line3-font-weight: var(--line3-font-weight, 400);
$line3-text-transform: var(--line3-text-transform, #{$text-transform});
$line3-line-height: var(--line3-line-height, 16px);

$line4-font-size: var(--line4-font-size, var(--email-font-size, #{$ms-font-size-s}));
$line4-font-weight: var(--line4-font-weight, 400);
$line4-text-transform: var(--line4-text-transform, #{$text-transform});

$focus-offset: var(--focus-offset, 11px);

$details-spacing: --details-spacing;
$details-cta-spacing: --details-cta-spacing;

$user-presence-margin-offset: --user-presence-margin-offset;

$person-flex-direction: --person-flex-direction;
$presence-color-online: #13a10e;
$presence-color-dnd: #c50f1f;
$presence-color-away: #ffaa44;
$presence-color-invisible: #8a8886;
$presence-color-oof: #b4009e;
$background-color-initials: #e5e5e5;

.flyout {
  --mgt-flyout-border-radius: 2px;
}

:host([hidden]) {
  display: none;
}

:host {
  display: block;
  font-family: $font-family;
  :focus-visible {
    outline-offset: $focus-offset;
  }
}

:host .root {
  display: block;
}

:host svg,
mgt-person svg {
  width: $avatar-size;
  height: $avatar-size;
}

:host .person-root,
mgt-person .person-root {
  position: relative;
  display: flex;
  align-items: center;
  color: $color;
  flex-direction: var($person-flex-direction, row);

  &.clickable {
    cursor: pointer;
  }

  &.vertical {
    text-align: center;
    display: block;
  }

  .user-avatar {
    position: relative;
    width: $avatar-size;
    height: $avatar-size;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-shrink: 0;
    cursor: $avatar-cursor;

    .user-presence {
      position: absolute;
      left: calc(#{$avatar-size} * 0.72 - 2px);
      top: calc(#{$avatar-size} * 0.72 - 2px);
      width: calc(#{$avatar-size} * 0.28);
      height: calc(#{$avatar-size} * 0.28);
      border: 1px solid set-var(presence-background-color, $theme-default, $person-theme);
      border-radius: 50%;

      .presence-oof-offline-wrapper {
        background-color: set-var(presence-background-color, $theme-default, $person-theme);
        border-color: $presence-color-oof;

        .presence-oof-offline svg {
          color: $presence-color-oof;
          width: calc(#{$avatar-size} * 0.14);
          margin-inline-start: calc(#{$avatar-size} * 0.07 - 2px);
        }
      }

      &.presence-offline {
        background-color: $presence-color-invisible;
        border-color: set-var(presence-background-color, $theme-default, $person-theme);
      }

      &.presence-available {
        background-color: $presence-color-online;
        border-color: set-var(presence-background-color, $theme-default, $person-theme);
      }

      &.presence-oof-offline {
        background-color: set-var(presence-background-color, $theme-default, $person-theme);
        border-color: set-var(presence-background-color, $theme-default, $person-theme);
      }

      &.presence-oof-available {
        background-color: set-var(presence-background-color, $theme-default, $person-theme);
        border-color: set-var(presence-background-color, $theme-default, $person-theme);
      }

      &.presence-away {
        background-color: $presence-color-away;
        border-color: set-var(presence-background-color, $theme-default, $person-theme);
      }

      &.presence-dnd {
        background-color: $presence-color-dnd;
        border-color: set-var(presence-background-color, $theme-default, $person-theme);
      }

      &.presence-oof-dnd {
        background-color: set-var(presence-background-color, $theme-default, $person-theme);
        border-color: set-var(presence-background-color, $theme-default, $person-theme);
      }

      &.presence-busy {
        background-color: $presence-color-dnd;
        border-color: set-var(presence-background-color, $theme-default, $person-theme);
      }

      &.presence-oof-busy {
        background-color: set-var(presence-background-color, $theme-default, $person-theme);
        border-color: set-var(presence-background-color, $theme-default, $person-theme);
      }

      .presence-basic {
        width: calc(#{$avatar-size} * 0.28 - 4px);
        height: calc(#{$avatar-size} * 0.28 - 4px);
        border-style: solid;
        border-width: 2px;
        border-radius: 50%;
        margin: 0;
        font-size: calc(#{$avatar-size} * 0.14);
        vertical-align: top;
        display: flex;
        align-items: center;

        &.presence-offline {
          background-color: set-var(presence-background-color, $theme-default, $person-theme);
          border-color: $presence-color-invisible;
        }

        &.presence-available {
          background-color: $presence-color-online;
          border-color: $presence-color-online;
        }

        &.presence-oof-available {
          background-color: set-var(presence-background-color, $theme-default, $person-theme);
          border-color: $presence-color-online;
        }

        &.presence-away {
          background-color: $presence-color-away;
          border-color: $presence-color-away;
        }

        &.presence-dnd {
          background-color: $presence-color-dnd;
          border-color: $presence-color-dnd;
        }

        &.presence-oof-dnd {
          background-color: set-var(presence-background-color, $theme-default, $person-theme);
          border-color: $presence-color-dnd;
        }

        &.presence-busy {
          background-color: $presence-color-dnd;
          border-color: $presence-color-dnd;
        }

        &.presence-oof-busy {
          background-color: set-var(presence-background-color, $theme-default, $person-theme);
          border-color: $presence-color-dnd;
        }
      }

      .presence-offline::before {
        content: $ms-icon-code-StatusCircleErrorX;
        color: $presence-color-invisible;
        font-weight: bold;
        margin-inline-start: calc(#{$avatar-size} * 0.07 - 2px);
      }

      .presence-available::before {
        content: $ms-icon-code-SkypeCheck;
        color: set-var(presence-icon-color, $theme-default, $person-theme);
        margin-inline-start: calc(#{$avatar-size} * 0.07 - 2px);
      }

      .presence-oof-available::before {
        content: $ms-icon-code-SkypeCheck;
        color: $presence-color-online;
        margin-inline-start: calc(#{$avatar-size} * 0.07 - 2px);
      }

      .presence-away::before {
        content: $ms-icon-code-SkypeClock;
        color: set-var(presence-icon-color, $theme-default, $person-theme);
        margin-inline-start: calc(#{$avatar-size} * 0.07 - 2px);
      }

      .presence-dnd::before {
        content: $ms-icon-code-SkypeMinus;
        color: set-var(presence-icon-color, $theme-default, $person-theme);
        margin-inline-start: calc(#{$avatar-size} * 0.07 - 2px);
      }

      .presence-oof-dnd::before {
        content: $ms-icon-code-SkypeMinus;
        color: $presence-color-dnd;
        margin-inline-start: calc(#{$avatar-size} * 0.07 - 2px);
      }
    }

    &.initials {
      color: set-var(initials-color, $theme-default, $person-theme);
      border-radius: $avatar-border-radius;
      font-weight: 400;

      & .initials-text,
      & .contact-icon {
        cursor: $avatar-cursor;
        margin-top: -1px;
        font-size: calc(#{$avatar-size} * 0.4);
        svg {
          height: 30px;
          width: 30px;
        }
      }

      & .contact-icon {
        display: inline;
      }
    }

    &.small {
      width: $avatar-size-s;
      height: $avatar-size-s;

      & .initials-text,
      & .contact-icon {
        font-size: calc(#{$avatar-size-s} * 0.4);
      }
      .user-presence {
        left: calc(#{$avatar-size-s} - 8px);
        top: calc(#{$avatar-size-s} - 8px);
        width: 6px;
        height: 6px;

        &__people {
          left: calc(#{$avatar-size-s} - 6px);
          border: 0px;
          width: 6px;
          height: 6px;
        }

        .presence-basic {
          width: 2px;
          height: 2px;
          border-radius: 50%;
          padding: 0;
          font-size: calc(#{$avatar-size-s} * 0.14);

          & .presence-oof-offline svg {
            width: calc(#{$avatar-size-s} * 0.14);
            margin-inline-start: calc(#{$avatar-size-s} * 0.07 - 2px);
          }
        }

        .presence-offline::before,
        .presence-available::before,
        .presence-oof-available::before,
        .presence-away::before,
        .presence-oof-away::before,
        .presence-dnd::before,
        .presence-oof-dnd::before,
        .presence-oof-offline::before {
          margin-inline-start: calc(#{$avatar-size-s} * 0.07 - 2px);
        }
      }
    }

    &.threeLines {
      width: $avatar-size-3-lines;
      height: $avatar-size-3-lines;

      & .initials-text,
      & .contact-icon {
        font-size: calc(#{$avatar-size-3-lines} * 0.4);
      }
      .user-presence {
        left: calc(var(--avatar-size-3-lines, var(--avatar-size, 56px)) - 18px);
        top: calc(var(--avatar-size-3-lines, var(--avatar-size, 56px)) - 18px);
        width: 16px;
        height: 16px;

        .presence-basic {
          width: 12px;
          height: 12px;
          border-radius: 50%;
          padding: 0px;
          font-size: calc(#{$avatar-size-3-lines} * 0.14);

          & .presence-oof-offline svg {
            width: calc(#{$avatar-size-3-lines} * 0.14);
            margin-inline-start: calc(#{$avatar-size-3-lines} * 0.07 - 2px);
          }
        }

        .presence-offline::before,
        .presence-available::before,
        .presence-oof-available::before,
        .presence-away::before,
        .presence-oof-away::before,
        .presence-dnd::before,
        .presence-oof-dnd::before,
        .presence-oof-offline::before {
          margin-inline-start: calc(#{$avatar-size-3-lines} * 0.07 - var(--user-presence-margin-offset, 2px));
        }
      }
    }

    &.fourLines,
    &.vertical {
      width: $avatar-size-4-lines;
      height: $avatar-size-4-lines;

      & .initials-text,
      & .contact-icon {
        font-size: calc(#{$avatar-size-4-lines} * 0.4);
      }
      .user-presence {
        left: calc(var(--avatar-size-4-lines, var(--avatar-size, 72px)) - 22px);
        top: calc(var(--avatar-size-4-lines, var(--avatar-size, 72px)) - 22px);
        width: 20px;
        height: 20px;

        .presence-basic {
          width: 16px;
          height: 16px;
          border-radius: 50%;
          padding: 0px;
          font-size: calc(#{$avatar-size-4-lines} * 0.14);

          & .presence-oof-offline svg {
            width: calc(#{$avatar-size-4-lines} * 0.14);
            margin-inline-start: calc(#{$avatar-size-4-lines} * 0.07 - 2px);
          }
        }

        .presence-offline::before,
        .presence-available::before,
        .presence-oof-available::before,
        .presence-away::before,
        .presence-oof-away::before,
        .presence-dnd::before,
        .presence-oof-dnd::before,
        .presence-oof-offline::before {
          margin-inline-start: calc(#{$avatar-size-4-lines} * 0.07 - 2px);
        }
      }
    }

    &.vertical {
      margin-inline-start: auto;
    }

    .img-wrapper {
      height: 100%;
      width: 100%;
      display: flex;
      overflow: hidden;
      border: $avatar-border;
      border-radius: $avatar-border-radius;
      position: relative;

      img {
        position: absolute;
        display: block;
        inset: -100%;
        margin: auto;
        height: 100%;
        width: 100%;
        object-fit: cover;
        object-position: top;
        &:focus() {
          outline: none;
        }
      }
    }

    &.pinkRed10 {
      background-color: var($initials-background-color, $ms-color-sharedPinkRed10);
    }

    &.red20 {
      background-color: var($initials-background-color, $ms-color-sharedRed20);
    }

    &.red10 {
      background-color: var($initials-background-color, $ms-color-sharedRed10);
    }

    &.orange20 {
      background-color: var($initials-background-color, $ms-color-sharedOrange20);
    }

    &.orangeYellow20 {
      background-color: var($initials-background-color, $ms-color-sharedOrangeYellow20);
    }

    &.green10 {
      background-color: var($initials-background-color, $ms-color-sharedGreen10);
    }

    &.green20 {
      background-color: var($initials-background-color, $ms-color-sharedGreen20);
    }

    &.cyan20 {
      background-color: var($initials-background-color, $ms-color-sharedCyan20);
    }

    &.cyan30 {
      background-color: var($initials-background-color, $ms-color-sharedCyan30);
    }

    &.cyanBlue10 {
      background-color: var($initials-background-color, $ms-color-sharedCyanBlue10);
    }

    &.cyanBlue20 {
      background-color: var($initials-background-color, $ms-color-sharedCyanBlue20);
    }

    &.blue10 {
      background-color: var($initials-background-color, $ms-color-sharedBlue10);
    }

    &.blueMagenta30 {
      background-color: var($initials-background-color, $ms-color-sharedBlueMagenta30);
    }

    &.blueMagenta20 {
      background-color: var($initials-background-color, $ms-color-sharedBlueMagenta20);
    }

    &.magenta20 {
      background-color: var($initials-background-color, $ms-color-sharedMagenta20);
    }

    &.magenta10 {
      background-color: var($initials-background-color, $ms-color-sharedMagenta10);
    }

    &.magentaPink10 {
      background-color: var($initials-background-color, $ms-color-sharedMagentaPink10);
    }

    &.orange30 {
      background-color: var($initials-background-color, $ms-color-sharedOrange30);
    }

    &.gray30 {
      background-color: var($initials-background-color, $ms-color-sharedGray30);
    }

    &.lightGrey {
      background-color: $background-color-initials;
    }
  }

  .details {
    flex-shrink: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    line-height: 1.6;
    margin-inline-start: var($details-spacing, 12px);

    &.small {
      margin-inline-start: var($details-spacing, 8px);
      .line1 {
        font-weight: 400;
      }
    }

    &.threeLines {
      margin-inline-start: var($details-spacing, 14px);
      margin-bottom: var($details-cta-spacing, 0);
      .line1 {
        font-size: var($line1-font-size, 16px);
        line-height: var($line1-line-height, 22px);
      }
    }

    &.fourLines {
      margin-inline-start: var($details-spacing, 16px);
      height: 84px;
      .line1 {
        font-size: 20px;
        line-height: 26px;
        margin-bottom: 6px;
      }
    }

    &.vertical {
      text-align: center;
      align-items: center;
      margin-top: var($details-spacing, 7px);

      &.small {
        margin-top: var($details-spacing, 7px);
      }

      &.threelines {
        margin-top: var($details-spacing, 12px);
      }

      &.fourlines {
        margin-top: var($details-spacing, 10px);
      }

      &.threelines,
      &.fourlines {
        .line1 {
          margin-bottom: 0;
        }
      }
    }

    & > div {
      text-overflow: ellipsis;
      white-space: nowrap;
      overflow: hidden;
    }

    .line1 {
      color: set-var(line1-color, $theme-default, $person-theme);
      font-size: $line1-font-size;
      font-weight: $line1-font-weight;
      text-transform: $text-transform;
      line-height: $line1-line-height;
      width: fit-content;
    }

    .line2 {
      color: set-var(line2-color, $theme-default, $person-theme);
      font-size: $line2-font-size;
      font-weight: $line2-font-weight;
      text-transform: $line2-text-transform;
      line-height: $line2-line-height;
    }

    .line3 {
      color: set-var(line3-color, $theme-default, $person-theme);
      font-size: $line3-font-size;
      font-weight: $line3-font-weight;
      text-transform: $line3-text-transform;
      line-height: $line3-line-height;
    }

    .line4 {
      color: set-var(line4-color, $theme-default, $person-theme);
      font-size: $line4-font-size;
      font-weight: $line4-font-weight;
      text-transform: $line4-text-transform;
      line-height: 16px;
    }
  }
}

:host .avatar-icon,
mgt-person .avatar-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  line-height: 1;
  margin: 0;
  font-size: calc(#{$avatar-size} * 0.5);
  width: $avatar-size;
  height: $avatar-size;
  overflow: hidden;
  border-radius: $avatar-border-radius;

  &.small {
    font-size: $avatar-size-s;
    width: $avatar-size-s;
    height: $avatar-size-s;
  }
  &.threeLines {
    font-size: $avatar-size-3-lines;
    width: $avatar-size-3-lines;
    height: $avatar-size-3-lines;
  }
  &.fourLines {
    font-size: $avatar-size-4-lines;
    width: $avatar-size-4-lines;
    height: $avatar-size-4-lines;
  }
}

:host .vertical,
mgt-person .vertical {
  display: block;
}

[dir='rtl'] {
  .root {
    direction: rtl;
  }
  svg {
    direction: rtl;
  }
  .person-root {
    .user-avatar {
      position: relative;
    }

    &.small {
      & .initials-text,
      & .contact-icon {
        font-size: calc(#{$avatar-size-s} * 0.4);
      }
      .user-presence {
        left: calc(#{$avatar-size-s} - 8px);
        top: calc(#{$avatar-size-s} - 8px);
        width: 8px;
        height: 8px;

        &__people {
          border: 0px;
          width: 6px;
          height: 6px;
          left: calc(#{$avatar-size-s} - 6px);
        }

        .presence-basic {
          width: 4px;
          height: 4px;
          border-radius: 4px;
          padding: 0;

          & .presence-oof-offline svg {
            height: 0;
            width: 0;
          }
        }
      }
    }

    &.vertical {
      text-align: center;
      display: block;
      .user-avatar {
        display: block;
        margin-inline-start: auto;
      }
    }
  }
}

@media (forced-colors: active) and (prefers-color-scheme: dark) {
  :host svg,
  :host svg > path,
  mgt-person svg,
  mgt-person svg > path {
    fill: rgb(255, 255, 255) !important;
    fill-rule: nonzero !important;
    clip-rule: nonzero !important;
  }
}

@media (forced-colors: active) and (prefers-color-scheme: dark) {
  :host svg,
  :host svg > path,
  mgt-person svg,
  mgt-person svg > path {
    fill: rgb(0, 0, 0) !important;
    fill-rule: nonzero !important;
    clip-rule: nonzero !important;
  }
}
