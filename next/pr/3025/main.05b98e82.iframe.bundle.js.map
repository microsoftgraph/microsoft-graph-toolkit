{"version":3,"file":"main.05b98e82.iframe.bundle.js","mappings":";;;AA4BA;;AAXA;;;;;;;;;;;AAYA;;;;AAKA;;AAjBA;;AAGA;;AAGA;;AAGA;;AAGA;;AAGA;;;;;;;;;AARA;;;;;;;;;AAUA;;;;;;;;;AAUA;;;;;;;;;AAUA;;;;;;;;;AAUA;;;;;;;;;AAUA;;;;;;;;;AAUA;;;;;;;;;;;;;;;;;;;;;;;;;;;AA1CA;;;;;;;;;;;;;;;;;;;;AAPA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6MA;;;;;;;;AASA;;;;;;;;AASA;;AAtOA;;AAXA;;;;AAKA;;;;;;;;;;;;;AAcA;;AAnBA;;;;AAKA;;;;;AAMA;;;;;;;;;AAUA;;;AAIA;;;;;;AAOA;;;AAIA;;;;;;;;;AAUA;;;;AAKA;;;;;AAMA;;;;;;;AAQA;;;;;;;;;;;;;;;AA4BA;;;;;;;;;AAtFA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwBA;;;;;;;;;;;;;;;;;;;AArBA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+CA;;AA9CA;;AAXA;;;;AAKA;;;;;;;;;;;;;;;AAgBA;;;;;;;;;;;;;;;;;;;;AAqBA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgGA;;;;AAxIA;;AAGA;;;;AAKA;;;;AAKA;;;;AAKA;;;;;;AAOA;;;;;;;;;AAUA;;AAGA;;;;;;;;;AAUA;;;;;;;AAQA;;;AAIA;;AAGA;;AAGA;;AAGA;;AAGA;;AAGA;;;;AAKA;;;;;;;;;;AAWA;;;;AAKA;;;;;;;;;AA3FA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwDA;;;;;;;;;;;;;;;;;;;AA/CA;;;;;;;;;;;;;;;;AAiBA;;;;;;;;;;;;;;AAeA;;;;;;AA5BA;;;;;;AAhBA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqDA;;;;;;;;;;AAWA;;;;;;AAOA;;;;;;AAOA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqCA;;;;;;;;;;;;;;;;;;;;;;AApKA;;AATA;;AAXA;;AAGA;;AAGA;;AAGA;;;;;;;;;;;AAYA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuCA;;;;AAKA;;;;;;;;;;;;;;;;;AAkBA;;;;;;;;;;;;;;AAeA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgCA;;;;;;;;;AA3HA;;;;;;;;;AAUA;;;;;;;;;AAUA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkDA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAzBA;;AAzCA;;AAXA;;;;AAKA;;AALA;;AAGA;;AAGA;;;;;AAMA;;;;;AAMA;;AAGA;;;;;AAMA;;;;;;AAOA;;;;;;AAOA;;;;;;;;;AAlCA;;;;;;;;;;;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyBA;;;;;AAMA;;;;;AAMA;;AAnCA;;AAXA;;;;AAKA;;;;;;;;AASA;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4BA;;;;;;AAOA;;;;;;AAOA;;;;;;;;;;;;;;;;;;AAmBA;;;;;;AAOA;;;;;AAMA;;AAxFA;;AAGA;;AAGA;;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsCA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkIA;;;AAIA;;;AAIA;;;AAIA;;;AAIA;;;AAIA;;;AAIA;;;AAIA;;;AAIA;;;;;;;;;AAUA;;;;AAKA;;;;AAKA;;;;AAKA;;;;AAKA;;;;;AAMA;;;;;;;AAQA;;;;AAKA;;;;;AAMA;;;;;;;;AASA;;;;;AAMA;;;;;AAMA;;;;;;;;;;;;AAaA;;;;;;AAOA;;;;;;AAOA;;;;;;;;;;;;;AAgBA;;;;;;;;;AAjUA;;;;;;;;;;;;;;;AAgBA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAIA;;;;;;;;;;;;;AAhBA;;;;;;;;;;;;;AAcA;;AAdA;;;;;;;;;;AAHA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+CA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmCA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0DA;;;AA5JA;;;;AA2ZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AA5aA;;AAQA;;;;;;;;;AAUA;;;;;;;;;;;;;AAcA;;;;;;;;;;;AAYA;;;;;;;;;;;AAYA;;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8BA;;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuDA;;;AAIA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8BA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+HA;;AAGA;;;;AAKA;;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+GA;;;;;;;;AASA;;;;;;;;;;;;;;;;;;;;;;;;;;;AAtZA;;;;;;;;;;;;;;;;;;;;;;;;;;AA2BA;;;;;;;;;;;;;;;;;;;;;;;;;;AA2BA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAdA;;;;;;;;;;;;;;;;AAiBA;;;;;;;;;;;AAzEA;;;;;;;;;AAUA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4CA;;;;;;;AAQA;;;;;;;;;;;;;;AAhDA;;;;;;;;;;;;;;AAXA;;;;;;;;;;;AAYA;;;;AAKA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkDA;;;;;;;;;;;;;;;;;;;AAoBA;;;;;;;;;;;;;;;;AArFA;;;;;;;;;;;;;;;;AAiBA;;AAGA;;;;;;;;;AA3BA;;;;;;;;;;;;;;;;;;;;;;;;AAyBA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA;;;;;;;;;;AA1BA;;;;;;;;;;;;AAaA;;;;;;;;;;;;;;;AAgBA;;AA1BA;;AAXA;;AAGA;;AAGA;;AAGA;;AAGA;;;;;;;;AASA;;;;;;;;;AAdA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8BA;;;;;;;AAhCA;;;;;;;;;AAUA;;;;;;;;;AAUA;;AAdA;;AAXA;;;;;;AAOA;;;;;;;;;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkFA;;AA9EA;;AAXA;;;;;;;;;;;;;AAcA;;;;;;;;;;;AAYA;;AA1BA;;AAGA;;AAGA;;;;;;;;;AACA;;;;;;;;;;;;;;;;;;;;;;;AAwBA;;;;;;AAhBA;;;;;;AAXA;;;;;;;;;;;;;;;;;AAkBA;;;AArBA;;;AAIA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwFA;;;AAIA;;;AAIA;;;AAIA;;;AAIA;;;AAIA;;;AAIA;;;AAIA;;;AAIA;;;AAIA;;;AAIA;;;AAIA;;;;;;;;;;;;;AA9HA;;;;;;;;;;AAHA;;AAGA;;AAXA;;;;;;;;AASA;;AATA;;AAGA;;;;;;;;AASA;;;AAIA;;;;;;;;;AATA;;;;;;;;;;;;;;;;;;;;;AAsBA;;;;;;;;;AAtBA;;;;;;;;AASA;;AALA;;AAXA;;;;;;;;;;;;;;;;;;;;AAqBA;;;;;;;;;;;;;;;;;;AAmBA;;;;;;;;;;;;;;AAeA;;;;;;;;;;;;;;;;;;;;;;;;AAyBA;;;;AAKA;;;;;;;;;;;;;;AAeA;;;;;;;;;AA7FA;;;;;;;;;;;;;;;;;;;;;AAsBA;;;;;;;;;;;;;;;;;;;;;;;;;;;AAXA;;;;;;AAdA;;;;;;AAOA;;;;;;;;;AASA;;;;;;;;;;;;AARA;;;;;;;AAQA;;;;;;;AAQA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2DA;;;;;;;;;;;;;;;;;;;AAoBA;;;;;;;;;;;;;;;;AA3FA;;;;;;;;;;;;;;AAeA;;AApBA;;AAXA;;AAGA;;AAGA;;AAGA;;;;;;;;;AAFA;;;;;;;;;;;;;;;;AAOA;;;;;;;;;AALA;;;AALA;;;;;;;;;;;;;AAcA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqDA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+EA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsDA;;;;;;;;;;;;;;;;;;AAzLA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmNA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0DA;;;;;;;;;;;;;AAcA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwCA;;;;;;;;;ACnJA;AACA;;AAKA;;;AAIA;;AAGA;AAkBA;AAGA;;;AAqEA;AACA;AATA;AAWA;AACA;AACA;AACA;;AAIA;ACnKA;AACA;;AAEA;;;;;;;;;;;;;;;;;AA8QA;AA7LA;AACA;AACA;;AAEA;AACA;;AAEA;;AAGA;AAeA;AAGA;;AAaA;AACA;;AAKA;AAEA;;AAiBA;AACA;;AANA;;;;;AA4BA;;AAPA;AAyBA;AACA;AA4BA;AAGA;;AAIA;AAYA;;;;AAMA;AACA;AAGA;AClMA;AACA;AAoBA;AAGA;AACA;AAGA;;AC/SA;;ACqQA;AACA;AAsEA;;;AAVA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;AAqBA;AACA;;;;;AAKA;;AAEA;;AAGA;;;;AAiDA;;;;AAIA;;AAEA;;AAEA;;;AAIA;;AA0BA;AACA;;AAEA;AACA;;AAIA;;;;;;AAmBA;AACA;AACA;AAGA;;;;;AA+BA;AACA;AACA;AACA;;AAIA;;AAoCA;AACA;AACA;AACA;AACA;;;AAKA;;;;;;AAuBA;AACA;;AAEA;;;;;AASA;AACA;;;AAKA;AACA;;;;AAIA;;;AAMA;AAsEA;;;;;ACyGA;AACA;;;AA0cA;;AAznBA;;AAGA;;;;;;;AAuDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAGA;;;AAiBA;;AAEA;;AAMA;;;;;;AAWA;AACA;AACA;AACA;;AAEA;AA9BA;;AA4CA;;;;;AAKA;AACA;;AAEA;;;AAIA;;AA4DA;AACA;;;AAKA;;;;;;AAkBA;;AAEA;;AAKA;;;AAGA;AACA;;;;AAMA;;;AAgBA;;;AAGA;AACA;;AAIA;;;AAcA;AACA;;AAEA;;AAGA;;ACr4BA;;;;;ACqFA;AACA;AACA;AACA;AACA;AACA;AACA;;AA2BA;AACA;AACA;AAEA;;;;;ACuBA;AACA;;AAEA;;;AAGA;AACA;AA/EA;;AAwFA;AAKA;AAoBA;AAGA;;AC0OA;;AAKA;AACA;;AAEA;AACA;;AAMA;;;;AAiRA;AACA;AACA;;AAIA;;;AAkBA;AACA;AAGA;;AAoBA;AACA;AAEA;AAGA;;AAEA;;AAEA;AAEA;;;AAiBA;AACA;AACA;;AAEA;AACA;AAGA;AAKA;;AASA;AACA;AACA;;AAGA;AACA;AAGA;AAUA;;AASA;AACA;;AAEA;;AAGA;AACA;AAGA;;;;AAMA;AACA;AACA;AACA;AAGA;;;AAOA;AACA;AACA;;AAEA;;;;AAIA;AACA;;AAEA;AAGA;;AAEA;;;;AAOA;;AAEA;AACA;AACA;AACA;;;AAGA;;;;AAKA;;AA+DA;AACA;;AAIA;;AAIA;AACA;;AAIA;;AAIA;;AAJA;;;AAmBA;AAKA;;AASA;AACA;AACA;;;;;AAKA;AACA;AACA;AACA;;;AAGA;;AAEA;;;AAIA;;AAiFA;AACA;;AAEA;AACA;;;;;;;;;;;;AAcA;;AAEA;AACA;AACA;AAGA;;;AAGA;AACA;;AAEA;AACA;;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8DA;;;ACn7BA;;;;;;AAMA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;;AAEA;;AAEA;;;;;;;;;AAiTA;;;AAcA;;;;AASA;;;AAyDA;;AAnVA;;AAEA;AAOA;;AAEA;AACA;AACA;;AAEA;AAEA;;AAyBA;;AAGA;;;;;AAeA;AACA;AACA;;;;;AAMA;AAgDA;;;;AAKA;AAWA;;;;AAKA;;;AA8CA;;;;AAIA;;AAEA;AACA;;AAOA;AAEA;;AAIA;AACA;AACA;AACA;AAOA;AAIA;;AAcA;AACA;AACA;AACA;AAEA;;AChjBA;;;;ACoOA;AACA;;;;;AAKA;AACA;AAEA;;AAKA;;;AA6BA;AACA;AACA;AACA;AACA;AACA;AAEA;ACnKA;AACA;AACA;AACA;;AAEA;;;;;;;;AAoBA;;;ACsDA;;AAEA;AAEA;AAGA;;AAEA;;AAEA;;AAEA;;AAGA;;;;;AAMA;AACA;AACA;AACA;;;AAKA;;;;;;AAQA;AACA;AACA;AACA;AACA;;AAEA;AAEA;;AAGA;AACA;AACA;;AAKA;AAEA;AAEA;AACA;;AAEA;AAGA;;AAoCA;AACA;AACA;AAGA;;;;AAQA;AACA;AACA;AAEA;AAMA;AACA;AACA;;;AAIA;;;;;AAKA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AAGA;;AAEA;;AAGA;AA6BA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;;;AAGA;;AAEA;AAxOA;AACA;AAEA;;;;;AAeA;;AAIA;;;;;;ACsEA;;;AAcA;AA4CA;AAGA;;AAGA;AAaA;AAIA;;;AAiCA;AACA;;AAEA;AACA;AAEA;ACtSA;AACA;AACA;AACA;;AAGA;;;;;;;ACgBA;AACA;AACA;AACA;AACA;;AAEA;;;ACmWA;;AAEA;;AAEA;AA0IA;;;;;;;;;;;;;;;;;;;;;AAuBA;;;;;;;;;AAiOA;;AAlKA;AACA;AACA;AACA;;AAGA;AAyDA;;AAIA;;AAEA;AACA;AACA;AAGA;AAUA;;AAIA;;;AAGA;;AAEA;;;;;AAMA;AACA;;;AAGA;;;;AAqBA;AACA;AACA;AACA;;;;AAaA;AACA;AACA;AACA;AAGA;;;;AA2EA;;;;;;;AAOA;;;;;AAKA;;;;;;;AAOA;;;AAGA;;AAGA;;AAGA;;;;;AAOA;;;AAaA;;;;AAIA;;;;AAIA;;;AAGA;;;;AAKA;;;;AAcA;;;;;;AAMA;AACA;;;AAGA;;;;AAKA;;;AAaA;;;;AAIA;AACA;;;;;;AAMA;;;;;;;AAOA;;;AAGA;;AAGA;;AAGA;;;;AAQA;;;;AAcA;;;;;;AAOA;;;AAuCA;;;;AAIA;;AAEA;;;;AAKA;;;AAaA;;;;AAKA;AAEA;AACA;AAEA;;;AAIA;;;;AAKA;;ACvoCA;;ACAA;;;;;;;ACqWA;;;AAGA;AACA;;;;AAIA;;;;;;;AAOA;;;;;AAKA;;;;;;;;;AASA;;;;;AAKA;;;;;AAKA;AACA;AACA;AACA;;;;AAIA;;AAGA;;;;AAmBA;;;;;;AASA;AAkCA;AACA;;AAEA;;AAEA;;;AAGA;AACA;AACA;;;;;;AAMA;;;AAIA;;;;;AAkBA;;AAEA;;;;;;AAMA;AACA;;AAEA;;;AAGA;AACA;;;;;;;AAQA;ACzDA;AACA;AACA;AAeA;AACA;;;;;;;;AAQA;AACA;AACA;AACA;;AAEA;;;AAMA;AACA;AACA;;;;AAMA;;AASA;AAcA;AAGA;;AAeA;;;;;AAKA;;AAEA;AAGA;AAqBA;AAEA;;;;AC7RA;AAEA;;AAqDA;AAEA;AACA;AAEA;;;AAKA;AAoBA;AAGA;AAMA;AAGA;AAMA;AAGA;;AAIA;;AAGA;;;;;;ACxVA;;AAiFA;;AC5JA;ACuMA;AAGA;AACA;AACA;;AAGA;AAgBA;AAEA;AAGA;AACA;;AAGA;AAwBA;AACA;AAEA;AAGA;AACA;AACA;;AAEA;AACA;;;;AAIA;AACA;;AAEA;;;AAIA;;ACtRA;ACoGA;AAEA;;AAIA;;AAGA;AAgBA;AAHA;;AASA;;AAGA;AAYA;;AAEA;AACA;AACA;;AAEA;;AAGA;;AC3JA;;ACmIA;;AATA;AAuCA;AAEA;AAGA;AACA;;AAGA;;;AAcA;AAGA;;;;;AAKA;AACA;;AAEA;;;;AAIA;;;;AAKA;;;AA8CA;;;AAIA;AAGA;;;;;AAKA;AACA;AACA;;;;;AAKA;;;;;AAzBA;;AA+CA;;;AAIA;AAGA;;;;AAIA;AACA;AACA;;;;;;AAQA;;;;;AAgBA;AACA;AACA;;;;;AAMA;;;AAcA;AAGA;;;;;AAKA;AACA;AACA;;;;;AAMA;;AAuBA;;AAEA;;AAGA;;AC1YA;ACwJA;AACA;;AAGA;AAaA;AACA;;AAGA;;AA2CA;;AAKA;;AAEA;AACA;;AAGA;;AAMA;;;AAGA;;;;AAKA;;AAoBA;;AAKA;;AAIA;;;AAGA;;;;AAKA;;;AAsBA;;AAEA;;;;;AAKA;;;AAGA;;;;AAOA;;AAIA;;;AAGA;;;;AAKA;;;AAqBA;;AAEA;;;AAIA;;AAGA;AACA;;AAOA;;AAIA;;;AAGA;;;;AAKA;;AAkBA;;AAKA;;AAIA;;;AAGA;;;;AAKA;;AAkBA;;AAKA;;AAIA;;;AAGA;;;;AAKA;;;;;;AAoBA;;;AAGA;;;;;AAZA;;;;;ACmBA;AACA;AACA;;;AAGA;;;;;AAUA;AACA;AACA;;;AAGA;AAaA;AAEA;AAeA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;;;AAoDA;AACA;AACA;AACA;;;AAIA;AAgBA;AAEA;;AAqBA;AACA;AACA;;AAOA;;AAIA;AACA;AACA;;AAOA;;AAGA;AACA;AACA;;AAKA;;AAKA;AACA;AACA;;AAKA;;AAEA;;AAGA;;AAYA;;AAEA;;AAEA;;AAGA;;;;AAoBA;;AASA;;;;AAIA;AACA;;;AAIA;;AAyBA;AACA;;AAEA;AACA;;AAEA;;AAEA;;;AAOA;AACA;;;AAMA;;;;AAUA;;;AAGA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAGA;;;AAcA;;;;AAIA;;AAEA;;;AAGA;;AAKA;;AAWA;;AAMA;;AAEA;AACA;;AAGA;AAyBA;AAJA;AALA;AAWA;;;;;AAsBA;AACA;AACA;AAIA;;;AAGA;AACA;AACA;AACA;;;AAGA;;ACn6BA;ACuhBA;AACA;AAEA;;AAqBA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AAoDA;AAEA;AAgCA;AACA;AACA;AACA;;AAaA;AACA;AACA;;AAEA;;AASA;;AA6GA;AACA;AACA;;AAEA;;AAGA;;AAeA;AACA;;AAGA;AA6CA;AAGA;AAIA;AAOA;AAMA;AAGA;AAIA;AAKA;AASA;AAGA;AAIA;AAKA;AASA;AAGA;AAIA;AAKA;AAQA;AACA;;AAGA;;AAmBA;AACA;AAeA;AACA;AACA;AAEA;;;;AAiBA;AACA;AACA;AACA;AAGA;;;AC1yBA;AACA;;AAGA;AAGA;;AAEA;;;;AAIA;;AAGA;;AAaA;;AASA;;;;;;ACuFA;;;;;;AAOA;;;AAKA;;;AAMA;;;;;;;AAUA;;;;;AAQA;;;;;AAQA;;;;;AAQA;;;;AAQA;;;;AAOA;;;;;;AASA;;;;AAOA;;;;;AAQA;;;;AAOA;;;;;;AASA;;AAGA;;AAIA;;;;AAOA;;;;AAOA;;;;AAOA;;;;AAOA;;;;AAOA;;;;;AAQA;;;;AAOA;;;;AAOA;;;;AAOA;;;;AAOA;;;;AAOA;;;;AAOA;;;;;;;;;;;;;AAgBA;;;;AAOA;;;;;;AASA;;;;AAMA;;;;AAOA;;;;;;AASA;;;;;;AASA;;;;AAOA;;;;;AAQA;;;;;AAQA;;;;;;AASA;;;;;AAQA;;AAGA;;AAIA;;;;AAOA;;;;AAOA;;;AAMA;;;AAMA;;;;AAOA;;AAGA;AAGA;;AAGA;;AAIA;;AAGA;AAGA;AAEA;AACA;AAGA;;;;;AAOA;;;;AAOA;;;;AAOA;;;;AAOA;;;;AAOA;;;;AAOA;;;AAMA;;;AAMA;;;AAMA;;;;AAOA;;;AAMA;;;AAMA;;;AAMA;;;AAMA;;;AAMA;;;AAKA;;AClmBA;;AArIA;AA2DA;AAGA","sources":["webpack://root/","webpack://root/src/components/mgt-people/mgt-people.ts","webpack://root/src/components/mgt-agenda/mgt-agenda.ts","webpack://root/src/components/mgt-get/mgt-get.ts","webpack://root/src/components/mgt-login/strings.ts","webpack://root/src/components/mgt-login/mgt-login.ts","webpack://root/src/components/mgt-people-picker/mgt-people-picker.ts","webpack://root/src/components/mgt-planner/strings.ts","webpack://root/src/components/sub-components/mgt-dot-options/mgt-dot-options.ts","webpack://root/src/components/sub-components/mgt-arrow-options/mgt-arrow-options.ts","webpack://root/src/components/mgt-planner/mgt-planner.ts","webpack://root/src/components/mgt-teams-channel-picker/mgt-teams-channel-picker.ts","webpack://root/src/components/mgt-todo/strings.ts","webpack://root/src/components/mgt-picker/mgt-picker.ts","webpack://root/src/components/mgt-tasks-base/mgt-tasks-base.ts","webpack://root/src/components/mgt-todo/mgt-todo.ts","webpack://root/src/components/mgt-taxonomy-picker/mgt-taxonomy-picker.ts","webpack://root/src/components/mgt-theme-toggle/mgt-theme-toggle.ts","webpack://root/src/components/mgt-search-box/mgt-search-box.ts","webpack://root/src/components/mgt-search-results/mgt-search-results.ts","webpack://root/src/components/mgt-file-list/strings.ts","webpack://root/src/components/mgt-file-list/mgt-file-upload/strings.ts","webpack://root/src/components/mgt-file-list/mgt-file-upload/mgt-file-upload.ts","webpack://root/src/components/mgt-file-list/mgt-file-list.ts","webpack://root/src/components/mgt-file/mgt-file.ts","webpack://root/src/components/BasePersonCardSection.ts","webpack://root/src/components/mgt-contact/strings.ts","webpack://root/src/components/mgt-contact/mgt-contact.ts","webpack://root/src/components/mgt-messages/strings.ts","webpack://root/src/components/mgt-messages/mgt-messages.ts","webpack://root/src/components/mgt-organization/strings.ts","webpack://root/src/components/mgt-organization/mgt-organization.ts","webpack://root/src/components/mgt-profile/strings.ts","webpack://root/src/components/mgt-profile/mgt-profile.ts","webpack://root/src/components/mgt-person-card/mgt-person-card.ts","webpack://root/src/components/mgt-person/mgt-person-types.ts","webpack://root/src/components/mgt-person/mgt-person.ts","webpack://root/src/components/sub-components/mgt-flyout/mgt-flyout.ts","webpack://root/src/utils/SvgHelper.ts","webpack://root/src/components/templatedTaskComponent.ts"],"sourcesContent":[null,"/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport * as MicrosoftGraph from '@microsoft/microsoft-graph-types';\nimport { html, TemplateResult } from 'lit';\nimport { property, state } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { getPeople, getPeopleFromResource } from '../../graph/graph.people';\nimport { getUsersPresenceByPeople } from '../../graph/graph.presence';\nimport { findGroupMembers, getUsersForPeopleQueries, getUsersForUserIds } from '../../graph/graph.user';\nimport { IDynamicPerson } from '../../graph/types';\nimport { Providers, ProviderState, MgtTemplatedTaskComponent, mgtHtml } from '@microsoft/mgt-element';\nimport '../../styles/style-helper';\nimport { type PersonCardInteraction, personCardConverter } from './../PersonCardInteraction';\n\nimport { styles } from './mgt-people-css';\nimport { MgtPerson, registerMgtPersonComponent } from '../mgt-person/mgt-person';\nimport { registerComponent } from '@microsoft/mgt-element';\n\n/**\n * web component to display a group of people or contacts by using their photos or initials.\n *\n * @export\n * @class MgtPeople\n * @extends {MgtTemplatedTaskComponent}\n *\n * @cssprop --people-list-margin- {String} the margin around the list of people. Default is 8px 4px 8px 8px.\n * @cssprop --people-avatar-gap - {String} the gap between the people in the list. Default is 4px.\n * @cssprop --people-overflow-font-color - {Color} the color of the overflow text.\n * @cssprop --people-overflow-font-size - {String} the text color of the overflow text. Default is 12px.\n * @cssprop --people-overflow-font-weight - {String} the font weight of the overflow text. Default is 400.\n * @cssprop --people-person-avatar-size - {Length} the size of the avatar. Default is 24px.\n */\n\nexport const registerMgtPeopleComponent = () => {\n  registerMgtPersonComponent();\n  registerComponent('people', MgtPeople);\n};\n\nexport class MgtPeople extends MgtTemplatedTaskComponent {\n  /**\n   * Array of styles to apply to the element. The styles should be defined\n   * using the `css` tag function.\n   */\n  static get styles() {\n    return styles;\n  }\n\n  /**\n   * determines if agenda events come from specific group\n   *\n   * @type {string}\n   */\n  @property({\n    attribute: 'group-id',\n    type: String\n  })\n  public groupId: string;\n\n  /**\n   * user id array\n   *\n   * @memberof MgtPeople\n   */\n  @property({\n    attribute: 'user-ids',\n    converter: (value, _type) => {\n      return value.split(',').map(v => v.trim());\n    }\n  })\n  public userIds: string[];\n\n  /**\n   * containing array of people used in the component.\n   *\n   * @type {IDynamicPerson[]}\n   */\n  @property({\n    attribute: 'people',\n    type: Object\n  })\n  public people: IDynamicPerson[];\n\n  /**\n   * allows developer to define queries of people for component\n   *\n   * @type {string[]}\n   */\n\n  @property({\n    attribute: 'people-queries',\n    converter: (value, _type) => {\n      return value.split(',').map(v => v.trim());\n    }\n  })\n  public peopleQueries: string[];\n\n  /**\n   * developer determined max people shown in component\n   *\n   * @type {number}\n   */\n  @property({\n    attribute: 'show-max',\n    type: Number\n  })\n  public showMax: number;\n\n  /**\n   * determines if person component renders presence\n   *\n   * @type {boolean}\n   */\n  @property({\n    attribute: 'show-presence',\n    type: Boolean\n  })\n  public showPresence: boolean;\n\n  /**\n   * Sets how the person-card is invoked\n   * Valid options are: 'none', 'hover', or 'click'\n   * Set to 'none' to not show the card\n   *\n   * @type {PersonCardInteraction}\n   * @memberof MgtPerson\n   */\n  @property({\n    attribute: 'person-card',\n    converter: (value, _type) => personCardConverter(value, 'hover')\n  })\n  public personCardInteraction: PersonCardInteraction = 'hover';\n\n  /**\n   * The resource to get\n   *\n   * @type {string}\n   * @memberof MgtPeople\n   */\n  @property({\n    attribute: 'resource',\n    type: String\n  })\n  public resource: string;\n\n  /**\n   * Api version to use for request\n   *\n   * @type {string}\n   * @memberof MgtPeople\n   */\n  @property({\n    attribute: 'version',\n    type: String\n  })\n  public version = 'v1.0';\n\n  /**\n   * The scopes to request\n   *\n   * @type {string[]}\n   * @memberof MgtPeople\n   */\n  @property({\n    attribute: 'scopes',\n    converter: value => {\n      return value ? value.toLowerCase().split(',') : null;\n    },\n    reflect: true\n  })\n  public scopes: string[] = [];\n\n  /**\n   * Fallback when no user is found\n   *\n   * @type {IDynamicPerson[]}\n   */\n  @property({\n    attribute: 'fallback-details',\n    type: Array\n  })\n  public fallbackDetails: IDynamicPerson[];\n\n  /**\n   * Get the scopes required for people\n   *\n   * @static\n   * @return {*}  {string[]}\n   * @memberof MgtPeople\n   */\n  public static get requiredScopes(): string[] {\n    return [\n      ...new Set([\n        'user.read.all',\n        'people.read',\n        'user.readbasic.all',\n        'presence.read.all',\n        'contacts.read',\n        ...MgtPerson.requiredScopes\n      ])\n    ];\n  }\n\n  private _peoplePresence: Record<string, MicrosoftGraph.Presence> = {};\n  @state() private _arrowKeyLocation = -1;\n\n  constructor() {\n    super();\n    this.showMax = 3;\n  }\n\n  /**\n   * Clears the state of the component\n   *\n   * @protected\n   * @memberof MgtPeople\n   */\n  protected clearState(): void {\n    this.people = null;\n  }\n\n  protected args(): unknown[] {\n    return [\n      this.providerState,\n      this.groupId,\n      this.userIds,\n      this.peopleQueries,\n      this.showMax,\n      this.resource,\n      this.version,\n      this.fallbackDetails\n    ];\n  }\n\n  /**\n   * Invoked on each update to perform rendering tasks. This method must return\n   * a lit-html TemplateResult. Setting properties inside this method will *not*\n   * trigger the element to update.\n   */\n  protected renderContent = () => {\n    if (!this.people || this.people.length === 0) {\n      return this.renderNoData();\n    }\n\n    return this.renderTemplate('default', { people: this.people, max: this.showMax }) || this.renderPeople();\n  };\n\n  /**\n   * Render the loading state.\n   *\n   * @protected\n   * @returns\n   * @memberof MgtPeople\n   */\n  protected renderLoading = () => {\n    return this.renderTemplate('loading', null) || html``;\n  };\n\n  /**\n   * Render the list of people.\n   *\n   * @protected\n   * @param {*} people\n   * @returns {TemplateResult}\n   * @memberof MgtPeople\n   */\n  protected renderPeople(): TemplateResult {\n    const maxPeople = this.people.slice(0, this.showMax).filter(pple => pple);\n    return html`\n      <ul\n        tabindex=\"0\"\n        class=\"people-list\"\n        aria-label=\"people\"\n        @keydown=${this.handleKeyDown}>\n        ${repeat(\n          maxPeople,\n          p => (p.id ? p.id : p.displayName),\n          p => html`\n            <li tabindex=\"-1\" class=\"people-person\">\n              ${this.renderPerson(p)}\n            </li>\n          `\n        )}\n        ${this.people.length > this.showMax ? this.renderOverflow() : null}\n      </ul>\n    `;\n  }\n\n  /**\n   * Render the overflow content to represent any extra people, beyond the max.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtPeople\n   */\n  protected renderOverflow(): TemplateResult {\n    const extra = this.people.length - this.showMax;\n    return (\n      this.renderTemplate('overflow', {\n        extra,\n        max: this.showMax,\n        people: this.people\n      }) ||\n      html`\n        <li tabindex=\"-1\" aria-label=\"and ${extra} more attendees\" class=\"overflow\"><span>+${extra}</span></li>\n      `\n    );\n  }\n\n  /**\n   * Handles the keypresses on a keyboard for the listed people.\n   *\n   * @param event is a KeyboardEvent.\n   */\n  protected handleKeyDown = (event: KeyboardEvent) => {\n    const peopleContainer: HTMLElement = this.shadowRoot.querySelector('.people-list');\n    let person: HTMLElement;\n    const peopleElements: HTMLCollection = peopleContainer?.children;\n    // Default all tabindex values in li nodes to -1\n    for (const element of peopleElements) {\n      const el: HTMLElement = element as HTMLElement;\n      el.setAttribute('tabindex', '-1');\n      el.blur();\n    }\n\n    const childElementCount = peopleContainer.childElementCount;\n    const keyName = event.key;\n    if (keyName === 'ArrowRight') {\n      this._arrowKeyLocation = (this._arrowKeyLocation + 1 + childElementCount) % childElementCount;\n    } else if (keyName === 'ArrowLeft') {\n      this._arrowKeyLocation = (this._arrowKeyLocation - 1 + childElementCount) % childElementCount;\n    } else if (keyName === 'Tab' || keyName === 'Escape') {\n      this._arrowKeyLocation = -1;\n      peopleContainer.blur();\n    } else if (['Enter', 'space', ' '].includes(keyName)) {\n      if (this.personCardInteraction !== 'none') {\n        const personEl = peopleElements[this._arrowKeyLocation] as HTMLElement;\n        const mgtPerson = personEl.querySelector<MgtPerson>('mgt-person');\n        if (mgtPerson) {\n          mgtPerson.showPersonCard();\n        }\n      }\n    }\n\n    if (this._arrowKeyLocation > -1) {\n      person = peopleElements[this._arrowKeyLocation] as HTMLElement;\n      person.setAttribute('tabindex', '1');\n      person.focus();\n    }\n  };\n\n  /**\n   * Render an individual person.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtPeople\n   */\n  protected renderPerson(person: MicrosoftGraph.User | MicrosoftGraph.Person | MicrosoftGraph.Contact): TemplateResult {\n    let personPresence: MicrosoftGraph.Presence = {\n      // set up default presence\n      activity: 'Offline',\n      availability: 'Offline',\n      id: null\n    };\n    if (this.showPresence && this._peoplePresence) {\n      personPresence = this._peoplePresence[person.id];\n    }\n    const avatarSize = 'small';\n    return (\n      this.renderTemplate('person', { person }, person.id) ||\n      // set image to @ to flag the mgt-person component to\n      // query the image from the graph\n      mgtHtml`\n        <mgt-person\n          class=\"people-person\"\n          .personDetails=${person}\n          .fetchImage=${true}\n          .avatarSize=${avatarSize}\n          .personCardInteraction=${this.personCardInteraction}\n          .showPresence=${this.showPresence}\n          .personPresence=${personPresence}\n          .usage=${'people'}\n        ></mgt-person>\n      `\n    );\n  }\n\n  /**\n   * render the no data state.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtPeople\n   */\n  protected renderNoData(): TemplateResult {\n    return this.renderTemplate('no-data', null) || html``;\n  }\n\n  /**\n   * load state into the component.\n   *\n   * @protected\n   * @returns\n   * @memberof MgtPeople\n   */\n  protected async loadState() {\n    if (!this.people) {\n      const provider = Providers.globalProvider;\n\n      if (provider && provider.state === ProviderState.SignedIn) {\n        const graph = provider.graph.forComponent(this);\n\n        // populate people\n        if (this.groupId) {\n          this.people = await findGroupMembers(graph, null, this.groupId, this.showMax, 'person');\n        } else if (this.userIds) {\n          this.people = await getUsersForUserIds(graph, this.userIds, '', '', this.fallbackDetails);\n        } else if (this.peopleQueries) {\n          this.people = await getUsersForPeopleQueries(graph, this.peopleQueries, this.fallbackDetails);\n        } else if (this.resource) {\n          this.people = await getPeopleFromResource(graph, this.version, this.resource, this.scopes);\n        } else {\n          this.people = await getPeople(graph);\n        }\n\n        // populate presence for people\n        if (this.showPresence) {\n          this._peoplePresence = await getUsersPresenceByPeople(graph, this.people);\n        } else {\n          this._peoplePresence = null;\n        }\n      }\n    }\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport * as MicrosoftGraph from '@microsoft/microsoft-graph-types';\nimport { html, TemplateResult } from 'lit';\nimport { property } from 'lit/decorators.js';\nimport { Providers, ProviderState, mgtHtml, MgtTemplatedTaskComponent } from '@microsoft/mgt-element';\nimport '../../styles/style-helper';\nimport '../mgt-person/mgt-person';\nimport { styles } from './mgt-agenda-css';\nimport { getEventsPageIterator, getEventsQueryPageIterator } from './mgt-agenda.graph';\nimport { SvgIcon, getSvg } from '../../utils/SvgHelper';\nimport { MgtPeople, registerMgtPeopleComponent } from '../mgt-people/mgt-people';\nimport { registerFluentComponents } from '../../utils/FluentComponents';\nimport { fluentCard } from '@fluentui/web-components';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { registerComponent } from '@microsoft/mgt-element';\n\n/**\n * Web Component which represents events in a user or group calendar.\n *\n * @export\n * @class MgtAgenda\n * @extends {MgtTemplatedComponent}\n *\n * @fires {CustomEvent<MicrosoftGraph.Event>} eventClick - Fired when user click an event\n *\n * @cssprop --event-box-shadow - {String} Event box shadow color and size\n * @cssprop --event-row-gap - {String} The size of the gap between two event elements\n * @cssprop --event-padding - {String} Event padding\n * @cssprop --event-background-color - {Color} Event background color\n * @cssprop --event-border - {String} Event border style\n * @cssprop --agenda-header-margin - {String} Agenda header margin size\n * @cssprop --agenda-header-font-size - {Length} Agenda header font size\n * @cssprop --agenda-header-color - {Color} Agenda header color\n * @cssprop --event-time-font-size - {Length} Event time font size\n * @cssprop --event-time-color - {Color} Event time color\n * @cssprop --event-subject-font-size - {Length} Event subject font size\n * @cssprop --event-subject-color - {Color} Event subject color\n * @cssprop --event-location-font-size - {Length} Event location font size\n * @cssprop --event-location-color - {Color} Event location color\n * @cssprop --event-attendees-color - {Color} Event attendees color\n */\n\nexport const registerMgtAgendaComponent = () => {\n  registerFluentComponents(fluentCard);\n  // register dependent components\n  registerMgtPeopleComponent();\n  // register self\n  registerComponent('agenda', MgtAgenda);\n};\n\nexport class MgtAgenda extends MgtTemplatedTaskComponent {\n  /**\n   * Array of styles to apply to the element. The styles should be defined\n   * using the `css` tag function.\n   */\n  static get styles() {\n    return styles;\n  }\n\n  /**\n   * stores current date for initial calender selection in events.\n   *\n   * @type {string}\n   */\n  @property({\n    attribute: 'date',\n    type: String\n  })\n  public date: string;\n\n  /**\n   * determines if agenda events come from specific group\n   *\n   * @type {string}\n   */\n  @property({\n    attribute: 'group-id',\n    type: String\n  })\n  public groupId: string;\n\n  /**\n   * sets number of days until end date, 3 is the default\n   *\n   * @type {number}\n   */\n  @property({\n    attribute: 'days',\n    type: Number\n  })\n  public days = 3;\n\n  /**\n   * allows developer to specify a different graph query that retrieves events\n   *\n   * @type {string}\n   */\n  @property({\n    attribute: 'event-query',\n    type: String\n  })\n  public eventQuery: string;\n\n  /**\n   * array containing events from user agenda.\n   *\n   * @type {MicrosoftGraph.Event[]}\n   */\n  @property({\n    attribute: 'events',\n    type: Array,\n    hasChanged: (newVal: [], oldVal: []) => {\n      return newVal !== oldVal;\n    }\n  })\n  public events: MicrosoftGraph.Event[];\n\n  /**\n   * allows developer to define max number of events shown\n   *\n   * @type {number}\n   */\n  @property({\n    attribute: 'show-max',\n    type: Number\n  })\n  public showMax: number;\n\n  /**\n   * allows developer to define agenda to group events by day.\n   *\n   * @type {boolean}\n   */\n  @property({\n    attribute: 'group-by-day',\n    type: Boolean\n  })\n  public groupByDay: boolean;\n\n  /**\n   * allows developer to specify preferred timezone that should be used for\n   * rendering events retrieved from Graph, eg. `America/Los_Angeles`.\n   * By default events are rendered using the current timezone of the\n   * device being used.\n   *\n   * @type {string}\n   */\n  @property({\n    attribute: 'preferred-timezone',\n    type: String\n  })\n  public preferredTimezone: string;\n\n  /**\n   * Get the scopes required for agenda\n   *\n   * @static\n   * @return {*}  {string[]}\n   * @memberof MgtAgenda\n   */\n  public static get requiredScopes(): string[] {\n    return [...new Set(['calendars.read', ...MgtPeople.requiredScopes])];\n  }\n\n  /**\n   * determines width available for agenda component.\n   *\n   * @type {boolean}\n   */\n  @property({ attribute: false }) private _isNarrow: boolean;\n\n  /**\n   * Determines width available if resize is necessary, adds onResize event listener to window\n   *\n   * @memberof MgtAgenda\n   */\n  public connectedCallback() {\n    this._isNarrow = this.offsetWidth < 600;\n    super.connectedCallback();\n    window.addEventListener('resize', this.onResize);\n  }\n\n  /**\n   * Removes onResize event listener from window\n   *\n   * @memberof MgtAgenda\n   */\n  public disconnectedCallback() {\n    window.removeEventListener('resize', this.onResize);\n    super.disconnectedCallback();\n  }\n\n  /**\n   * Invoked on each update to perform rendering tasks. This method must return a lit-html TemplateResult.\n   * Setting properties inside this method will not trigger the element to update\n   *\n   * @returns\n   * @memberof MgtAgenda\n   */\n  public renderContent = (): TemplateResult => {\n    // No data\n    if (!this.events || this.events.length === 0) {\n      return this.renderNoData();\n    }\n\n    // Prep data\n    const events = this.showMax && this.showMax > 0 ? this.events.slice(0, this.showMax) : this.events;\n\n    // Default template\n    const renderedTemplate = this.renderTemplate('default', { events });\n    if (renderedTemplate) {\n      return renderedTemplate;\n    }\n\n    const agendaClasses = {\n      agenda: true,\n      grouped: this.groupByDay\n    };\n\n    // Render list\n    return html`\n      <div dir=${this.direction} class=\"${classMap(agendaClasses)}\">\n        ${this.groupByDay ? this.renderGroups(events) : this.renderEvents(events)}\n      </div>\n    `;\n  };\n\n  /**\n   * Reloads the component with its current settings and potential new data\n   *\n   * @memberof MgtAgenda\n   */\n  public async reload() {\n    this.events = await this.loadEvents();\n  }\n\n  /**\n   * Render the loading state\n   *\n   * @protected\n   * @returns\n   * @memberof MgtAgenda\n   */\n  protected renderLoading = (): TemplateResult => {\n    return (\n      this.renderTemplate('loading', null) ||\n      html`\n        <fluent-card class=\"event event-loading\">\n          <div class=\"event-time-container\">\n            <div class=\"event-time-loading loading-element\"></div>\n          </div>\n          <div class=\"event-details-container\">\n            <div class=\"event-subject-loading loading-element\"></div>\n            <div class=\"event-location-container\">\n              <div class=\"event-location-icon-loading loading-element\"></div>\n              <div class=\"event-location-loading loading-element\"></div>\n            </div>\n            <div class=\"event-location-container\">\n              <div class=\"event-attendee-loading loading-element\"></div>\n              <div class=\"event-attendee-loading loading-element\"></div>\n              <div class=\"event-attendee-loading loading-element\"></div>\n            </div>\n          </div>\n        </fluent-card>`\n    );\n  };\n\n  /**\n   * Clears state of the component\n   *\n   * @protected\n   * @memberof MgtAgenda\n   */\n  protected clearState(): void {\n    this.events = null;\n  }\n\n  /**\n   * Render the no-data state.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtAgenda\n   */\n  protected renderNoData(): TemplateResult {\n    return this.renderTemplate('no-data', null) || html``;\n  }\n\n  /**\n   * Render an individual Event.\n   *\n   * @protected\n   * @param {MicrosoftGraph.Event} event\n   * @returns\n   * @memberof MgtAgenda\n   */\n  protected renderEvent(event: MicrosoftGraph.Event): TemplateResult {\n    // Update narrow state\n    this._isNarrow = this.offsetWidth < 600;\n\n    const eventClasses = {\n      narrow: this._isNarrow\n    };\n\n    return html`\n      <fluent-card class=\"${classMap({ event: true, ...eventClasses })}\">\n        <div class=\"${classMap({ 'event-time-container': true, ...eventClasses })}\">\n          <div class=\"event-time\" aria-label=\"${this.getEventTimeString(event)}\">${this.getEventTimeString(event)}</div>\n        </div>\n        <div class=\"${classMap({ 'event-details-container': true, ...eventClasses })}\">\n          ${this.renderTitle(event)} ${this.renderLocation(event)} ${this.renderAttendees(event)}\n        </div>\n        <div class=\"event-other-container\">${this.renderOther(event)}</div>\n      </fluent-card>\n    `;\n  }\n\n  /**\n   * Render the header for a group.\n   * Only relevant for grouped Events.\n   *\n   * @protected\n   * @param {Date} date\n   * @returns\n   * @memberof MgtAgenda\n   */\n  protected renderHeader(header: string): TemplateResult {\n    return (\n      this.renderTemplate('header', { header }, 'header-' + header) ||\n      html`\n        <div class=\"header\" aria-label=\"${header}\">${header}</div>\n      `\n    );\n  }\n\n  /**\n   * Render the title field of an Event\n   *\n   * @protected\n   * @param {MicrosoftGraph.Event} event\n   * @returns\n   * @memberof MgtAgenda\n   */\n  protected renderTitle(event: MicrosoftGraph.Event): TemplateResult {\n    return html`\n      <div\n        aria-label=${event.subject}\n        class=\"${classMap({\n          'event-subject': true,\n          narrow: this._isNarrow\n        })}\"\n      >\n        ${event.subject}\n      </div>`;\n  }\n\n  /**\n   * Render the location field of an Event\n   *\n   * @protected\n   * @param {MicrosoftGraph.Event} event\n   * @returns\n   * @memberof MgtAgenda\n   */\n  protected renderLocation(event: MicrosoftGraph.Event): TemplateResult {\n    if (!event.location.displayName) {\n      return null;\n    }\n\n    return html`\n      <div class=\"event-location-container\">\n        <div class=\"event-location-icon\">${getSvg(SvgIcon.OfficeLocation)}</div>\n        <div class=\"event-location\" aria-label=\"${event.location.displayName}\">${event.location.displayName}</div>\n      </div>\n    `;\n  }\n\n  /**\n   * Render the attendees field of an Event\n   *\n   * @protected\n   * @param {MicrosoftGraph.Event} event\n   * @returns\n   * @memberof MgtAgenda\n   */\n  protected renderAttendees(event: MicrosoftGraph.Event): TemplateResult {\n    if (!event.attendees.length) {\n      return null;\n    }\n    return mgtHtml`\n      <mgt-people\n        show-max=\"5\"\n        show-presence\n        class=\"event-attendees\"\n        .peopleQueries=${event.attendees.map(attendee => {\n          return attendee.emailAddress.address;\n        })}\n      ></mgt-people>\n    `;\n  }\n\n  /**\n   * Render the event other field of an Event\n   *\n   * @protected\n   * @param {MicrosoftGraph.Event} event\n   * @returns\n   * @memberof MgtAgenda\n   */\n  protected renderOther(event: MicrosoftGraph.Event): TemplateResult {\n    return this.hasTemplate('event-other')\n      ? html`\n          ${this.renderTemplate('event-other', { event }, event.id + '-other')}\n        `\n      : null;\n  }\n\n  /**\n   * Render the events in groups, each with a header.\n   *\n   * @protected\n   * @param {MicrosoftGraph.Event[]} events\n   * @returns {TemplateResult}\n   * @memberof MgtAgenda\n   */\n  protected renderGroups(events: MicrosoftGraph.Event[]): TemplateResult {\n    // Render list, grouped by day\n    const grouped: Record<string, MicrosoftGraph.Event[]> = {};\n\n    events.forEach(event => {\n      let dateString = event?.start?.dateTime;\n      if (event.end.timeZone === 'UTC') {\n        dateString += 'Z';\n      }\n\n      const header = this.getDateHeaderFromDateTimeString(dateString);\n      grouped[header] = grouped[header] || [];\n      grouped[header].push(event);\n    });\n\n    return html`\n      ${Object.keys(grouped).map(\n        header =>\n          html`\n            <div class=\"group\">${this.renderHeader(header)} ${this.renderEvents(grouped[header])}</div>\n          `\n      )}\n    `;\n  }\n\n  /**\n   * Render a list of events.\n   *\n   * @protected\n   * @param {MicrosoftGraph.Event[]} events\n   * @returns {TemplateResult}\n   * @memberof MgtAgenda\n   */\n  protected renderEvents(events: MicrosoftGraph.Event[]): TemplateResult {\n    return html`\n        ${events.map(\n          event =>\n            html`\n              <div\n                class=\"event-container\"\n                tabindex=\"0\"\n                @focus=${() => this.eventClicked(event)}>\n                ${this.renderTemplate('event', { event }, event.id) || this.renderEvent(event)}\n              </div>`\n        )}`;\n  }\n\n  protected args() {\n    return [this.providerState, this.preferredTimezone, this.eventQuery, this.date, this.groupId, this.days];\n  }\n\n  /**\n   * Load state into the component\n   *\n   * @protected\n   * @returns\n   * @memberof MgtAgenda\n   */\n  protected async loadState() {\n    if (this.events) {\n      return;\n    }\n\n    const events = await this.loadEvents();\n    if (events?.length > 0) {\n      this.events = events;\n    }\n  }\n\n  private readonly onResize = () => {\n    this._isNarrow = this.offsetWidth < 600;\n  };\n\n  private eventClicked(event: MicrosoftGraph.Event) {\n    this.fireCustomEvent('eventClick', event);\n  }\n\n  private getEventTimeString(event: MicrosoftGraph.Event) {\n    if (event.isAllDay) {\n      return 'ALL DAY';\n    }\n\n    // #937 When not specifying a preferred time zone using the\n    // preferred-timezone attribute, MGT treats the dates retrieved from\n    // Microsoft Graph as local time, rather than UTC.\n    let startString = event.start.dateTime;\n    if (event.start.timeZone === 'UTC') {\n      startString += 'Z';\n    }\n    let endString = event.end.dateTime;\n    if (event.end.timeZone === 'UTC') {\n      endString += 'Z';\n    }\n\n    const start = this.prettyPrintTimeFromDateTime(new Date(startString));\n    const end = this.prettyPrintTimeFromDateTime(new Date(endString));\n\n    return `${start} - ${end}`;\n  }\n\n  private async loadEvents(): Promise<MicrosoftGraph.Event[]> {\n    const p = Providers.globalProvider;\n    let events: MicrosoftGraph.Event[] = [];\n\n    if (p?.state === ProviderState.SignedIn) {\n      const graph = p.graph.forComponent(this);\n\n      if (this.eventQuery) {\n        try {\n          const tokens = this.eventQuery.split('|');\n          let scope: string;\n          let query: string;\n          if (tokens.length > 1) {\n            query = tokens[0].trim();\n            scope = tokens[1].trim();\n          } else {\n            query = this.eventQuery;\n          }\n          const iterator = await getEventsQueryPageIterator(graph, query, scope ? [scope] : []);\n          if (iterator?.value) {\n            events = iterator.value;\n\n            while (iterator.hasNext) {\n              await iterator.next();\n              events = iterator.value;\n            }\n          }\n          // eslint-disable-next-line no-empty\n        } catch (e) {}\n      } else {\n        const start = this.date ? new Date(this.date) : new Date();\n        const end = new Date(start.getTime());\n        end.setDate(start.getDate() + this.days);\n\n        try {\n          const iterator = await getEventsPageIterator(graph, start, end, this.groupId);\n          if (iterator?.value) {\n            events = iterator.value;\n\n            while (iterator.hasNext) {\n              await iterator.next();\n              events = iterator.value;\n            }\n          }\n        } catch (error) {\n          // noop - possible error with graph\n        }\n      }\n    }\n\n    return events;\n  }\n\n  private prettyPrintTimeFromDateTime(date: Date) {\n    return date.toLocaleTimeString(navigator.language, {\n      timeStyle: 'short',\n      timeZone: this.preferredTimezone\n    });\n  }\n\n  private getDateHeaderFromDateTimeString(dateTimeString: string) {\n    const date = new Date(dateTimeString);\n    return date.toLocaleDateString(navigator.language, {\n      dateStyle: 'full',\n      timeZone: this.preferredTimezone\n    });\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { html, TemplateResult } from 'lit';\nimport { property } from 'lit/decorators.js';\nimport {\n  CacheService,\n  CacheStore,\n  equals,\n  MgtTemplatedTaskComponent,\n  prepScopes,\n  Providers,\n  ProviderState,\n  CollectionResponse,\n  IGraph\n} from '@microsoft/mgt-element';\n\nimport { getPhotoForResource } from '../../graph/graph.photos';\nimport { getDocumentThumbnail } from '../../graph/graph.files';\nimport { schemas } from '../../graph/cacheStores';\nimport { CacheResponse } from '../CacheResponse';\nimport { Entity } from '@microsoft/microsoft-graph-types';\nimport { GraphRequest } from '@microsoft/microsoft-graph-client';\nimport { registerComponent } from '@microsoft/mgt-element';\n\n/**\n * Simple holder type for an image\n */\ninterface ImageValue {\n  image: string;\n}\n\n/**\n * A type guard to check if a value is a collection response\n *\n * @param value {*} the value to check\n * @returns {boolean} true if the value is a collection response\n */\nexport const isCollectionResponse = (value: unknown): value is CollectionResponse<unknown> =>\n  Array.isArray((value as CollectionResponse<unknown>)?.value);\n\nconst responseTypes = ['json', 'image'] as const;\n/**\n * Enumeration to define what types of query are available\n *\n * @export\n * @enum {string}\n */\nexport type ResponseType = (typeof responseTypes)[number];\nconst isResponseType = (value: unknown): value is ResponseType =>\n  typeof value === 'string' && responseTypes.includes(value as ResponseType);\nconst responseTypeConverter = (value: string, defaultValue: ResponseType = 'json'): ResponseType =>\n  isResponseType(value) ? value : defaultValue;\n\n/**\n * Defines the expiration time\n */\nconst getResponseInvalidationTime = (currentInvalidationPeriod: number): number =>\n  currentInvalidationPeriod ||\n  CacheService.config.response.invalidationPeriod ||\n  CacheService.config.defaultInvalidationPeriod;\n\n/**\n * Whether the response store is enabled\n */\nconst getIsResponseCacheEnabled = (): boolean =>\n  CacheService.config.response.isEnabled && CacheService.config.isEnabled;\n\n/**\n * Holder type emitted with the dataChange event\n */\nexport interface DataChangedDetail {\n  response?: CollectionResponse<Entity>;\n  error?: object;\n}\n\nexport const registerMgtGetComponent = () => registerComponent('get', MgtGet);\n\n/**\n * Custom element for making Microsoft Graph get queries\n *\n * @fires {CustomEvent<DataChangedDetail>} dataChange - Fired when data changes bubbles, composed, and is not cancelable.\n *\n * @export\n * @class mgt-get\n * @extends {MgtTemplatedComponent}\n */\nexport class MgtGet extends MgtTemplatedTaskComponent {\n  /**\n   * The resource to get\n   *\n   * @type {string}\n   * @memberof MgtGet\n   */\n  @property({\n    attribute: 'resource',\n    reflect: true,\n    type: String\n  })\n  public resource: string;\n\n  /**\n   * The scopes to request\n   *\n   * @type {string[]}\n   * @memberof MgtGet\n   */\n  @property({\n    attribute: 'scopes',\n    converter: (value, _type) => {\n      return value ? value.toLowerCase().split(',') : null;\n    },\n    reflect: true\n  })\n  public scopes: string[] = [];\n\n  /**\n   * Api version to use for request\n   *\n   * @type {string}\n   * @memberof MgtGet\n   */\n  @property({\n    attribute: 'version',\n    reflect: true,\n    type: String\n  })\n  public version = 'v1.0';\n\n  /**\n   * Type of response\n   * Default = json\n   * Supported values = json, image\n   *\n   * @type {ResponseType}\n   * @memberof MgtGet\n   */\n  @property({\n    attribute: 'type',\n    reflect: true,\n    type: String,\n    converter: value => responseTypeConverter(value, 'json')\n  })\n  public type: ResponseType = 'json';\n\n  /**\n   * Maximum number of pages to get for the resource\n   * default = 3\n   * if <= 0, all pages will be fetched\n   *\n   * @type {number}\n   * @memberof MgtGet\n   */\n  @property({\n    attribute: 'max-pages',\n    reflect: true,\n    type: Number\n  })\n  public maxPages = 3;\n\n  /**\n   * Number of milliseconds to poll the delta API and\n   * update the response. Set to positive value to enable\n   *\n   * @type {number}\n   * @memberof MgtGet\n   */\n  @property({\n    attribute: 'polling-rate',\n    reflect: true,\n    type: Number\n  })\n  public pollingRate = 0;\n\n  /**\n   * Enables cache on the response from the specified resource\n   * default = false\n   *\n   * @type {boolean}\n   * @memberof MgtGet\n   */\n  @property({\n    attribute: 'cache-enabled',\n    reflect: true,\n    type: Boolean\n  })\n  public cacheEnabled = false;\n\n  /**\n   * Invalidation period of the cache for the responses in milliseconds\n   *\n   * @type {number}\n   * @memberof MgtGet\n   */\n  @property({\n    attribute: 'cache-invalidation-period',\n    type: Number\n  })\n  public cacheInvalidationPeriod = 0;\n\n  /**\n   * Gets or sets the response of the request\n   *\n   * @type any\n   * @memberof MgtGet\n   */\n  @property({ attribute: false }) public response: CollectionResponse<Entity> | Entity | ImageValue;\n\n  /**\n   *\n   * Gets or sets the error (if any) of the request\n   *\n   * @type any\n   * @memberof MgtGet\n   */\n  @property({ attribute: false }) public error: object;\n\n  private isPolling = false;\n  private isRefreshing = false;\n\n  /**\n   * Refresh the data\n   *\n   * @param {boolean} [hardRefresh=false]\n   * if false (default), the component will only update if the data changed\n   * if true, the data will be first cleared and reloaded completely\n   * @memberof MgtGet\n   */\n  public refresh(hardRefresh = false) {\n    this.isRefreshing = true;\n    if (hardRefresh) {\n      this.clearState();\n    }\n    void this._task.run();\n  }\n\n  /**\n   * Clears state of the component\n   *\n   * @protected\n   * @memberof MgtGet\n   */\n  protected clearState(): void {\n    this.response = null;\n  }\n\n  protected args(): unknown[] {\n    return [\n      this.providerState,\n      this.resource,\n      this.scopes,\n      this.version,\n      this.pollingRate,\n      this.type,\n      this.maxPages,\n      this.cacheEnabled,\n      this.cacheInvalidationPeriod\n    ];\n  }\n\n  protected renderLoading = () => {\n    const loading = this.renderTemplate('loading', null);\n    return isCollectionResponse(this.response)\n      ? this.renderValueContentWithDefaultTemplate(\n          html`${this.response.value.map(v => this.renderTemplate('value', v, v.id))} ${loading} `\n        )\n      : loading;\n  };\n\n  /**\n   * Invoked on each update to perform rendering tasks. This method must return\n   * a lit-html TemplateResult. Setting properties inside this method will *not*\n   * trigger the element to update.\n   */\n  protected renderContent = () => {\n    if (this.hasTemplate('value') && isCollectionResponse(this.response)) {\n      const valueContent: TemplateResult = isCollectionResponse(this.response)\n        ? html`\n          ${this.response.value.map(v => this.renderTemplate('value', v, v.id))}\n        `\n        : this.renderTemplate('value', this.response);\n\n      return this.renderValueContentWithDefaultTemplate(valueContent);\n    } else if (this.response) {\n      return this.renderTemplate('default', this.response) || html``;\n    } else if (this.hasTemplate('no-data')) {\n      return this.renderTemplate('no-data', null);\n    } else {\n      return html``;\n    }\n  };\n\n  private renderValueContentWithDefaultTemplate(valueContent: TemplateResult) {\n    if (this.hasTemplate('default')) {\n      const defaultContent = this.renderTemplate('default', this.response);\n\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/dot-notation\n      if ((this.templates['value']?.templateOrder ?? 999) > this.templates['default'].templateOrder) {\n        return html`\n          ${defaultContent}${valueContent}\n        `;\n      } else {\n        return html`\n          ${valueContent}${defaultContent}\n        `;\n      }\n    } else {\n      return valueContent;\n    }\n  }\n\n  /**\n   * load state into the component.\n   *\n   * @protected\n   * @returns\n   * @memberof MgtGet\n   */\n  protected async loadState() {\n    const provider = Providers.globalProvider;\n\n    this.error = null;\n\n    if (!provider || provider.state !== ProviderState.SignedIn) {\n      return;\n    }\n\n    if (this.resource) {\n      try {\n        let cache: CacheStore<CacheResponse>;\n        const key = `${this.version}${this.resource}`;\n        let response: Entity | CollectionResponse<Entity> | ImageValue = null;\n\n        if (this.shouldRetrieveCache()) {\n          cache = CacheService.getCache<CacheResponse>(schemas.get, schemas.get.stores.responses);\n          const result: CacheResponse = getIsResponseCacheEnabled() ? await cache.getValue(key) : null;\n          if (result && getResponseInvalidationTime(this.cacheInvalidationPeriod) > Date.now() - result.timeCached) {\n            response = JSON.parse(result.response) as CollectionResponse<Entity>;\n          }\n        }\n\n        if (!response) {\n          let uri = this.resource;\n          let isDeltaLink = false;\n\n          // if we had a response earlier with a delta link, use it instead\n          if (this.response?.['@odata.deltaLink']) {\n            uri = this.response['@odata.deltaLink'] as string;\n            isDeltaLink = true;\n          } else {\n            // TODO: Check this against the base url for the cloud in use.\n            isDeltaLink = new URL(uri, 'https://graph.microsoft.com').pathname.endsWith('delta');\n          }\n\n          const graph: IGraph = provider.graph.forComponent(this);\n          let request: GraphRequest = graph.api(uri).version(this.version);\n\n          if (this.scopes?.length) {\n            request = request.middlewareOptions(prepScopes(this.scopes));\n          }\n\n          if (this.type === 'json') {\n            response = (await request.get()) as CollectionResponse<Entity> | Entity;\n\n            if (isDeltaLink && isCollectionResponse(this.response) && isCollectionResponse(response)) {\n              const responseValues: Entity[] = response.value;\n              response.value = this.response.value.concat(responseValues);\n            }\n\n            if (!this.isPolling && !equals(this.response, response)) {\n              this.response = response;\n            }\n\n            // get more pages if there are available\n            if (isCollectionResponse(response) && response['@odata.nextLink']) {\n              let pageCount = 1;\n              let page = response;\n\n              while (\n                (pageCount < this.maxPages || this.maxPages <= 0 || (isDeltaLink && this.pollingRate)) &&\n                page?.['@odata.nextLink']\n              ) {\n                pageCount++;\n                const nextResource = (page['@odata.nextLink'] as string).split(this.version)[1];\n                page = (await graph.api(nextResource).version(this.version).get()) as CollectionResponse<Entity>;\n                if (page?.value?.length) {\n                  page.value = response.value.concat(page.value);\n                  response = page;\n                  if (!this.isPolling) {\n                    this.response = response;\n                  }\n                }\n              }\n            }\n          } else {\n            if (this.resource.indexOf('/photo/$value') === -1 && this.resource.indexOf('/thumbnails/') === -1) {\n              throw new Error('Only /photo/$value and /thumbnails/ endpoints support the image type');\n            }\n\n            let image: string;\n            if (this.resource.indexOf('/photo/$value') > -1) {\n              // Sanitizing the resource to ensure getPhotoForResource gets the right format\n              const sanitizedResource = this.resource.replace('/photo/$value', '');\n              const photoResponse = await getPhotoForResource(graph, sanitizedResource, this.scopes);\n              if (photoResponse) {\n                image = photoResponse.photo;\n              }\n            } else if (this.resource.indexOf('/thumbnails/') > -1) {\n              const imageResponse = await getDocumentThumbnail(graph, this.resource, this.scopes);\n              if (imageResponse) {\n                image = imageResponse.thumbnail;\n              }\n            }\n\n            if (image) {\n              response = {\n                image\n              };\n            }\n          }\n\n          if (this.shouldUpdateCache() && response) {\n            cache = CacheService.getCache<CacheResponse>(schemas.get, schemas.get.stores.responses);\n            await cache.putValue(key, { response: JSON.stringify(response) });\n          }\n        }\n\n        if (!equals(this.response, response)) {\n          this.response = response;\n        }\n      } catch (e: unknown) {\n        this.error = e as object;\n      }\n\n      if (this.response) {\n        this.error = null;\n\n        if (this.pollingRate) {\n          setTimeout(() => {\n            this.isPolling = true;\n            void this.loadState().finally(() => {\n              this.isPolling = false;\n            });\n          }, this.pollingRate);\n        }\n      }\n    } else {\n      this.response = null;\n    }\n    this.isRefreshing = false;\n    this.fireCustomEvent('dataChange', { response: this.response, error: this.error }, true, false, true);\n  }\n\n  private shouldRetrieveCache(): boolean {\n    return getIsResponseCacheEnabled() && this.cacheEnabled && !(this.isRefreshing || this.isPolling);\n  }\n\n  private shouldUpdateCache(): boolean {\n    return getIsResponseCacheEnabled() && this.cacheEnabled;\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nexport const strings: Record<string, string> = {\n  signInLinkSubtitle: 'Sign In',\n  signOutLinkSubtitle: 'Sign Out',\n  signInWithADifferentAccount: 'Sign in with a different account'\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { CSSResult, html, TemplateResult } from 'lit';\nimport { property, state } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { ifDefined } from 'lit/directives/if-defined.js';\nimport { Providers, ProviderState, IProviderAccount, mgtHtml, MgtTemplatedTaskComponent } from '@microsoft/mgt-element';\n\nimport { AvatarSize, IDynamicPerson, ViewType } from '../../graph/types';\nimport { MgtFlyout, registerMgtFlyoutComponent } from '../sub-components/mgt-flyout/mgt-flyout';\nimport { getUserWithPhoto } from '../../graph/graph.userWithPhoto';\nimport { MgtPerson, registerMgtPersonComponent } from '../mgt-person/mgt-person';\n\nimport { getSvg, SvgIcon } from '../../utils/SvgHelper';\n\nimport { styles } from './mgt-login-css';\nimport { strings } from './strings';\n\nimport '../../styles/style-helper';\n\nimport { fluentListbox, fluentProgressRing, fluentButton, fluentCard } from '@fluentui/web-components';\nimport { registerFluentComponents } from '../../utils/FluentComponents';\nimport { registerComponent } from '@microsoft/mgt-element';\nimport { TaskStatus } from '@lit/task';\n\n/**\n * loginViewType describes the enum strings that can be passed in to determine\n * size of the mgt-login control.\n */\nexport type LoginViewType = 'avatar' | 'compact' | 'full';\n\ninterface PersonViewConfig {\n  view: ViewType;\n  avatarSize: AvatarSize;\n}\n\nexport const registerMgtLoginComponent = () => {\n  registerFluentComponents(fluentListbox, fluentProgressRing, fluentButton, fluentCard);\n\n  registerMgtFlyoutComponent();\n  registerMgtPersonComponent();\n  registerComponent('login', MgtLogin);\n};\n\n/**\n * Web component button and flyout control to facilitate Microsoft identity platform authentication\n *\n * @export\n * @class MgtLogin\n * @extends {MgtTemplatedTaskComponent}\n *\n * @fires {CustomEvent<undefined>} loginInitiated - Fired when login is initiated by the user\n * @fires {CustomEvent<undefined>} loginCompleted - Fired when login completes\n * @fires {CustomEvent<undefined>} loginFailed - Fired when login fails\n * @fires {CustomEvent<undefined>} logoutInitiated - Fired when logout is initiated by the user\n * @fires {CustomEvent<undefined>} logoutCompleted - Fired when logout completed\n *\n * @template signed-in-button-content (dataContext: {personDetails, personImage})\n * @template signed-out-button-content (dataContext: null)\n * @template flyout-commands (dataContext: {handleSignOut})\n * @template flyout-person-details (dataContext: {personDetails, personImage})\n *\n * @cssprop --login-signed-in-background - {String} the background properties of the component when signed in.\n * @cssprop --login-signed-in-hover-background - {String} the background properties of the component when signed in.\n * @cssprop --login-signed-out-button-background - {String} the background properties of the component when signed out.\n * @cssprop --login-signed-out-button-hover-background - {String} the background properties of the component when signed out.\n * @cssprop --login-signed-out-button-text-color - {Color} the background color of the component when signed out.\n * @cssprop --login-button-padding - {Length} the padding of the button. Default is 0px.\n * @cssprop --login-popup-background-color - {Color} the background color of the popup.\n * @cssprop --login-popup-command-button-background-color - {Color} the color of the background to the popup command button.\n * @cssprop --login-popup-padding - {Length} the padding applied to the popup card. Default is 16px.\n * @cssprop --login-add-account-button-text-color - {Color} the color for the text and icon of the add account button.\n * @cssprop --login-add-account-button-background-color - {Color} the color for the background and icon of the add account button.\n * @cssprop --login-add-account-button-hover-background-color - {Color} the color for the background and icon of the add account button on hover.\n * @cssprop --login-command-button-text-color - {Color} the color for the text of the command button.\n * @cssprop --login-command-button-background-color - {Color} the color for the background of the command button.\n * @cssprop --login-command-button-hover-background-color - {Color} the color for the background of the command button on hovering.\n * @cssprop --login-account-item-hover-bg-color - {Color} the background color of the account item on hover.\n * @cssprop --login-flyout-command-text-color - {Color} the color for the text of the flyout command button.\n * @cssprop --login-person-avatar-size - {Length} the size of the avatar in the person component. Default is 40px.\n */\nexport class MgtLogin extends MgtTemplatedTaskComponent {\n  /**\n   * Array of styles to apply to the element. The styles should be defined\n   * using the `css` tag function.\n   */\n  static get styles(): CSSResult[] {\n    return styles;\n  }\n  /**\n   * Returns the object of strings for localization\n   *\n   * @readonly\n   * @protected\n   * @memberof MgtLogin\n   */\n  protected get strings(): Record<string, string> {\n    return strings;\n  }\n\n  /**\n   * Allows developer to use specific user details for login.\n   *\n   * @type {IDynamicPerson}\n   */\n  @property({\n    attribute: 'user-details',\n    type: Object\n  })\n  public userDetails: IDynamicPerson;\n\n  /**\n   * Determines if presence is shown for logged in user\n   * defaults to false\n   *\n   * @type {boolean}\n   */\n  @property({\n    attribute: 'show-presence',\n    type: Boolean\n  })\n  public showPresence = false;\n\n  /**\n   * Determines the view style to apply to the logged in user\n   * options are 'full', 'compact', 'avatar', defaults to 'full'\n   *\n   * @type {LoginViewType}\n   */\n  @property({\n    attribute: 'login-view',\n    type: String\n  })\n  public loginView: LoginViewType = 'full';\n\n  /**\n   * Gets the flyout element\n   *\n   * @protected\n   * @type {MgtFlyout}\n   * @memberof MgtLogin\n   */\n  protected get flyout(): MgtFlyout {\n    return this.renderRoot.querySelector('.flyout');\n  }\n\n  /**\n   * Get the scopes required for login\n   *\n   * @static\n   * @return {*}  {string[]}\n   * @memberof MgtLogin\n   */\n  public static get requiredScopes(): string[] {\n    return [...new Set(['user.read', ...MgtPerson.requiredScopes])];\n  }\n\n  /**\n   * Determines if login menu popup should be showing.\n   *\n   * @private\n   * @type {boolean}\n   */\n  @state() private _isFlyoutOpen: boolean;\n\n  /**\n   * The image blob string\n   *\n   * @private\n   * @type {string}\n   * @memberof MgtLogin\n   */\n  private _image: string;\n\n  /**\n   * Suffix for user details key\n   *\n   * @private\n   * @type {string}\n   * @memberof MgtLogin\n   */\n  private get _userDetailsKey() {\n    return '-userDetails';\n  }\n\n  @state() private _arrowKeyLocation = -1;\n\n  constructor() {\n    super();\n    this._isFlyoutOpen = false;\n  }\n\n  /**\n   * Invoked each time the custom element is appended into a document-connected element\n   *\n   * @memberof MgtLogin\n   */\n  public connectedCallback() {\n    super.connectedCallback();\n    this.addEventListener('click', e => e.stopPropagation());\n  }\n\n  /**\n   * Initiate login\n   *\n   * @returns {Promise<void>}\n   * @memberof MgtLogin\n   */\n  public async login(): Promise<void> {\n    const provider = Providers.globalProvider;\n    // (If we have user details or the consumer doesn't cancel the loginInitiated event) and the provider doesn't support multi-account, we don't have to login.\n    // This condition is to prevent the login popup from showing up when the user is already logged in while still ensuring the loginIntiated event is raised\n    if ((this.userDetails || !this.fireCustomEvent('loginInitiated')) && !provider.isMultiAccountSupportedAndEnabled) {\n      return;\n    }\n    if (provider?.login) {\n      await provider.login();\n\n      if (provider.state === ProviderState.SignedIn) {\n        this.fireCustomEvent('loginCompleted');\n      } else {\n        this.fireCustomEvent('loginFailed');\n      }\n    }\n  }\n\n  /**\n   * Initiate logout\n   *\n   * @returns {Promise<void>}\n   * @memberof MgtLogin\n   */\n  public logout = async (): Promise<void> => {\n    if (!this.fireCustomEvent('logoutInitiated')) {\n      return;\n    }\n\n    const provider = Providers.globalProvider;\n    if (provider?.isMultiAccountSupportedAndEnabled) {\n      localStorage.removeItem(provider.getActiveAccount().id + this._userDetailsKey);\n    }\n    if (provider?.logout) {\n      await provider.logout();\n      this.userDetails = null;\n      if (provider.isMultiAccountSupportedAndEnabled) {\n        localStorage.removeItem(provider.getActiveAccount().id + this._userDetailsKey);\n      }\n      this.hideFlyout();\n      this.fireCustomEvent('logoutCompleted');\n    }\n  };\n\n  /**\n   * Invoked on each update to perform rendering tasks. This method must return\n   * a lit-html TemplateResult. Setting properties inside this method will *not*\n   * trigger the element to update.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   */\n  protected renderContent = (): TemplateResult => {\n    return html`\n      <div class=\"login-root\">\n        ${this.renderButton()}\n        ${this.renderFlyout()}\n      </div>`;\n  };\n\n  protected args(): unknown[] {\n    return [this.providerState];\n  }\n\n  /**\n   * Load state into the component.\n   *\n   * @protected\n   * @memberof MgtLogin\n   */\n  protected async loadState() {\n    const provider = Providers.globalProvider;\n    if (provider && !this.userDetails) {\n      if (provider.state === ProviderState.SignedIn) {\n        this.userDetails = await getUserWithPhoto(provider.graph.forComponent(this));\n\n        if (this.userDetails.personImage) {\n          this._image = this.userDetails.personImage;\n        }\n\n        if (provider.isMultiAccountSupportedAndEnabled) {\n          localStorage.setItem(\n            Providers.globalProvider.getActiveAccount().id + this._userDetailsKey,\n            JSON.stringify(this.userDetails)\n          );\n        }\n        this.fireCustomEvent('loginCompleted');\n      } else {\n        this.userDetails = null;\n      }\n    }\n  }\n\n  /**\n   * Render the sign in or sign out button.\n   *\n   * @protected\n   * @memberof MgtLogin\n   * @returns {TemplateResult}\n   */\n  protected renderButton(): TemplateResult {\n    const isSignedIn = Providers.globalProvider?.state === ProviderState.SignedIn;\n    const loginClasses = classMap({\n      'signed-in': isSignedIn && Boolean(this.userDetails),\n      'signed-out': !isSignedIn,\n      small: this.loginView === 'avatar'\n    });\n    const appearance = isSignedIn ? 'stealth' : 'neutral';\n    const showSignedInState = isSignedIn && this.userDetails;\n    const buttonContentTemplate = showSignedInState\n      ? this.renderSignedInButtonContent(this.userDetails, this._image)\n      : this.renderSignedOutButtonContent();\n    const expandedState: boolean | undefined = showSignedInState ? this._isFlyoutOpen : undefined;\n    return html`\n      <fluent-button\n        id=\"login-button\"\n        aria-expanded=\"${ifDefined(expandedState)}\"\n        appearance=${appearance}\n        aria-label=\"${ifDefined(isSignedIn ? undefined : this.strings.signInLinkSubtitle)}\"\n        ?disabled=${this._task.status === TaskStatus.PENDING}\n        @click=${this.onClick}\n        class=${loginClasses}>\n          ${buttonContentTemplate}\n      </fluent-button>`;\n  }\n\n  private readonly flyoutOpened = () => {\n    this._isFlyoutOpen = true;\n  };\n  private readonly flyoutClosed = () => {\n    this._isFlyoutOpen = false;\n  };\n\n  /**\n   * Render the details flyout.\n   *\n   * @protected\n   * @memberof MgtLogin\n   * @returns {TemplateResult}\n   */\n  protected renderFlyout(): TemplateResult {\n    return mgtHtml`\n      <mgt-flyout\n        class=\"flyout\"\n        light-dismiss\n        @opened=${this.flyoutOpened}\n        @closed=${this.flyoutClosed}>\n        <fluent-card\n          slot=\"flyout\"\n          tabindex=\"0\"\n          class=\"flyout-card\"\n          @keydown=${this.onUserKeyDown}\n          >\n          ${this.renderFlyoutContent()}\n        </fluent-card>\n      </mgt-flyout>`;\n  }\n\n  /**\n   * Tracks tabbing through the flyout (keydown)\n   */\n  private readonly onUserKeyDown = (e: KeyboardEvent): void => {\n    if (!this.flyout.isOpen) {\n      return;\n    }\n\n    const el = this.renderRoot.querySelector('.popup-content');\n    const focusableEls = el.querySelectorAll('ul, fluent-button');\n    const firstFocusableEl = el.querySelector('#signout-button') || focusableEls[0];\n    const lastFocusableEl =\n      el.querySelector('#signin-different-account-button') || focusableEls[focusableEls.length - 1];\n\n    if (e.key === 'Tab' && e.shiftKey && firstFocusableEl === e.target) {\n      e.preventDefault();\n      (lastFocusableEl as HTMLElement)?.focus();\n    }\n    if (e.key === 'Tab' && !e.shiftKey && lastFocusableEl === e.target) {\n      e.preventDefault();\n      (firstFocusableEl as HTMLElement)?.focus();\n    }\n    if (e.key === 'Escape') {\n      const loginButton = this.renderRoot.querySelector('#login-button');\n      (loginButton as HTMLElement)?.focus();\n    }\n    const fluentCardEl = this.renderRoot.querySelector('fluent-card');\n    if (e.shiftKey && e.key === 'Tab' && e.target === fluentCardEl) {\n      this.hideFlyout();\n    }\n  };\n\n  /**\n   * Render the flyout menu content.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtLogin\n   */\n  protected renderFlyoutContent(): TemplateResult {\n    if (!this.userDetails) {\n      return;\n    }\n    return html`\n       <div class=\"popup\">\n         <div class=\"popup-content\">\n           <div class=\"commands\">\n             ${this.renderFlyoutCommands()}\n           </div>\n           <div class=\"content\">\n             <div class=\"main-profile\">\n               ${this.renderFlyoutPersonDetails(this.userDetails, this._image)}\n             </div>\n             ${this.renderAccounts()}\n           </div>\n           ${this.renderAddAccountContent()}\n         </div>\n       </div>\n     `;\n  }\n\n  private get hasMultipleAccounts(): boolean {\n    return (\n      Providers.globalProvider?.isMultiAccountSupportedAndEnabled &&\n      Providers.globalProvider?.getAllAccounts?.()?.length > 1\n    );\n  }\n\n  private get usesVerticalPersonCard(): boolean {\n    return this.loginView === 'full' || this.hasMultipleAccounts;\n  }\n\n  /**\n   * Render the flyout person details.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtLogin\n   */\n  protected renderFlyoutPersonDetails(personDetails: IDynamicPerson, personImage: string): TemplateResult {\n    const template = this.renderTemplate('flyout-person-details', { personDetails, personImage });\n    return (\n      template ||\n      mgtHtml`\n        <mgt-person\n          .personDetails=${personDetails}\n          .personImage=${personImage}\n          view=\"twolines\"\n          .line2Property=${'email'}\n          ?vertical-layout=${this.usesVerticalPersonCard}\n          class=\"person\">\n        </mgt-person>`\n    );\n  }\n\n  /**\n   * Render the flyout commands.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtLogin\n   */\n  protected renderFlyoutCommands(): TemplateResult {\n    const template = this.renderTemplate('flyout-commands', { handleSignOut: () => this.logout() });\n    return (\n      template ||\n      html`\n        <fluent-button\n          id=\"signout-button\"\n          appearance=\"stealth\"\n          size=\"medium\"\n          class=\"flyout-command\"\n          @click=${this.logout}\n          aria-label=${this.strings.signOutLinkSubtitle}>\n            ${this.strings.signOutLinkSubtitle}\n        </fluent-button>`\n    );\n  }\n\n  /**\n   * Render the button content.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtLogin\n   */\n  protected renderButtonContent(): TemplateResult {\n    if (this.userDetails) {\n      return this.renderSignedInButtonContent(this.userDetails, this._image);\n    } else {\n      return this.renderSignedOutButtonContent();\n    }\n  }\n\n  /**\n   * Renders the button to allow adding accounts.\n   *\n   * @protected\n   * @returns\n   * @memberof MgtLogin\n   */\n  protected renderAddAccountContent() {\n    if (Providers.globalProvider.isMultiAccountSupportedAndEnabled) {\n      return html`\n        <div class=\"add-account\">\n          <fluent-button\n            id=\"signin-different-account-button\"\n            appearance=\"stealth\"\n            aria-label=\"${this.strings.signInWithADifferentAccount}\"\n            @click=${() => void this.login()}>\n            <span slot=\"start\"><i>${getSvg(SvgIcon.SelectAccount, 'currentColor')}</i></span>\n            ${this.strings.signInWithADifferentAccount}\n          </fluent-button>\n        </div>`;\n    }\n  }\n\n  private parsePersonDisplayConfiguration(): PersonViewConfig {\n    const displayConfig: PersonViewConfig = { view: 'twolines', avatarSize: 'small' };\n    switch (this.loginView) {\n      case 'avatar':\n        displayConfig.view = 'image';\n        displayConfig.avatarSize = 'small';\n        break;\n      case 'compact':\n        displayConfig.view = 'oneline';\n        displayConfig.avatarSize = 'small';\n        break;\n      case 'full':\n      default:\n        displayConfig.view = 'twolines';\n        displayConfig.avatarSize = 'auto';\n        break;\n    }\n    return displayConfig;\n  }\n\n  /**\n   * Render the button content when the user is signed in.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtLogin\n   */\n  protected renderSignedInButtonContent(personDetails: IDynamicPerson, personImage: string): TemplateResult {\n    const template = this.renderTemplate('signed-in-button-content', { personDetails, personImage });\n    const displayConfig = this.parsePersonDisplayConfiguration();\n    return (\n      template ||\n      mgtHtml`\n        <mgt-person\n          .personDetails=${this.userDetails}\n          .personImage=${this._image}\n          .view=${displayConfig.view}\n          .showPresence=${this.showPresence}\n          .avatarSize=${displayConfig.avatarSize}\n          line2-property=\"email\"\n          class=\"signed-in-person\"\n        ></mgt-person>`\n    );\n  }\n\n  /**\n   * Renders multiple accounts that can be used to sign in.\n   *\n   * @return {TemplateResult}\n   * @memberof MgtLogin\n   */\n  renderAccounts(): TemplateResult {\n    if (\n      Providers.globalProvider.state === ProviderState.SignedIn &&\n      Providers.globalProvider.isMultiAccountSupportedAndEnabled\n    ) {\n      const provider = Providers.globalProvider;\n      const accounts = provider.getAllAccounts();\n\n      if (accounts?.length > 1) {\n        return html`\n          <div id=\"accounts\">\n            <ul\n              tabindex=\"0\"\n              class=\"account-list\"\n              part=\"account-list\"\n              aria-label=\"${this.ariaLabel}\"\n              @keydown=${this.handleAccountListKeyDown}\n            >\n              ${accounts\n                .filter(a => a.id !== provider.getActiveAccount().id)\n                .map(account => {\n                  const details = localStorage.getItem(account.id + this._userDetailsKey);\n                  return mgtHtml`\n                    <li\n                      tabindex=\"-1\"\n                      part=\"account-item\"\n                      class=\"account-item\"\n                      @click=${() => this.setActiveAccount(account)}\n                      @keyup=${(e: KeyboardEvent) => {\n                        if (e.key === 'Enter') this.setActiveAccount(account);\n                      }}\n                    >\n                      <mgt-person\n                        .personDetails=${details ? JSON.parse(details) : null}\n                        .fallbackDetails=${{ displayName: account.name, mail: account.mail }}\n                        view=\"twolines\"\n                        class=\"account\"\n                      ></mgt-person>\n                    </li>`;\n                })}\n            </ul>\n          </div>\n       `;\n      }\n    }\n  }\n\n  private readonly handleAccountListKeyDown = (event: KeyboardEvent) => {\n    const list: HTMLUListElement = this.renderRoot.querySelector('ul.account-list');\n    let item: HTMLLIElement;\n    const listItems: HTMLCollection = list?.children;\n    // Default all tabindex values in li nodes to -1\n    for (const element of listItems) {\n      const el = element as HTMLLIElement;\n      el.setAttribute('tabindex', '-1');\n      el.blur();\n    }\n\n    const childElementCount = list.childElementCount;\n    const keyName = event.key;\n    if (keyName === 'ArrowDown') {\n      this._arrowKeyLocation = (this._arrowKeyLocation + 1 + childElementCount) % childElementCount;\n    } else if (keyName === 'ArrowUp') {\n      this._arrowKeyLocation = (this._arrowKeyLocation - 1 + childElementCount) % childElementCount;\n    } else if (keyName === 'Tab' || keyName === 'Escape') {\n      this._arrowKeyLocation = -1;\n      list.blur();\n      if (keyName === 'Escape') {\n        event.preventDefault();\n        event.stopPropagation();\n      }\n      return;\n    }\n\n    if (this._arrowKeyLocation > -1) {\n      item = listItems[this._arrowKeyLocation] as HTMLLIElement;\n      item.setAttribute('tabindex', '1');\n      item.focus();\n    }\n  };\n\n  /**\n   * Set one of the non-active accounts as the active account\n   *\n   * @param {IProviderAccount} account\n   * @memberof MgtLogin\n   */\n  private setActiveAccount(account: IProviderAccount) {\n    Providers.globalProvider.setActiveAccount(account);\n  }\n\n  /**\n   * Clears state of the component\n   *\n   * @protected\n   * @memberof MgtLogin\n   */\n  protected clearState() {\n    this.userDetails = null;\n    this._image = null;\n  }\n\n  /**\n   * Render the button content when the user is not signed in.\n   *\n   * @protected\n   * @returns\n   * @memberof MgtLogin\n   */\n  protected renderSignedOutButtonContent(): TemplateResult {\n    const template = this.renderTemplate('signed-out-button-content', null);\n    return (\n      template ||\n      html`\n        <span>${this.strings.signInLinkSubtitle}</span>`\n    );\n  }\n\n  /**\n   * Show the flyout and its content.\n   *\n   * @protected\n   * @memberof MgtLogin\n   */\n  protected showFlyout(): void {\n    const flyout = this.flyout;\n    if (flyout) {\n      flyout.open();\n    }\n  }\n\n  /**\n   * Dismiss the flyout.\n   *\n   * @protected\n   * @memberof MgtLogin\n   */\n  protected hideFlyout(): void {\n    const flyout = this.flyout;\n    if (flyout) {\n      flyout.close();\n    }\n  }\n\n  /**\n   * Handles the click on the button in the flyout.\n   *\n   * @private\n   * @memberof MgtLogin\n   */\n  private readonly onClick = (): void => {\n    if (this.userDetails && this._isFlyoutOpen) {\n      this.hideFlyout();\n    } else if (this.userDetails) {\n      this.showFlyout();\n    } else {\n      void this.login();\n    }\n  };\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { html, TemplateResult } from 'lit';\nimport { property, state } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { TaskStatus } from '@lit/task';\nimport {\n  findGroups,\n  getGroupsForGroupIds,\n  GroupType,\n  getGroup,\n  findGroupsFromGroupIds,\n  isGroupType,\n  groupTypeConverter\n} from '../../graph/graph.groups';\nimport {\n  findPeople,\n  getPeople,\n  PersonType,\n  personTypeConverter,\n  UserType,\n  userTypeConverter\n} from '../../graph/graph.people';\nimport {\n  findUsers,\n  findGroupMembers,\n  findUsersFromGroupIds,\n  getUser,\n  getUsersForUserIds,\n  getUsers\n} from '../../graph/graph.user';\nimport { IDynamicPerson } from '../../graph/types';\nimport {\n  Providers,\n  ProviderState,\n  MgtTemplatedTaskComponent,\n  arraysAreEqual,\n  IGraph,\n  mgtHtml\n} from '@microsoft/mgt-element';\nimport '../../styles/style-helper';\nimport { debounce, isValidEmail } from '../../utils/Utils';\nimport { MgtPerson, defaultPersonProperties, registerMgtPersonComponent } from '../mgt-person/mgt-person';\nimport { MgtFlyout, registerMgtFlyoutComponent } from '../sub-components/mgt-flyout/mgt-flyout';\nimport { styles } from './mgt-people-picker-css';\nimport { SvgIcon, getSvg } from '../../utils/SvgHelper';\nimport { fluentTextField, fluentCard } from '@fluentui/web-components';\nimport { registerFluentComponents } from '../../utils/FluentComponents';\nimport { strings } from './strings';\nimport { Person, User } from '@microsoft/microsoft-graph-types';\nimport { registerComponent } from '@microsoft/mgt-element';\nimport { registerMgtSpinnerComponent } from '../sub-components/mgt-spinner/mgt-spinner';\nimport { isGraphError } from '../../graph/isGraphError';\nimport { type PersonCardInteraction, personCardConverter } from './../PersonCardInteraction';\n\nexport { GroupType } from '../../graph/graph.groups';\nexport { PersonType, UserType } from '../../graph/graph.people';\n\nexport const registerMgtPeoplePickerComponent = () => {\n  registerFluentComponents(fluentTextField, fluentCard);\n\n  registerMgtFlyoutComponent();\n  registerMgtPersonComponent();\n  registerMgtSpinnerComponent();\n  registerComponent('people-picker', MgtPeoplePicker);\n};\n\n/**\n * Web component used to search for people from the Microsoft Graph\n *\n * @export\n * @class MgtPicker\n * @extends {MgtTemplatedTaskComponent}\n *\n * @fires {CustomEvent<IDynamicPerson[]>} selectionChanged - Fired when set of selected people changes\n *\n * @cssprop --people-picker-selected-option-background-color - {Color} the background color of the selected person.\n * @cssprop --people-picker-selected-option-highlight-background-color - {Color} the background color of the selected person when you select it for copy/cut.\n * @cssprop --people-picker-dropdown-background-color - {Color} the background color of the dropdown card.\n * @cssprop --people-picker-dropdown-result-background-color - {Color} the background color of the dropdown result.\n * @cssprop --people-picker-dropdown-result-hover-background-color - {Color} the background color of the dropdown result on hover.\n * @cssprop --people-picker-dropdown-result-focus-background-color - {Color} the background color of the dropdown result on focus.\n * @cssprop --people-picker-no-results-text-color - {Color} the no results found text color.\n * @cssprop --people-picker-input-background - {Color} the input background color.\n * @cssprop --people-picker-input-border-color - {Color} the input border color.\n * @cssprop --people-picker-input-hover-background - {Color} the input background color when you hover.\n * @cssprop --people-picker-input-hover-border-color - {Color} the input border color when you hover\n * @cssprop --people-picker-input-focus-background - {Color} the input background color when you focus.\n * @cssprop --people-picker-input-focus-border-color - {Color} the input border color when you focus.\n * @cssprop --people-picker-input-placeholder-focus-text-color - {Color} the placeholder text color when you focus.\n * @cssprop --people-picker-input-placeholder-hover-text-color - {Color} the placeholder text color when you hover.\n * @cssprop --people-picker-input-placeholder-text-color - {Color} the placeholder text color.\n * @cssprop --people-picker-search-icon-color - {Color} the search icon color\n * @cssprop --people-picker-remove-selected-close-icon-color - {Color} the remove selected person close icon color.\n * @cssprop --people-picker-result-person-avatar-size - {Length} the avatar size of the person in the result. Default is 40px.\n * @cssprop --people-picker-selected-person-avatar-size - {Length} the avatar size of the selected person. Default is 24px.\n */\nexport class MgtPeoplePicker extends MgtTemplatedTaskComponent {\n  /**\n   * Array of styles to apply to the element. The styles should be defined\n   * user the `css` tag function.\n   */\n  static get styles() {\n    return styles;\n  }\n\n  /**\n   * The strings to be used for localizing the component.\n   *\n   * @readonly\n   * @protected\n   * @memberof MgtPeoplePicker\n   */\n  protected get strings() {\n    return strings;\n  }\n\n  /**\n   * Gets the flyout element\n   *\n   * @protected\n   * @type {MgtFlyout}\n   * @memberof MgtLogin\n   */\n  protected get flyout(): MgtFlyout {\n    return this.renderRoot.querySelector('.flyout');\n  }\n\n  /**\n   * Gets the input element\n   *\n   * @protected\n   * @type {MgtFlyout}\n   * @memberof MgtLogin\n   */\n  protected get input(): HTMLInputElement {\n    return this.renderRoot.querySelector('fluent-text-field');\n  }\n\n  /**\n   * value determining if search is filtered to a group.\n   *\n   * @type {string}\n   */\n  @property({ attribute: 'group-id', converter: value => value.trim() })\n  public groupId: string;\n\n  /**\n   * array of groups for search to be filtered by.\n   *\n   * @type {string[]}\n   */\n  @property({\n    attribute: 'group-ids',\n    converter: value => {\n      return value.split(',').map(v => v.trim());\n    }\n  })\n  public groupIds: string[] = [];\n  /**\n   * Value determining if search is filtered to a group.\n   * Valid options are 'any', 'person', 'group'\n   *\n   * @type {PersonType}\n   */\n  @property({\n    attribute: 'type',\n    converter: value => personTypeConverter(value, 'any')\n  })\n  public type: PersonType = 'any';\n\n  /**\n   * Type of groups to search for - requires personType to be set to \"Group\" or \"All\"\n   * Valid values are 'any', 'unified', 'security', 'mailenabledsecurity', 'distribution'\n   * Default is ['any'].\n   *\n   * @type {GroupType}\n   */\n  @property({\n    attribute: 'group-type',\n    converter: value => {\n      const defaultResult: GroupType[] = ['any'];\n      if (!value || value.length === 0) {\n        return defaultResult;\n      }\n\n      const values = value.split(',');\n      const groupTypes: GroupType[] = [];\n\n      for (let v of values) {\n        v = v.trim();\n        if (isGroupType(v)) {\n          groupTypes.push(groupTypeConverter(v));\n        }\n      }\n\n      if (groupTypes.length === 0) {\n        return defaultResult;\n      }\n\n      return groupTypes;\n    }\n  })\n  public groupType: GroupType[] = ['any'];\n\n  /**\n   * The type of user to search for.\n   * Valid options are 'any', 'user', 'contact'\n   * Default is any.\n   *\n   * @type {UserType}\n   * @memberof MgtPeoplePicker\n   */\n  @property({\n    attribute: 'user-type',\n    converter: value => userTypeConverter(value)\n  })\n  public userType: UserType = 'any';\n\n  /**\n   * whether the return should contain a flat list of all nested members\n   *\n   * @type {boolean}\n   */\n  @property({\n    attribute: 'transitive-search',\n    type: Boolean\n  })\n  public transitiveSearch = false;\n\n  /**\n   * containing object of IDynamicPerson.\n   *\n   * @type {IDynamicPerson[]}\n   */\n  @property({\n    attribute: 'people',\n    type: Object\n  })\n  public people: IDynamicPerson[] | null = null;\n\n  /**\n   * determining how many people to show in list.\n   *\n   * @type {number}\n   */\n  @property({\n    attribute: 'show-max',\n    type: Number\n  })\n  public showMax = 6;\n\n  /**\n   * Sets whether the person image should be fetched\n   * from the Microsoft Graph\n   *\n   * @type {boolean}\n   * @memberof MgtPerson\n   */\n  @property({\n    attribute: 'disable-images',\n    type: Boolean\n  })\n  public disableImages = false;\n\n  @property({\n    attribute: 'show-presence',\n    type: Boolean\n  })\n  public showPresence: boolean;\n\n  /**\n   * Sets how the person-card is invoked\n   * Set to PersonCardInteraction.none to not show the card\n   *\n   * @type {PersonCardInteraction}\n   * @memberof MgtPerson\n   */\n  @property({\n    attribute: 'person-card',\n    converter: value => personCardConverter(value)\n  })\n  public personCardInteraction: PersonCardInteraction = 'none';\n\n  /**\n   * array of user picked people.\n   *\n   * @type {IDynamicPerson[]}\n   */\n  public get selectedPeople(): IDynamicPerson[] {\n    return this._selectedPeople;\n  }\n  @property({\n    attribute: 'selected-people',\n    type: Array\n  })\n  public set selectedPeople(value: IDynamicPerson[]) {\n    if (!value) value = [];\n    if (!arraysAreEqual(this._selectedPeople, value)) {\n      this._selectedPeople = value;\n      this.fireCustomEvent('selectionChanged', this._selectedPeople);\n    }\n  }\n\n  /**\n   * array of people to be selected upon initialization\n   *\n   * @type {string[]}\n   * @memberof MgtPeoplePicker\n   */\n  @property({\n    attribute: 'default-selected-user-ids',\n    converter: value => {\n      return value.split(',').map(v => v.trim());\n    },\n    type: String\n  })\n  public defaultSelectedUserIds: string[] = [];\n\n  /**\n   * array of groups to be selected upon initialization\n   *\n   * @type {string[]}\n   * @memberof MgtPeoplePicker\n   */\n  @property({\n    attribute: 'default-selected-group-ids',\n    converter: value => {\n      return value.split(',').map(v => v.trim());\n    },\n    type: String\n  })\n  public defaultSelectedGroupIds: string[] = [];\n\n  /**\n   * Placeholder text.\n   *\n   * @type {string}\n   * @memberof MgtPeoplePicker\n   */\n  @property({\n    attribute: 'placeholder',\n    type: String\n  })\n  public placeholder: string;\n\n  /**\n   * Determines whether component should be disabled or not\n   *\n   * @type {boolean}\n   * @memberof MgtPeoplePicker\n   */\n  @property({\n    attribute: 'disabled',\n    type: Boolean\n  })\n  public disabled = false;\n\n  /**\n   * Determines if a user can enter an email without selecting a person\n   *\n   * @type {boolean}\n   * @memberof MgtPeoplePicker\n   */\n  @property({\n    attribute: 'allow-any-email',\n    type: Boolean\n  })\n  public allowAnyEmail = false;\n\n  /**\n   * Determines whether component allows multiple or single selection of people\n   *\n   * @type {string}\n   * @memberof MgtPeoplePicker\n   */\n  @property({\n    attribute: 'selection-mode',\n    type: String\n  })\n  public selectionMode: string;\n\n  /**\n   * Array of the only users to be searched.\n   *\n   * @type {string[]}\n   * @memberof MgtPeoplePicker\n   */\n  @property({\n    attribute: 'user-ids',\n    converter: value => {\n      return value.split(',').map(v => v.trim());\n    },\n    type: String\n  })\n  public userIds: string[] = [];\n\n  /**\n   * Filters that can be set on the user properties query.\n   */\n  @property({ attribute: 'user-filters' })\n  public userFilters: string;\n\n  /**\n   * Filters that can be set on the people query properties.\n   */\n  @property({ attribute: 'people-filters' })\n  public peopleFilters: string;\n\n  /**\n   * Filters that can be set on the group query properties.\n   */\n  @property({ attribute: 'group-filters' })\n  public groupFilters: string;\n\n  /**\n   * Label that can be set on the people picker input to provide context to\n   * assistive technologies\n   */\n  @property({\n    attribute: 'aria-label',\n    type: String\n  })\n  public ariaLabel: string;\n\n  /**\n   * Get the scopes required for people picker\n   *\n   * @static\n   * @return {*}  {string[]}\n   * @memberof MgtPeoplePicker\n   */\n  public static get requiredScopes(): string[] {\n    return [\n      ...new Set([\n        'user.read.all',\n        'people.read',\n        'group.read.all',\n        'user.readbasic.all',\n        'contacts.read',\n        ...MgtPerson.requiredScopes\n      ])\n    ];\n  }\n\n  /**\n   * User input in search.\n   *\n   * @protected\n   * @type {string}\n   * @memberof MgtPeoplePicker\n   */\n  @state()\n  protected userInput = '';\n\n  private _selectedPeople: IDynamicPerson[] = [];\n\n  private defaultPeople: IDynamicPerson[];\n\n  // tracking of user arrow key input for selection\n  @state() private _arrowSelectionCount = -1;\n  // List of people requested if group property is provided\n  private _groupPeople: IDynamicPerson[];\n  private _debouncedSearch: { (): void; (): void };\n  private defaultSelectedUsers: IDynamicPerson[] = [];\n  private defaultSelectedGroups: IDynamicPerson[] = [];\n  // List of users highlighted for copy/cut-pasting\n  @state() private _highlightedUsers: Element[] = [];\n  // current user index to the left of the highlighted users\n  private _currentHighlightedUserPos = 0;\n\n  /**\n   * Checks if the input is focused.\n   */\n  @state() private _isFocused = false;\n\n  /**\n   * Switch to determine if a typed email can be set.\n   */\n  @state() private _setAnyEmail = false;\n\n  /**\n   * List of people found from the graph calls.\n   */\n  @state() private _foundPeople: IDynamicPerson[];\n\n  constructor() {\n    super();\n\n    this.addEventListener('copy', this.handleCopy);\n    this.addEventListener('cut', this.handleCut);\n    this.addEventListener('paste', this.handlePaste);\n    this.addEventListener('selectionChanged', this.handleSelectionChanged);\n  }\n\n  /**\n   * Disable the inner input of the fluent-text-field.\n   */\n  private disableTextInput() {\n    const inputControl = this.input.shadowRoot.querySelector<HTMLInputElement>('input');\n    if (inputControl) {\n      inputControl.setAttribute('disabled', 'true');\n      inputControl.value = '';\n    }\n  }\n\n  /**\n   * Enable the inner input of the fluent-text-field.\n   */\n  private enableTextInput() {\n    const inputControl = this.input.shadowRoot.querySelector<HTMLInputElement>('input');\n    if (inputControl) {\n      inputControl.removeAttribute('disabled');\n      inputControl.focus();\n    }\n  }\n\n  /**\n   * Clears the disabled property on the people picker when used in single mode.\n   */\n  private readonly handleSelectionChanged = () => {\n    if (this.selectedPeople.length === 0 && !this.disabled) {\n      this.enableTextInput();\n    }\n  };\n\n  private get hasMaxSelections(): boolean {\n    return this.selectionMode === 'single' && this.selectedPeople.length >= 1;\n  }\n\n  /**\n   * Focuses the input element when focus is called\n   *\n   * @param {FocusOptions} [options]\n   * @memberof MgtPeoplePicker\n   */\n  public focus(options?: FocusOptions) {\n    if (!this.input) {\n      return;\n    }\n    this.input.focus(options);\n    this.input.select();\n  }\n\n  /**\n   * Queries the microsoft graph for a user based on the user id and adds them to the selectedPeople array\n   *\n   * @param {readonly string []} an array of user ids to add to selectedPeople\n   * @returns {Promise<void>}\n   * @memberof MgtPeoplePicker\n   */\n  public async selectUsersById(userIds: readonly string[]): Promise<void> {\n    const provider = Providers.globalProvider;\n    const graph = Providers.globalProvider.graph;\n    if (provider && provider.state === ProviderState.SignedIn) {\n      // eslint-disable-next-line guard-for-in, @typescript-eslint/no-for-in-array\n      for (const id in userIds) {\n        const userId = userIds[id];\n        try {\n          const personDetails = await getUser(graph, userId, defaultPersonProperties);\n          this.addPerson(personDetails);\n        } catch (e: unknown) {\n          // This caters for allow-any-email property if it's enabled on the component\n          // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-unsafe-call\n          if (isGraphError(e) && e.message?.includes('does not exist') && this.allowAnyEmail) {\n            if (isValidEmail(userId)) {\n              const anyMailUser = {\n                mail: userId,\n                displayName: userId\n              };\n              this.addPerson(anyMailUser);\n            }\n          }\n        }\n      }\n    }\n  }\n  /**\n   * Queries the microsoft graph for a group of users from a group id, and adds them to the selectedPeople\n   *\n   * @param {readonly string []} an array of group ids to add to selectedPeople\n   * @returns {Promise<void>}\n   * @memberof MgtPeoplePicker\n   */\n  public async selectGroupsById(groupIds: readonly string[]): Promise<void> {\n    const provider = Providers.globalProvider;\n    const graph = Providers.globalProvider.graph;\n    if (provider && provider.state === ProviderState.SignedIn) {\n      // eslint-disable-next-line guard-for-in, @typescript-eslint/no-for-in-array\n      for (const id in groupIds) {\n        try {\n          const groupDetails = await getGroup(graph, groupIds[id]);\n          this.addPerson(groupDetails);\n        } catch (e) {\n          // no-op\n        }\n      }\n    }\n  }\n\n  /**\n   * Invoked on each update to perform rendering tasks. This method must return a lit-html TemplateResult.\n   * Setting properties inside this method will not trigger the element to update.\n   *\n   * @returns {TemplateResult}\n   * @memberof MgtPeoplePicker\n   */\n  public render(): TemplateResult {\n    const defaultTemplate = this.renderTemplate('default', { people: this._foundPeople });\n    if (defaultTemplate) {\n      return defaultTemplate;\n    }\n\n    const selectedPeopleTemplate = this.renderSelectedPeople(this.selectedPeople);\n    const inputTemplate = this.renderInput(selectedPeopleTemplate);\n    const flyoutTemplate = this.renderFlyout(inputTemplate);\n\n    return html`\n      <div>\n        ${flyoutTemplate}\n      </div>\n    `;\n  }\n\n  protected args(): unknown[] {\n    return [\n      this.providerState,\n      this.groupId,\n      this.groupIds,\n      this.type,\n      this.groupType,\n      this.userType,\n      this.transitiveSearch,\n      this.people,\n      this.showMax,\n      this.defaultSelectedUserIds,\n      this.defaultSelectedGroupIds,\n      this.userIds,\n      this.userFilters,\n      this.peopleFilters,\n      this.groupFilters\n    ];\n  }\n\n  /**\n   * Clears state of the component\n   *\n   * @protected\n   * @memberof MgtPeoplePicker\n   */\n  protected clearState(): void {\n    this.selectedPeople = [];\n    this.userInput = '';\n    this._highlightedUsers = [];\n    this._currentHighlightedUserPos = 0;\n  }\n\n  /**\n   * Render the input text box.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtPeoplePicker\n   */\n  protected renderInput(selectedPeopleTemplate: TemplateResult): TemplateResult {\n    const placeholder = this.disabled ? '' : this.placeholder || this.strings.inputPlaceholderText;\n    const maxSelectionsAriaLabel = this.hasMaxSelections ? this.strings.maxSelectionsAriaLabel : '';\n\n    const searchIcon = html`<span class=\"search-icon\">${getSvg(SvgIcon.Search)}</span>`;\n    const startSlot = this.selectedPeople?.length > 0 ? selectedPeopleTemplate : searchIcon;\n    return html`\n      <fluent-text-field\n        autocomplete=\"off\"\n        appearance=\"outline\"\n        slot=\"anchor\"\n        id=\"people-picker-input\"\n        role=\"combobox\"\n        placeholder=${this.hasMaxSelections ? this.strings.maxSelectionsPlaceHolder : placeholder}\n        aria-label=${this.ariaLabel || maxSelectionsAriaLabel || placeholder || this.strings.selectContact}\n        aria-expanded=${this.flyout?.isOpen ?? false}\n        @click=\"${this.hasMaxSelections ? undefined : this.handleInputClick}\"\n        @focus=\"${this.hasMaxSelections ? undefined : this.gainedFocus}\"\n        @keydown=\"${this.hasMaxSelections ? undefined : this.onUserKeyDown}\"\n        @input=\"${this.hasMaxSelections ? undefined : this.onUserInput}\"\n        @blur=\"${this.lostFocus}\"\n        ?disabled=${this.disabled}\n      >\n        <span slot=\"start\">${startSlot}</span>\n      </fluent-text-field>\n    `;\n  }\n\n  /**\n   * Render the selected people tokens.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtPeoplePicker\n   */\n  protected renderSelectedPeople(selectedPeople?: IDynamicPerson[]): TemplateResult {\n    if (!selectedPeople?.length) {\n      return html``;\n    }\n\n    return html`\n       <ul\n        id=\"selected-list\"\n        aria-label=\"${this.strings.selected}\"\n        class=\"selected-list\">\n          ${repeat(\n            selectedPeople,\n            person => person?.id,\n            person => html`\n            <li class=\"selected-list-item\">\n              ${\n                this.renderTemplate(\n                  'selected-person',\n                  { person },\n                  `selected-${person?.id ? person.id : person.displayName}`\n                ) || this.renderSelectedPerson(person)\n              }\n\n              <div\n                role=\"button\"\n                tabindex=\"0\"\n                class=\"selected-list-item-close-icon\"\n                aria-label=\"${this.strings.removeSelectedUser}${person?.displayName ?? ''}\"\n                @click=\"${(e: UIEvent) => this.removePerson(person, e)}\"\n                @keydown=\"${(e: KeyboardEvent) => this.handleRemovePersonKeyDown(person, e)}\">\n                  ${getSvg(SvgIcon.Close)}\n              </div>\n          </li>`\n          )}\n      </ul>`;\n  }\n  /**\n   * Render the flyout chrome.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtPeoplePicker\n   */\n  protected renderFlyout(anchor: TemplateResult): TemplateResult {\n    return mgtHtml`\n       <mgt-flyout light-dismiss class=\"flyout\">\n         ${anchor}\n         <fluent-card\n          tabindex=\"0\"\n          slot=\"flyout\"\n          class=\"flyout-root\"\n          @wheel=${(e: WheelEvent) => this.handleSectionScroll(e)}\n          @keydown=${(e: KeyboardEvent) => this.onUserKeyDown(e)}\n          class=\"custom\">\n           ${this.renderFlyoutContent()}\n         </fluent-card>\n       </mgt-flyout>\n     `;\n  }\n\n  /**\n   * Render the appropriate state in the results flyout.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtPeoplePicker\n   */\n  protected renderFlyoutContent(): TemplateResult {\n    if (this._task.status === TaskStatus.PENDING) {\n      return this.renderLoading();\n    }\n\n    const people = this._foundPeople;\n\n    if (!people || people.length === 0 || this.showMax === 0) {\n      return this.renderNoData();\n    } else {\n      return this.renderSearchResults(people);\n    }\n  }\n\n  /**\n   * Render the loading state.\n   *\n   * @protected\n   * @returns\n   * @memberof MgtPeoplePicker\n   */\n  protected renderLoading = (): TemplateResult => {\n    return (\n      this.renderTemplate('loading', null) ||\n      mgtHtml`\n         <div class=\"message-parent\">\n           <mgt-spinner></mgt-spinner>\n           <div aria-label=\"${this.strings.loadingMessage}\" class=\"loading-text\">\n             ${this.strings.loadingMessage}\n           </div>\n         </div>\n       `\n    );\n  };\n\n  /**\n   * Render the state when no results are found for the search query.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtPeoplePicker\n   */\n  protected renderNoData(): TemplateResult {\n    if (!this._isFocused) {\n      return;\n    }\n    return (\n      this.renderTemplate('error', null) ||\n      this.renderTemplate('no-data', null) ||\n      html`\n         <div class=\"message-parent\">\n           <div aria-label=${this.strings.noResultsFound} class=\"search-error-text\">\n             ${this.strings.noResultsFound}\n           </div>\n         </div>\n       `\n    );\n  }\n\n  /**\n   * Render the list of search results.\n   *\n   * @protected\n   * @param {IDynamicPerson[]} people\n   * @returns\n   * @memberof MgtPeoplePicker\n   */\n  protected renderSearchResults(people: IDynamicPerson[]) {\n    const filteredPeople = people.filter(person => person.id);\n    return html`\n      <ul\n        id=\"suggestions-list\"\n        class=\"searched-people-list\"\n        role=\"listbox\"\n        aria-live=\"polite\"\n        title=${this.strings.suggestionsTitle}\n      >\n        ${repeat(\n          filteredPeople,\n          person => person.id,\n          person => html`\n          <li\n            id=\"${person.id}\"\n            class=\"searched-people-list-result\"\n            role=\"option\"\n            @click=\"${() => this.handleSuggestionClick(person)}\">\n              ${this.renderPersonResult(person)}\n          </li>\n        `\n        )}\n      </ul>\n     `;\n  }\n\n  /**\n   * Render an individual person search result.\n   *\n   * @protected\n   * @param {IDynamicPerson} person\n   * @returns {TemplateResult}\n   * @memberof MgtPeoplePicker\n   */\n  protected renderPersonResult(person: IDynamicPerson): TemplateResult {\n    return (\n      this.renderTemplate('person', { person }, person.id) ||\n      mgtHtml`\n         <mgt-person\n          class=\"person-image-result\"\n          ?show-presence=${this.showPresence}\n          view=\"twolines\"\n          line2-property=\"jobTitle,mail\"\n          .personDetails=${person}\n          ?fetch-image=${!this.disableImages}\n          person-card=\"none\"\n        ></mgt-person>`\n    );\n  }\n\n  /**\n   * Render an individual selected person token.\n   *\n   * @protected\n   * @param {IDynamicPerson} person\n   * @returns {TemplateResult}\n   * @memberof MgtPeoplePicker\n   */\n  protected renderSelectedPerson(person: IDynamicPerson): TemplateResult {\n    return mgtHtml`\n       <mgt-person\n         class=\"person-image-selected\"\n         .personDetails=${person}\n         ?fetch-image=${!this.disableImages}\n         view=\"oneline\"\n         person-card=${this.personCardInteraction}\n        ></mgt-person>\n     `;\n  }\n\n  /**\n   * Async query to Graph for members of group if determined by developer.\n   * set's `this.groupPeople` to those members.\n   */\n  protected async loadState(): Promise<void> {\n    this._groupPeople = null;\n    this._foundPeople = null;\n    this.defaultPeople = null;\n    let people = this.people;\n    const input = this.userInput.toLowerCase();\n    const provider = Providers.globalProvider;\n\n    if (people?.length) {\n      if (input) {\n        const displayNameMatch = people.filter(person => person?.displayName.toLowerCase().includes(input));\n        people = displayNameMatch;\n      }\n    } else if (!people && provider && provider.state === ProviderState.SignedIn) {\n      const graph = provider.graph.forComponent(this);\n\n      if (!input.length) {\n        if (this.defaultPeople) {\n          people = this.defaultPeople;\n        } else {\n          if (this.groupId || this.groupIds.length) {\n            if (this._groupPeople === null) {\n              if (this.groupId) {\n                try {\n                  if (this.type === 'group') {\n                    this._groupPeople = await findGroupMembers(\n                      graph,\n                      null,\n                      this.groupId,\n                      this.showMax,\n                      this.type,\n                      this.transitiveSearch\n                    );\n                  } else {\n                    this._groupPeople = await findGroupMembers(\n                      graph,\n                      null,\n                      this.groupId,\n                      this.showMax,\n                      this.type,\n                      this.transitiveSearch,\n                      this.userFilters,\n                      this.peopleFilters\n                    );\n                  }\n                } catch (_) {\n                  this._groupPeople = [];\n                }\n              } else {\n                if (this.type === 'group') {\n                  try {\n                    this._groupPeople = await getGroupsForGroupIds(graph, this.groupIds, this.groupFilters);\n                  } catch (_) {\n                    this._groupPeople = [];\n                  }\n                } else {\n                  try {\n                    const peopleInGroups = await findUsersFromGroupIds(\n                      graph,\n                      '',\n                      this.groupIds,\n                      this.showMax,\n                      this.type,\n                      this.transitiveSearch,\n                      this.userFilters\n                    );\n                    this._groupPeople = peopleInGroups;\n                  } catch (_) {\n                    this._groupPeople = [];\n                  }\n                }\n              }\n            }\n            people = this._groupPeople || [];\n          } else if (this.type === 'person' || this.type === 'any') {\n            if (this.userIds.length) {\n              people = await getUsersForUserIds(graph, this.userIds, '', this.userFilters);\n            } else {\n              const isUserOrContactType = this.userType === 'user' || this.userType === 'contact';\n              if (this.userFilters && isUserOrContactType) {\n                people = await getUsers(graph, this.userFilters, this.showMax);\n              } else {\n                people = await getPeople(graph, this.userType, this.peopleFilters, this.showMax);\n              }\n            }\n          } else if (this.type === 'group') {\n            let groups = (await findGroups(graph, '', this.showMax, this.groupType, this.groupFilters)) || [];\n            // eslint-disable-next-line @typescript-eslint/dot-notation\n            if (groups.length > 0 && groups[0]['value']) {\n              // eslint-disable-next-line @typescript-eslint/dot-notation, @typescript-eslint/no-unsafe-assignment\n              groups = groups[0]['value'];\n            }\n            people = groups;\n          }\n          this.defaultPeople = people;\n        }\n      }\n\n      if (\n        (this.defaultSelectedUserIds.length > 0 || this.defaultSelectedGroupIds.length > 0) &&\n        !this.selectedPeople.length &&\n        !this.defaultSelectedUsers.length &&\n        !this.defaultSelectedGroups.length\n      ) {\n        this.defaultSelectedUsers = await getUsersForUserIds(graph, this.defaultSelectedUserIds, '', this.userFilters);\n        this.defaultSelectedGroups = await getGroupsForGroupIds(\n          graph,\n          this.defaultSelectedGroupIds,\n          this.peopleFilters\n        );\n\n        this.defaultSelectedGroups = this.defaultSelectedGroups.filter(group => {\n          return group !== null;\n        });\n\n        this.defaultSelectedUsers = this.defaultSelectedUsers.filter(user => {\n          return user !== null;\n        });\n\n        this.selectedPeople = [...this.defaultSelectedUsers, ...this.defaultSelectedGroups];\n        this.requestUpdate();\n      }\n\n      if (input) {\n        people = [];\n\n        if (this.groupId) {\n          people =\n            (await findGroupMembers(\n              graph,\n              input,\n              this.groupId,\n              this.showMax,\n              this.type,\n              this.transitiveSearch,\n              this.userFilters,\n              this.peopleFilters\n            )) || [];\n        } else {\n          if (this.type === 'person' || this.type === 'any') {\n            try {\n              // Default UserType === any\n              if (this.userType === 'contact' || this.userType === 'user') {\n                // we might have a user-filters property set, search for users with it.\n                if (this.userIds?.length) {\n                  // has the user-ids property set\n                  people = await getUsersForUserIds(graph, this.userIds, input, this.userFilters);\n                } else {\n                  people = await findUsers(graph, input, this.showMax, this.userFilters);\n                }\n              } else {\n                if (!this.groupIds.length) {\n                  if (this.userIds?.length) {\n                    // has the user-ids property set\n                    people = await getUsersForUserIds(graph, this.userIds, input, this.userFilters);\n                  } else {\n                    people = (await findPeople(graph, input, this.showMax, this.userType, this.peopleFilters)) || [];\n                  }\n                } else {\n                  // Does not work when the PersonType = person.\n                  try {\n                    people = await findUsersFromGroupIds(\n                      graph,\n                      input,\n                      this.groupIds,\n                      this.showMax,\n                      this.type,\n                      this.transitiveSearch,\n                      this.userFilters\n                    );\n                  } catch (_) {\n                    // nop\n                  }\n                }\n              }\n            } catch (e) {\n              // nop\n            }\n\n            // Don't follow this path if a people-filters attribute is set on the component as the\n            // default type === PersonType.person\n            if (people && people.length < this.showMax && this.userType !== 'contact' && this.type !== 'person') {\n              try {\n                const users = (await findUsers(graph, input, this.showMax, this.userFilters)) || [];\n\n                // make sure only unique people\n                const peopleIds = new Set(people.map(p => p.id));\n                for (const user of users) {\n                  if (!peopleIds.has(user.id)) {\n                    people.push(user);\n                  }\n                }\n              } catch (e) {\n                // no-op\n              }\n            }\n          }\n\n          if ((this.type === 'group' || this.type === 'any') && people.length < this.showMax) {\n            if (this.groupIds.length) {\n              try {\n                people = await findGroupsFromGroupIds(\n                  graph,\n                  input,\n                  this.groupIds,\n                  this.showMax,\n                  this.groupType,\n                  this.userFilters\n                );\n              } catch (_) {\n                // no-op\n              }\n            } else {\n              let groups = [];\n              try {\n                groups = (await findGroups(graph, input, this.showMax, this.groupType, this.groupFilters)) || [];\n                people = people.concat(groups);\n              } catch (e) {\n                // nop\n              }\n            }\n          }\n        }\n      }\n    }\n    // people = this.getUniquePeople(people);\n    this._foundPeople = this.filterPeople(people);\n  }\n\n  /**\n   * Gets the Groups in a list of group IDs.\n   *\n   * @param graph the graph object\n   * @param people already found groups\n   * @returns groups found\n   */\n  private async getGroupsForGroupIds(graph: IGraph, people: IDynamicPerson[]) {\n    const groups = await getGroupsForGroupIds(graph, this.groupIds, this.groupFilters);\n    for (const group of groups as IDynamicPerson[]) {\n      people = people.concat(group);\n    }\n    people = people.filter(person => person);\n    return people;\n  }\n\n  /**\n   * Hide the results flyout.\n   *\n   * @protected\n   * @memberof MgtPeoplePicker\n   */\n  protected hideFlyout(): void {\n    const flyout = this.flyout;\n    if (flyout) {\n      flyout.close();\n    }\n    if (this.input) {\n      this.input.setAttribute('aria-activedescendant', '');\n    }\n    this._arrowSelectionCount = -1;\n  }\n\n  /**\n   * Show the results flyout.\n   *\n   * @protected\n   * @memberof MgtPeoplePicker\n   */\n  protected showFlyout(): void {\n    const flyout = this.flyout;\n    if (flyout) {\n      flyout.open();\n    }\n    this._arrowSelectionCount = -1;\n  }\n\n  /**\n   * Removes person from selected people\n   *\n   * @param person - person and details pertaining to user selected\n   */\n  protected removePerson(person: IDynamicPerson, e: UIEvent): void {\n    e.stopPropagation();\n    const filteredPersonArr = this.selectedPeople.filter(p => {\n      if (!person.id && p.displayName) {\n        return p.displayName !== person.displayName;\n      }\n      return p.id !== person.id;\n    });\n    if (this.hasMaxSelections) {\n      this.enableTextInput();\n    }\n    this.selectedPeople = filteredPersonArr;\n    void this.loadState();\n  }\n\n  /**\n   * Checks if key pressed is an `Enter` key before removing person\n   *\n   * @param person\n   * @param e\n   */\n  protected handleRemovePersonKeyDown(person: IDynamicPerson, e: KeyboardEvent): void {\n    if (e.key === 'Enter') {\n      this.removePerson(person, e);\n    }\n  }\n\n  /**\n   * Tracks when user selects person from picker\n   *\n   * @param person - contains details pertaining to selected user\n   * @param event - tracks user event\n   */\n  protected addPerson(person: IDynamicPerson): void {\n    if (person) {\n      setTimeout(() => {\n        this.clearInput();\n      }, 50);\n      const duplicatePeople = this.selectedPeople.filter(p => {\n        if (!person.id && p.displayName) {\n          return p.displayName === person.displayName;\n        }\n        return p.id === person.id;\n      });\n\n      if (duplicatePeople.length === 0) {\n        this.selectedPeople = [...this.selectedPeople, person];\n        void this.loadState();\n        this._foundPeople = [];\n        this._arrowSelectionCount = -1;\n      }\n    }\n  }\n\n  private clearInput() {\n    this.clearHighlighted();\n    if (this.selectionMode !== 'single') {\n      this.input.value = '';\n    }\n    this.userInput = '';\n  }\n\n  // handle input click\n  private readonly handleInputClick = () => {\n    if (!this.flyout.isOpen) {\n      this.handleUserSearch();\n    }\n  };\n\n  // handle input focus\n  private readonly gainedFocus = () => {\n    this.clearHighlighted();\n    this._isFocused = true;\n    void this.loadState();\n    this.showFlyout();\n  };\n\n  // handle input blur\n  private readonly lostFocus = () => {\n    this._isFocused = false;\n    if (this.input) {\n      this.input.setAttribute('aria-activedescendant', '');\n    }\n\n    const peopleList = this.renderRoot.querySelector('.people-list');\n\n    if (peopleList) {\n      for (const el of peopleList.children) {\n        el.classList.remove('focused');\n        el.setAttribute('aria-selected', 'false');\n      }\n    }\n\n    this.requestUpdate();\n  };\n\n  /**\n   * Handles input from the key up events on the keyboard.\n   */\n  private readonly onUserKeyUp = (event: KeyboardEvent): void => {\n    const keyName = event.key;\n    const isCmdOrCtrlKey = event.getModifierState('Control') || event.getModifierState('Meta');\n    const isPaste = isCmdOrCtrlKey && keyName === 'v';\n    const isArrowKey = ['ArrowDown', 'ArrowRight', 'ArrowUp', 'ArrowLeft'].includes(keyName);\n\n    if ((!isPaste && isCmdOrCtrlKey) || isArrowKey) {\n      if (isCmdOrCtrlKey || ['ArrowLeft', 'ArrowRight'].includes(keyName)) {\n        // Only hide the flyout when you're doing selections with Left/Right Arrow key\n        this.hideFlyout();\n      }\n\n      if (keyName === 'ArrowDown') {\n        if (!this.flyout.isOpen && this._isFocused) {\n          this.handleUserSearch();\n        }\n      }\n      return;\n    }\n\n    if (['Tab', 'Enter', 'Shift'].includes(keyName)) return;\n\n    if (keyName === 'Escape') {\n      this.clearInput();\n      this._foundPeople = [];\n      this._arrowSelectionCount = -1;\n      return;\n    }\n\n    if (keyName === 'Backspace' && this.userInput.length === 0 && this.selectedPeople.length > 0) {\n      this.clearHighlighted();\n      // remove last person in selected list\n      this.selectedPeople = this.selectedPeople.splice(0, this.selectedPeople.length - 1);\n      void this.loadState();\n      this.hideFlyout();\n      return;\n    }\n\n    if ([';', ','].includes(keyName)) {\n      if (this.allowAnyEmail) {\n        this._setAnyEmail = true;\n        event.preventDefault();\n        event.stopPropagation();\n      }\n      return;\n    }\n  };\n\n  private readonly onUserInput = (event: InputEvent) => {\n    const input = event.target as HTMLInputElement;\n    this.userInput = input.value;\n    if (this.userInput) {\n      const validEmail = isValidEmail(this.userInput);\n      if (validEmail && this.allowAnyEmail) {\n        if (this._setAnyEmail) {\n          this.handleAnyEmail();\n        }\n      } else {\n        this.handleUserSearch();\n      }\n      this._setAnyEmail = false;\n    }\n  };\n\n  private handleAnyEmail() {\n    this._arrowSelectionCount = -1;\n    if (isValidEmail(this.userInput)) {\n      const anyMailUser = {\n        mail: this.userInput,\n        displayName: this.userInput\n      };\n      this.addPerson(anyMailUser);\n    }\n    this.hideFlyout();\n    if (this.input) {\n      this.input.focus();\n      this._isFocused = true;\n    }\n  }\n\n  // handle suggestion list item click\n  private handleSuggestionClick(person: IDynamicPerson): void {\n    this.addPerson(person);\n    if (this.hasMaxSelections) {\n      this.disableTextInput();\n      this.input.value = '';\n    }\n    this.hideFlyout();\n  }\n\n  /**\n   * Tracks event on user input in search\n   *\n   * @param input - input text\n   */\n  private handleUserSearch() {\n    if (!this._debouncedSearch) {\n      this._debouncedSearch = debounce(async () => {\n        await this._task.run();\n        this._arrowSelectionCount = -1;\n        this.showFlyout();\n      }, 400);\n    }\n\n    this._debouncedSearch();\n  }\n\n  /**\n   * Tracks event on user search (keydown)\n   *\n   * @param event - event tracked on user input (keydown)\n   */\n  private readonly onUserKeyDown = (event: KeyboardEvent): void => {\n    event.stopPropagation();\n    const keyName = event.key;\n    const selectedList = this.renderRoot.querySelector('.selected-list');\n    const isCmdOrCtrlKey = event.getModifierState('Control') || event.getModifierState('Meta');\n    if (isCmdOrCtrlKey && selectedList) {\n      const selectedPeople = selectedList.querySelectorAll('mgt-person.person-image-selected');\n      this.hideFlyout();\n      if (isCmdOrCtrlKey && keyName === 'ArrowLeft') {\n        this._currentHighlightedUserPos =\n          (this._currentHighlightedUserPos - 1 + selectedPeople.length) % selectedPeople.length;\n        if (this._currentHighlightedUserPos >= 0 && !Number.isNaN(this._currentHighlightedUserPos)) {\n          this._highlightedUsers.push(selectedPeople[this._currentHighlightedUserPos]);\n        } else {\n          this._currentHighlightedUserPos = 0;\n        }\n      } else if (isCmdOrCtrlKey && keyName === 'ArrowRight') {\n        const person = this._highlightedUsers.pop();\n        if (person) {\n          const personParent = person.parentElement;\n          if (personParent) {\n            this.clearHighlighted(personParent);\n            this._currentHighlightedUserPos++;\n          }\n        }\n      } else if (isCmdOrCtrlKey && keyName === 'a') {\n        this._highlightedUsers = [];\n        selectedPeople.forEach(person => this._highlightedUsers.push(person));\n      }\n      if (this._highlightedUsers) {\n        this.highlightSelectedPeople(this._highlightedUsers);\n      }\n      return;\n    }\n\n    this.clearHighlighted();\n\n    if (!this.flyout.isOpen) {\n      return;\n    }\n\n    if (keyName === 'ArrowUp' || keyName === 'ArrowDown') {\n      this.handleArrowSelection(event);\n      event.preventDefault();\n    }\n\n    if (keyName === 'Enter') {\n      if (!event.shiftKey && this._foundPeople) {\n        event.preventDefault();\n\n        const foundPerson = this._foundPeople[this._arrowSelectionCount];\n        if (foundPerson) {\n          this.addPerson(foundPerson);\n          this.hideFlyout();\n          this.input.value = '';\n          if (this.hasMaxSelections) {\n            this.disableTextInput();\n          }\n          return;\n        }\n      }\n\n      if (this.allowAnyEmail) {\n        this.handleAnyEmail();\n      } else {\n        this.showFlyout();\n      }\n    }\n\n    if ([';', ',', 'Tab'].includes(keyName)) {\n      if (this.allowAnyEmail) {\n        // need to ensure the tab key does tab things\n        if ('Tab' !== keyName) event.preventDefault();\n        this.userInput = this.input.value;\n        this.handleAnyEmail();\n      }\n    }\n    // need to ensure that the tab key hides the flyout even if the input doesn't have an email address\n    if (keyName === 'Tab') {\n      this.hideFlyout();\n    }\n  };\n\n  /**\n   * Gets the text of the highlighed people and writes it to the clipboard\n   */\n  private async writeHighlightedText() {\n    const copyText = [];\n    for (const element of this._highlightedUsers) {\n      // eslint-disable-next-line @typescript-eslint/dot-notation\n      const { id, displayName, mail, userPrincipalName, scoredEmailAddresses } = element['_personDetails'] as Person &\n        User;\n      let emailAddress: string;\n      if (scoredEmailAddresses && scoredEmailAddresses.length > 0) {\n        emailAddress = scoredEmailAddresses.pop().address;\n      } else {\n        emailAddress = userPrincipalName || mail;\n      }\n\n      copyText.push({ id, displayName, email: emailAddress });\n    }\n    let copiedTextStr = '';\n    if (copyText.length > 0) {\n      copiedTextStr = JSON.stringify(copyText);\n    }\n\n    await navigator.clipboard.writeText(copiedTextStr);\n  }\n\n  /**\n   * Handles the cut event when it is fired\n   */\n  private readonly handleCut = () => {\n    this.writeHighlightedText().then(\n      () => {\n        this.removeHighlightedOnCut();\n      },\n      () => {\n        // intentionally left blank\n      }\n    );\n  };\n\n  /**\n   * Handles the copy event when it is fired\n   */\n  private readonly handleCopy = () => {\n    void this.writeHighlightedText();\n  };\n\n  /**\n   * Parses the copied people text and adds them when you paste\n   */\n  private readonly handlePaste = () => {\n    navigator.clipboard.readText().then(\n      copiedText => {\n        if (copiedText) {\n          try {\n            const people: IDynamicPerson[] = JSON.parse(copiedText) as IDynamicPerson[];\n            if (people && people.length > 0) {\n              for (const person of people) {\n                this.addPerson(person);\n              }\n            }\n          } catch (error) {\n            if (error instanceof SyntaxError) {\n              const delimiters = [',', ';'];\n              let listOfUsers: string[];\n              try {\n                for (const delimiter of delimiters) {\n                  listOfUsers = copiedText.split(delimiter);\n                  if (listOfUsers.length > 1) {\n                    this.hideFlyout();\n                    void this.selectUsersById(listOfUsers);\n                    break;\n                  }\n                }\n                // eslint-disable-next-line no-empty\n              } catch (_) {}\n            }\n          }\n        }\n      },\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      error => {\n        // 'navigator.clipboard.readText is not a function' error is thrown in Mozilla\n        // more information here https://developer.mozilla.org/en-US/docs/Web/API/Clipboard/readText#browser_compatibility\n        // Firefox only supports reading the clipboard in browser extensions,\n        // using the \"clipboardRead\" extension permission.\n      }\n    );\n  };\n\n  /**\n   * Removes only the highlighted elements from the peoplePicker during cut operations.\n   */\n  private removeHighlightedOnCut() {\n    this.selectedPeople = this.selectedPeople.splice(0, this.selectedPeople.length - this._highlightedUsers.length);\n    this._highlightedUsers = [];\n    this._currentHighlightedUserPos = 0;\n    void this.loadState();\n    this.hideFlyout();\n  }\n  /**\n   * Changes the color class to show which people are selected for copy/cut-paste\n   *\n   * @param people list of selected people classes\n   */\n  private highlightSelectedPeople(people: Element[]) {\n    for (const person of people) {\n      const parentElement = person?.parentElement;\n      parentElement.classList.add('highlighted');\n    }\n  }\n\n  /**\n   * Defaults the people class back to the normal view\n   */\n  private clearHighlighted(node?: Element) {\n    if (node) {\n      node.classList.remove('highlighted');\n    } else {\n      for (const person of this._highlightedUsers) {\n        const parentElement = person.parentElement;\n        if (parentElement) {\n          parentElement.classList.remove('highlighted');\n        }\n      }\n      this._highlightedUsers = [];\n      this._currentHighlightedUserPos = 0;\n    }\n  }\n\n  /**\n   * Tracks user key selection for arrow key selection of people\n   *\n   * @param event - tracks user key selection\n   */\n  private handleArrowSelection(event?: KeyboardEvent): void {\n    const peopleList = this.renderRoot.querySelector('.searched-people-list');\n\n    if (peopleList?.children?.length) {\n      if (event) {\n        // update arrow count\n        if (event.key === 'ArrowUp') {\n          if (this._arrowSelectionCount === -1) {\n            this._arrowSelectionCount = 0;\n          } else {\n            this._arrowSelectionCount =\n              (this._arrowSelectionCount - 1 + peopleList.children.length) % peopleList.children.length;\n          }\n        }\n        if (event.key === 'ArrowDown') {\n          if (this._arrowSelectionCount === -1) {\n            this._arrowSelectionCount = 0;\n          } else {\n            this._arrowSelectionCount =\n              (this._arrowSelectionCount + 1 + peopleList.children.length) % peopleList.children.length;\n          }\n        }\n      }\n\n      for (const person of peopleList?.children ?? []) {\n        const p = person as HTMLElement;\n        p.setAttribute('aria-selected', 'false');\n        p.blur();\n        p.removeAttribute('tabindex');\n      }\n\n      // set selected background\n      // set aria-selected to true\n      const focusedItem = peopleList.children[this._arrowSelectionCount] as HTMLElement;\n\n      if (focusedItem) {\n        focusedItem.setAttribute('tabindex', '0');\n        focusedItem.focus();\n        focusedItem.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'nearest' });\n        focusedItem.setAttribute('aria-selected', 'true');\n        this.input.setAttribute('aria-activedescendant', focusedItem?.id);\n      }\n    }\n  }\n\n  /**\n   * Filters people searched from already selected people\n   *\n   * @param people - array of people returned from query to Graph\n   */\n  private filterPeople(people: IDynamicPerson[]): IDynamicPerson[] {\n    // check if people need to be updated\n    // ensuring people list is displayed\n    // find ids from selected people\n    const uniquePeople: IDynamicPerson[] = [];\n    if (people && people.length > 0) {\n      people = people.filter(person => person);\n      const idFilter = this.selectedPeople.map(el => {\n        return el.id ? el.id : el.displayName;\n      });\n\n      // filter id's\n      const filtered = people.filter((person: IDynamicPerson) => {\n        if (person?.id) {\n          return idFilter.indexOf(person.id) === -1;\n        } else {\n          return idFilter.indexOf(person?.displayName) === -1;\n        }\n      });\n\n      // remove duplicates\n      const dupsSet = new Set<string>();\n      for (const d of filtered) {\n        const person = JSON.stringify(d);\n        dupsSet.add(person);\n      }\n\n      dupsSet.forEach((person: string) => {\n        const p: IDynamicPerson = JSON.parse(person) as IDynamicPerson;\n        uniquePeople.push(p);\n      });\n    }\n    return uniquePeople;\n  }\n\n  // stop propagating wheel event to flyout so mouse scrolling works\n  private handleSectionScroll(e: WheelEvent) {\n    const target = this.renderRoot.querySelector('.flyout-root');\n    if (target) {\n      if (\n        !(e.deltaY < 0 && target.scrollTop === 0) &&\n        !(e.deltaY > 0 && target.clientHeight + target.scrollTop >= target.scrollHeight - 1)\n      ) {\n        e.stopPropagation();\n      }\n    }\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\nexport const strings = {\n  removeTaskSubtitle: 'Delete Task',\n  cancelNewTaskSubtitle: 'Cancel',\n  newTaskPlaceholder: 'Adding a task...',\n  addTaskButtonSubtitle: 'Add',\n  due: 'Due ',\n  addTaskDate: 'Add the task date',\n  assign: 'Assign',\n  planNotFound: 'Plan not found',\n  plansSelfAssigned: 'All Plans',\n  bucketNotFound: 'Bucket not found',\n  bucketsSelfAssigned: 'All Tasks',\n  baseSelfAssigned: 'Assigned to Me'\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { fluentMenu, fluentMenuItem, fluentButton } from '@fluentui/web-components';\nimport { MgtBaseTaskComponent } from '@microsoft/mgt-element';\nimport { html } from 'lit';\nimport { property } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { strings } from './strings';\nimport { registerFluentComponents } from '../../../utils/FluentComponents';\nimport { styles } from './mgt-dot-options-css';\nimport { registerComponent } from '@microsoft/mgt-element';\nimport { SvgIcon, getSvg } from '../../../utils/SvgHelper';\n\n/**\n * Defines the event functions passed to the option item.\n */\ntype MenuOptionEventFunction = (e: Event) => void;\n\nexport const registerMgtDotOptionsComponent = () => {\n  registerFluentComponents(fluentMenu, fluentMenuItem, fluentButton);\n  registerComponent('dot-options', MgtDotOptions);\n};\n\n/**\n * Custom Component used to handle an arrow rendering for TaskGroups utilized in the task component.\n *\n * @export MgtDotOptions\n * @class MgtDotOptions\n * @extends {MgtBaseComponent}\n */\n\nexport class MgtDotOptions extends MgtBaseTaskComponent {\n  /**\n   * Array of styles to apply to the element. The styles should be defined\n   * user the `css` tag function.\n   */\n  public static get styles() {\n    return styles;\n  }\n\n  /**\n   * Strings for localization\n   *\n   * @readonly\n   * @protected\n   * @memberof MgtDotOptions\n   */\n  protected get strings() {\n    return strings;\n  }\n\n  /**\n   * Determines if header menu is rendered or hidden.\n   *\n   * @type {boolean}\n   * @memberof MgtDotOptions\n   */\n  @property({ type: Boolean }) public open: boolean;\n\n  /**\n   * Menu options to be rendered with an attached MouseEvent handler for expansion of details\n   *\n   * @memberof MgtDotOptions\n   */\n  @property({ type: Object }) public options: Record<string, (e: Event) => void>;\n\n  private readonly _clickHandler = () => (this.open = false);\n\n  public connectedCallback() {\n    super.connectedCallback();\n    window.addEventListener('click', this._clickHandler);\n  }\n\n  public disconnectedCallback() {\n    window.removeEventListener('click', this._clickHandler);\n    super.disconnectedCallback();\n  }\n\n  /**\n   * Invoked from the base class render method when the _task is in a completed state.\n   */\n  public readonly renderContent = () => {\n    const menuOptions = Object.keys(this.options);\n    return html`\n      <fluent-button\n        appearance=\"stealth\"\n        aria-label=${this.strings.dotOptionsTitle}\n        @click=${this.onDotClick}\n        @keydown=${this.onDotKeydown}\n        class=\"dot-icon\">${getSvg(SvgIcon.Dot)}</fluent-button>\n      <fluent-menu class=${classMap({ menu: true, open: this.open })}>\n        ${menuOptions.map(opt => this.getMenuOption(opt, this.options[opt]))}\n      </fluent-menu>`;\n  };\n\n  private readonly handleItemClick = (e: MouseEvent, fn: MenuOptionEventFunction) => {\n    e.preventDefault();\n    e.stopPropagation();\n    fn(e);\n    this.open = false;\n  };\n\n  private readonly handleItemKeydown = (e: KeyboardEvent, fn: MenuOptionEventFunction) => {\n    this.handleKeydownMenuOption(e);\n    fn(e);\n    this.open = false;\n  };\n\n  /**\n   * Used by the render method to attach click handler to each dot item\n   *\n   * @param {string} name\n   * @param {MenuOptionEventFunction} clickFn\n   * @returns\n   * @memberof MgtDotOptions\n   */\n  public getMenuOption(name: string, clickFn: (e: Event) => void) {\n    return html`\n      <fluent-menu-item\n        @click=${(e: MouseEvent) => this.handleItemClick(e, clickFn)}\n        @keydown=${(e: KeyboardEvent) => this.handleItemKeydown(e, clickFn)}>\n          ${name}\n      </fluent-menu-item>`;\n  }\n\n  private readonly onDotClick = (e: MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    this.open = !this.open;\n  };\n\n  private readonly onDotKeydown = (e: KeyboardEvent) => {\n    if (e.key === 'Enter') {\n      e.preventDefault();\n      e.stopPropagation();\n\n      this.open = !this.open;\n    }\n  };\n\n  private handleKeydownMenuOption(e: KeyboardEvent) {\n    if (e.key === 'Enter') {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { html } from 'lit';\nimport { property } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { MgtBaseTaskComponent } from '@microsoft/mgt-element';\nimport { styles } from './mgt-arrow-options-css';\nimport { registerFluentComponents } from '../../../utils/FluentComponents';\nimport { fluentMenu, fluentMenuItem, fluentButton } from '@fluentui/web-components';\nimport { registerComponent } from '@microsoft/mgt-element';\n\n/*\n  Ok, the name here deserves a bit of explanation,\n  This component originally had a built-in arrow icon,\n  The problem came when you wanted to use a different symbol,\n  So the arrow was removed, but the name was already set everywhere.\n  - benotter\n */\n\nexport const registerMgtArrowOptionsComponent = () => {\n  registerFluentComponents(fluentMenu, fluentMenuItem, fluentButton);\n  registerComponent('arrow-options', MgtArrowOptions);\n};\n\n/**\n * Custom Component used to handle an arrow rendering for TaskGroups utilized in the task component.\n *\n * @cssprop --arrow-options-left {Length} The distance of the dropdown menu from the left in absolute position. Default is 0.\n * @cssprop --arrow-options-button-background-color {Color} The background color of the arrow options button.\n * @cssprop --arrow-options-button-font-size {Length} The font size of the button text. Default is large.\n * @cssprop --arrow-options-button-font-weight {Length} The font weight of the button text. Default is 600.\n * @cssprop --arrow-options-button-font-color {Color} The font color of the text in the button.\n *\n * @export MgtArrowOptions\n * @class MgtArrowOptions\n * @extends {MgtBaseComponent}\n */\nexport class MgtArrowOptions extends MgtBaseTaskComponent {\n  /**\n   * Array of styles to apply to the element. The styles should be defined\n   * user the `css` tag function.\n   */\n  public static get styles() {\n    return styles;\n  }\n\n  /**\n   * Determines if header menu is rendered or hidden.\n   *\n   * @type {boolean}\n   * @memberof MgtArrowOptions\n   */\n  @property({ type: Boolean }) public open: boolean;\n\n  /**\n   * Title of chosen TaskGroup.\n   *\n   * @type {string}\n   * @memberof MgtArrowOptions\n   */\n  @property({ type: String }) public value: string;\n\n  /**\n   * Menu options to be rendered with an attached UIEvent handler for expansion of details\n   *\n   * @type {object}\n   * @memberof MgtArrowOptions\n   */\n  @property({ type: Object }) public options: Record<string, (e: UIEvent) => void>;\n\n  private readonly _clickHandler: (e: UIEvent) => void;\n\n  constructor() {\n    super();\n    this.value = '';\n    this.options = {};\n    this._clickHandler = () => (this.open = false);\n    window.addEventListener('onblur', () => (this.open = false));\n  }\n\n  public connectedCallback() {\n    super.connectedCallback();\n    window.addEventListener('click', this._clickHandler);\n  }\n\n  public disconnectedCallback() {\n    window.removeEventListener('click', this._clickHandler);\n    super.disconnectedCallback();\n  }\n\n  /**\n   * Handles clicking for header menu, utilizing boolean switch open\n   *\n   * @param {MouseEvent} e attaches to Header to open menu\n   * @memberof MgtArrowOptions\n   */\n  public onHeaderClick = (e: MouseEvent) => {\n    const keys = Object.keys(this.options);\n    if (keys.length > 1) {\n      e.preventDefault();\n      e.stopPropagation();\n      this.open = !this.open;\n    }\n  };\n\n  /**\n   * Handles key down presses done on the header element.\n   *\n   * @param {KeyboardEvent} e\n   */\n  private readonly onHeaderKeyDown = (e: KeyboardEvent) => {\n    if (e.key === 'Enter') {\n      e.preventDefault();\n      e.stopPropagation();\n      this.open = !this.open;\n\n      // Manually adding the 'open' class to display the menu because\n      // by the time I set the first element's focus, the classes are not\n      // updated and that has no effect. You can't set focus on elements\n      // that have no display.\n      const fluentMenuEl: HTMLElement = this.renderRoot.querySelector('fluent-menu');\n      if (fluentMenuEl) {\n        fluentMenuEl.classList.remove('closed');\n        fluentMenuEl.classList.add('open');\n      }\n\n      const header: HTMLButtonElement = e.target as HTMLButtonElement;\n      if (header) {\n        const firstMenuItem: HTMLElement = this.renderRoot.querySelector(\"fluent-menu-item[tabindex='0']\");\n        if (firstMenuItem) {\n          header.blur();\n          firstMenuItem.focus();\n        }\n      }\n    }\n  };\n\n  /**\n   * Invoked on each update to perform rendering tasks. This method must return\n   * a lit-html TemplateResult. Setting properties inside this method will *not*\n   * trigger the element to update.\n   */\n  public renderContent = () => {\n    return html`\n      <fluent-button\n        class=\"header\"\n        @click=${this.onHeaderClick}\n        @keydown=${this.onHeaderKeyDown}\n        appearance=\"lightweight\">\n          ${this.value}\n      </fluent-button>\n      <fluent-menu\n        class=${classMap({ menu: true, open: this.open, closed: !this.open })}>\n          ${this.getMenuOptions()}\n      </fluent-menu>`;\n  };\n\n  private getMenuOptions() {\n    const keys = Object.keys(this.options);\n\n    return keys.map((opt: string) => {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n      const clickFn = (e: MouseEvent) => {\n        this.open = false;\n        this.options[opt](e);\n      };\n\n      const keyDownFn = (e: KeyboardEvent) => {\n        const header: HTMLButtonElement = this.renderRoot.querySelector<HTMLButtonElement>('.header');\n        if (e.key === 'Enter') {\n          this.open = false;\n          this.options[opt](e);\n          header.focus();\n        } else if (e.key === 'Tab') {\n          this.open = false;\n        } else if (e.key === 'Escape') {\n          this.open = false;\n          if (header) {\n            header.focus();\n          }\n        }\n      };\n\n      return html`\n          <fluent-menu-item\n            @click=${clickFn}\n            @keydown=${keyDownFn}>\n              ${opt}\n          </fluent-menu-item>`;\n    });\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport {\n  ComponentMediaQuery,\n  MgtTemplatedTaskComponent,\n  ProviderState,\n  Providers,\n  mgtHtml\n} from '@microsoft/mgt-element';\nimport { Person, PlannerAssignments, PlannerTask, User } from '@microsoft/microsoft-graph-types';\nimport { Contact } from '@microsoft/microsoft-graph-types-beta';\nimport { HTMLTemplateResult, PropertyValueMap, TemplateResult, html } from 'lit';\nimport { property, state } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { ifDefined } from 'lit/directives/if-defined.js';\nimport { getMe } from '../../graph/graph.user';\nimport { getShortDateString } from '../../utils/Utils';\nimport { MgtPeoplePicker, registerMgtPeoplePickerComponent } from '../mgt-people-picker/mgt-people-picker';\nimport { MgtPeople, registerMgtPeopleComponent } from '../mgt-people/mgt-people';\nimport '../mgt-person/mgt-person';\nimport '../sub-components/mgt-arrow-options/mgt-arrow-options';\nimport '../sub-components/mgt-dot-options/mgt-dot-options';\nimport { MgtFlyout, registerMgtFlyoutComponent } from '../sub-components/mgt-flyout/mgt-flyout';\nimport { styles } from './mgt-planner-css';\nimport { strings } from './strings';\nimport { ITask, ITaskFolder, ITaskGroup, ITaskSource, PlannerTaskSource } from './task-sources';\nimport { getSvg, SvgIcon } from '../../utils/SvgHelper';\nimport { isElementDark } from '../../utils/isDark';\nimport { registerFluentComponents } from '../../utils/FluentComponents';\nimport {\n  fluentSelect,\n  fluentOption,\n  fluentTextField,\n  fluentButton,\n  fluentCheckbox,\n  fluentSkeleton\n} from '@fluentui/web-components';\nimport { registerComponent } from '@microsoft/mgt-element';\nimport { registerMgtDotOptionsComponent } from '../sub-components/mgt-dot-options/mgt-dot-options';\nimport { registerMgtArrowOptionsComponent } from '../sub-components/mgt-arrow-options/mgt-arrow-options';\n\n/*\n * Filter function\n */\nexport type TaskFilter = (task: PlannerTask) => boolean;\n\nconst plannerAssignment = {\n  '@odata.type': '#microsoft.graph.plannerAssignment',\n  orderHint: ' !'\n};\n\nexport const registerMgtPlannerComponent = () => {\n  registerFluentComponents(fluentSelect, fluentOption, fluentTextField, fluentButton, fluentCheckbox, fluentSkeleton);\n\n  registerMgtArrowOptionsComponent();\n  registerMgtDotOptionsComponent();\n  registerMgtFlyoutComponent();\n  registerMgtPeopleComponent();\n  registerMgtPeoplePickerComponent();\n  registerComponent('planner', MgtPlanner);\n};\n\n/**\n * Web component enables the user to view, add, remove, complete, or edit tasks. It works with tasks in Microsoft Planner.\n *\n * @export\n * @class MgtPlanner\n * @extends {MgtBaseComponent}\n *\n * @fires {CustomEvent<ITask>} taskAdded - Fires when a new task has been created.\n * @fires {CustomEvent<ITask>} taskChanged - Fires when task metadata has been changed, such as marking completed.\n * @fires {CustomEvent<ITask>} taskClick - Fires when the user clicks or taps on a task.\n * @fires {CustomEvent<ITask>} taskRemoved - Fires when an existing task has been deleted.\n *\n * @cssprop --tasks-header-padding - {String} Tasks header padding. Default is 0 0 14px 0.\n * @cssprop --tasks-header-margin - {String} Tasks header margin. Default is none.\n * @cssprop --tasks-header-text-font-size: {Length} the font size of the tasks header. Default is 24px.\n * @cssprop --tasks-header-text-font-weight: {Length} the font weight of the tasks header. Default is 600.\n * @cssprop --tasks-header-text-color: {Color} the font color of the tasks header.\n * @cssprop --tasks-header-text-hover-color: {Color} the font color of the tasks header when you hover on it.\n *\n * @cssprop --tasks-new-button-width - {Length} Tasks new button width. Default is none.\n * @cssprop --tasks-new-button-height - {Length} Tasks new button height. Default is none\n * @cssprop --tasks-new-button-text-color - {Color} Tasks new button text color.\n * @cssprop --tasks-new-button-text-font-weight - {Length} Tasks new button text font weight. Default is 700.\n * @cssprop --tasks-new-button-background - {Length} Tasks new button background.\n * @cssprop --tasks-new-button-border - {Length} Tasks new button border. Default is none.\n * @cssprop --tasks-new-button-background-hover - {Color} Tasks new button hover background.\n * @cssprop --tasks-new-button-background-active - {Color} Tasks new button active background.\n *\n * @cssprop --task-add-new-button-width - {Length} Add a new task button width. Default is none.\n * @cssprop --task-add-new-button-height - {Length} Add a new task button height. Default is none\n * @cssprop --task-add-new-button-text-color - {Color} Add a new task button text color.\n * @cssprop --task-add-new-button-text-font-weight - {Length} Add a new task button text font weight. Default is 700.\n * @cssprop --task-add-new-button-background - {Length} Add a new task button background.\n * @cssprop --task-add-new-button-border - {Length} Add a new task button border. Default is none.\n * @cssprop --task-add-new-button-background-hover - {Color} Add a new task button hover background.\n * @cssprop --task-add-new-button-background-active - {Color} Add a new task button active background.\n *\n * @cssprop --task-cancel-new-button-width - {Length} Cancel adding a new task button width. Default is none.\n * @cssprop --task-cancel-new-button-height - {Length} Cancel adding a new task button height. Default is none\n * @cssprop --task-cancel-new-button-text-color - {Color} Cancel adding a new task button text color.\n * @cssprop --task-cancel-new-button-text-font-weight - {Length} Cancel adding a new task button text font weight. Default is 700.\n * @cssprop --task-cancel-new-button-background - {Length} Cancel adding a new task button background.\n * @cssprop --task-cancel-new-button-border - {Length} Cancel adding a new task button border. Default is none.\n * @cssprop --task-cancel-new-button-background-hover - {Color} Cancel adding a new task button hover background.\n * @cssprop --task-cancel-new-button-background-active - {Color} Cancel adding a new task button active background.\n *\n * @cssprop --task-new-input-border - {Length} the border of the input for a new task. Default is fluent UI input border.\n * @cssprop --task-new-input-border-radius - {Length} the border radius of the input for a new task. Default is fluent UI input border.\n * @cssprop --task-new-input-background-color - {Color} the background color of the new task input.\n * @cssprop --task-new-input-hover-background-color - {Color} the background color of the new task input when you hover.\n * @cssprop --task-new-input-placeholder-color - {Color} the placeholder colder of the new task input.\n * @cssprop --task-new-dropdown-border - {Length} the border of the dropdown for a new task. Default is fluent UI dropdown border.\n * @cssprop --task-new-dropdown-border-radius - {Length} the border radius of the dropdown for a new task. Default is fluent UI dropdown border.\n * @cssprop --task-new-dropdown-background-color - {Color} the background color of the new task dropdown.\n * @cssprop --task-new-dropdown-hover-background-color - {Color} the background color of the new task dropdown when you hover.\n * @cssprop --task-new-dropdown-placeholder-color - {Color} the placeholder colder of the new task dropdown.\n * @cssprop --task-new-dropdown-list-background-color - {Color} the background color of the dropdown list options.\n * @cssprop --task-new-dropdown-option-text-color - {Color} the text color of the dropdown option text.\n * @cssprop --task-new-dropdown-option-hover-background-color - {Color} the background color of the dropdown option when you hover.\n * @cssprop --task-new-person-icon-color - {Color} color of the assign person text.\n * @cssprop --task-new-person-icon-text-color - {Color} color of the text beside the assign person icon.\n *\n * @cssprop --task-complete-checkbox-background-color - {Color} A completed task checkbox background color.\n * @cssprop --task-complete-checkbox-text-color - {Color} A completed task checkbox check color.\n * @cssprop --task-incomplete-checkbox-background-color - {Color} An incomplete task checkbox background color.\n * @cssprop --task-incomplete-checkbox-background-hover-color - {Color} An incomplete task checkbox background color.\n *\n * @cssprop --task-title-text-font-size - {Length} Task title text font size. Default is medium.\n * @cssprop --task-title-text-font-weight - {Length} Task title text font weight. Default is 600.\n * @cssprop --task-complete-title-text-color - {Length} Task title color for a complete task.\n * @cssprop --task-incomplete-title-text-color - {Length} Task title color for an incomplete task.\n *\n * @cssprop --task-icons-width - {Length} The icons in a task width size. Default is 20px;\n * @cssprop --task-icons-height - {Length} The icons in a task height size. Default is 20px;\n * @cssprop --task-icons-background-color - {Color} The icons in a task color background color.\n * @cssprop --task-icons-text-font-color - {Color} The text beside icons in a task color background color.\n * @cssprop --task-icons-text-font-size - {Length} The font size of the text beside icons in a task. Default is 12px.\n * @cssprop --task-icons-text-font-weight - {Length} The font weight of the text beside icons in a task. Default is 600.\n *\n * @cssprop --task-complete-background-color - {Color} The background color of a task that is complete.\n * @cssprop --task-incomplete-background-color - {Color} The background color of a task that is incomplete.\n * @cssprop --task-complete-border - {Length} The border of a task that is complete.  Default is 2px dotted var(--neutral-fill-strong-rest).\n * @cssprop --task-incomplete-border - {Length} The border of a task that is incomplete. Default is 1px solid var(--neutral-fill-strong-rest).\n * @cssprop --task-complete-border-radius - {Length} The border radius of a task that is incomplete. Default is 4px.\n * @cssprop --task-incomplete-border-radius - {Length} The border radius of a task that is incomplete. Default is 4px.\n * @cssprop --task-complete-padding - {Length} The padding of a task that is complete. Default is 10px.\n * @cssprop --task-incomplete-padding - {Length} The padding of a task that is incomplete. Default is 10px.\n * @cssprop --tasks-gap - {Length} The size of the gap between two tasks in a row. Default is 20px.\n *\n * @cssprop --tasks-background-color - {Color} the color of the background where the tasks are rendered.\n * @cssprop --tasks-border - {Length} the border of the area the tasks are rendered. Default is none.\n * @cssprop --tasks-border-radius - {Length} the border radius of the area where the tasks are rendered. Default is none.\n * @cssprop --tasks-padding - {Length} the padding of the are where the tasks are rendered. Default is 12px.\n */\nexport class MgtPlanner extends MgtTemplatedTaskComponent {\n  /**\n   * Array of styles to apply to the element. The styles should be defined\n   * using the `css` tag function.\n   */\n\n  public static get styles() {\n    return styles;\n  }\n\n  /**\n   * Strings for localization\n   *\n   * @readonly\n   * @protected\n   * @memberof MgtPlanner\n   */\n  protected get strings() {\n    return strings;\n  }\n\n  /**\n   * Get whether new task view is visible\n   *\n   * @memberof MgtPlanner\n   */\n  public get isNewTaskVisible(): boolean {\n    return this._isNewTaskVisible;\n  }\n\n  /**\n   * Set whether new task is visible\n   *\n   * @memberof MgtPlanner\n   */\n  public set isNewTaskVisible(value: boolean) {\n    this._isNewTaskVisible = value;\n    if (!value) {\n      this._newTaskDueDate = null;\n      this._newTaskName = '';\n      this._newTaskGroupId = '';\n      this._newTaskContainerId = '';\n    }\n  }\n\n  /**\n   * determines if tasks are un-editable\n   *\n   * @type {boolean}\n   */\n  @property({ attribute: 'read-only', type: Boolean })\n  public readOnly: boolean;\n\n  /**\n   * if set, the component will only show tasks from this plan\n   *\n   * @type {string}\n   */\n  @property({ attribute: 'target-id', type: String })\n  public targetId: string;\n\n  /**\n   * if set, the component will only show tasks from this bucket\n   *\n   * @type {string}\n   */\n  @property({ attribute: 'target-bucket-id', type: String })\n  public targetBucketId: string;\n\n  /**\n   * if set, the component will first show tasks from this plan\n   *\n   * @type {string}\n   * @memberof MgtPlanner\n   */\n  @property({ attribute: 'initial-id', type: String })\n  public initialId: string;\n\n  /**\n   * if set, the component will first show tasks from this bucket\n   *\n   * @type {string}\n   * @memberof MgtPlanner\n   */\n  @property({ attribute: 'initial-bucket-id', type: String })\n  public initialBucketId: string;\n\n  /**\n   * sets whether the header is rendered\n   *\n   * @type {boolean}\n   * @memberof MgtPlanner\n   */\n  @property({ attribute: 'hide-header', type: Boolean })\n  public hideHeader: boolean;\n\n  /**\n   * sets whether the options are rendered\n   *\n   * @type {boolean}\n   * @memberof MgtPlanner\n   */\n  @property({ attribute: 'hide-options', type: Boolean })\n  public hideOptions: boolean;\n\n  /**\n   * allows developer to define specific group id\n   *\n   * @type {string}\n   */\n  @property({ attribute: 'group-id', type: String })\n  public groupId: string;\n\n  /**\n   * Optional filter function when rendering tasks\n   *\n   * @type {TaskFilter}\n   * @memberof MgtPlanner\n   */\n  public taskFilter: TaskFilter;\n\n  /**\n   * Get the scopes required for tasks\n   *\n   * @static\n   * @return {*}  {string[]}\n   * @memberof MgtPlanner\n   */\n  public static get requiredScopes(): string[] {\n    return [\n      ...new Set([\n        'group.read.all',\n        'group.readwrite.all',\n        'tasks.read',\n        'tasks.readwrite',\n        ...MgtPeople.requiredScopes,\n        ...MgtPeoplePicker.requiredScopes\n      ])\n    ];\n  }\n\n  @state() private _isNewTaskVisible: boolean;\n  @state() private _newTaskBeingAdded: boolean;\n  @state() private _newTaskName: string;\n  @state() private _newTaskDueDate: Date;\n  @state() private _newTaskGroupId: string;\n  @state() private _newTaskFolderId: string;\n  @state() private _newTaskContainerId: string;\n  @state() private _groups: ITaskGroup[];\n  @state() private _folders: ITaskFolder[];\n  @state() private _tasks: ITask[];\n  @state() private _hiddenTasks: string[];\n  @state() private _inTaskLoad: boolean;\n  @state() private _hasDoneInitialLoad: boolean;\n\n  @state() private _currentGroup: string;\n  @state() private _currentFolder: string;\n  @state() private _isDarkMode = false;\n  @state() private _me: User = null;\n\n  private get filteredTasks(): ITask[] {\n    const temp = this._tasks\n      .filter(task => this.isTaskInSelectedGroupFilter(task))\n      .filter(task => this.isTaskInSelectedFolderFilter(task))\n      .filter(task => !this._hiddenTasks.includes(task.id));\n\n    if (this.taskFilter) {\n      return temp.filter(task => this.taskFilter(task._raw));\n    }\n    return temp;\n  }\n\n  private previousMediaQuery: ComponentMediaQuery;\n\n  constructor() {\n    super();\n    this.clearState();\n\n    this.previousMediaQuery = this.mediaQuery;\n  }\n\n  /**\n   * updates provider state\n   *\n   * @memberof MgtPlanner\n   */\n  public connectedCallback() {\n    super.connectedCallback();\n    window.addEventListener('resize', this.onResize);\n    window.addEventListener('darkmodechanged', this.onThemeChanged);\n    // invoked to ensure we have the correct initial value for _isDarkMode\n    this.onThemeChanged();\n  }\n\n  /**\n   * removes updates on provider state\n   *\n   * @memberof MgtPlanner\n   */\n  public disconnectedCallback() {\n    window.removeEventListener('resize', this.onResize);\n    window.removeEventListener('darkmodechanged', this.onThemeChanged);\n    super.disconnectedCallback();\n  }\n\n  /**\n   * clears state of component\n   */\n  protected clearState(): void {\n    this._newTaskFolderId = '';\n    this._newTaskGroupId = '';\n    this._newTaskDueDate = null;\n    this._newTaskName = '';\n    this._newTaskBeingAdded = false;\n\n    this._tasks = [];\n    this._folders = [];\n    this._groups = [];\n    this._hiddenTasks = [];\n\n    this._hasDoneInitialLoad = false;\n    this._inTaskLoad = false;\n  }\n\n  /**\n   * Invoked when the element is first updated. Implement to perform one time\n   * work on the element after update.\n   *\n   * Setting properties inside this method will trigger the element to update\n   * again after this update cycle completes.\n   *\n   * @param _changedProperties Map of changed properties with old values\n   */\n  protected firstUpdated(changedProperties: PropertyValueMap<unknown>) {\n    super.firstUpdated(changedProperties);\n\n    if (this.initialId && !this._currentGroup) {\n      this._currentGroup = this.initialId;\n    }\n\n    if (this.initialBucketId && !this._currentFolder) {\n      this._currentFolder = this.initialBucketId;\n    }\n  }\n\n  /**\n   * Renders the loading state of the component if the initial load has not been completed\n   * @returns {TemplateResult}\n   */\n  protected renderLoading = (): TemplateResult => {\n    if (!this._hasDoneInitialLoad) {\n      return this.renderLoadingTask();\n    }\n    return this.renderContent();\n  };\n\n  /**\n   * Renders the contentful state of the component.\n   */\n  protected renderContent = () => {\n    const loadingTask = this._inTaskLoad && !this._hasDoneInitialLoad ? this.renderLoadingTask() : null;\n\n    let header: TemplateResult;\n\n    if (!this.hideHeader) {\n      header = html`\n        <div class=\"header\">\n          ${this.renderPlanOptions()}\n        </div>\n      `;\n    }\n\n    return html`\n      ${header}\n      <div class=\"tasks\">\n        ${this._isNewTaskVisible ? this.renderNewTask() : null} ${loadingTask}\n        ${repeat(\n          this.filteredTasks,\n          task => task.id,\n          task => this.renderTask(task)\n        )}\n      </div>\n    `;\n  };\n\n  /**\n   * loads tasks from dataSource\n   *\n   * @returns\n   * @memberof MgtPlanner\n   */\n  protected async loadState() {\n    const ts = this.getTaskSource();\n    if (!ts) {\n      return;\n    }\n\n    const provider = Providers.globalProvider;\n    if (!provider || provider.state !== ProviderState.SignedIn) {\n      return;\n    }\n\n    this._inTaskLoad = true;\n    if (!this._me) {\n      const graph = provider.graph.forComponent(this);\n      this._me = await getMe(graph);\n    }\n\n    if (this.groupId) {\n      await this._loadTasksForGroup(ts);\n    } else if (this.targetId) {\n      await this._loadTargetPlannerTasks(ts);\n    } else {\n      await this._loadAllTasks(ts);\n    }\n\n    this._inTaskLoad = false;\n    this._hasDoneInitialLoad = true;\n  }\n\n  private readonly onResize = () => {\n    if (this.mediaQuery !== this.previousMediaQuery) {\n      this.previousMediaQuery = this.mediaQuery;\n      this.requestUpdate();\n    }\n  };\n\n  private readonly onThemeChanged = () => {\n    this._isDarkMode = isElementDark(this);\n  };\n\n  private async _loadTargetPlannerTasks(ts: ITaskSource) {\n    const group = await ts.getTaskGroup(this.targetId);\n    let folders = await ts.getTaskFoldersForTaskGroup(group.id);\n\n    if (this.targetBucketId) {\n      folders = folders.filter(folder => folder.id === this.targetBucketId);\n    }\n\n    const tasks = (\n      await Promise.all(folders.map(folder => ts.getTasksForTaskFolder(folder.id, folder.parentId)))\n    ).reduce((cur, ret) => [...cur, ...ret], []);\n\n    this._tasks = tasks;\n    this._folders = folders;\n    this._groups = [group];\n  }\n\n  private async _loadAllTasks(ts: ITaskSource) {\n    const groups = await ts.getTaskGroups();\n    const folders = (await Promise.all(groups.map(group => ts.getTaskFoldersForTaskGroup(group.id)))).reduce(\n      (cur, ret) => [...cur, ...ret],\n      []\n    );\n\n    const tasks = (\n      await Promise.all(folders.map(folder => ts.getTasksForTaskFolder(folder.id, folder.parentId)))\n    ).reduce((cur, ret) => [...cur, ...ret], []);\n\n    this._tasks = tasks;\n    this._folders = folders;\n    this._groups = groups;\n  }\n\n  private async _loadTasksForGroup(ts: ITaskSource) {\n    const groups = await ts.getTaskGroupsForGroup(this.groupId);\n    const folders = (await Promise.all(groups.map(group => ts.getTaskFoldersForTaskGroup(group.id)))).reduce(\n      (cur, ret) => [...cur, ...ret],\n      []\n    );\n\n    const tasks = (\n      await Promise.all(folders.map(folder => ts.getTasksForTaskFolder(folder.id, folder.parentId)))\n    ).reduce((cur, ret) => [...cur, ...ret], []);\n\n    this._tasks = tasks;\n    this._folders = folders;\n    this._groups = groups;\n  }\n\n  private async addTask(\n    name: string,\n    dueDate: Date,\n    topParentId: string,\n    immediateParentId: string,\n    assignments: PlannerAssignments = {}\n  ) {\n    const ts = this.getTaskSource();\n    if (!ts) {\n      return;\n    }\n\n    const newTask = {\n      assignments,\n      dueDate,\n      immediateParentId,\n      name,\n      topParentId\n    } as ITask;\n\n    this._newTaskBeingAdded = true;\n    newTask._raw = await ts.addTask(newTask);\n    this.fireCustomEvent('taskAdded', newTask);\n\n    this._newTaskBeingAdded = false;\n    this.isNewTaskVisible = false;\n    await this._task.run();\n  }\n\n  private async completeTask(task: ITask) {\n    const ts = this.getTaskSource();\n    if (!ts) {\n      return;\n    }\n    await ts.setTaskComplete(task);\n    this.fireCustomEvent('taskChanged', task);\n\n    await this._task.run();\n  }\n\n  private async uncompleteTask(task: ITask) {\n    const ts = this.getTaskSource();\n    if (!ts) {\n      return;\n    }\n\n    await ts.setTaskIncomplete(task);\n    this.fireCustomEvent('taskChanged', task);\n\n    await this._task.run();\n  }\n\n  private async removeTask(task: ITask) {\n    const ts = this.getTaskSource();\n    if (!ts) {\n      return;\n    }\n\n    this._hiddenTasks = [...this._hiddenTasks, task.id];\n    await ts.removeTask(task);\n    this.fireCustomEvent('taskRemoved', task);\n\n    await this._task.run();\n    this._hiddenTasks = this._hiddenTasks.filter(id => id !== task.id);\n  }\n\n  private async assignPeople(task: ITask, people: (User | Person | Contact)[] = []) {\n    const ts = this.getTaskSource();\n    if (!ts) {\n      return;\n    }\n\n    // create previously selected people Object\n    let currentTaskAssigneesIds: string[] = [];\n    if (task) {\n      if (task.assignments) {\n        currentTaskAssigneesIds = Object.keys(task.assignments).sort();\n      }\n    }\n\n    const newTaskAssigneesIds: string[] = people.map(person => {\n      return person.id;\n    });\n\n    // new people from people picker\n    const isEqual =\n      newTaskAssigneesIds.length === currentTaskAssigneesIds.length &&\n      newTaskAssigneesIds.sort().every((value, index) => {\n        return value === currentTaskAssigneesIds[index];\n      });\n\n    if (isEqual) {\n      return;\n    }\n\n    const peopleObj: Record<string, PlannerAssignments> = {};\n\n    // Removes an assignee to a task by setting the value to null\n    for (const p of currentTaskAssigneesIds) {\n      if (newTaskAssigneesIds.includes(p)) {\n        peopleObj[p] = plannerAssignment;\n      } else {\n        peopleObj[p] = null;\n      }\n    }\n\n    // Adds a person to the task by assigning them a temporary planner value\n    newTaskAssigneesIds.forEach(assigneeId => {\n      if (!currentTaskAssigneesIds.includes(assigneeId)) {\n        peopleObj[assigneeId] = plannerAssignment;\n      }\n    });\n\n    if (task) {\n      await ts.assignPeopleToTask(task, peopleObj);\n      await this._task.run();\n    }\n  }\n\n  private readonly onAddTaskClick = () => {\n    const picker = this.getPeoplePicker(null);\n\n    const peopleObj: Record<string, unknown> = {};\n\n    if (picker) {\n      for (const person of picker?.selectedPeople ?? []) {\n        peopleObj[person.id] = plannerAssignment;\n      }\n    }\n\n    if (!this._newTaskBeingAdded && this._newTaskName && (this._currentGroup || this._newTaskGroupId)) {\n      void this.addTask(\n        this._newTaskName,\n        this._newTaskDueDate,\n        !this._currentGroup ? this._newTaskGroupId : this._currentGroup,\n        !this._currentFolder ? this._newTaskFolderId : this._currentFolder,\n        peopleObj\n      );\n    }\n  };\n\n  private readonly onAddTaskKeyDown = (e: KeyboardEvent) => {\n    if (e.key === 'Enter' || e.key === ' ') {\n      this.onAddTaskClick();\n    }\n  };\n\n  private readonly addNewTaskButtonClick = () => {\n    this.isNewTaskVisible = !this.isNewTaskVisible;\n  };\n\n  private readonly newTaskVisible = (e: KeyboardEvent) => {\n    if (e.key === 'Enter') {\n      this.isNewTaskVisible = false;\n    }\n  };\n\n  private renderPlanOptions(): TemplateResult {\n    const p = Providers.globalProvider;\n\n    if (!p || p.state !== ProviderState.SignedIn) {\n      return null;\n    }\n\n    if (this._inTaskLoad && !this._hasDoneInitialLoad) {\n      return html`<span class=\"loading-header\"></span>`;\n    }\n\n    const addButton =\n      this.readOnly || this._isNewTaskVisible\n        ? null\n        : html`\n          <fluent-button\n            appearance=\"accent\"\n            class=\"new-task-button\"\n            @click=${this.addNewTaskButtonClick}>\n              <span slot=\"start\">${getSvg(SvgIcon.Add, 'currentColor')}</span>\n              ${this.strings.addTaskButtonSubtitle}\n          </fluent-button>\n        `;\n\n    const currentGroup = this._groups.find(d => d.id === this._currentGroup) || {\n      title: this.strings.baseSelfAssigned\n    };\n    const groupOptions = {\n      [this.strings.baseSelfAssigned]: () => {\n        this._currentGroup = null;\n        this._currentFolder = null;\n      }\n    };\n    for (const group of this._groups) {\n      groupOptions[group.title] = () => {\n        this._currentGroup = group.id;\n        this._currentFolder = null;\n      };\n    }\n    const groupSelect: TemplateResult = mgtHtml`\n        <mgt-arrow-options\n          class=\"arrow-options\"\n          .options=\"${groupOptions}\"\n          .value=\"${currentGroup.title}\"\n        ></mgt-arrow-options>`;\n\n    const separator = !this._currentGroup ? null : getSvg(SvgIcon.ChevronRight);\n\n    const currentFolder = this._folders.find(d => d.id === this._currentFolder) || {\n      name: this.strings.bucketsSelfAssigned\n    };\n    const folderOptions = {\n      [this.strings.bucketsSelfAssigned]: () => {\n        this._currentFolder = null;\n      }\n    };\n\n    for (const folder of this._folders.filter(d => d.parentId === this._currentGroup)) {\n      folderOptions[folder.name] = () => {\n        this._currentFolder = folder.id;\n      };\n    }\n\n    const folderSelect = this.targetBucketId\n      ? html`\n            <span class=\"plan-title\">\n              ${this._folders[0]?.name || ''}\n            </span>`\n      : mgtHtml`\n            <mgt-arrow-options class=\"arrow-options\" .options=\"${folderOptions}\" .value=\"${currentFolder.name}\"></mgt-arrow-options>\n          `;\n\n    return html`\n        <div class=\"title\">\n          ${groupSelect} ${separator} ${!this._currentGroup ? null : folderSelect}\n        </div>\n        ${addButton}\n      `;\n  }\n\n  private readonly handleDateChange = (e: UIEvent) => {\n    const value = (e.target as HTMLInputElement).value;\n    if (value) {\n      this._newTaskDueDate = new Date(value + 'T17:00');\n    } else {\n      this._newTaskDueDate = null;\n    }\n  };\n\n  private renderNewTask() {\n    const iconColor = 'var(--neutral-foreground-hint)';\n\n    const taskTitle = html`\n      <fluent-text-field\n        autocomplete=\"off\"\n        ?autofocus=${this.isNewTaskVisible}\n        placeholder=${this.strings.newTaskPlaceholder}\n        .value=\"${this._newTaskName}\"\n        class=\"new-task\"\n        aria-label=${this.strings.newTaskPlaceholder}\n        @input=${(e: KeyboardEvent) => (this._newTaskName = (e.target as HTMLInputElement).value)}>\n      </fluent-text-field>`;\n\n    if (this._groups.length > 0 && !this._newTaskGroupId) {\n      this._newTaskGroupId = this._groups[0].id;\n    }\n\n    const groupOptions = html`\n      ${repeat(\n        this._groups,\n        grp => grp.id,\n        grp => html`<fluent-option value=\"${grp.id}\">${grp.title}</fluent-option>`\n      )}`;\n\n    const group = this._currentGroup\n      ? html`\n          <span class=\"new-task-group\">\n            ${this.renderPlannerIcon(iconColor)}\n            <span>${this.getPlanTitle(this._currentGroup)}</span>\n          </span>`\n      : html`\n            <fluent-select>\n              <span slot=\"start\">${this.renderPlannerIcon(iconColor)}</span>\n              ${this._groups.length > 0 ? groupOptions : html`<fluent-option selected>No groups found</fluent-option>`}\n            </fluent-select>`;\n\n    const folders = this._folders.filter(\n      folder =>\n        (this._currentGroup && folder.parentId === this._currentGroup) ||\n        (!this._currentGroup && folder.parentId === this._newTaskGroupId)\n    );\n    if (folders.length > 0 && !this._newTaskFolderId) {\n      this._newTaskFolderId = folders[0].id;\n    }\n\n    const folderOptions = html`\n      ${repeat(\n        folders,\n        folder => folder.id,\n        folder => html`<fluent-option value=\"${folder.id}\">${folder.name}</fluent-option>`\n      )}`;\n\n    const taskFolder = this._currentFolder\n      ? html`\n          <span class=\"new-task-bucket\">\n            ${this.renderBucketIcon(iconColor)}\n            <span>${this.getFolderName(this._currentFolder)}</span>\n          </span>\n        `\n      : html`\n         <fluent-select>\n          <span slot=\"start\">${this.renderBucketIcon(iconColor)}</span>\n          ${folders.length > 0 ? folderOptions : html`<fluent-option selected>No folders found</fluent-option>`}\n        </fluent-select>`;\n\n    const dateField = { dark: this._isDarkMode, 'new-task': true };\n\n    const taskDue = html`\n      <fluent-text-field\n        autocomplete=\"off\"\n        type=\"date\"\n        class=${classMap(dateField)}\n        aria-label=\"${this.strings.addTaskDate}\"\n        .value=\"${this.dateToInputValue(this._newTaskDueDate)}\"\n        @change=${this.handleDateChange}>\n      </fluent-text-field>`;\n\n    const taskPeople = this.renderAssignedPeople(null);\n\n    const newTaskActionButtons = this._newTaskBeingAdded\n      ? html`<div class=\"task-add-button-container\"></div>`\n      : html`\n          <fluent-button\n            class=\"add-task\"\n            ?disabled=${!this._newTaskName}\n            @click=${this.onAddTaskClick}\n            @keydown=${this.onAddTaskKeyDown}\n            appearance=\"neutral\">\n              ${this.strings.addTaskButtonSubtitle}\n          </fluent-button>\n          <fluent-button\n            class=\"cancel-task\"\n            @click=${() => (this.isNewTaskVisible = false)}\n            @keydown=${this.newTaskVisible}\n            appearance=\"neutral\">\n              ${this.strings.cancelNewTaskSubtitle}\n          </fluent-button>`;\n\n    return html`\n    <div\n      class=${classMap({\n        task: true,\n        'new-task': true\n      })}>\n      <div class=\"task-details-container\">\n        <div class=\"top add-new-task\">\n          <div class=\"check-and-title\">\n            ${taskTitle}\n            <div class=\"task-content\">\n              <div class=\"task-group\">${group}</div>\n              <div class=\"task-bucket\">${taskFolder}</div>\n              ${taskPeople}\n              <div class=\"task-due\">${taskDue}</div>\n            </div>\n          </div>\n          <div class=\"task-options new-task-action-buttons\">${newTaskActionButtons}</div>\n        </div>\n      </div>\n    </div>\n  `;\n  }\n\n  private togglePeoplePicker(task: ITask) {\n    const picker = this.getPeoplePicker(task);\n    const mgtPeople = this.getMgtPeople(task);\n    const flyout = this.getFlyout(task);\n\n    if (picker && mgtPeople && flyout) {\n      if (flyout.isOpen) {\n        flyout.close();\n      } else {\n        picker.selectedPeople = mgtPeople.people;\n        flyout.open();\n        setTimeout(() => picker.focus(), 100);\n      }\n    }\n  }\n\n  private updateAssignedPeople(task: ITask) {\n    const picker = this.getPeoplePicker(task);\n    const mgtPeople = this.getMgtPeople(task);\n\n    if (picker && picker.selectedPeople !== mgtPeople.people) {\n      mgtPeople.people = picker.selectedPeople;\n      void this.assignPeople(task, picker.selectedPeople);\n    }\n  }\n\n  private getPeoplePicker(task: ITask): MgtPeoplePicker {\n    const taskId = task ? task.id : 'new-task';\n    return this.renderRoot.querySelector<MgtPeoplePicker>(`.picker-${taskId}`);\n  }\n\n  private getMgtPeople(task: ITask): MgtPeople {\n    const taskId = task ? task.id : 'new-task';\n    return this.renderRoot.querySelector<MgtPeople>(`.people-${taskId}`);\n  }\n\n  private getFlyout(task: ITask): MgtFlyout {\n    const taskId = task ? task.id : 'new-task';\n    return this.renderRoot.querySelector(`.flyout-${taskId}`);\n  }\n\n  private renderTask(task: ITask) {\n    const { name = 'Task', completed = false, dueDate } = task;\n\n    const groupTitle = this._currentGroup ? null : this.getPlanTitle(task.topParentId);\n    const folderTitle = this._currentFolder ? null : this.getFolderName(task.immediateParentId);\n\n    const context = { task: { ...task._raw, groupTitle, folderTitle } };\n    const taskTemplate = this.renderTemplate('task', context, task.id);\n    if (taskTemplate) {\n      return taskTemplate;\n    }\n\n    let taskDetails = this.renderTemplate('task-details', context, `task-details-${task.id}`);\n\n    if (!taskDetails) {\n      const iconColor = 'var(--neutral-foreground-hint)';\n      const group = this._currentGroup\n        ? null\n        : html`\n              <div class=\"task-group\">\n                <span class=\"task-icon\">${this.renderPlannerIcon(iconColor)}</span>\n                <span class=\"task-icon-text\">${this.getPlanTitle(task.topParentId)}</span>\n              </div>\n            `;\n\n      const folder = this._currentFolder\n        ? null\n        : html`\n            <div class=\"task-bucket\">\n              <span class=\"task-icon\">${this.renderBucketIcon(iconColor)}</span>\n              <span class=\"task-icon-text\">${this.getFolderName(task.immediateParentId)}</span>\n            </div>\n          `;\n\n      const taskDue = !dueDate\n        ? null\n        : html`\n            <div class=\"task-due\">\n              <span class=\"task-icon-text\">${this.strings.due}${getShortDateString(dueDate)}</span>\n            </div>\n          `;\n\n      const taskPeople = this.renderAssignedPeople(task);\n\n      taskDetails = html`${group} ${folder} ${taskPeople} ${taskDue}`;\n    }\n\n    const taskOptions =\n      this.readOnly || this.hideOptions\n        ? null\n        : mgtHtml`\n            <mgt-dot-options\n              class=\"dot-options\"\n              .options=\"${{\n                [this.strings.removeTaskSubtitle]: () => this.removeTask(task)\n              }}\"\n            ></mgt-dot-options>`;\n\n    const taskClasses = classMap({\n      task: true,\n      complete: completed,\n      incomplete: !completed,\n      'read-only': this.readOnly\n    });\n\n    return html`\n      <div\n        data-id=\"task-${task.id}\"\n        class=${taskClasses}\n        @click=${() => this.handleTaskClick(task)}>\n        <div class=\"task-details-container\">\n          <div class=\"top\">\n            <div class=\"check-and-title\">\n              <fluent-checkbox\n                @click=${(e: MouseEvent) => this.handleTaskCheckClick(e, task)}\n                @keydown=${(e: KeyboardEvent) => this.handleTaskCheckKeyDown(e, task)}\n                ?checked=${completed}>\n                  ${name}\n              </fluent-checkbox>\n            </div>\n            <div class=\"task-options\">${taskOptions}</div>\n          </div>\n          <div class=\"bottom\">${taskDetails}</div>\n        </div>\n      </div>\n    `;\n  }\n\n  private async handleTaskCheckKeyDown(e: KeyboardEvent, task: ITask) {\n    if (e.key === 'Enter') {\n      e.stopPropagation();\n      e.preventDefault();\n      await this.checkTask(task);\n    }\n  }\n\n  private async handleTaskCheckClick(e: MouseEvent, task: ITask) {\n    e.stopPropagation();\n    e.preventDefault();\n    await this.checkTask(task);\n  }\n\n  private async checkTask(task: ITask) {\n    if (!this.readOnly) {\n      const target = this.shadowRoot.querySelector(`[data-id='task-${task.id}'`);\n      if (target) target.classList.add('updating');\n      if (!task.completed) {\n        await this.completeTask(task);\n      } else {\n        await this.uncompleteTask(task);\n      }\n      if (target) target.classList.remove('updating');\n    }\n  }\n\n  private readonly renderPlannerIcon = (iconColor: string) => {\n    return getSvg(SvgIcon.Planner, iconColor);\n  };\n  private readonly renderBucketIcon = (iconColor: string) => {\n    return getSvg(SvgIcon.Milestone, iconColor);\n  };\n\n  private readonly handlePeopleClick = (e: MouseEvent, task: ITask) => {\n    this.togglePeoplePicker(task);\n    e.stopPropagation();\n  };\n\n  private readonly handlePeopleKeydown = (e: KeyboardEvent, task: ITask) => {\n    if (e.key === 'Enter' || e.key === ' ') {\n      this.togglePeoplePicker(task);\n      e.stopPropagation();\n      e.preventDefault();\n    }\n  };\n\n  private readonly handlePeoplePickerKeydown = (e: KeyboardEvent) => {\n    if (e.key === 'Enter') {\n      e.stopPropagation();\n    }\n  };\n\n  private renderAssignedPeople(task: ITask): TemplateResult {\n    let assignedGroupId: string;\n    const taskAssigneeClasses = {\n      'new-task-assignee': task === null,\n      'task-assignee': task !== null,\n      'task-detail': task !== null\n    };\n\n    const taskId = task ? task.id : 'new-task';\n    taskAssigneeClasses[`flyout-${taskId}`] = true;\n\n    const assignedPeople = task ? Object.keys(task.assignments).map(key => key) : [];\n\n    if (!this.newTaskVisible) {\n      const raw: PlannerTask = task?._raw;\n      const planId = raw?.planId;\n      if (planId) {\n        const group = this._groups.filter(grp => grp.id === planId);\n        assignedGroupId = group.pop()?.containerId;\n      }\n    }\n\n    const planGroupId = this.isNewTaskVisible ? this._newTaskContainerId : assignedGroupId;\n\n    const assignedPeopleTemplate: HTMLTemplateResult = mgtHtml`\n      <mgt-people\n        class=\"people people-${taskId}\"\n        .userIds=${assignedPeople}\n        person-card=\"none\"\n        @click=${(e: MouseEvent) => this.handlePeopleClick(e, task)}\n        @keydown=${(e: KeyboardEvent) => this.handlePeopleKeydown(e, task)}\n      >\n        <template data-type=\"no-data\">\n          <fluent-button>\n            <span style=\"display:flex;place-content:start;gap:4px;padding-inline-start:4px\">\n              <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" xmlns=\"http://www.w3.org/2000/svg\" class=\"svg\" fill=\"currentColor\">\n                <path d=\"M9 2a4 4 0 100 8 4 4 0 000-8zM6 6a3 3 0 116 0 3 3 0 01-6 0z\"></path>\n                <path d=\"M4 11a2 2 0 00-2 2c0 1.7.83 2.97 2.13 3.8A9.14 9.14 0 009 18c.41 0 .82-.02 1.21-.06A5.5 5.5 0 019.6 17 12 12 0 019 17a8.16 8.16 0 01-4.33-1.05A3.36 3.36 0 013 13a1 1 0 011-1h5.6c.18-.36.4-.7.66-1H4z\"></path>\n                <path d=\"M14.5 19a4.5 4.5 0 100-9 4.5 4.5 0 000 9zm0-7c.28 0 .5.22.5.5V14h1.5a.5.5 0 010 1H15v1.5a.5.5 0 01-1 0V15h-1.5a.5.5 0 010-1H14v-1.5c0-.28.22-.5.5-.5z\"></path>\n              </svg> Assign</span>\n            </fluent-button>\n        </template>\n      </mgt-people>`;\n\n    const picker = mgtHtml`\n      <mgt-people-picker\n        class=\"people-picker picker-${taskId}\"\n        .groupId=${ifDefined(planGroupId)}\n        @keydown=${this.handlePeoplePickerKeydown}>\n      ></mgt-people-picker>`;\n\n    return mgtHtml`\n      <mgt-flyout\n        light-dismiss\n        class=${classMap(taskAssigneeClasses)}\n        @closed=${() => this.updateAssignedPeople(task)}\n      >\n        <div slot=\"anchor\">${assignedPeopleTemplate}</div>\n        <div slot=\"flyout\" part=\"picker\" class=\"picker\">${picker}</div>\n      </mgt-flyout>\n    `;\n  }\n\n  private handleTaskClick(task: ITask) {\n    if (task) {\n      this.fireCustomEvent('taskClick', task);\n    }\n  }\n\n  private renderLoadingTask() {\n    return html`\n      <div class=\"header\">\n        <div class=\"title\">\n          <fluent-skeleton shimmer class=\"shimmer\" shape=\"rect\"></fluent-skeleton>\n        </div>\n        <div class=\"new-task-button\">\n          <fluent-skeleton shimmer class=\"shimmer\" shape=\"rect\"></fluent-skeleton>\n        </div>\n      </div>\n      <div class=\"tasks\">\n        <div class=\"task incomplete\">\n          <div class=\"task-details-container\">\n            <div class=\"top\">\n              <div class=\"check-and-title shimmer\">\n                <fluent-skeleton shimmer class=\"checkbox\" shape=\"circle\"></fluent-skeleton>\n                <fluent-skeleton shimmer class=\"title\" shape=\"rect\"></fluent-skeleton>\n              </div>\n              <div class=\"task-options\">\n                <fluent-skeleton shimmer class=\"options\" shape=\"rect\"></fluent-skeleton>\n              </div>\n            </div>\n            <div class=\"bottom\">\n              <div class=\"task-group\">\n                <div class=\"task-icon\">\n                  <fluent-skeleton shimmer class=\"shimmer icon\" shape=\"rect\"></fluent-skeleton>\n                </div>\n                <div class=\"task-icon-text\">\n                  <fluent-skeleton shimmer class=\"shimmer text\" shape=\"rect\"></fluent-skeleton>\n                </div>\n              </div>\n              <div class=\"task-bucket\">\n                <div class=\"task-icon\">\n                  <fluent-skeleton shimmer class=\"shimmer icon\" shape=\"rect\"></fluent-skeleton>\n                </div>\n                <div class=\"task-icon-text\">\n                  <fluent-skeleton shimmer class=\"shimmer text\" shape=\"rect\"></fluent-skeleton>\n                </div>\n              </div>\n              <div class=\"task-details shimmer\">\n                <fluent-skeleton shimmer class=\"shimmer icon\" shape=\"circle\"></fluent-skeleton>\n                <fluent-skeleton shimmer class=\"shimmer icon\" shape=\"circle\"></fluent-skeleton>\n                <fluent-skeleton shimmer class=\"shimmer icon\" shape=\"circle\"></fluent-skeleton>\n              </div>\n              <div class=\"task-due\">\n                <div class=\"task-icon-text\">\n                  <fluent-skeleton shimmer class=\"shimmer text\" shape=\"rect\"></fluent-skeleton>\n                </div>\n              </div>\n              </div>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  private getTaskSource(): ITaskSource | null {\n    const p = Providers.globalProvider;\n    if (!p || p.state !== ProviderState.SignedIn) {\n      return null;\n    }\n\n    const graph = p.graph.forComponent(this);\n    return new PlannerTaskSource(graph);\n  }\n\n  private getPlanTitle(planId: string): string {\n    if (!planId) {\n      return this.strings.baseSelfAssigned;\n    } else if (planId === this.strings.plansSelfAssigned) {\n      return this.strings.plansSelfAssigned;\n    } else {\n      return (\n        this._groups.find(plan => plan.id === planId) || {\n          title: this.strings.planNotFound\n        }\n      ).title;\n    }\n  }\n\n  private getFolderName(bucketId: string): string {\n    if (!bucketId) {\n      return this.strings.bucketsSelfAssigned;\n    }\n    return (\n      this._folders.find(buck => buck.id === bucketId) || {\n        name: this.strings.bucketNotFound\n      }\n    ).name;\n  }\n\n  private isTaskInSelectedGroupFilter(task: ITask) {\n    return (\n      !this._currentGroup ||\n      task.topParentId === this._currentGroup ||\n      (!this._currentGroup && this.getTaskSource().isAssignedToMe(task, this._me?.id))\n    );\n  }\n\n  private isTaskInSelectedFolderFilter(task: ITask) {\n    return task.immediateParentId === this._currentFolder || !this._currentFolder;\n  }\n\n  private dateToInputValue(date: Date) {\n    if (date) {\n      return new Date(date.getTime() - date.getTimezoneOffset() * 60000).toISOString().split('T')[0];\n    }\n\n    return null;\n  }\n}\n\nexport { ITask };\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport * as MicrosoftGraph from '@microsoft/microsoft-graph-types';\nimport { html, TemplateResult } from 'lit';\nimport { state } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { TaskStatus } from '@lit/task';\nimport { Providers, ProviderState, MgtTemplatedTaskComponent, mgtHtml } from '@microsoft/mgt-element';\nimport '../../styles/style-helper';\nimport { getSvg, SvgIcon } from '../../utils/SvgHelper';\nimport { debounce } from '../../utils/Utils';\nimport { styles } from './mgt-teams-channel-picker-css';\nimport { getAllMyTeams, getChannelsForTeams, getTeamsPhotosForPhotoIds } from './mgt-teams-channel-picker.graph';\nimport { strings } from './strings';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { registerFluentComponents } from '../../utils/FluentComponents';\nimport {\n  fluentBreadcrumb,\n  fluentBreadcrumbItem,\n  fluentTreeView,\n  fluentTreeItem,\n  fluentCard,\n  fluentTextField\n} from '@fluentui/web-components';\nimport { registerComponent } from '@microsoft/mgt-element';\nimport { registerMgtSpinnerComponent } from '../sub-components/mgt-spinner/mgt-spinner';\nimport { SelectedChannel, DropdownItem, ChannelPickerItemState } from './teams-channel-picker-types';\n\nexport const registerMgtTeamsChannelPickerComponent = () => {\n  registerFluentComponents(\n    fluentBreadcrumb,\n    fluentBreadcrumbItem,\n    fluentCard,\n    fluentTreeView,\n    fluentTreeItem,\n    fluentTextField\n  );\n  registerMgtSpinnerComponent();\n  registerComponent('teams-channel-picker', MgtTeamsChannelPicker);\n};\n\n/**\n * Web component used to select channels from a User's Microsoft Teams profile\n *\n *\n * @class MgtTeamsChannelPicker\n * @extends {MgtTemplatedTaskComponent}\n *\n * @fires {CustomEvent<SelectedChannel | null>} selectionChanged - Fired when the selection changes\n *\n * @cssprop --channel-picker-input-border-color - {Color} Input border color\n * @cssprop --channel-picker-input-background-color - {Color} Input section background color\n * @cssprop --channel-picker-input-background-color-hover - {Color} Input background hover color\n * @cssprop --channel-picker-input-background-color-focus - {Color} Input background focus color\n *\n * @cssprop --channel-picker-dropdown-background-color - {Color} Background color of dropdown area\n * @cssprop --channel-picker-dropdown-item-text-color - {Color} Text color of the dropdown text.\n * @cssprop --channel-picker-dropdown-item-background-color-hover - {Color} Background color of channel or team during hover\n * @cssprop --channel-picker-dropdown-item-text-color-selected - {Color} Text color of channel or team during after selection\n *\n * @cssprop --channel-picker-arrow-fill - {Color} Color of arrow svg\n * @cssprop --channel-picker-input-placeholder-text-color - {Color} Color of placeholder text\n * @cssprop --channel-picker-input-placeholder-text-color-focus - {Color} Color of placeholder text during focus state\n * @cssprop --channel-picker-input-placeholder-text-color-hover - {Color} Color of placeholder text during hover state\n *\n * @cssprop --channel-picker-search-icon-color - {Color} the search icon color.\n * @cssprop --channel-picker-down-chevron-color - {Color} the down chevron icon color.\n * @cssprop --channel-picker-up-chevron-color - {Color} the up chevron icon color.\n * @cssprop --channel-picker-close-icon-color - {Color} the close icon color.\n *\n */\nexport class MgtTeamsChannelPicker extends MgtTemplatedTaskComponent {\n  /**\n   * Array of styles to apply to the element. The styles should be defined\n   * user the `css` tag function.\n   */\n  static get styles() {\n    return styles;\n  }\n\n  /**\n   * Strings for localization\n   *\n   * @readonly\n   * @protected\n   * @memberof MgtTeamsChannelPicker\n   */\n  protected get strings() {\n    return strings;\n  }\n\n  private teamsPhotos = {};\n\n  /**\n   * Gets Selected item to be used\n   *\n   * @readonly\n   * @type {SelectedChannel}\n   * @memberof MgtTeamsChannelPicker\n   */\n  public get selectedItem(): SelectedChannel | null {\n    if (this._selectedItemState) {\n      return { channel: this._selectedItemState.item, team: this._selectedItemState.parent.item };\n    } else {\n      return null;\n    }\n  }\n\n  /**\n   * Get the scopes required for teams channel picker\n   *\n   * @static\n   * @return {*}  {string[]}\n   * @memberof MgtTeamsChannelPicker\n   */\n  public static get requiredScopes(): string[] {\n    return ['team.readbasic.all', 'channel.readbasic.all'];\n  }\n\n  private set items(value) {\n    if (this._items === value) {\n      return;\n    }\n    this._items = value;\n    this._treeViewState = value ? this.generateTreeViewState(value) : [];\n    this.resetFocusState();\n  }\n  private get items(): DropdownItem[] | undefined {\n    return this._items;\n  }\n\n  private get _inputWrapper(): HTMLInputElement | null {\n    return this.renderRoot.querySelector<HTMLInputElement>('fluent-text-field');\n  }\n  // User input in search\n  private get _input(): HTMLInputElement | null {\n    const wrapper = this._inputWrapper;\n    const input = wrapper?.shadowRoot.querySelector<HTMLInputElement>('input');\n    return input;\n  }\n  private _inputValue = '';\n\n  @state() private _selectedItemState: ChannelPickerItemState;\n  private _items: DropdownItem[] | undefined;\n  private _treeViewState: ChannelPickerItemState[] = [];\n  private _focusList: ChannelPickerItemState[] = [];\n\n  // focus state\n  private debouncedSearch: () => void;\n\n  // determines loading state\n  @state() private _isDropdownVisible: boolean;\n\n  constructor() {\n    super();\n    this._inputValue = '';\n    this._treeViewState = [];\n    this._focusList = [];\n    this._isDropdownVisible = false;\n  }\n\n  /**\n   * Invoked each time the custom element is appended into a document-connected element\n   *\n   * @memberof MgtTeamsChannelPicker\n   */\n  public connectedCallback() {\n    super.connectedCallback();\n    window.addEventListener('click', this.handleWindowClick);\n    this.addEventListener('focus', this.loadTeamsIfNotLoaded);\n    this.addEventListener('mouseover', this.loadTeamsIfNotLoaded);\n    this.addEventListener('blur', this.lostFocus);\n\n    const ownerDocument = this.renderRoot.ownerDocument;\n    if (ownerDocument) {\n      ownerDocument.documentElement.setAttribute('dir', this.direction);\n    }\n  }\n\n  /**\n   * Invoked each time the custom element is disconnected from the document's DOM\n   *\n   * @memberof MgtTeamsChannelPicker\n   */\n  public disconnectedCallback() {\n    window.removeEventListener('click', this.handleWindowClick);\n    this.removeEventListener('focus', this.loadTeamsIfNotLoaded);\n    this.removeEventListener('mouseover', this.loadTeamsIfNotLoaded);\n    this.removeEventListener('blur', this.lostFocus);\n    super.disconnectedCallback();\n  }\n\n  protected args(): unknown[] {\n    return [];\n  }\n\n  /**\n   * selects a channel by looking up the id in the Graph\n   *\n   * @param {string} channelId MicrosoftGraph.Channel.id\n   * @returns {Promise<return>} A promise that will resolve to true if channel was selected\n   * @memberof MgtTeamsChannelPicker\n   */\n  public async selectChannelById(channelId: string): Promise<boolean> {\n    const provider = Providers.globalProvider;\n    if (provider && provider.state === ProviderState.SignedIn) {\n      // since the component normally handles loading on hover, forces the load for items\n      if (!this.items) {\n        await this._task.run();\n      }\n\n      for (const item of this._treeViewState) {\n        for (const channel of item.channels) {\n          if (channel.item.id === channelId) {\n            item.isExpanded = true;\n            this.selectChannel(channel);\n            this.markSelectedChannelInDropdown(channelId);\n            return true;\n          }\n        }\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Marks a channel selected by ID as selected in the dropdown menu.\n   * It ensures the parent team is set to as expanded to show the channel.\n   *\n   * @param channelId ID string of the selected channel\n   */\n  private markSelectedChannelInDropdown(channelId: string) {\n    const treeItem = this.renderRoot.querySelector(`[id='${channelId}']`);\n    if (treeItem) {\n      treeItem.setAttribute('selected', 'true');\n      if (treeItem.parentElement) {\n        treeItem.parentElement.setAttribute('expanded', 'true');\n      }\n    }\n  }\n\n  /**\n   * Called from the base class while the _task is in a pending state\n   * This calls to the renderContent method as the loading indicator is nested inside the dropdown\n   * This ensures that the component shows a control immediately and only shows a loading indicator\n   * if the user interacts with the component while the _task is pending.\n   */\n  protected renderLoading = () => this.renderContent();\n\n  /**\n   * Invoked by the render method when the _task has been completed\n   *\n   * @returns\n   * @memberof MgtTeamsChannelPicker\n   */\n  public renderContent = () => {\n    const dropdownClasses = {\n      dropdown: true,\n      visible: this._isDropdownVisible\n    };\n\n    return (\n      this.renderTemplate('default', { teams: this.items ?? [] }) ||\n      html`\n        <div class=\"container\" @blur=${this.lostFocus}>\n          <fluent-text-field\n            autocomplete=\"off\"\n            appearance=\"outline\"\n            id=\"teams-channel-picker-input\"\n            role=\"combobox\"\n            placeholder=\"${this._selectedItemState ? '' : this.strings.inputPlaceholderText} \"\n            aria-label=${this.strings.inputPlaceholderText}\n            aria-expanded=\"${this._isDropdownVisible}\"\n            label=\"teams-channel-picker-input\"\n            @focus=${this.handleFocus}\n            @keyup=${this.handleInputChanged}\n            @click=${this.handleInputClick}\n            @keydown=${this.handleInputKeydown}\n          >\n            <div tabindex=\"0\" slot=\"start\" style=\"width: max-content;\">${this.renderSelected()}</div>\n            <div tabindex=\"0\" slot=\"end\">${this.renderChevrons()}${this.renderCloseButton()}</div>\n          </fluent-text-field>\n          <fluent-card\n            class=${classMap(dropdownClasses)}\n          >\n            ${this.renderDropdown()}\n          </fluent-card>\n        </div>`\n    );\n  };\n\n  /**\n   * Handles clicks on the input section.\n   *\n   * @param e {UIEvent}\n   */\n  handleInputClick = (e: UIEvent) => {\n    e.stopPropagation();\n    this.gainedFocus();\n  };\n\n  handleInputKeydown = (e: KeyboardEvent) => {\n    const keyName = e.key;\n    if (['ArrowDown', 'Enter'].includes(keyName)) {\n      if (!this._isDropdownVisible) {\n        this.gainedFocus();\n      } else {\n        // focus on the first item on the list. Ideally, focus on the selected.\n        const firstTreeItem = this.renderRoot.querySelector<HTMLElement>('fluent-tree-item');\n        firstTreeItem.focus();\n      }\n    } else if (keyName === 'Escape') {\n      this.lostFocus();\n    }\n  };\n\n  /**\n   * Renders selected channel\n   *\n   * @protected\n   * @returns\n   * @memberof MgtTeamsChannelPicker\n   */\n  protected renderSelected() {\n    if (!this._selectedItemState) {\n      return this.renderSearchIcon();\n    }\n    let icon: TemplateResult;\n    if (this._selectedItemState.parent.channels) {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-unsafe-assignment\n      const src = this.teamsPhotos[this._selectedItemState.parent.item.id]?.photo;\n      icon = html`<img\n        class=\"team-photo\"\n        alt=\"${this._selectedItemState.parent.item.displayName}\"\n        role=\"img\"\n        src=${src} />`;\n    }\n\n    const parentName = this._selectedItemState?.parent?.item?.displayName.trim();\n    const channelName = this._selectedItemState?.item?.displayName.trim();\n\n    return html`\n      <fluent-breadcrumb title=${this._selectedItemState.item.displayName}>\n        <fluent-breadcrumb-item>\n          <span slot=\"start\">${icon}</span>\n          <span class=\"team-parent-name\">${parentName}</span>\n          <span slot=\"separator\" class=\"arrow\">${getSvg(SvgIcon.TeamSeparator, '#000000')}</span>\n        </fluent-breadcrumb-item>\n        <fluent-breadcrumb-item>${channelName}</fluent-breadcrumb-item>\n      </fluent-breadcrumb>`;\n  }\n\n  /**\n   * Clears the state of the component\n   *\n   * @protected\n   * @memberof MgtTeamsChannelPicker\n   */\n  protected clearState(): void {\n    this._inputValue = '';\n    this._treeViewState = [];\n    this._focusList = [];\n    this._isDropdownVisible = false;\n  }\n\n  /**\n   * Renders search icon\n   *\n   * @protected\n   * @returns\n   * @memberof MgtTeamsChannelPicker\n   */\n  protected renderSearchIcon() {\n    return html`\n      <div class=\"search-icon\">\n        ${getSvg(SvgIcon.Search, '#252424')}\n      </div>\n    `;\n  }\n\n  /**\n   * Renders close button\n   *\n   * @protected\n   * @returns\n   * @memberof MgtTeamsChannelPicker\n   */\n  protected renderCloseButton() {\n    return html`\n      <fluent-button\n        appearance=\"stealth\"\n        class=\"close-icon\"\n        style=\"display:none\"\n        aria-label=${this.strings.closeButtonAriaLabel}\n        @click=${this.onClickCloseButton}\n        @keydown=${this.onKeydownCloseButton}>\n        <svg width=\"8\" height=\"8\" viewBox=\"0 0 8 8\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M0.0885911 0.215694L0.146447 0.146447C0.320013 -0.0271197 0.589437 -0.046405 0.784306 0.0885911L0.853553 0.146447L4 3.293L7.14645 0.146447C7.34171 -0.0488154 7.65829 -0.0488154 7.85355 0.146447C8.04882 0.341709 8.04882 0.658291 7.85355 0.853553L4.707 4L7.85355 7.14645C8.02712 7.32001 8.0464 7.58944 7.91141 7.78431L7.85355 7.85355C7.67999 8.02712 7.41056 8.0464 7.21569 7.91141L7.14645 7.85355L4 4.707L0.853553 7.85355C0.658291 8.04882 0.341709 8.04882 0.146447 7.85355C-0.0488154 7.65829 -0.0488154 7.34171 0.146447 7.14645L3.293 4L0.146447 0.853553C-0.0271197 0.679987 -0.046405 0.410563 0.0885911 0.215694L0.146447 0.146447L0.0885911 0.215694Z\" fill=\"#212121\"/>\n        </svg>\n      </fluent-button>\n    `;\n  }\n\n  /**\n   * Handles clicks on the close button after selecting a channel.\n   *\n   * @param e {UIEvent}\n   */\n  onClickCloseButton = () => {\n    this.removeSelectedChannel(null);\n  };\n\n  /**\n   * Handles keypresses on the close button.\n   *\n   * @param e {KeyboardEvent}\n   */\n  onKeydownCloseButton = (e: KeyboardEvent) => {\n    if (e.key === 'Enter') this.removeSelectedChannel(null);\n  };\n\n  /**\n   * Displays the close button after selecting a channel.\n   */\n  protected showCloseIcon() {\n    const downChevron = this.renderRoot.querySelector<HTMLElement>('.down-chevron');\n    const upChevron = this.renderRoot.querySelector<HTMLElement>('.up-chevron');\n    const closeIcon = this.renderRoot.querySelector<HTMLElement>('.close-icon');\n    if (downChevron) {\n      downChevron.style.display = 'none';\n    }\n    if (upChevron) {\n      upChevron.style.display = 'none';\n    }\n\n    if (closeIcon) {\n      closeIcon.style.display = null;\n    }\n  }\n\n  /**\n   * Renders down chevron icon\n   *\n   * @protected\n   * @returns\n   * @memberof MgtTeamsChannelPicker\n   */\n  protected renderDownChevron() {\n    return html`\n      <fluent-button appearance=\"stealth\" class=\"down-chevron\" @click=${this.gainedFocus}>\n        <svg width=\"12\" height=\"12\" viewBox=\"0 0 12 12\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M2.21967 4.46967C2.51256 4.17678 2.98744 4.17678 3.28033 4.46967L6 7.18934L8.71967 4.46967C9.01256 4.17678 9.48744 4.17678 9.78033 4.46967C10.0732 4.76256 10.0732 5.23744 9.78033 5.53033L6.53033 8.78033C6.23744 9.07322 5.76256 9.07322 5.46967 8.78033L2.21967 5.53033C1.92678 5.23744 1.92678 4.76256 2.21967 4.46967Z\" fill=\"#212121\" />\n        </svg>\n      </fluent-button>`;\n  }\n\n  /**\n   * Renders up chevron icon\n   *\n   * @protected\n   * @returns\n   * @memberof MgtTeamsChannelPicker\n   */\n  protected renderUpChevron() {\n    return html`\n      <fluent-button appearance=\"stealth\" style=\"display:none\" class=\"up-chevron\" @click=${this.handleUpChevronClick}>\n        <svg width=\"12\" height=\"12\" viewBox=\"0 0 12 12\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M2.21967 7.53033C2.51256 7.82322 2.98744 7.82322 3.28033 7.53033L6 4.81066L8.71967 7.53033C9.01256 7.82322 9.48744 7.82322 9.78033 7.53033C10.0732 7.23744 10.0732 6.76256 9.78033 6.46967L6.53033 3.21967C6.23744 2.92678 5.76256 2.92678 5.46967 3.21967L2.21967 6.46967C1.92678 6.76256 1.92678 7.23744 2.21967 7.53033Z\" fill=\"#212121\" />\n        </svg>\n      </fluent-button>`;\n  }\n\n  /**\n   * Renders both chevrons\n   */\n  private renderChevrons() {\n    return html`${this.renderUpChevron()}${this.renderDownChevron()}`;\n  }\n\n  /**\n   * Renders dropdown content\n   *\n   * @returns\n   * @memberof MgtTeamsChannelPicker\n   */\n  protected renderDropdown() {\n    if (this._task.status === TaskStatus.PENDING || !this._treeViewState) {\n      return this.renderLoadingIndicator();\n    }\n\n    if (this._treeViewState) {\n      if (this._treeViewState.length === 0 && this._inputValue.length > 0) {\n        return this.renderError();\n      }\n\n      return this.renderDropdownList(this._treeViewState);\n    }\n\n    return html``;\n  }\n\n  /**\n   * Renders the dropdown list recursively\n   *\n   * @protected\n   * @param {ChannelPickerItemState[]} items\n   * @returns\n   * @memberof MgtTeamsChannelPicker\n   */\n  protected renderDropdownList(items: ChannelPickerItemState[]) {\n    if (items && items.length > 0) {\n      let icon: TemplateResult = null;\n\n      return html`\n        <fluent-tree-view\n          class=\"tree-view\"\n          dir=${this.direction}\n          aria-live=\"polite\"\n          aria-relevant=\"all\"\n          aria-atomic=\"true\"\n          aria-label=${this.strings.teamsChannels}\n          aria-orientation=\"horizontal\"\n          @keydown=${this.onKeydownTreeView}>\n          ${repeat(\n            items,\n            (itemObj: ChannelPickerItemState) => itemObj?.item,\n            (obj: ChannelPickerItemState) => {\n              if (obj.channels) {\n                icon = html`<img\n                  class=\"team-photo\"\n                  alt=\"${this.strings.photoFor} ${obj.item.displayName}\"\n                  src=${// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n                  this.teamsPhotos[obj.item.id]?.photo} />`;\n              }\n              return html`\n                <fluent-tree-item\n                  ?expanded=${obj?.isExpanded}\n                  @click=${this.handleTeamTreeItemClick}>\n                    <span slot=\"start\">${icon}</span>${obj.item.displayName}\n                    ${repeat(\n                      obj?.channels,\n                      (channels: ChannelPickerItemState) => channels.item,\n                      (channel: ChannelPickerItemState) => {\n                        return this.renderItem(channel);\n                      }\n                    )}\n                </fluent-tree-item>`;\n            }\n          )}\n        </fluent-tree-view>`;\n    }\n    return null;\n  }\n\n  /**\n   * Renders each Channel or Team\n   *\n   * @param {ChannelPickerItemState} itemState\n   * @returns\n   * @memberof MgtTeamsChannelPicker\n   */\n  protected renderItem(itemState: ChannelPickerItemState) {\n    return html`\n      <fluent-tree-item\n        id=${itemState?.item?.id}\n        @keydown=${(e: KeyboardEvent) => this.onUserKeyDown(e, itemState)}\n        @click=${() => this.handleItemClick(itemState)}>\n          ${itemState?.item.displayName}\n      </fluent-tree-item>`;\n  }\n\n  /**\n   * Renders an error message when no channel or teams match the query\n   *\n   * @protected\n   * @returns\n   * @memberof MgtTeamsChannelPicker\n   */\n  protected renderError = (): TemplateResult => {\n    const template = this.renderTemplate('error', null, 'error');\n\n    return (\n      template ||\n      html`\n        <div class=\"message-parent\">\n          <div\n            label=\"search-error-text\"\n            aria-live=\"polite\"\n            aria-relevant=\"all\"\n            aria-atomic=\"true\"\n            class=\"search-error-text\"\n          >\n            ${this.strings.noResultsFound}\n          </div>\n        </div>\n      `\n    );\n  };\n\n  /**\n   * Renders loading spinner while channels are fetched from the Graph\n   *\n   * @protected\n   * @returns\n   * @memberof MgtTeamsChannelPicker\n   */\n  protected renderLoadingIndicator = (): TemplateResult => {\n    const template = this.renderTemplate('loading', null, 'loading');\n\n    return (\n      template ||\n      mgtHtml`\n        <div class=\"message-parent\">\n          <mgt-spinner></mgt-spinner>\n          <div label=\"loading-text\" aria-label=\"loading\" class=\"loading-text\">\n            ${this.strings.loadingMessage}\n          </div>\n        </div>\n      `\n    );\n  };\n\n  /**\n   * Queries Microsoft Graph for Teams & respective channels then sets to items list\n   *\n   * @protected\n   * @memberof MgtTeamsChannelPicker\n   */\n  protected async loadState() {\n    const provider = Providers.globalProvider;\n    let teams: MicrosoftGraph.Team[];\n    if (provider && provider.state === ProviderState.SignedIn) {\n      const graph = provider.graph.forComponent(this);\n\n      teams = await getAllMyTeams(graph);\n      teams = teams.filter(t => !t.isArchived);\n\n      const teamsIds = teams.map(t => t.id);\n      this.teamsPhotos = await getTeamsPhotosForPhotoIds(graph, teamsIds);\n\n      this._items = await getChannelsForTeams(graph, teams);\n    }\n    this.filterList();\n    this.resetFocusState();\n  }\n\n  /**\n   * Clears the selectedItem state.\n   *\n   * @memberof MgtTeamsChannelPicker\n   */\n  clearSelectedItem() {\n    this.removeSelectedChannel();\n  }\n\n  /**\n   * Handles operations that are performed on the DOM when you remove a\n   * channel. For example on clicking the X button.\n   *\n   * @param item a selected channel item\n   */\n  private removeSelectedChannel(item?: ChannelPickerItemState) {\n    this.selectChannel(item);\n    const treeItems = this.renderRoot.querySelectorAll('fluent-tree-item');\n    if (treeItems) {\n      treeItems.forEach((treeItem: HTMLElement) => {\n        treeItem.removeAttribute('expanded');\n        treeItem.removeAttribute('selected');\n      });\n    }\n  }\n\n  onKeydownTreeView = (e: KeyboardEvent) => {\n    const keyName = e.key;\n    if (keyName === 'Escape') {\n      this.lostFocus();\n    }\n  };\n\n  private handleItemClick(item: ChannelPickerItemState) {\n    if (item.channels) {\n      item.isExpanded = !item.isExpanded;\n    } else {\n      this.selectChannel(item);\n      this.lostFocus();\n    }\n  }\n\n  handleTeamTreeItemClick = (event: Event) => {\n    event.preventDefault();\n    event.stopImmediatePropagation();\n    const element = event.target as HTMLElement;\n    if (element) {\n      const expanded = element.getAttribute('expanded');\n\n      if (expanded) {\n        element.removeAttribute('expanded');\n      } else {\n        element.setAttribute('expanded', 'true');\n      }\n      element.removeAttribute('selected');\n      const hasId = element.getAttribute('id');\n      if (hasId) {\n        element.setAttribute('selected', 'true');\n      }\n    }\n  };\n\n  handleInputChanged = (e: KeyboardEvent) => {\n    const target = e.target as HTMLInputElement;\n    if (this._inputValue !== target?.value) {\n      this._inputValue = target?.value;\n    } else {\n      return;\n    }\n\n    // shows list\n    this.gainedFocus();\n\n    if (!this.debouncedSearch) {\n      this.debouncedSearch = debounce(() => {\n        this.filterList();\n      }, 400);\n    }\n\n    this.debouncedSearch();\n  };\n\n  private onUserKeyDown(e: KeyboardEvent, item?: ChannelPickerItemState) {\n    const key = e.code;\n    switch (key) {\n      case 'Enter':\n        this.selectChannel(item);\n        this.resetFocusState();\n        this.lostFocus();\n        e.preventDefault();\n        break;\n      case 'Backspace':\n        if (this._inputValue.length === 0 && this._selectedItemState) {\n          this.selectChannel(null);\n          this.resetFocusState();\n          e.preventDefault();\n        }\n        break;\n    }\n  }\n\n  private filterList() {\n    if (this.items) {\n      this._treeViewState = this.generateTreeViewState(this.items, this._inputValue);\n      this.resetFocusState();\n    }\n  }\n\n  private generateTreeViewState(\n    tree: DropdownItem[],\n    filterString = '',\n    parent: ChannelPickerItemState = null\n  ): ChannelPickerItemState[] {\n    const treeView: ChannelPickerItemState[] = [];\n    filterString = filterString.toLowerCase();\n\n    if (tree) {\n      for (const item of tree) {\n        let stateItem: ChannelPickerItemState;\n\n        if (filterString.length === 0 || item.item.displayName.toLowerCase().includes(filterString)) {\n          stateItem = { item: item.item, parent };\n          if (item.channels) {\n            stateItem.channels = this.generateTreeViewState(item.channels, '', stateItem);\n            stateItem.isExpanded = filterString.length > 0;\n          }\n        } else if (item.channels) {\n          const newStateItem = { item: item.item, parent };\n          const channels = this.generateTreeViewState(item.channels, filterString, newStateItem);\n          if (channels.length > 0) {\n            stateItem = newStateItem;\n            stateItem.channels = channels;\n            stateItem.isExpanded = true;\n          }\n        }\n\n        if (stateItem) {\n          treeView.push(stateItem);\n        }\n      }\n    }\n    return treeView;\n  }\n\n  // generates a flat list from a tree to facilitate easier focus\n  // navigation\n  private generateFocusList(items: ChannelPickerItemState[]): ChannelPickerItemState[] {\n    if (!items || items.length === 0) {\n      return [];\n    }\n\n    let array: ChannelPickerItemState[] = [];\n\n    for (const item of items) {\n      array.push(item);\n      if (item.channels && item.isExpanded) {\n        array = [...array, ...this.generateFocusList(item.channels)];\n      }\n    }\n\n    return array;\n  }\n\n  private resetFocusState() {\n    this._focusList = this.generateFocusList(this._treeViewState);\n    this.requestUpdate();\n  }\n\n  private readonly loadTeamsIfNotLoaded = () => {\n    if (!this.items && this._task.status !== TaskStatus.PENDING) {\n      void this._task.run();\n    }\n  };\n\n  private readonly handleWindowClick = (e: MouseEvent) => {\n    if (e.target !== this) {\n      this.lostFocus();\n    }\n  };\n\n  private readonly gainedFocus = () => {\n    const input = this._input;\n    if (input) {\n      input.focus();\n    }\n\n    this._isDropdownVisible = true;\n    this.toggleChevron();\n    this.resetFocusState();\n    this.requestUpdate();\n  };\n\n  private readonly lostFocus = () => {\n    this._inputValue = '';\n    if (this._input) {\n      this._input.value = this._inputValue;\n      this._input.textContent = '';\n    }\n    const wrapper = this._inputWrapper;\n    if (wrapper) wrapper.value = '';\n\n    this._isDropdownVisible = false;\n    this.filterList();\n    this.toggleChevron();\n    this.requestUpdate();\n\n    if (this._selectedItemState !== undefined) {\n      this.showCloseIcon();\n    }\n  };\n\n  handleFocus = () => {\n    this.lostFocus();\n    this.gainedFocus();\n  };\n\n  private selectChannel(item?: ChannelPickerItemState) {\n    if (item && this._selectedItemState !== item) {\n      this._input?.setAttribute('disabled', 'true');\n    } else {\n      this._input?.removeAttribute('disabled');\n    }\n    this._selectedItemState = item;\n    this.lostFocus();\n    this.fireCustomEvent('selectionChanged', this.selectedItem);\n  }\n\n  /**\n   * Hides the close icon.\n   */\n  private hideCloseIcon() {\n    const closeIcon = this.renderRoot.querySelector<HTMLElement>('.close-icon');\n    if (closeIcon) {\n      closeIcon.style.display = 'none';\n    }\n  }\n\n  /**\n   * Toggles the up and down chevron depending on the dropdown\n   * visibility.\n   */\n  private toggleChevron() {\n    const downChevron = this.renderRoot.querySelector<HTMLElement>('.down-chevron');\n    const upChevron = this.renderRoot.querySelector<HTMLElement>('.up-chevron');\n    if (this._isDropdownVisible) {\n      if (downChevron) {\n        downChevron.style.display = 'none';\n      }\n      if (upChevron) {\n        upChevron.style.display = null;\n      }\n    } else {\n      if (downChevron) {\n        downChevron.style.display = null;\n        this.hideCloseIcon();\n      }\n      if (upChevron) {\n        upChevron.style.display = 'none';\n      }\n    }\n    this.hideCloseIcon();\n  }\n\n  handleUpChevronClick = (e: Event) => {\n    e.stopPropagation();\n    this.lostFocus();\n  };\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\n/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nexport const strings = {\n  cancelNewTaskSubtitle: 'Cancel',\n  newTaskPlaceholder: 'Add a task',\n  newTaskLabel: 'New Task Input',\n  editTaskLabel: 'Edit Task Input',\n  addTaskButtonSubtitle: 'Add',\n  deleteTaskOption: 'Delete',\n  editTaskOption: 'Edit',\n  dueDate: 'Due date',\n  newTaskDateInputLabel: 'New Task Date Input',\n  changeTaskDateInputLabel: 'Change Task Date Input',\n  newTaskNameInputLabel: 'New Task Name Input',\n  cancelAddingTask: 'Cancel adding a new task'\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { html, PropertyValueMap, TemplateResult } from 'lit';\nimport { property, state } from 'lit/decorators.js';\nimport { ifDefined } from 'lit/directives/if-defined.js';\nimport { MgtTemplatedTaskComponent, mgtHtml } from '@microsoft/mgt-element';\nimport { strings } from './strings';\nimport { fluentCombobox, fluentOption } from '@fluentui/web-components';\nimport { registerFluentComponents } from '../../utils/FluentComponents';\nimport '../../styles/style-helper';\nimport { Entity } from '@microsoft/microsoft-graph-types';\nimport { DataChangedDetail, registerMgtGetComponent } from '../mgt-get/mgt-get';\nimport { styles } from './mgt-picker-css';\nimport { registerComponent } from '@microsoft/mgt-element';\n\nexport const registerMgtPickerComponent = () => {\n  registerFluentComponents(fluentCombobox, fluentOption);\n\n  registerMgtGetComponent();\n  registerComponent('picker', MgtPicker);\n};\n\n/**\n * Web component that allows a single entity pick from a generic endpoint from Graph. Is a thin wrapper over mgt-get.\n * Does not load any state itself, only received state from mgt-get via events.\n *\n * @fires {CustomEvent<any>} selectionChanged - Fired when an option is clicked/selected\n * @export\n * @class MgtPicker\n * @extends {MgtTemplatedTaskComponent}\n *\n * @cssprop --picker-background-color - {Color} Picker component background color\n * @cssprop --picker-list-max-height - {String} max height for options list. Default value is 380px.\n */\nexport class MgtPicker extends MgtTemplatedTaskComponent {\n  protected get strings() {\n    return strings;\n  }\n\n  public static get styles() {\n    return styles;\n  }\n\n  /**\n   * The resource to get\n   *\n   * @type {string}\n   * @memberof MgtPicker\n   */\n  @property({\n    attribute: 'resource',\n    type: String\n  })\n  public resource: string;\n\n  /**\n   * Api version to use for request\n   *\n   * @type {string}\n   * @memberof MgtPicker\n   */\n  @property({\n    attribute: 'version',\n    type: String\n  })\n  public version = 'v1.0';\n\n  /**\n   * Maximum number of pages to get for the resource\n   * default = 3\n   * if <= 0, all pages will be fetched\n   *\n   * @type {number}\n   * @memberof MgtPicker\n   */\n  @property({\n    attribute: 'max-pages',\n    type: Number\n  })\n  public maxPages = 3;\n\n  /**\n   * A placeholder for the picker\n   *\n   * @type {string}\n   * @memberof MgtPicker\n   */\n  @property({\n    attribute: 'placeholder',\n    type: String\n  })\n  public placeholder: string;\n\n  /**\n   * Key to be rendered in the picker\n   *\n   * @type {string}\n   * @memberof MgtPicker\n   */\n  @property({\n    attribute: 'key-name',\n    type: String\n  })\n  public keyName: string;\n\n  /**\n   * Entity to be rendered in the picker\n   *\n   * @type {string}\n   * @memberof MgtPicker\n   */\n  @property({\n    attribute: 'entity-type',\n    type: String\n  })\n  public entityType: string;\n\n  /**\n   * The scopes to request\n   *\n   * @type {string[]}\n   * @memberof MgtPicker\n   */\n  @property({\n    attribute: 'scopes',\n    converter: value => {\n      return value ? value.toLowerCase().split(',') : null;\n    }\n  })\n  public scopes: string[] = [];\n\n  /**\n   * Enables cache on the response from the specified resource\n   * default = false\n   *\n   * @type {boolean}\n   * @memberof MgtPicker\n   */\n  @property({\n    attribute: 'cache-enabled',\n    type: Boolean\n  })\n  public cacheEnabled = false;\n\n  /**\n   * Invalidation period of the cache for the responses in milliseconds\n   *\n   * @type {number}\n   * @memberof MgtPicker\n   */\n  @property({\n    attribute: 'cache-invalidation-period',\n    type: Number\n  })\n  public cacheInvalidationPeriod = 0;\n\n  /**\n   * Sets the currently selected value for the picker\n   * Must be present as an option in the supplied data returned from the the underlying graph query\n   *\n   * @type {string}\n   * @memberof MgtPicker\n   */\n  @property({\n    attribute: 'selected-value',\n    type: String\n  })\n  public selectedValue: string;\n\n  @state() private response: Entity[];\n\n  constructor() {\n    super();\n    this.placeholder = this.strings.comboboxPlaceholder;\n    this.entityType = null;\n    this.keyName = null;\n  }\n\n  /**\n   * Refresh the data\n   *\n   * @param {boolean} [hardRefresh=false]\n   * if false (default), the component will only update if the data changed\n   * if true, the data will be first cleared and reloaded completely\n   * @memberof MgtPicker\n   */\n  public refresh(hardRefresh = false) {\n    if (hardRefresh) {\n      this.clearState();\n    }\n    void this._task.run();\n  }\n\n  /**\n   * Clears the state of the component\n   *\n   * @protected\n   * @memberof MgtPicker\n   */\n  protected clearState(): void {\n    this.response = null;\n    this.error = null;\n  }\n\n  public renderLoading = (): TemplateResult => {\n    if (!this.response) {\n      return this.renderTemplate('loading', null);\n    }\n    return this.renderContent();\n  };\n\n  /**\n   * Invoked on each update to perform rendering the picker. This method must return\n   * a lit-html TemplateResult. Setting properties inside this method will *not*\n   * trigger the element to update.\n   */\n  public renderContent = () => {\n    const error = this.error ? (this.error as Error) : null;\n    if (error && this.hasTemplate('error')) {\n      return this.renderTemplate('error', { error }, 'error');\n    } else if (this.hasTemplate('no-data')) {\n      return this.renderTemplate('no-data', null);\n    }\n\n    return this.response?.length > 0 ? this.renderPicker() : this.renderGet();\n  };\n\n  /**\n   * Render picker.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtPicker\n   */\n  protected renderPicker(): TemplateResult {\n    return mgtHtml`\n      <fluent-combobox\n        @keydown=${this.handleComboboxKeydown}\n        current-value=${ifDefined(this.selectedValue)}\n        part=\"picker\"\n        class=\"picker\"\n        id=\"combobox\"\n        autocomplete=\"list\"\n        placeholder=${this.placeholder}>\n          ${this.response.map(\n            item => html`\n            <fluent-option value=${item.id} @click=${(e: MouseEvent) =>\n              this.handleClick(e, item)}> ${this.getNestedPropertyValue(item, this.keyName)} </fluent-option>`\n          )}\n      </fluent-combobox>\n     `;\n  }\n\n  private getNestedPropertyValue(item: Entity, keyName: string) {\n    const keys = keyName.split('.');\n    let value: Entity | object | string = item;\n\n    for (const key of keys) {\n      value = value[key] as object | string;\n\n      if (value === undefined) {\n        console.warn(`mgt-picker: Key '${key}' is undefined.`);\n        return '';\n      }\n    }\n\n    return value;\n  }\n\n  /**\n   * Renders mgt-get which does a GET request to the resource.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtPicker\n   */\n  protected renderGet(): TemplateResult {\n    return mgtHtml`\n      <mgt-get\n        class=\"mgt-get\"\n        resource=${this.resource}\n        version=${this.version}\n        .scopes=${this.scopes}\n        max-pages=${this.maxPages}\n        ?cache-enabled=${this.cacheEnabled}\n        ?cache-invalidation-period=${this.cacheInvalidationPeriod}>\n      </mgt-get>`;\n  }\n\n  /**\n   * When the component is first updated wire up the event listeners.\n   * @param changedProperties a map of changed properties with old values\n   */\n  protected firstUpdated(changedProperties: PropertyValueMap<unknown> | Map<PropertyKey, unknown>): void {\n    super.firstUpdated(changedProperties);\n    const parent = this.renderRoot;\n    if (parent) {\n      parent.addEventListener('dataChange', (e: CustomEvent<DataChangedDetail>): void => this.handleDataChange(e));\n    } else {\n      console.error(': mgt-picker component requires a renderRoot. Something has gone horribly wrong.');\n    }\n  }\n\n  private handleDataChange(e: CustomEvent<DataChangedDetail>): void {\n    const response = e.detail.response.value;\n    const error = e.detail.error ? e.detail.error : null;\n    this.response = response;\n    this.error = error;\n  }\n\n  private handleClick(_e: MouseEvent, item: Entity) {\n    this.fireCustomEvent('selectionChanged', item, true, false, true);\n  }\n\n  /**\n   * Handles getting the fluent option item in the dropdown and fires a custom\n   * event with it when you press Enter or Backspace keys.\n   *\n   * @param {KeyboardEvent} e\n   */\n  private readonly handleComboboxKeydown = (e: KeyboardEvent) => {\n    let value: string;\n    let item: Entity;\n    const keyName: string = e.key;\n    const comboBox: HTMLElement = e.target as HTMLElement;\n    const fluentOptionEl = comboBox.querySelector('.selected');\n    if (fluentOptionEl) {\n      value = fluentOptionEl.getAttribute('value');\n    }\n\n    if ('Enter' === keyName) {\n      if (value) {\n        item = this.response.filter(res => res.id === value).pop();\n        this.fireCustomEvent('selectionChanged', item, true, false, true);\n      }\n    }\n  };\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { html, TemplateResult } from 'lit';\nimport { property } from 'lit/decorators.js';\nimport { ComponentMediaQuery, Providers, ProviderState, MgtTemplatedTaskComponent } from '@microsoft/mgt-element';\nimport { strings } from './strings';\nimport { registerFluentComponents } from '../../utils/FluentComponents';\nimport { fluentTextField, fluentButton, fluentCalendar } from '@fluentui/web-components';\nimport { TodoTask } from '@microsoft/microsoft-graph-types';\n/**\n * The foundation for creating task based components.\n *\n * @export\n * @class MgtTasksBase\n * @extends {MgtTemplatedComponent}\n */\nexport abstract class MgtTasksBase extends MgtTemplatedTaskComponent {\n  /**\n   * determines if tasks are un-editable\n   *\n   * @type {boolean}\n   */\n  @property({ attribute: 'read-only', type: Boolean })\n  public readOnly: boolean;\n\n  /**\n   * sets whether the header is rendered\n   *\n   * @type {boolean}\n   * @memberof MgtTasksBase\n   */\n  @property({ attribute: 'hide-header', type: Boolean })\n  public hideHeader: boolean;\n\n  /**\n   * sets whether the options are rendered\n   *\n   * @type {boolean}\n   * @memberof MgtTasksBase\n   */\n  @property({ attribute: 'hide-options', type: Boolean })\n  public hideOptions: boolean;\n\n  /**\n   * if set, the component will only show tasks from the target list\n   *\n   * @type {string}\n   */\n  @property({ attribute: 'target-id', type: String })\n  public targetId: string;\n\n  /**\n   * if set, the component will first show tasks from this list\n   *\n   * @type {string}\n   * @memberof MgtTodo\n   */\n  @property({ attribute: 'initial-id', type: String })\n  public initialId: string;\n\n  private _previousMediaQuery: ComponentMediaQuery;\n\n  protected get strings(): Record<string, string> {\n    return strings;\n  }\n\n  constructor() {\n    super();\n\n    registerFluentComponents(fluentTextField, fluentButton, fluentCalendar);\n\n    this.clearState();\n    this._previousMediaQuery = this.mediaQuery;\n  }\n\n  protected args(): unknown[] {\n    return [this.providerState, this.targetId, this.initialId];\n  }\n\n  /**\n   * updates provider state\n   *\n   * @memberof MgtTasksBase\n   */\n  public connectedCallback() {\n    super.connectedCallback();\n    window.addEventListener('resize', this.onResize);\n  }\n\n  /**\n   * removes updates on provider state\n   *\n   * @memberof MgtTasksBase\n   */\n  public disconnectedCallback() {\n    window.removeEventListener('resize', this.onResize);\n    super.disconnectedCallback();\n  }\n\n  /**\n   * Render the loading state\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtTasksBase\n   */\n  protected renderLoading = (): TemplateResult => {\n    return this.renderLoadingTask();\n  };\n\n  /**\n   * Invoked by render when the task is in a completed state\n   */\n  protected renderContent = () => {\n    const provider = Providers.globalProvider;\n    if (!provider || provider.state !== ProviderState.SignedIn) {\n      return html``;\n    }\n\n    const picker = this.renderPicker();\n    const newTaskTemplate = this.renderNewTask();\n    const tasksTemplate = this.renderTasks();\n\n    return html`\n      ${picker}\n      ${newTaskTemplate}\n      <div class=\"tasks\" dir=${this.direction}>\n        ${tasksTemplate}\n      </div>\n    `;\n  };\n\n  /**\n   * Render a task in a loading state.\n   *\n   * @protected\n   * @returns\n   * @memberof MgtTodo\n   */\n  protected renderLoadingTask() {\n    return html`\n      <div class=\"task loading-task\">\n        <div class=\"task-details\">\n          <div class=\"title\"></div>\n          <div class=\"task-due\"></div>\n          <div class=\"task-delete\"></div>\n        </div>\n      </div>\n    `;\n  }\n\n  /**\n   * Render the panel for creating a new task.\n   *\n   * @protected\n   * @memberof MgtTasksBase\n   */\n  protected abstract renderNewTask(): TemplateResult;\n\n  /**\n   * Render the generic picker.\n   *\n   * @protected\n   * @memberof MgtTasksBase\n   */\n  protected abstract renderPicker(): TemplateResult;\n\n  /**\n   * Render the list of todo tasks\n   *\n   * @protected\n   * @abstract\n   * @param {ITask[]} tasks\n   * @returns {TemplateResult}\n   * @memberof MgtTasksBase\n   */\n  protected abstract renderTasks(): TemplateResult;\n\n  /**\n   * Make a service call to create the new task object.\n   *\n   * @protected\n   * @abstract\n   * @memberof MgtTasksBase\n   */\n  protected abstract createNewTask(): Promise<void>;\n\n  /**\n   * Clear the form data from the new task panel.\n   *\n   * @protected\n   * @memberof MgtTasksBase\n   */\n  protected abstract clearNewTaskData(): void;\n\n  /**\n   * Clear the component state.\n   *\n   * @protected\n   * @memberof MgtTasksBase\n   */\n  protected clearState(): void {\n    this.requestUpdate();\n  }\n\n  /**\n   * Handle when a task is clicked\n   *\n   * @protected\n   * @param {Event} e\n   * @param {TodoTask} task\n   * @memberof MgtTasksBase\n   */\n  protected handleTaskClick = (task: TodoTask): void => {\n    this.fireCustomEvent('taskClick', { task });\n  };\n\n  /**\n   * Convert a date to a properly formatted string\n   *\n   * @protected\n   * @param {Date} date\n   * @returns\n   * @memberof MgtTasksBase\n   */\n  protected dateToInputValue(date: Date): string {\n    if (date) {\n      return new Date(date.getTime() - date.getTimezoneOffset() * 60000).toISOString().split('T')[0];\n    }\n\n    return null;\n  }\n\n  private readonly onResize = () => {\n    if (this.mediaQuery !== this._previousMediaQuery) {\n      this._previousMediaQuery = this.mediaQuery;\n      this.requestUpdate();\n    }\n  };\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { html, nothing, TemplateResult } from 'lit';\nimport { state } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { ifDefined } from 'lit/directives/if-defined.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport { fluentCheckbox, fluentRadioGroup, fluentButton } from '@fluentui/web-components';\nimport { IGraph, mgtHtml, registerComponent, Providers, ProviderState } from '@microsoft/mgt-element';\nimport { TodoTaskList, TodoTask, TaskStatus } from '@microsoft/microsoft-graph-types';\nimport {\n  createTodoTask,\n  deleteTodoTask,\n  getTodoTaskList,\n  getTodoTaskLists,\n  getTodoTasks,\n  updateTodoTask\n} from './graph.todo';\nimport { styles } from './mgt-todo-css';\nimport { strings } from './strings';\nimport { registerMgtPickerComponent } from '../mgt-picker/mgt-picker';\nimport { MgtTasksBase } from '../mgt-tasks-base/mgt-tasks-base';\nimport { registerFluentComponents } from '../../utils/FluentComponents';\nimport { isElementDark } from '../../utils/isDark';\nimport { getSvg, SvgIcon } from '../../utils/SvgHelper';\n\n/**\n * Filter function\n */\nexport type TodoFilter = (task: TodoTask) => boolean;\n\nexport const registerMgtTodoComponent = () => {\n  registerFluentComponents(fluentCheckbox, fluentRadioGroup, fluentButton);\n  registerMgtPickerComponent();\n  registerComponent('todo', MgtTodo);\n};\n\n/**\n * component enables the user to view, add, remove, complete, or edit todo tasks. It works with tasks in Microsoft Planner or Microsoft To-Do.\n *\n * @export\n * @class MgtTodo\n * @extends {MgtTasksBase}\n *\n * @cssprop --task-color - {Color} - Task text color\n * @cssprop --task-background-color - {Color} - Task background color\n * @cssprop --task-complete-background - {Color} - Task background color when completed\n * @cssprop --task-date-input-active-color - {Color} - Task date input active color\n * @cssprop --task-date-input-hover-color - {Color} - Task date input hover color\n * @cssprop --task-background-color-hover - {Color} - Task background when hovered\n * @cssprop --task-box-shadow - {Color} - Task box shadow color\n * @cssprop --task-border-completed - {Color} - Task border color when completed\n * @cssprop --task-radio-background-color - {Color} - Task radio background color\n */\nexport class MgtTodo extends MgtTasksBase {\n  /**\n   * Array of styles to apply to the element. The styles should be defined\n   * using the `css` tag function.\n   */\n  public static get styles() {\n    return styles;\n  }\n  /**\n   * Strings for localization\n   *\n   * @readonly\n   * @protected\n   * @memberof MgtTodo\n   */\n  protected get strings() {\n    return strings;\n  }\n\n  /**\n   * Optional filter function when rendering tasks\n   *\n   * @type {TodoFilter}\n   * @memberof MgtTodo\n   */\n  public taskFilter: TodoFilter;\n\n  /**\n   * Get the scopes required for todo\n   *\n   * @static\n   * @return {*}  {string[]}\n   * @memberof MgtTodo\n   */\n  public static get requiredScopes(): string[] {\n    return ['tasks.read', 'tasks.readwrite'];\n  }\n  @state() private _tasks: TodoTask[];\n  @state() private _taskBeingUpdated: TodoTask;\n  @state() private _updatingTaskDate: boolean;\n  @state() private _isChangedDueDate = false;\n\n  @state() private _newTaskDueDate: Date;\n  @state() private _newTaskName: string;\n  @state() private _changedTaskName: string;\n  @state() private _isNewTaskBeingAdded: boolean;\n  @state() private _graph: IGraph;\n  @state() private currentList: TodoTaskList;\n  @state() private _isDarkMode = false;\n\n  constructor() {\n    super();\n    this._graph = null;\n    this._newTaskDueDate = null;\n    this._tasks = [];\n    this.addEventListener('selectionChanged', this.handleSelectionChanged);\n    this.addEventListener('blur', this.handleBlur);\n  }\n\n  /**\n   * updates provider state\n   *\n   * @memberof MgtTodo\n   */\n  public connectedCallback() {\n    super.connectedCallback();\n    window.addEventListener('darkmodechanged', this.onThemeChanged);\n    // invoked to ensure we have the correct initial value for _isDarkMode\n    this.onThemeChanged();\n  }\n\n  /**\n   * removes updates on provider state\n   *\n   * @memberof MgtTodo\n   */\n  public disconnectedCallback() {\n    window.removeEventListener('darkmodechanged', this.onThemeChanged);\n    super.disconnectedCallback();\n  }\n\n  private readonly onThemeChanged = () => {\n    this._isDarkMode = isElementDark(this);\n  };\n\n  /**\n   * Render the list of todo tasks\n   */\n  protected renderTasks(): TemplateResult {\n    let tasks = this._tasks;\n    if (tasks && this.taskFilter) {\n      tasks = tasks.filter(task => this.taskFilter(task));\n    }\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n    const completedTasks = tasks.filter(task => task.status === 'completed');\n\n    const taskTemplates = repeat(\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n      tasks.filter(task => task.status !== 'completed'),\n      task => task.id,\n      task => this.renderTask(task)\n    );\n\n    const completedTaskTemplates = repeat(\n      completedTasks\n        .sort((a, b) => {\n          return a.lastModifiedDateTime < b.lastModifiedDateTime ? -1 : 1;\n        })\n        .filter(task => task.status === 'completed'),\n      task => task.id,\n      task => this.renderTask(task)\n    );\n    return html`\n      ${taskTemplates}\n      ${completedTaskTemplates}\n    `;\n  }\n\n  /**\n   * Render the generic picker or the task list displayName.\n   *\n   */\n  protected renderPicker() {\n    if (this.targetId) {\n      return html`<p>${this.currentList?.displayName}</p>`;\n    } else {\n      return mgtHtml`\n        <mgt-picker\n          resource=\"me/todo/lists\"\n          scopes=\"tasks.read, tasks.readwrite\"\n          key-name=\"displayName\"\n          selected-value=\"${ifDefined(this.currentList?.displayName)}\"\n          placeholder=\"Select a task list\">\n        </mgt-picker>`;\n    }\n  }\n\n  /**\n   * Render the panel for creating a new task\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtTodo\n   */\n  protected renderNewTask = (): TemplateResult => {\n    const addIcon = this._newTaskName\n      ? html`\n        <fluent-checkbox\n          class=\"task-add-icon\"\n          @click=\"${this.addTask}\">\n        </fluent-checkbox>\n      `\n      : html`\n        <span class=\"add-icon\">${getSvg(SvgIcon.Add)}</span>\n      `;\n\n    const cancelIcon = html`\n      <fluent-button\n        aria-label=${this.strings.cancelAddingTask}\n        class=\"task-cancel-icon\" \n        @click=\"${this.clearNewTaskData}\"\n      >\n        ${getSvg(SvgIcon.Cancel)}\n      </fluent-button>\n    `;\n    const dateClass = { dark: this._isDarkMode, date: true };\n    const calendarTemplate = html`\n      <fluent-text-field\n        autocomplete=\"off\"\n        type=\"date\"\n        id=\"new-taskDate-input\"\n        class=\"${classMap(dateClass)}\"\n        aria-label=\"${this.strings.newTaskDateInputLabel}\"\n        .value=\"${this.dateToInputValue(this._newTaskDueDate)}\"\n        @change=\"${this.handleDateChange}\"\n      >\n      </fluent-text-field>\n    `;\n\n    const newTaskDetails = this.readOnly\n      ? nothing\n      : html`\n      <fluent-text-field\n        autocomplete=\"off\"\n        appearance=\"outline\"\n        class=\"new-task\"\n        id=\"new-task-name-input\"\n        aria-label=\"${this.strings.newTaskLabel}\"\n        .value=${this._newTaskName}\n        placeholder=\"${this.strings.newTaskPlaceholder}\"\n        @keydown=\"${this.handleKeyDown}\"\n        @input=\"${this.handleInput}\"\n      >\n        <div slot=\"start\" class=\"start\">${addIcon}</div>\n        ${\n          this._newTaskName\n            ? html`\n              <div slot=\"end\" class=\"end\">\n                <span class=\"calendar\">${calendarTemplate}</span>\n                ${cancelIcon}\n              </div> `\n            : html``\n        }\n      </fluent-text-field>\n    `;\n    return html`\n      ${\n        this.currentList\n          ? html`\n            <div dir=${this.direction} class=\"task new-task incomplete\">\n              ${newTaskDetails}\n            </div>\n        `\n          : html``\n      }  \n     `;\n  };\n\n  /**\n   * Handle a change in taskList.\n   *\n   * @protected\n   * @param {CustomEvent} e\n   * @returns {TemplateResult}\n   * @memberof MgtTodo\n   */\n\n  protected handleSelectionChanged = (e: CustomEvent<TodoTaskList>) => {\n    this.currentList = e.detail;\n    void this.loadTasks(this.currentList);\n  };\n\n  /**\n   * Render task details.\n   *\n   * @protected\n   * @param {TodoTask} task\n   * @returns {TemplateResult}\n   * @memberof MgtTodo\n   */\n  protected renderTaskDetails = (task: TodoTask) => {\n    const context = { task, list: this.currentList };\n\n    if (this.hasTemplate('task')) {\n      return this.renderTemplate('task', context, task.id);\n    }\n\n    let taskDetailsTemplate = null;\n\n    const taskDeleteTemplate = html`\n      <fluent-button class=\"task-delete\"\n        @click=\"${() => this.removeTask(task.id)}\"\n        aria-label=\"${this.strings.deleteTaskOption}\">\n        ${getSvg(SvgIcon.Delete)}\n      </fluent-button>`;\n\n    if (this.hasTemplate('task-details')) {\n      taskDetailsTemplate = this.renderTemplate('task-details', context, `task-details-${task.id}`);\n    } else {\n      const dateClass = { dark: this._isDarkMode, date: true, 'task-due': true };\n      const calendarTemplate = html`\n        <fluent-text-field\n          autocomplete=\"off\"\n          type=\"date\"\n          id=\"${task.id}-taskDate-input\"\n          class=\"${classMap(dateClass)}\"\n          aria-label=\"${this.strings.changeTaskDateInputLabel}\"\n          .value=\"${\n            task.dueDateTime\n              ? this.dateToInputValue(new Date(task.dueDateTime.dateTime))\n              : this._taskBeingUpdated === task\n              ? this.dateToInputValue(this._newTaskDueDate)\n              : nothing\n          }\"\n          @change=\"${this.handleDateUpdate}\"\n          @focus=\"${(e: KeyboardEvent) => this.updatingTask(e, task)}\"\n          @blur=\"${this.handleBlur}\"\n        >\n        </fluent-text-field>\n      `;\n      const changeTaskDetailsTemplate = html`\n          <fluent-text-field \n            autocomplete=\"off\"\n            appearance=\"outline\"\n            class=\"title\"\n            id=${task.id}\n            .value=\"${task.title ? task.title : this._taskBeingUpdated === task ? this._changedTaskName : ''}\"\n            aria-label=\"${this.strings.editTaskLabel}\"\n            @keydown=\"${(e: KeyboardEvent) => this.handleChange(e, task)}\"\n            @input=\"${(e: KeyboardEvent) => this.handleChange(e, task)}\"\n            @focus=\"${(e: KeyboardEvent) => this.updatingTask(e, task)}\"\n          >\n          </fluent-text-field>\n          ${task.dueDateTime || this._taskBeingUpdated === task ? html`${calendarTemplate}` : nothing}\n          ${taskDeleteTemplate}\n      `;\n\n      taskDetailsTemplate = html`\n      <div class=\"task-details\">\n        ${changeTaskDetailsTemplate}\n      </div>\n      `;\n    }\n\n    return html`${taskDetailsTemplate}`;\n  };\n\n  /**\n   * Render a task in the list.\n   *\n   * @protected\n   * @param {TodoTask} task\n   * @returns {TemplateResult}\n   * @memberof MgtTodo\n   */\n  protected renderTask = (task: TodoTask) => {\n    const isCompleted = task.status === 'completed';\n\n    const taskClasses = classMap({\n      complete: isCompleted,\n      'read-only': this.readOnly,\n      task: true\n    });\n\n    const checkboxClasses = classMap({\n      complete: isCompleted\n    });\n\n    const taskCheckContent = html`${getSvg(SvgIcon.CheckMark)}`;\n\n    return html`\n      <div class=${taskClasses} @blur=\"${this.handleBlur}\">\n        <fluent-checkbox \n          id=${task.id} \n          class=${checkboxClasses}\n          ?checked=${isCompleted}\n          @click=\"${() => this.handleTaskCheckClick(task)}\"\n          @keydown=\"${(e: KeyboardEvent) => this.handleTaskCheckKeydown(e, task)}\"\n        >\n          <div slot=\"checked-indicator\">\n            ${taskCheckContent}\n          </div>\n        </fluent-checkbox>\n        ${this.renderTaskDetails(task)}\n      </div>\n    `;\n  };\n\n  /**\n   * loads tasks from dataSource\n   *\n   * @returns {Promise<void>}\n   * @memberof MgtTodo\n   */\n  protected loadState = async (): Promise<void> => {\n    const provider = Providers.globalProvider;\n    if (!provider || provider.state !== ProviderState.SignedIn) {\n      return;\n    }\n\n    if (!this._graph) {\n      const graph = provider.graph.forComponent(this);\n      this._graph = graph;\n    }\n\n    if (!this.currentList && !this.initialId) {\n      const lists = await getTodoTaskLists(this._graph);\n      const defaultList = lists?.find(l => l.wellknownListName === 'defaultList');\n      if (defaultList) await this.loadTasks(defaultList);\n    }\n\n    if (this.targetId) {\n      // Call to get the displayName of the list\n      this.currentList = await getTodoTaskList(this._graph, this.targetId);\n      this._tasks = await getTodoTasks(this._graph, this.targetId);\n    } else if (this.initialId) {\n      // Call to get the displayName of the list\n      this.currentList = await getTodoTaskList(this._graph, this.initialId);\n      this._tasks = await getTodoTasks(this._graph, this.initialId);\n    }\n  };\n\n  /**\n   * Send a request the Graph to create a new todo task item\n   *\n   * @protected\n   * @returns {Promise<void>}\n   * @memberof MgtTodo\n   */\n  protected async createNewTask(): Promise<void> {\n    const listId = this.currentList.id;\n    const taskData = {\n      title: this._newTaskName\n    };\n\n    if (this._newTaskDueDate) {\n      // eslint-disable-next-line @typescript-eslint/dot-notation\n      taskData['dueDateTime'] = {\n        dateTime: new Date(this._newTaskDueDate).toLocaleDateString(),\n        timeZone: 'UTC'\n      };\n    }\n\n    const task = await createTodoTask(this._graph, listId, taskData);\n    this._tasks.unshift(task);\n  }\n\n  /**\n   * Create a new todo task and add it to the list\n   *\n   * @protected\n   * @returns {Promise<void>}\n   * @memberof MgtTodo\n   */\n  protected addTask = async (): Promise<void> => {\n    if (this._isNewTaskBeingAdded || !this._newTaskName) {\n      return;\n    }\n\n    this._isNewTaskBeingAdded = true;\n\n    try {\n      await this.createNewTask();\n    } finally {\n      this.clearNewTaskData();\n      this._isNewTaskBeingAdded = false;\n    }\n  };\n\n  /**\n   *Update a todo task in the todo list\n   * @protected\n   * @returns {Promise<void>}\n   * @memberof MgtTodo\n   */\n  protected updateTask = async (task: TodoTask): Promise<void> => {\n    try {\n      if (!this._changedTaskName && !this._isChangedDueDate) {\n        return;\n      }\n      await this.updateTaskItem(task);\n    } finally {\n      this.clearNewTaskData();\n    }\n  };\n\n  /**\n   * Send a request the Graph to update a todo task item\n   *\n   * @protected\n   * @returns {Promise<void>}\n   * @memberof MgtTodo\n   */\n  protected async updateTaskItem(task: TodoTask): Promise<void> {\n    const listId = this.currentList.id;\n    let taskData: TodoTask = {};\n\n    if (this._changedTaskName && this._changedTaskName !== task.title) {\n      taskData = {\n        title: this._changedTaskName\n      };\n    }\n\n    if (this._updatingTaskDate) {\n      if (!this._isChangedDueDate) {\n        return;\n      }\n      if (this._newTaskDueDate) {\n        taskData.dueDateTime = {\n          dateTime: new Date(this._newTaskDueDate).toLocaleDateString(),\n          timeZone: 'UTC'\n        };\n      } else if (this._isChangedDueDate && !this._newTaskDueDate) {\n        taskData.dueDateTime = null;\n      } else {\n        taskData.dueDateTime = null;\n      }\n    }\n\n    if (!Object.keys(taskData).length) {\n      return;\n    }\n    const updatedTask = await updateTodoTask(this._graph, listId, task.id, taskData);\n    const taskIndex = this._tasks.findIndex(t => t.id === updatedTask.id);\n    this._tasks[taskIndex] = updatedTask;\n  }\n\n  /**\n   * Clear out the new task metadata input fields\n   *\n   * @protected\n   * @memberof MgtTodo\n   */\n  protected clearNewTaskData = (): void => {\n    this._newTaskDueDate = null;\n    this._newTaskName = '';\n    this._changedTaskName = '';\n    this._isChangedDueDate = false;\n    this.focusOnTaskInput();\n  };\n\n  protected focusOnTaskInput = (): void => {\n    const taskInputWrapper = this.renderRoot.querySelector<HTMLInputElement>('#new-task-name-input');\n    const input = taskInputWrapper?.shadowRoot.querySelector<HTMLInputElement>('input');\n    if (input) {\n      input.focus();\n    }\n  };\n\n  /**\n   * Clear the state of the component\n   *\n   * @protected\n   * @memberof MgtTodo\n   */\n  protected clearState = (): void => {\n    super.clearState();\n    this.currentList = null;\n    this._tasks = [];\n    this._taskBeingUpdated = null;\n  };\n\n  private readonly loadTasks = async (list: TodoTaskList): Promise<void> => {\n    this.currentList = list;\n\n    this._tasks = await getTodoTasks(this._graph, list.id);\n  };\n\n  private readonly updateTaskStatus = async (task: TodoTask, taskStatus: TaskStatus): Promise<void> => {\n    // Change the task status\n    task.status = taskStatus;\n\n    // Send update request\n    const listId = this.currentList.id;\n    task = await updateTodoTask(this._graph, listId, task.id, task);\n\n    const taskIndex = this._tasks.findIndex(t => t.id === task.id);\n    this._tasks[taskIndex] = task;\n    await this._task.run();\n  };\n\n  private readonly removeTask = async (taskId: string): Promise<void> => {\n    this._tasks = this._tasks.filter(t => t.id !== taskId);\n    this.requestUpdate();\n\n    const listId = this.currentList.id;\n    await deleteTodoTask(this._graph, listId, taskId);\n\n    this._tasks = this._tasks.filter(t => t.id !== taskId);\n  };\n\n  private handleTaskCheckClick(task: TodoTask) {\n    this.handleTaskClick(task);\n    if (!this.readOnly) {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n      if (task.status === 'completed') {\n        void this.updateTaskStatus(task, 'notStarted');\n      } else {\n        void this.updateTaskStatus(task, 'completed');\n      }\n    }\n  }\n\n  private handleTaskCheckKeydown(e: KeyboardEvent, task: TodoTask) {\n    if (e.key === 'Enter' && !this.readOnly) {\n      this.handleTaskClick(task);\n      if (task.status === 'completed') {\n        void this.updateTaskStatus(task, 'notStarted');\n      } else {\n        void this.updateTaskStatus(task, 'completed');\n      }\n    }\n  }\n\n  private readonly handleInput = (e: MouseEvent) => {\n    if ((e.target as HTMLInputElement).id === 'new-task-name-input') {\n      this._newTaskName = (e.target as HTMLInputElement).value;\n    }\n  };\n\n  private readonly handleChange = async (e: KeyboardEvent, task: TodoTask) => {\n    if ((e.target as HTMLInputElement).id === task.id) {\n      if (e.key === 'Enter') {\n        await this.updateTask(task);\n        (e.target as HTMLInputElement)?.blur();\n      }\n      this._changedTaskName = (e.target as HTMLInputElement).value;\n    }\n  };\n\n  private readonly handleKeyDown = async (e: KeyboardEvent) => {\n    if (e.key === 'Enter' && (e.target as HTMLInputElement).id === 'new-task-name-input') {\n      await this.addTask();\n    }\n  };\n\n  private readonly updatingTask = (e: KeyboardEvent, task: TodoTask) => {\n    if ((e.target as HTMLInputElement).id === task.id) {\n      this._taskBeingUpdated = task;\n    }\n    if ((e.target as HTMLInputElement).id === `${task.id}-taskDate-input`) {\n      this._updatingTaskDate = true;\n      this._taskBeingUpdated = task;\n    }\n  };\n\n  private readonly handleBlur = () => {\n    const task = this._taskBeingUpdated;\n    const targets = this.renderRoot.querySelectorAll('fluent-text-field');\n    for (const target of targets) {\n      if (\n        task &&\n        ((target as HTMLInputElement).id === task.id || (target as HTMLInputElement).id === `${task.id}-taskDate-input`)\n      ) {\n        void this.updateTask(task);\n        (target as HTMLElement)?.blur();\n        this._taskBeingUpdated = null;\n        this._updatingTaskDate = false;\n      }\n    }\n  };\n\n  private readonly handleDateChange = (e: Event) => {\n    const value = (e.target as HTMLInputElement).value;\n    if (value) {\n      this._newTaskDueDate = new Date(value + 'T17:00');\n    } else {\n      this._newTaskDueDate = null;\n    }\n  };\n\n  private readonly handleDateUpdate = (e: Event) => {\n    const task = this._taskBeingUpdated;\n    if (task) {\n      const value = (e.target as HTMLInputElement).value;\n      if (value) {\n        this._newTaskDueDate = new Date(value + 'T17:00');\n      } else {\n        this._newTaskDueDate = null;\n      }\n\n      if (task.dueDateTime && this._newTaskDueDate) {\n        this._isChangedDueDate = new Date(task.dueDateTime.dateTime) !== this._newTaskDueDate;\n      } else if (task.dueDateTime || this._newTaskDueDate) {\n        this._isChangedDueDate = true;\n      } else {\n        this._isChangedDueDate = false;\n      }\n    }\n  };\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport type * as MicrosoftGraph from '@microsoft/microsoft-graph-types';\nimport { Position } from '../../graph/types';\nimport { html, PropertyValueMap, TemplateResult } from 'lit';\nimport { property, state } from 'lit/decorators.js';\nimport { MgtTemplatedTaskComponent, mgtHtml } from '@microsoft/mgt-element';\nimport { strings } from './strings';\nimport { fluentCombobox, fluentOption } from '@fluentui/web-components';\nimport { registerFluentComponents } from '../../utils/FluentComponents';\nimport '../../styles/style-helper';\nimport { styles } from './mgt-taxonomy-picker-css';\nimport { DataChangedDetail, registerMgtGetComponent } from '../mgt-get/mgt-get';\nimport { registerComponent } from '@microsoft/mgt-element';\nimport { registerMgtSpinnerComponent } from '../sub-components/mgt-spinner/mgt-spinner';\n\nexport const registerMgtTaxonomyPickerComponent = () => {\n  registerFluentComponents(fluentCombobox, fluentOption);\n\n  registerMgtSpinnerComponent();\n  registerMgtGetComponent();\n  registerComponent('taxonomy-picker', MgtTaxonomyPicker);\n};\n\n/**\n * Web component that can query the Microsoft Graph API for Taxonomy\n * and render a dropdown control with terms,\n * allowing selection of a single term based on\n * the specified term set id or a combination of the specified term set id and the specified term id.\n * Uses mgt-get.\n *\n * @fires {CustomEvent<MicrosoftGraph.TermStore.Term>} selectionChanged - Fired when an option is clicked/selected\n * @export\n * @class MgtTaxonomyPicker\n * @extends {MgtTemplatedTaskComponent}\n *\n * @cssprop --taxonomy-picker-background-color - {Color} Picker component background color\n * @cssprop --taxonomy-picker-list-max-height - {String} max height for options list. Default value is 380px.\n * @cssprop --taxonomy-picker-placeholder-color - {Color} Text color for the placeholder in the picker\n * @cssprop --taxonomy-picker-placeholder-hover-color - {Color} Text color for the placeholder in the picker on hover\n */\nexport class MgtTaxonomyPicker extends MgtTemplatedTaskComponent {\n  /**\n   * The strings to be used for localizing the component.\n   *\n   * @readonly\n   * @protected\n   * @memberof MgtTaxonomyPicker\n   */\n  protected get strings() {\n    return strings;\n  }\n\n  public static get styles() {\n    return styles;\n  }\n\n  /**\n   * The termsetId of the term set whose children to get.\n   *\n   * @type {string}\n   * @memberof MgtTaxonomyPicker\n   */\n  @property({\n    attribute: 'term-set-id',\n    type: String\n  })\n  public termsetId: string;\n\n  /**\n   * The termId of the term whose children to get. This term must be a child of the term set specified by termsetId.\n   *\n   * @type {string}\n   * @memberof MgtTaxonomyPicker\n   */\n  @property({\n    attribute: 'term-id',\n    type: String\n  })\n  public termId: string;\n\n  /**\n   * The id of the site where the termset is located. If not specified, the termset is assumed to be at the tenant level.\n   *\n   * @type {string}\n   * @memberof MgtTaxonomyPicker\n   */\n  @property({\n    attribute: 'site-id',\n    type: String\n  })\n  public siteId: string;\n\n  /**\n   * The locale based on which the term names should be returned.\n   *\n   * @type {string}\n   * @memberof MgtTaxonomyPicker\n   */\n  @property({\n    attribute: 'locale',\n    type: String\n  })\n  public locale: string;\n\n  /**\n   * Api version to use for request.\n   * Default is beta.\n   *\n   * @type {string}\n   * @memberof MgtTaxonomyPicker\n   */\n  @property({\n    attribute: 'version',\n    type: String\n  })\n  public version = 'beta';\n\n  /**\n   * A placeholder for the picker.\n   *\n   * @type {string}\n   * @memberof MgtTaxonomyPicker\n   */\n  @property({\n    attribute: 'placeholder',\n    type: String\n  })\n  public placeholder: string;\n\n  /**\n   * The position of the dropdown. Can be 'above' or 'below'.\n   *\n   * @type {string}\n   * @memberof MgtTaxonomyPicker\n   */\n  @property({\n    attribute: 'position',\n    type: String,\n    converter: (value: Position): Position => {\n      if (value === 'above') {\n        return 'above';\n      }\n      return 'below';\n    }\n  })\n  public position: Position = 'below';\n\n  /**\n   * The default selected term id.\n   *\n   * @type {string}\n   * @memberof MgtTaxonomyPicker\n   */\n  @property({\n    attribute: 'default-selected-term-id',\n    type: String\n  })\n  public defaultSelectedTermId: string;\n\n  /**\n   * The selected term.\n   *\n   * @type {MicrosoftGraph.TermStore.Term}\n   * @memberof MgtTaxonomyPicker\n   */\n  @property({\n    attribute: 'selected-term',\n    type: Object\n  })\n  public selectedTerm: MicrosoftGraph.TermStore.Term | null = null;\n\n  /**\n   * Determines whether component should be disabled or not\n   *\n   * @type {boolean}\n   * @memberof MgtPeoplePicker\n   */\n  @property({\n    attribute: 'disabled',\n    type: Boolean\n  })\n  public disabled: boolean;\n\n  /**\n   * Enables cache on the response from the specified resource.\n   * Default is false.\n   *\n   * @type {boolean}\n   * @memberof MgtTaxonomyPicker\n   */\n  @property({\n    attribute: 'cache-enabled',\n    type: Boolean\n  })\n  public cacheEnabled = false;\n\n  /**\n   * Invalidation period of the cache for the responses in milliseconds.\n   *\n   * @type {number}\n   * @memberof MgtTaxonomyPicker\n   */\n  @property({\n    attribute: 'cache-invalidation-period',\n    type: Number\n  })\n  public cacheInvalidationPeriod = 0;\n\n  @state() private terms: MicrosoftGraph.TermStore.Term[];\n  @state() private noTerms: boolean;\n  // @state() private error: object;\n\n  constructor() {\n    super();\n    this.placeholder = this.strings.comboboxPlaceholder;\n    this.noTerms = false;\n  }\n\n  /**\n   * Refresh the data\n   *\n   * @param {boolean} [hardRefresh=false]\n   * if false (default), the component will only update if the data changed\n   * if true, the data will be first cleared and reloaded completely\n   * @memberof MgtTaxonomyPicker\n   */\n  public refresh(hardRefresh = false) {\n    if (hardRefresh) {\n      this.clearState();\n    }\n  }\n\n  /**\n   * Clears the state of the component\n   *\n   * @protected\n   * @memberof MgtTaxonomyPicker\n   */\n  protected clearState(): void {\n    this.terms = null;\n    this.error = null;\n    this.noTerms = false;\n  }\n  /**\n   * Renders loading spinner while terms are fetched from the Graph\n   *\n   * @protected\n   * @returns\n   * @memberof MgtTaxonomyPicker\n   */\n  protected renderLoading = () => {\n    if (!this.terms) {\n      return (\n        this.renderTemplate('loading', null, 'loading') ||\n        mgtHtml`\n        <div class=\"message-parent\">\n          <mgt-spinner></mgt-spinner>\n          <div label=\"loading-text\" aria-label=\"loading\">\n            ${this.strings.loadingMessage}\n          </div>\n        </div>\n      `\n      );\n    }\n    return this.renderContent();\n  };\n\n  /**\n   * Invoked on each update to perform rendering the picker. This method must return\n   * a lit-html TemplateResult. Setting properties inside this method will *not*\n   * trigger the element to update.\n   */\n  public renderContent = () => {\n    // if error state, render error template\n    if (this.error) {\n      return this.renderError();\n    }\n\n    // if no terms are found, render no-data template\n    if (this.noTerms) {\n      return this.renderNoData();\n    }\n\n    // if terms are found, render picker else render get\n    return this.terms?.length > 0 ? this.renderTaxonomyPicker() : this.renderGet();\n  };\n\n  /**\n   * Render the no-data state.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtTaxonomyPicker\n   */\n  protected renderError = (): TemplateResult =>\n    this.renderTemplate('error', null, 'error') || html`<span>${this.error}</span>`;\n  /**\n   * Render the no-data state.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtTaxonomyPicker\n   */\n  protected renderNoData(): TemplateResult {\n    return this.renderTemplate('no-data', null) || html`<span>${this.strings.noTermsFound}</span>`;\n  }\n\n  /**\n   * Render picker.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtTaxonomyPicker\n   */\n  protected renderTaxonomyPicker(): TemplateResult {\n    return mgtHtml`\n      <fluent-combobox class=\"taxonomy-picker\" autocomplete=\"both\" placeholder=${this.placeholder} position=${\n        this.position\n      } ?disabled=${this.disabled}>\n        ${this.terms.map(term => this.renderTaxonomyPickerItem(term))}\n      </fluent-combobox>\n     `;\n  }\n\n  /**\n   * Render picker item.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtTaxonomyPicker\n   */\n  protected renderTaxonomyPickerItem(term: MicrosoftGraph.TermStore.Term): TemplateResult {\n    const selected: boolean = this.defaultSelectedTermId && this.defaultSelectedTermId === term.id;\n\n    return html`\n        <fluent-option value=${term.id} ?selected=${selected} @click=${(e: MouseEvent) => this.handleClick(e, term)}> ${\n          this.renderTemplate('term', { term }, term.id) || term.labels[0].name\n        } </fluent-option>\n        `;\n  }\n\n  /**\n   * Render picker.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtTaxonomyPicker\n   */\n  protected renderGet(): TemplateResult {\n    // if termsetId is not specified, return error message\n    if (!this.termsetId) {\n      return html`<span>${this.strings.termsetIdRequired}</span>`;\n    }\n\n    let resource = `/termStore/sets/${this.termsetId}/children`;\n\n    // if both termsetId and termId are specified, then set resource to /termStore/sets/{termsetId}/terms/{termId}/children\n    if (this.termId) {\n      resource = `/termStore/sets/${this.termsetId}/terms/${this.termId}/children`;\n    }\n\n    // if siteId is specified, then prefix /sites/{siteId}/ to the resource\n    if (this.siteId) {\n      resource = `/sites/${this.siteId}${resource}`;\n    }\n\n    // Add properties to select to the resource\n    resource += '?$select=id,labels,descriptions,properties';\n\n    return mgtHtml`\n      <mgt-get\n        class=\"mgt-get\"\n        resource=${resource}\n        version=${this.version}\n        scopes=\"TermStore.Read.All, TermStore.ReadWrite.All\"\n        ?cache-enabled=${this.cacheEnabled}\n        ?cache-invalidation-period=${this.cacheInvalidationPeriod}>\n      </mgt-get>`;\n  }\n\n  protected firstUpdated(changedProperties: PropertyValueMap<unknown> | Map<PropertyKey, unknown>): void {\n    super.firstUpdated(changedProperties);\n    const parent = this.renderRoot;\n    parent.addEventListener('dataChange', (e: CustomEvent<DataChangedDetail>): void => this.handleDataChange(e));\n  }\n\n  private handleDataChange(e: CustomEvent<DataChangedDetail>): void {\n    const error = e.detail.error ? e.detail.error : null;\n\n    if (error) {\n      this.error = error;\n      return;\n    }\n\n    // if locale is specified, then convert it to lower case\n    if (this.locale) {\n      this.locale = this.locale.toLowerCase();\n    }\n\n    const response = e.detail.response.value;\n\n    // if response is not null and has values, if locale is specified, then\n    // get the label in response that has languageTag equal to locale and make it the first label and append the rest of the labels\n\n    const terms = response.map((item: MicrosoftGraph.TermStore.Term) => {\n      const labels = item.labels;\n      if (labels && labels.length > 0) {\n        if (this.locale) {\n          const label = labels.find(l => l.languageTag.toLowerCase() === this.locale);\n          if (label) {\n            item.labels = [label, ...labels.filter(l => l.languageTag.toLowerCase() !== this.locale)];\n          }\n        }\n      }\n      return item;\n    });\n\n    this.terms = terms;\n\n    //  if there are no terms then set noTerms to true\n    if (terms.length === 0) {\n      this.noTerms = true;\n    }\n  }\n\n  private handleClick(e: MouseEvent, item: MicrosoftGraph.TermStore.Term) {\n    this.selectedTerm = item;\n    this.fireCustomEvent('selectionChanged', item);\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { html, TemplateResult } from 'lit';\nimport { property } from 'lit/decorators.js';\nimport { MgtBaseTaskComponent } from '@microsoft/mgt-element';\nimport { fluentSwitch } from '@fluentui/web-components';\nimport { registerFluentComponents } from '../../utils/FluentComponents';\nimport { applyTheme } from '../../styles/theme-manager';\nimport { strings } from './strings';\nimport { registerComponent } from '@microsoft/mgt-element';\n\nexport const registerMgtThemeToggleComponent = () => {\n  registerFluentComponents(fluentSwitch);\n  registerComponent('theme-toggle', MgtThemeToggle);\n};\n\n/**\n * Toggle to switch between light and dark mode\n * Will detect browser preference and set accordingly or dark mode can be forced\n *\n * @fires {CustomEvent<boolean>} darkmodechanged - Fired when dark mode is toggled by a user action\n *\n * @class MgtDarkToggle\n * @extends {MgtBaseTaskComponent}\n */\nexport class MgtThemeToggle extends MgtBaseTaskComponent {\n  constructor() {\n    super();\n    const prefersDarkMode = window.matchMedia('(prefers-color-scheme:dark)').matches;\n    this.darkModeActive = prefersDarkMode;\n    this.applyTheme(this.darkModeActive);\n  }\n  /**\n   * Provides strings for localization\n   *\n   * @readonly\n   * @protected\n   * @memberof MgtDarkToggle\n   */\n  protected get strings() {\n    return strings;\n  }\n\n  /**\n   * Controls whether dark mode is active\n   *\n   * @type {boolean}\n   * @memberof MgtDarkToggle\n   */\n  @property({\n    attribute: 'mode',\n    reflect: true,\n    type: String,\n    converter: {\n      fromAttribute: (value: string) => {\n        return value === 'dark';\n      },\n      toAttribute: (value: boolean) => {\n        return value ? 'dark' : 'light';\n      }\n    }\n  })\n  public darkModeActive: boolean;\n\n  /**\n   * Fires after a component is updated.\n   * Allows a component to trigger side effects after updating.\n   *\n   * @param {Map<string, any>} changedProperties\n   * @memberof MgtDarkToggle\n   */\n  updated(changedProperties: Map<string, unknown>): void {\n    if (changedProperties.has('darkModeActive')) {\n      this.applyTheme(this.darkModeActive);\n    }\n  }\n\n  /**\n   * renders the component\n   *\n   * @return {TemplateResult}\n   * @memberof MgtDarkToggle\n   */\n  render(): TemplateResult {\n    return html`\n      <fluent-switch checked=${this.darkModeActive} @change=${this.onSwitchChanged}>\n        <span slot=\"checked-message\">${strings.on}</span>\n        <span slot=\"unchecked-message\">${strings.off}</span>\n        <label for=\"direction-switch\">${strings.label}</label>\n      </fluent-switch>\n`;\n  }\n\n  private readonly onSwitchChanged = (e: Event) => {\n    this.darkModeActive = (e.target as HTMLInputElement).checked;\n  };\n\n  private applyTheme(active: boolean) {\n    const targetTheme = active ? 'dark' : 'light';\n    applyTheme(targetTheme);\n\n    document.body.classList.remove('mgt-dark-mode', 'mgt-light-mode');\n    document.body.classList.add(`mgt-${targetTheme}-mode`);\n    this.fireCustomEvent('darkmodechanged', this.darkModeActive, true, false, true);\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { CSSResult, html, TemplateResult } from 'lit';\nimport { property } from 'lit/decorators.js';\nimport { MgtBaseTaskComponent } from '@microsoft/mgt-element';\nimport { fluentSearch } from '@fluentui/web-components';\nimport { registerFluentComponents } from '../../utils/FluentComponents';\nimport { strings } from './strings';\nimport { styles } from './mgt-search-box-css';\nimport { debounce } from '../../utils/Utils';\nimport { registerComponent } from '@microsoft/mgt-element';\n\nexport const registerMgtSearchBoxComponent = () => {\n  registerFluentComponents(fluentSearch);\n  registerComponent('search-box', MgtSearchBox);\n};\n\n/**\n * Web component used to enter a search value to power search scenarios.\n *\n * @fires {CustomEvent<string>} searchTermChanged - Fired when the search term is changed\n *\n * @class MgtSearchBox\n * @extends {MgtBaseComponent}\n */\nexport class MgtSearchBox extends MgtBaseTaskComponent {\n  /**\n   * Array of styles to apply to the element. The styles should be defined\n   * user the `css` tag function.\n   */\n  static get styles(): CSSResult[] {\n    return styles;\n  }\n\n  /**\n   * Provides strings for localization\n   *\n   * @readonly\n   * @protected\n   * @memberof MgtSearchBox\n   */\n  protected get strings() {\n    return strings;\n  }\n\n  /**\n   * The placeholder rendered in the search input (for example, `Select a user` or `Select a task list`).\n   *\n   * @type {string}\n   * @memberof MgtSearchBox\n   */\n  @property({\n    attribute: 'placeholder',\n    type: String\n  })\n  public placeholder: string;\n\n  /**\n   * Value of the search term\n   *\n   * @type {string}\n   * @memberof MgtSearchBox\n   */\n  @property({\n    attribute: 'search-term',\n    type: String\n  })\n  public get searchTerm() {\n    return this._searchTerm;\n  }\n  public set searchTerm(value) {\n    this._searchTerm = value;\n    this.fireSearchTermChanged();\n  }\n\n  /**\n   * Debounce delay of the search input in milliseconds\n   *\n   * @type {number}\n   * @memberof MgtSearchBox\n   */\n  @property({\n    attribute: 'debounce-delay',\n    type: Number,\n    reflect: true\n  })\n  public debounceDelay: number;\n  private _searchTerm = '';\n  private debouncedSearchTermChanged: () => void;\n\n  constructor() {\n    super();\n    this.debounceDelay = 300;\n  }\n\n  /**\n   * Renders the component\n   *\n   * @return {TemplateResult}\n   * @memberof MgtSearchBox\n   */\n  protected readonly renderContent = (): TemplateResult => {\n    return html`\n      <fluent-search\n        autocomplete=\"off\"\n        class=\"search-term-input\"\n        appearance=\"outline\"\n        value=${this.searchTerm ?? ''}\n        placeholder=${this.placeholder ? this.placeholder : strings.placeholder}\n        title=${this.title ? this.title : strings.title}\n        @input=${this.onInputChanged}\n        @change=${this.onInputChanged}\n      >\n      </fluent-search>`;\n  };\n\n  private readonly onInputChanged = (e: Event) => {\n    this.searchTerm = (e.target as HTMLInputElement).value;\n  };\n\n  /**\n   * Fires and debounces the custom event to listeners\n   */\n  private fireSearchTermChanged() {\n    if (!this.debouncedSearchTermChanged) {\n      this.debouncedSearchTermChanged = debounce(() => {\n        this.fireCustomEvent('searchTermChanged', this.searchTerm);\n      }, this.debounceDelay);\n    }\n\n    this.debouncedSearchTermChanged();\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { html, HTMLTemplateResult, nothing, TemplateResult } from 'lit';\nimport { property, state } from 'lit/decorators.js';\nimport {\n  CacheService,\n  CacheStore,\n  equals,\n  prepScopes,\n  Providers,\n  ProviderState,\n  mgtHtml,\n  BetaGraph,\n  BatchResponse,\n  CollectionResponse,\n  MgtTemplatedTaskComponent\n} from '@microsoft/mgt-element';\n\nimport { schemas } from '../../graph/cacheStores';\nimport { strings } from './strings';\nimport { styles } from './mgt-search-results-css';\nimport {\n  DirectoryObject,\n  Drive,\n  DriveItem,\n  EntityType,\n  List,\n  ListItem,\n  Message,\n  SearchHit,\n  SearchHitsContainer,\n  SearchRequest,\n  SearchResponse,\n  Site\n} from '@microsoft/microsoft-graph-types';\nimport { SearchRequest as BetaSearchRequest } from '@microsoft/microsoft-graph-types-beta';\nimport {\n  getIsResponseCacheEnabled,\n  getNameFromUrl,\n  getRelativeDisplayDate,\n  getResponseInvalidationTime,\n  sanitizeSummary,\n  trimFileExtension\n} from '../../utils/Utils';\nimport { getSvg, SvgIcon } from '../../utils/SvgHelper';\nimport { fluentSkeleton, fluentButton, fluentTooltip, fluentDivider } from '@fluentui/web-components';\nimport { registerFluentComponents } from '../../utils/FluentComponents';\nimport { CacheResponse } from '../CacheResponse';\nimport { registerComponent } from '@microsoft/mgt-element';\nimport { registerMgtFileComponent } from '../mgt-file/mgt-file';\nimport { registerMgtPersonComponent } from '../mgt-person/mgt-person';\n\n/**\n * Object representing a thumbnail\n */\ninterface Thumbnail {\n  /**\n   * The url of the Thumbnail\n   */\n  url?: string;\n}\n\n/**\n * Object representing a Binary Thumbnail\n */\ninterface BinaryThumbnail {\n  /**\n   * The url of the Thumbnail\n   */\n  url?: string;\n\n  /**\n   * The web Url of the Thumbnail\n   */\n  thumbnailWebUrl?: string;\n}\n\n/**\n * Object representing a Search Answer\n */\ninterface Answer {\n  '@odata.type': string;\n  displayName?: string;\n  description?: string;\n  webUrl?: string;\n}\n\n/**\n * Object representing a search resource supporting thumbnails\n */\ninterface ThumbnailResource {\n  thumbnail: Thumbnail;\n}\n\ninterface UserResource {\n  lastModifiedBy?: {\n    user?: {\n      email?: string;\n    };\n  };\n  userPrincipalName?: string;\n}\n\n/**\n * Object representing a Search Resource\n */\ntype SearchResource = Partial<\n  DriveItem & Site & List & Message & ListItem & Drive & DirectoryObject & Answer & ThumbnailResource & UserResource\n>;\n\n/**\n * Object representing a full Search Response\n */\ntype SearchResponseCollection = CollectionResponse<SearchResponse>;\n\nexport const registerMgtSearchResultsComponent = () => {\n  registerFluentComponents(fluentSkeleton, fluentButton, fluentTooltip, fluentDivider);\n\n  registerMgtFileComponent();\n  registerMgtPersonComponent();\n  registerComponent('search-results', MgtSearchResults);\n};\n\n/**\n * **Preview component** Custom element for making Microsoft Graph get queries.\n * Component may change before general availability release.\n *\n * @fires {CustomEvent<DataChangedDetail>} dataChange - Fired when data changes\n *\n * @cssprop --answer-border-radius - {Length} Border radius of an answer\n * @cssprop --answer-box-shadow - {Length} Box shadow of an answer\n * @cssprop --answer-border - {Length} Border of an answer\n * @cssprop --answer-padding - {Length} Padding of an answer\n *\n * @class mgt-search-results\n * @extends {MgtTemplatedTaskComponent}\n */\nexport class MgtSearchResults extends MgtTemplatedTaskComponent {\n  /**\n   * Default page size is 10\n   */\n  private _size = 10;\n\n  /**\n   * Array of styles to apply to the element. The styles should be defined\n   * user the `css` tag function.\n   */\n  static get styles() {\n    return styles;\n  }\n\n  /**\n   * Gets all the localization strings for the component\n   */\n  protected get strings() {\n    return strings;\n  }\n\n  private _queryString: string;\n\n  /**\n   * The query to send to Microsoft Search\n   *\n   * @type {string}\n   * @memberof MgtSearchResults\n   */\n  public get queryString(): string {\n    return this._queryString;\n  }\n  @property({\n    attribute: 'query-string',\n    type: String\n  })\n  public set queryString(value: string) {\n    if (this._queryString !== value) {\n      this._queryString = value;\n      this.currentPage = 1;\n    }\n  }\n\n  /**\n   * Query template to use in complex search scenarios\n   * Query Templates are currently supported only on the beta endpoint\n   */\n  @property({\n    attribute: 'query-template',\n    type: String\n  })\n  public queryTemplate: string;\n\n  /**\n   * One or more types of resources expected in the response.\n   * Possible values are: list, site, listItem, message, event,\n   * drive, driveItem, externalItem.\n   *\n   * @type {string[]}\n   * @memberof MgtSearchResults\n   */\n  @property({\n    attribute: 'entity-types',\n    converter: value => {\n      return value.split(',').map(v => v.trim());\n    },\n    type: String\n  })\n  public entityTypes: string[] = ['driveItem', 'listItem', 'site'];\n\n  /**\n   * The scopes to request\n   *\n   * @type {string[]}\n   * @memberof MgtSearchResults\n   */\n  @property({\n    attribute: 'scopes',\n    converter: (value, _type) => {\n      return value ? value.toLowerCase().split(',') : null;\n    }\n  })\n  public scopes: string[] = [];\n\n  /**\n   * Content sources to use with External Items\n   *\n   * @type {string[]}\n   * @memberof MgtSearchResults\n   */\n  @property({\n    attribute: 'content-sources',\n    converter: (value, _type) => {\n      return value ? value.toLowerCase().split(',') : null;\n    }\n  })\n  public contentSources: string[] = [];\n\n  /**\n   * Api version to use for request\n   *\n   * @type {string}\n   * @memberof MgtSearchResults\n   */\n  @property({\n    attribute: 'version',\n    reflect: true,\n    type: String\n  })\n  public version = 'v1.0';\n\n  /**\n   * Specifies the offset for the search results.\n   * Offset 0 returns the very first result.\n   *\n   * @type {number}\n   * @memberof MgtSearchResults\n   */\n  public get from(): number {\n    return (this.currentPage - 1) * this.size;\n  }\n\n  /**\n   * The size of the page to be retrieved.\n   * The maximum value is 1000.\n   *\n   * @type {number}\n   * @memberof MgtSearchResults\n   */\n  public get size(): number {\n    return this._size;\n  }\n  @property({\n    attribute: 'size',\n    reflect: true,\n    type: Number\n  })\n  public set size(value) {\n    if (value > this.maxPageSize) {\n      this._size = this.maxPageSize;\n    } else {\n      this._size = value;\n    }\n  }\n\n  /**\n   * The maximum number of pages to be clickable\n   * in the paging control\n   *\n   * @type {number}\n   * @memberof MgtSearchResults\n   */\n  @property({\n    attribute: 'paging-max',\n    reflect: true,\n    type: Number\n  })\n  public pagingMax = 7;\n\n  /**\n   * Sets whether the result thumbnail should be fetched\n   * from the Microsoft Graph\n   *\n   * @type {boolean}\n   * @memberof MgtSearchResults\n   */\n  @property({\n    attribute: 'fetch-thumbnail',\n    type: Boolean\n  })\n  public fetchThumbnail: boolean;\n\n  /**\n   * Contains the fields to be returned for each resource\n   *\n   * @type {string[]}\n   * @memberof MgtSearchResults\n   */\n  @property({\n    attribute: 'fields',\n    converter: value => {\n      return value.split(',').map(v => v.trim());\n    },\n    type: String\n  })\n  public fields: string[];\n\n  /**\n   * This triggers hybrid sort for messages : the first 3 messages are the most relevant.\n   * This property is only applicable to entityType=message\n   *\n   * @type {boolean}\n   * @memberof MgtSearchResults\n   */\n  @property({\n    attribute: 'enable-top-results',\n    reflect: true,\n    type: Boolean\n  })\n  public enableTopResults = false;\n\n  /**\n   * Enables cache on the response from the specified resource\n   * default = false\n   *\n   * @type {boolean}\n   * @memberof MgtSearchResults\n   */\n  @property({\n    attribute: 'cache-enabled',\n    reflect: true,\n    type: Boolean\n  })\n  public cacheEnabled = false;\n\n  /**\n   * Invalidation period of the cache for the responses in milliseconds\n   *\n   * @type {number}\n   * @memberof MgtSearchResults\n   */\n  @property({\n    attribute: 'cache-invalidation-period',\n    reflect: true,\n    type: Number\n  })\n  public cacheInvalidationPeriod = 30000;\n\n  /**\n   * Gets or sets the response of the request\n   *\n   * @type any\n   * @memberof MgtSearchResults\n   */\n  @state() private response: SearchResponseCollection;\n\n  private isRefreshing = false;\n  private get searchEndpoint() {\n    return '/search/query';\n  }\n  private get maxPageSize() {\n    return 1000;\n  }\n  private readonly defaultFields: string[] = [\n    'webUrl',\n    'lastModifiedBy',\n    'lastModifiedDateTime',\n    'summary',\n    'displayName',\n    'name'\n  ];\n\n  @property({ attribute: false })\n  public currentPage = 1;\n\n  constructor() {\n    super();\n  }\n\n  protected args(): unknown[] {\n    return [\n      this.providerState,\n      this.queryString,\n      this.queryTemplate,\n      this.entityTypes,\n      this.contentSources,\n      this.scopes,\n      this.version,\n      this.size,\n      this.fetchThumbnail,\n      this.fields,\n      this.enableTopResults,\n      this.currentPage\n    ];\n  }\n\n  /**\n   * Refresh the data\n   *\n   * @param {boolean} [hardRefresh=false]\n   * if false (default), the component will only update if the data changed\n   * if true, the data will be first cleared and reloaded completely\n   * @memberof MgtSearchResults\n   */\n  public refresh(hardRefresh = false) {\n    this.isRefreshing = true;\n    if (hardRefresh) {\n      this.clearState();\n    }\n    void this._task.run();\n  }\n\n  /**\n   * Clears state of the component\n   *\n   * @protected\n   * @memberof MgtSearchResults\n   */\n  protected clearState(): void {\n    this.response = null;\n  }\n\n  /**\n   * Invoked on each update to perform rendering tasks. This method must return\n   * a lit-html TemplateResult. Setting properties inside this method will *not*\n   * trigger the element to update.\n   */\n  protected renderContent = (): TemplateResult => {\n    let renderedTemplate: TemplateResult = null;\n    let headerTemplate: TemplateResult = null;\n    let footerTemplate: TemplateResult = null;\n\n    if (this.hasTemplate('header')) {\n      headerTemplate = this.renderTemplate('header', this.response);\n    }\n\n    footerTemplate = this.renderFooter(this.response?.value[0]?.hitsContainers[0]);\n\n    if (this.response && this.hasTemplate('default')) {\n      renderedTemplate = this.renderTemplate('default', this.response) || html``;\n    } else if (this.response?.value[0]?.hitsContainers[0]) {\n      renderedTemplate = html`${this.response?.value[0]?.hitsContainers[0]?.hits?.map(result =>\n        this.renderResult(result)\n      )}`;\n    } else if (this.hasTemplate('no-data')) {\n      renderedTemplate = this.renderTemplate('no-data', null);\n    } else {\n      renderedTemplate = html``;\n    }\n\n    return html`\n      ${headerTemplate}\n      <div class=\"search-results\">\n        ${renderedTemplate}\n      </div>\n      ${footerTemplate}`;\n  };\n\n  /**\n   * load state into the component.\n   *\n   * @protected\n   * @returns\n   * @memberof MgtSearchResults\n   */\n  protected async loadState() {\n    const provider = Providers.globalProvider;\n\n    this.error = null;\n\n    if (!provider || provider.state !== ProviderState.SignedIn) {\n      return;\n    }\n\n    if (this.queryString) {\n      try {\n        const requestOptions = this.getRequestOptions();\n\n        let cache: CacheStore<CacheResponse>;\n        const key = JSON.stringify({\n          endpoint: `${this.version}${this.searchEndpoint}`,\n          requestOptions\n        });\n        let response: SearchResponseCollection = null;\n\n        if (this.shouldRetrieveCache()) {\n          cache = CacheService.getCache<CacheResponse>(schemas.search, schemas.search.stores.responses);\n          const result: CacheResponse = getIsResponseCacheEnabled() ? await cache.getValue(key) : null;\n          if (result && getResponseInvalidationTime(this.cacheInvalidationPeriod) > Date.now() - result.timeCached) {\n            response = JSON.parse(result.response) as SearchResponseCollection;\n          }\n        }\n\n        if (!response) {\n          const graph = provider.graph.forComponent(this);\n          let request = graph.api(this.searchEndpoint).version(this.version);\n\n          if (this.scopes?.length) {\n            request = request.middlewareOptions(prepScopes(this.scopes));\n          }\n\n          response = (await request.post({ requests: [requestOptions] })) as SearchResponseCollection;\n\n          if (this.fetchThumbnail) {\n            const thumbnailBatch = graph.createBatch<BinaryThumbnail>();\n            const thumbnailBatchBeta = BetaGraph.fromGraph(graph).createBatch<BinaryThumbnail>();\n\n            const hits =\n              response.value?.length && response.value[0].hitsContainers?.length\n                ? response.value[0].hitsContainers[0]?.hits ?? []\n                : [];\n            for (const element of hits) {\n              const resource = element.resource as SearchResource;\n              if (\n                (resource.size > 0 || resource.webUrl?.endsWith('.aspx')) &&\n                (resource['@odata.type'] === '#microsoft.graph.driveItem' ||\n                  resource['@odata.type'] === '#microsoft.graph.listItem')\n              ) {\n                if (resource['@odata.type'] === '#microsoft.graph.listItem') {\n                  thumbnailBatchBeta.get(\n                    element.hitId.toString(),\n                    `/sites/${resource.parentReference.siteId}/pages/${resource.id}`\n                  );\n                } else {\n                  thumbnailBatch.get(\n                    element.hitId.toString(),\n                    `/drives/${resource.parentReference.driveId}/items/${resource.id}/thumbnails/0/medium`\n                  );\n                }\n              }\n            }\n\n            /**\n             * Based on the batch response, augment the search result resource with the thumbnail url\n             *\n             * @param thumbnailResponse\n             */\n            const augmentResponse = (thumbnailResponse: Map<string, BatchResponse<BinaryThumbnail>>) => {\n              if (thumbnailResponse && thumbnailResponse.size > 0) {\n                for (const [k, value] of thumbnailResponse) {\n                  const result: SearchHit = response.value[0].hitsContainers[0].hits[k] as SearchHit;\n                  const thumbnail: Thumbnail =\n                    result.resource['@odata.type'] === '#microsoft.graph.listItem'\n                      ? { url: value.content.thumbnailWebUrl }\n                      : { url: value.content.url };\n                  (result.resource as SearchResource).thumbnail = thumbnail;\n                }\n              }\n            };\n\n            try {\n              augmentResponse(await thumbnailBatch.executeAll());\n              augmentResponse(await thumbnailBatchBeta.executeAll());\n            } catch {\n              // no-op\n            }\n          }\n\n          if (this.shouldUpdateCache() && response) {\n            cache = CacheService.getCache<CacheResponse>(schemas.search, schemas.search.stores.responses);\n            await cache.putValue(key, { response: JSON.stringify(response) });\n          }\n        }\n\n        if (!equals(this.response, response)) {\n          this.response = response;\n        }\n      } catch (e: unknown) {\n        this.error = e as Error;\n      }\n\n      if (this.response) {\n        this.error = null;\n      }\n    } else {\n      this.response = null;\n    }\n    this.isRefreshing = false;\n    this.fireCustomEvent('dataChange', { response: this.response, error: this.error as Error });\n  }\n\n  /**\n   * Render the loading state.\n   *\n   * @protected\n   * @returns\n   * @memberof MgtSearchResults\n   */\n  protected readonly renderLoading = (): TemplateResult => {\n    return (\n      this.renderTemplate('loading', null) ||\n      // creates an array of n items where n is the current max number of results, this builds a shimmer for that many results\n      html`\n        ${[...Array<number>(this.size)].map(() => {\n          return html`\n            <div class=\"search-result\">\n              <div class=\"search-result-grid\">\n                <div class=\"search-result-icon\">\n                  <fluent-skeleton class=\"search-result-icon__shimmer\" shape=\"rect\" shimmer></fluent-skeleton>\n                </div>\n                <div class=\"searc-result-content\">\n                  <div class=\"search-result-name\">\n                    <fluent-skeleton class=\"search-result-name__shimmer\" shape=\"rect\" shimmer></fluent-skeleton>\n                  </div>\n                  <div class=\"search-result-info\">\n                    <div class=\"search-result-author\">\n                      <fluent-skeleton class=\"search-result-author__shimmer\" shape=\"circle\" shimmer></fluent-skeleton>\n                    </div>\n                    <div class=\"search-result-date\">\n                      <fluent-skeleton class=\"search-result-date__shimmer\" shape=\"rect\" shimmer></fluent-skeleton>\n                    </div>\n                  </div>\n                  <fluent-skeleton class=\"search-result-content__shimmer\" shape=\"rect\" shimmer></fluent-skeleton>\n                  <fluent-skeleton class=\"search-result-content__shimmer\" shape=\"rect\" shimmer></fluent-skeleton>\n                </div>\n                ${\n                  this.fetchThumbnail &&\n                  html`\n                    <div class=\"search-result-thumbnail\">\n                      <fluent-skeleton class=\"search-result-thumbnail__shimmer\" shape=\"rect\" shimmer></fluent-skeleton>\n                    </div>\n                  `\n                }\n              </div>\n              <fluent-divider></fluent-divider>\n            </div>\n          `;\n        })}\n       `\n    );\n  };\n\n  /**\n   * Render the result item.\n   *\n   * @protected\n   * @returns\n   * @memberof MgtSearchResults\n   */\n  protected renderResult(result: SearchHit): TemplateResult {\n    const type = this.getResourceType(result.resource);\n    if (this.hasTemplate(`result-${type}`)) {\n      return this.renderTemplate(`result-${type}`, result, result.hitId);\n    } else {\n      switch (result.resource['@odata.type']) {\n        case '#microsoft.graph.driveItem':\n          return this.renderDriveItem(result);\n        case '#microsoft.graph.site':\n          return this.renderSite(result);\n        case '#microsoft.graph.person':\n          return this.renderPerson(result);\n        case '#microsoft.graph.drive':\n        case '#microsoft.graph.list':\n          return this.renderList(result);\n        case '#microsoft.graph.listItem':\n          return this.renderListItem(result);\n        case '#microsoft.graph.search.bookmark':\n          return this.renderBookmark(result);\n        case '#microsoft.graph.search.acronym':\n          return this.renderAcronym(result);\n        case '#microsoft.graph.search.qna':\n          return this.renderQnA(result);\n        default:\n          return this.renderDefault(result);\n      }\n    }\n  }\n\n  /**\n   * Renders the footer with pages if required\n   *\n   * @param hitsContainer Search results\n   */\n  private renderFooter(hitsContainer: SearchHitsContainer) {\n    if (this.pagingRequired(hitsContainer)) {\n      const pages = this.getActivePages(hitsContainer.total);\n\n      return html`\n        <div class=\"search-results-pages\">\n          ${this.renderPreviousPage()}\n          ${this.renderFirstPage(pages)}\n          ${this.renderAllPages(pages)}\n          ${this.renderNextPage()}\n        </div>\n      `;\n    }\n  }\n\n  /**\n   * Validates if paging is required based on the provided results\n   *\n   * @param hitsContainer\n   */\n  private pagingRequired(hitsContainer: SearchHitsContainer) {\n    return hitsContainer?.moreResultsAvailable || this.currentPage * this.size < hitsContainer?.total;\n  }\n\n  /**\n   * Gets a list of active pages to render for paging purposes\n   *\n   * @param totalResults Total number of results of the search query\n   */\n  private getActivePages(totalResults: number) {\n    const getFirstPage = () => {\n      const medianPage = this.currentPage - Math.floor(this.pagingMax / 2) - 1;\n\n      if (medianPage >= Math.floor(this.pagingMax / 2)) {\n        return medianPage;\n      } else {\n        return 0;\n      }\n    };\n\n    const pages: number[] = [];\n    const firstPage = getFirstPage();\n\n    if (firstPage + 1 > this.pagingMax - this.currentPage || this.pagingMax === this.currentPage) {\n      for (\n        let i = firstPage + 1;\n        i < Math.ceil(totalResults / this.size) &&\n        i < this.pagingMax + (this.currentPage - 1) &&\n        pages.length < this.pagingMax - 2;\n        ++i\n      ) {\n        pages.push(i + 1);\n      }\n    } else {\n      for (let i = firstPage; i < this.pagingMax; ++i) {\n        pages.push(i + 1);\n      }\n    }\n\n    return pages;\n  }\n\n  /**\n   * Renders all sequential pages buttons\n   *\n   * @param pages\n   */\n  private renderAllPages(pages: number[]) {\n    return html`\n      ${pages.map(\n        page =>\n          html`\n            <fluent-button\n              title=\"${strings.page} ${page}\"\n              appearance=\"stealth\"\n              class=\"${page === this.currentPage ? 'search-results-page-active' : 'search-results-page'}\"\n              @click=\"${() => this.onPageClick(page)}\">\n                ${page}\n            </fluent-button>`\n      )}`;\n  }\n\n  /**\n   * Renders the \"First page\" button\n   *\n   * @param pages\n   */\n  private renderFirstPage(pages: number[]) {\n    return html`\n      ${\n        pages.some(page => page === 1)\n          ? nothing\n          : html`\n              <fluent-button\n                 title=\"${strings.page} 1\"\n                 appearance=\"stealth\"\n                 class=\"search-results-page\"\n                 @click=\"${this.onFirstPageClick}\">\n                 1\n               </fluent-button>`\n          ? html`\n              <fluent-button\n                id=\"page-back-dot\"\n                appearance=\"stealth\"\n                class=\"search-results-page\"\n                title=\"${this.getDotButtonTitle()}\"\n                @click=\"${() => this.onPageClick(this.currentPage - Math.ceil(this.pagingMax / 2))}\"\n              >\n                ...\n              </fluent-button>`\n          : nothing\n      }`;\n  }\n\n  /**\n   * Constructs the \"dot dot dot\" button title\n   */\n  private getDotButtonTitle() {\n    return `${strings.back} ${Math.ceil(this.pagingMax / 2)} ${strings.pages}`;\n  }\n\n  /**\n   * Renders the \"Previous page\" button\n   */\n  private renderPreviousPage() {\n    return this.currentPage > 1\n      ? html`\n          <fluent-button\n            appearance=\"stealth\"\n            class=\"search-results-page\"\n            title=\"${strings.back}\"\n            @click=\"${this.onPageBackClick}\">\n              ${getSvg(SvgIcon.ChevronLeft)}\n            </fluent-button>`\n      : nothing;\n  }\n\n  /**\n   * Renders the \"Next page\" button\n   */\n  private renderNextPage() {\n    return !this.isLastPage()\n      ? html`\n          <fluent-button\n            appearance=\"stealth\"\n            class=\"search-results-page\"\n            title=\"${strings.next}\"\n            aria-label=\"${strings.next}\"\n            @click=\"${this.onPageNextClick}\">\n              ${getSvg(SvgIcon.ChevronRight)}\n            </fluent-button>`\n      : nothing;\n  }\n\n  /**\n   * Triggers a specific page click\n   *\n   * @param pageNumber\n   */\n  private onPageClick(pageNumber: number) {\n    this.currentPage = pageNumber;\n    this.scrollToFirstResult();\n  }\n\n  /**\n   * Triggers a first page click\n   *\n   */\n  private readonly onFirstPageClick = () => {\n    this.currentPage = 1;\n    this.scrollToFirstResult();\n  };\n\n  /**\n   * Triggers a previous page click\n   */\n  private readonly onPageBackClick = () => {\n    this.currentPage--;\n    this.scrollToFirstResult();\n  };\n\n  /**\n   * Triggers a next page click\n   */\n  private readonly onPageNextClick = () => {\n    this.currentPage++;\n    this.scrollToFirstResult();\n  };\n\n  /**\n   * Validates if the current page is the last page of the collection\n   */\n  private isLastPage() {\n    return this.currentPage === Math.ceil(this.response.value[0].hitsContainers[0].total / this.size);\n  }\n\n  /**\n   * Scroll to the top of the search results\n   */\n  private scrollToFirstResult() {\n    const target = this.renderRoot.querySelector('.search-results');\n    target.scrollIntoView({\n      block: 'start',\n      behavior: 'smooth'\n    });\n  }\n\n  /**\n   * Gets the resource type (entity) of a search result\n   *\n   * @param resource\n   */\n  private getResourceType(resource: SearchResource) {\n    return resource['@odata.type'].split('.').pop();\n  }\n\n  /**\n   * Renders a driveItem entity\n   *\n   * @param result\n   */\n  private renderDriveItem(result: SearchHit) {\n    const resource = result.resource as SearchResource;\n    return mgtHtml`\n      <div class=\"search-result-grid\">\n        <div class=\"search-result-icon\">\n          <mgt-file\n            .fileDetails=\"${result.resource}\"\n            view=\"image\"\n            class=\"file-icon\">\n          </mgt-file>\n        </div>\n        <div class=\"search-result-content\">\n          <div class=\"search-result-name\">\n            <a href=\"${resource.webUrl}?Web=1\" target=\"_blank\">${trimFileExtension(resource.name)}</a>\n          </div>\n          <div class=\"search-result-info\">\n            <div class=\"search-result-author\">\n              <mgt-person\n                person-query=${resource.lastModifiedBy.user.email}\n                view=\"oneline\"\n                person-card=\"hover\"\n                show-presence=\"true\">\n              </mgt-person>\n            </div>\n            <div class=\"search-result-date\">\n              &nbsp; ${strings.modified} ${getRelativeDisplayDate(new Date(resource.lastModifiedDateTime))}\n            </div>\n          </div>\n          <div class=\"search-result-summary\" .innerHTML=\"${sanitizeSummary(result.summary)}\"></div>\n        </div>\n        ${\n          resource.thumbnail?.url &&\n          html`\n          <div class=\"search-result-thumbnail\">\n            <a href=\"${resource.webUrl}\" target=\"_blank\"><img alt=\"${resource.name}\" src=\"${resource.thumbnail?.url}\" /></a>\n          </div>`\n        }\n\n      </div>\n      <fluent-divider></fluent-divider>\n    `;\n  }\n\n  /**\n   * Renders a site entity\n   *\n   * @param result\n   * @returns\n   */\n  private renderSite(result: SearchHit): HTMLTemplateResult {\n    const resource = result.resource as SearchResource;\n    return html`\n      <div class=\"search-result-grid\">\n        <div class=\"search-result-icon\">\n          ${this.getResourceIcon(resource)}\n        </div>\n        <div class=\"searc-result-content\">\n          <div class=\"search-result-name\">\n            <a href=\"${resource.webUrl}\" target=\"_blank\">${resource.displayName}</a>\n          </div>\n          <div class=\"search-result-info\">\n            <div class=\"search-result-url\">\n              <a href=\"${resource.webUrl}\" target=\"_blank\">${resource.webUrl}</a>\n            </div>\n          </div>\n          <div class=\"search-result-summary\" .innerHTML=\"${sanitizeSummary(result.summary)}\"></div>\n        </div>\n      </div>\n      <fluent-divider></fluent-divider>\n    `;\n  }\n\n  /**\n   * Renders a list entity\n   *\n   * @param result\n   * @returns\n   */\n  private renderList(result: SearchHit): HTMLTemplateResult {\n    const resource = result.resource as SearchResource;\n    return mgtHtml`\n      <div class=\"search-result-grid\">\n        <div class=\"search-result-icon\">\n          <mgt-file\n            .fileDetails=\"${result.resource}\"\n            view=\"image\">\n          </mgt-file>\n        </div>\n        <div class=\"search-result-content\">\n          <div class=\"search-result-name\">\n            <a href=\"${resource.webUrl}?Web=1\" target=\"_blank\">\n              ${trimFileExtension(resource.name || getNameFromUrl(resource.webUrl))}\n            </a>\n          </div>\n          <div class=\"search-result-summary\" .innerHTML=\"${sanitizeSummary(result.summary)}\"></div>\n        </div>\n      </div>\n      <fluent-divider></fluent-divider>\n    `;\n  }\n\n  /**\n   * Renders a listItem entity\n   *\n   * @param result\n   * @returns\n   */\n  private renderListItem(result: SearchHit): HTMLTemplateResult {\n    const resource = result.resource as SearchResource;\n    return mgtHtml`\n      <div class=\"search-result-grid\">\n        <div class=\"search-result-icon\">\n          ${resource.webUrl.endsWith('.aspx') ? getSvg(SvgIcon.News) : getSvg(SvgIcon.FileOuter)}\n        </div>\n        <div class=\"search-result-content\">\n          <div class=\"search-result-name\">\n            <a href=\"${resource.webUrl}?Web=1\" target=\"_blank\">\n              ${trimFileExtension(resource.name || getNameFromUrl(resource.webUrl))}\n            </a>\n          </div>\n          <div class=\"search-result-info\">\n            <div class=\"search-result-author\">\n              <mgt-person\n                person-query=${resource.lastModifiedBy.user.email}\n                view=\"oneline\"\n                person-card=\"hover\"\n                show-presence=\"true\">\n              </mgt-person>\n            </div>\n            <div class=\"search-result-date\">\n              &nbsp; ${strings.modified} ${getRelativeDisplayDate(new Date(resource.lastModifiedDateTime))}\n            </div>\n          </div>\n          <div class=\"search-result-summary\" .innerHTML=\"${sanitizeSummary(result.summary)}\"></div>\n        </div>\n        ${\n          resource.thumbnail?.url &&\n          html`\n          <div class=\"search-result-thumbnail\">\n            <a href=\"${resource.webUrl}\" target=\"_blank\"><img alt=\"${trimFileExtension(\n              resource.name || getNameFromUrl(resource.webUrl)\n            )}\" src=\"${resource.thumbnail?.url || nothing}\" /></a>\n          </div>`\n        }\n      </div>\n      <fluent-divider></fluent-divider>\n    `;\n  }\n\n  /**\n   * Renders a person entity\n   *\n   * @param result\n   * @returns\n   */\n  private renderPerson(result: SearchHit): HTMLTemplateResult {\n    const resource = result.resource as SearchResource;\n    return mgtHtml`\n      <div class=\"search-result\">\n        <mgt-person\n          view=\"fourlines\"\n          person-query=${resource.userPrincipalName}\n          person-card=\"hover\"\n          show-presence=\"true\">\n        </mgt-person>\n      </div>\n      <fluent-divider></fluent-divider>\n    `;\n  }\n\n  /**\n   * Renders a bookmark entity\n   *\n   * @param result\n   */\n  private renderBookmark(result: SearchHit) {\n    return this.renderAnswer(result, SvgIcon.DoubleBookmark);\n  }\n\n  /**\n   * Renders an acronym entity\n   *\n   * @param result\n   */\n  private renderAcronym(result: SearchHit) {\n    return this.renderAnswer(result, SvgIcon.BookOpen);\n  }\n\n  /**\n   * Renders a qna entity\n   *\n   * @param result\n   */\n  private renderQnA(result: SearchHit) {\n    return this.renderAnswer(result, SvgIcon.BookQuestion);\n  }\n\n  /**\n   * Renders an answer entity\n   *\n   * @param result\n   */\n  private renderAnswer(result: SearchHit, icon: SvgIcon) {\n    const resource = result.resource as SearchResource;\n    return html`\n      <div class=\"search-result-grid search-result-answer\">\n        <div class=\"search-result-icon\">\n          ${getSvg(icon)}\n        </div>\n        <div class=\"search-result-content\">\n          <div class=\"search-result-name\">\n            <a href=\"${this.getResourceUrl(resource)}?Web=1\" target=\"_blank\">${resource.displayName}</a>\n          </div>\n          <div class=\"search-result-summary\">${resource.description}</div>\n        </div>\n      </div>\n      <fluent-divider></fluent-divider>\n    `;\n  }\n\n  /**\n   * Renders any entity\n   *\n   * @param result\n   */\n  private renderDefault(result: SearchHit) {\n    const resource = result.resource as SearchResource;\n    const resourceUrl = this.getResourceUrl(resource);\n    return html`\n      <div class=\"search-result-grid\">\n        <div class=\"search-result-icon\">\n          ${this.getResourceIcon(resource)}\n        </div>\n        <div class=\"search-result-content\">\n          <div class=\"search-result-name\">\n            ${\n              resourceUrl\n                ? html`\n                  <a href=\"${resourceUrl}?Web=1\" target=\"_blank\">${this.getResourceName(resource)}</a>\n                `\n                : html`\n                  ${this.getResourceName(resource)}\n                `\n            }\n          </div>\n          <div class=\"search-result-summary\" .innerHTML=\"${this.getResultSummary(result)}\"></div>\n        </div>\n      </div>\n      <fluent-divider></fluent-divider>\n    `;\n  }\n\n  /**\n   * Gets default resource URLs\n   *\n   * @param resource\n   */\n  private getResourceUrl(resource: SearchResource) {\n    return resource.webUrl || /* resource.url ||*/ resource.webLink || null;\n  }\n\n  /**\n   * Gets default resource Names\n   *\n   * @param resource\n   */\n  private getResourceName(resource: SearchResource) {\n    return resource.displayName || resource.subject || trimFileExtension(resource.name);\n  }\n\n  /**\n   * Gets default result summary\n   *\n   * @param resource\n   */\n  private getResultSummary(result: SearchHit) {\n    return sanitizeSummary(result.summary || (result.resource as SearchResource)?.description || null);\n  }\n\n  /**\n   * Gets default resource icon\n   *\n   * @param resource\n   */\n  private getResourceIcon(resource: SearchResource) {\n    switch (resource['@odata.type']) {\n      case '#microsoft.graph.site':\n        return getSvg(SvgIcon.Globe);\n      case '#microsoft.graph.message':\n        return getSvg(SvgIcon.Email);\n      case '#microsoft.graph.event':\n        return getSvg(SvgIcon.Event);\n      case 'microsoft.graph.chatMessage':\n        return getSvg(SvgIcon.SmallChat);\n      default:\n        return getSvg(SvgIcon.FileOuter);\n    }\n  }\n\n  /**\n   * Validates if cache should be retrieved\n   *\n   * @returns\n   */\n  private shouldRetrieveCache(): boolean {\n    return getIsResponseCacheEnabled() && this.cacheEnabled && !this.isRefreshing;\n  }\n\n  /**\n   * Validates if cache should be updated\n   *\n   * @returns\n   */\n  private shouldUpdateCache(): boolean {\n    return getIsResponseCacheEnabled() && this.cacheEnabled;\n  }\n\n  /**\n   * Builds the appropriate RequestOption for the search query\n   *\n   * @returns\n   */\n  private getRequestOptions(): SearchRequest | BetaSearchRequest {\n    const requestOptions: SearchRequest = {\n      entityTypes: this.entityTypes as EntityType[],\n      query: {\n        queryString: this.queryString\n      },\n      from: this.from ? this.from : undefined,\n      size: this.size ? this.size : undefined,\n      fields: this.getFields(),\n      enableTopResults: this.enableTopResults ? this.enableTopResults : undefined\n    };\n\n    if (this.entityTypes.includes('externalItem')) {\n      requestOptions.contentSources = this.contentSources;\n    }\n\n    if (this.version === 'beta') {\n      (requestOptions as BetaSearchRequest).query.queryTemplate = this.queryTemplate ? this.queryTemplate : undefined;\n    }\n\n    return requestOptions;\n  }\n\n  /**\n   * Gets the fields and default fields for default render methods\n   *\n   * @returns\n   */\n  private getFields(): string[] {\n    if (this.fields) {\n      return this.defaultFields.concat(this.fields);\n    }\n\n    return undefined;\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nexport const strings = {\n  showMoreSubtitle: 'Show more items',\n  filesSectionTitle: 'Files',\n  sharedTextSubtitle: 'Shared'\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nexport const strings = {\n  failUploadFile: 'File upload fail.',\n  cancelUploadFile: 'File cancel.',\n  buttonUploadFile: 'Upload Files',\n  maximumFilesTitle: 'Maximum files',\n  maximumFiles:\n    'Sorry, the maximum number of files you can upload at once is {MaxNumber}. Do you want to upload the first {MaxNumber} files or reselect?',\n  maximumFileSizeTitle: 'Maximum files size',\n  maximumFileSize: 'Sorry, the maximum file size to upload is {FileSize}. The file \"{FileName}\" has ',\n  fileTypeTitle: 'File type',\n  fileType: 'Sorry, the format of following file \"{FileName}\" cannot be uploaded.',\n  checkAgain: \"Don't show again\",\n  checkApplyAll: 'Apply to all',\n  buttonOk: 'OK',\n  buttonCancel: 'Cancel',\n  buttonUpload: 'Upload',\n  buttonKeep: 'Keep both',\n  buttonReplace: 'Replace',\n  buttonReselect: 'Reselect',\n  fileReplaceTitle: 'Replace file',\n  fileReplace: 'Do you want to replace the file \"{FileName}\" or keep both files?',\n  uploadButtonLabel: 'File upload button'\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { fluentButton, fluentCheckbox, fluentDialog, fluentProgress } from '@fluentui/web-components';\nimport { IGraph, MgtBaseComponent, mgtHtml } from '@microsoft/mgt-element';\nimport { html, TemplateResult } from 'lit';\nimport { property } from 'lit/decorators.js';\nimport { DriveItem } from '@microsoft/microsoft-graph-types';\nimport { classMap } from 'lit/directives/class-map.js';\nimport {\n  clearFilesCache,\n  getGraphfile,\n  getUploadSession,\n  sendFileContent,\n  sendFileChunk,\n  deleteSessionFile,\n  isUploadSession\n} from '../../../graph/graph.files';\nimport { ViewType } from '../../../graph/types';\nimport { registerFluentComponents } from '../../../utils/FluentComponents';\nimport { getSvg, SvgIcon } from '../../../utils/SvgHelper';\nimport { formatBytes } from '../../../utils/Utils';\nimport { styles } from './mgt-file-upload-css';\nimport { strings } from './strings';\nimport { registerComponent } from '@microsoft/mgt-element';\nimport { registerMgtFileComponent } from '../../mgt-file/mgt-file';\n\n/**\n * Simple union type for file system entry and directory entry types\n */\ntype FileEntry = (FileSystemDirectoryEntry | FileSystemFileEntry | FileSystemEntry) & {\n  /**\n   * This is a hack to get around the fact that the FileSystemEntry filePath is not writable\n   */\n  fullPath: string;\n};\n\n/**\n * Type guard for FileSystemDirectoryEntry\n *\n * @param {FileEntry} entry\n * @return {*}  {entry is FileSystemDirectoryEntry}\n */\nconst isFileSystemDirectoryEntry = (entry: FileEntry): entry is FileSystemDirectoryEntry => {\n  return entry.isDirectory;\n};\n\n/**\n * Type guard for FileSystemDirectoryEntry\n *\n * @param {FileEntry} entry\n * @return {*}  {entry is FileSystemDirectoryEntry}\n */\nconst isFileSystemFileEntry = (entry: FileEntry): entry is FileSystemFileEntry => {\n  return entry.isFile;\n};\n\ninterface FutureDataTransferItem extends DataTransferItem {\n  /**\n   * Possible future implementation of webkitGetAsEntry\n   */\n  getAsEntry: typeof DataTransferItem.prototype.webkitGetAsEntry;\n}\n\nconst isFutureDataTransferItem = (item: DataTransferItem): item is FutureDataTransferItem =>\n  'getAsEntry' in item && typeof item.getAsEntry === 'function';\n\nconst isDataTransferItem = (item: DataTransferItem | File): item is DataTransferItem =>\n  ('getAsFile' in item && typeof item.getAsFile === 'function') ||\n  ('webkitGetAsEntry' in item && typeof item.webkitGetAsEntry === 'function');\n\nconst conflictBehaviors = ['rename', 'replace'] as const;\n/**\n * Upload conflict behavior status\n */\nexport type MgtFileUploadConflictBehavior = (typeof conflictBehaviors)[number];\n\n/**\n * MgtFileUpload upload item lifecycle object.\n *\n * @export\n * @interface MgtFileUploadItem\n */\nexport interface MgtFileUploadItem {\n  /**\n   * Session url to keep upload progress open untill all chuncks are sent\n   */\n  uploadUrl?: string;\n\n  /**\n   * Upload file progress value\n   */\n  percent?: number;\n\n  /**\n   * Validate if File has any conflict Behavior\n   */\n  conflictBehavior?: MgtFileUploadConflictBehavior;\n\n  /**\n   * Output \"Success\" or \"Fail\" icon base on upload response\n   */\n  iconStatus?: TemplateResult;\n\n  /**\n   * File object to be upload.\n   */\n  file?: File;\n\n  /**\n   * Full file Path to be upload.\n   */\n  fullPath?: string;\n\n  /**\n   * Mgt-File View state change on upload response\n   */\n  view?: ViewType;\n\n  /**\n   * Manipulate fileDetails on upload lifecycle\n   */\n  driveItem?: DriveItem;\n\n  /**\n   * Mgt-File line2Property output field message\n   */\n  fieldUploadResponse?: string;\n\n  /**\n   * Validates state of upload progress\n   */\n  completed?: boolean;\n\n  /**\n   * Load large Files into ArrayBuffer to send by chuncks\n   */\n  mimeStreamString?: ArrayBuffer;\n\n  /**\n   * Max chunck size to upload file by slice\n   */\n  maxSize?: number;\n\n  /**\n   * Minimal chunck size to upload file by slice\n   */\n  minSize?: number;\n}\n\n/**\n * MgtFileUpload configuration object with MgtFileList Properties.\n *\n * @export\n * @interface MgtFileUploadConfig\n */\nexport interface MgtFileUploadConfig {\n  /**\n   * MS Graph APIs connector\n   *\n   * @type {IGraph}\n   */\n  graph: IGraph;\n\n  /**\n   * allows developer to provide site id for a file\n   *\n   * @type {string}\n   */\n  siteId?: string;\n\n  /**\n   * DriveId to upload Files\n   *\n   * @type {string}\n   */\n  driveId?: string;\n\n  /**\n   * GroupId to upload Files\n   *\n   * @type {string}\n   */\n  groupId?: string;\n\n  /**\n   * allows developer to provide item id for a file\n   *\n   * @type {string}\n   */\n  itemId?: string;\n\n  /**\n   * allows developer to provide item path for a file\n   *\n   * @type {string}\n   */\n  itemPath?: string;\n\n  /**\n   * allows developer to provide user id for a file\n   *\n   * @type {string}\n   */\n  userId?: string;\n\n  /**\n   * A number value indication for file size upload (KB)\n   *\n   * @type {Number}\n   */\n  maxFileSize?: number;\n\n  /**\n   * A number value to indicate the number of files to upload.\n   *\n   * @type {Number}\n   */\n  maxUploadFile?: number;\n\n  /**\n   * A Array of file extensions to be excluded from file upload.\n   *\n   * @type {string[]}\n   */\n  excludedFileExtensions?: string[];\n}\n\ninterface FileWithPath extends File {\n  fullPath: string;\n}\n\nexport const registerMgtFileUploadComponent = () => {\n  registerFluentComponents(fluentProgress, fluentButton, fluentCheckbox, fluentDialog);\n\n  registerMgtFileComponent();\n  registerComponent('file-upload', MgtFileUpload);\n};\n\nconst calculateConflictBehavior = (behavior: (number | true | MgtFileUploadConflictBehavior)[]) => {\n  if (behavior?.length > 1) {\n    return behavior[1] === 'replace' ? 'replace' : 'rename';\n  }\n  return null;\n};\n\n/**\n * A component to upload files to OneDrive or SharePoint Sites\n *\n * @export\n * @class MgtFileUpload\n * @extends {MgtBaseComponent}\n *\n * @cssprop --file-upload-background-color-drag - {Color} background color of the file list when you upload by drag and drop.\n * @cssprop --file-upload-button-background-color - {Color} background color of the file upload button.\n * @cssprop --file-upload-button-background-color-hover - {Color} background color of the file upload button on hover.\n * @cssprop --file-upload-button-text-color - {Color} text color of the file upload button.\n * @cssprop --file-upload-dialog-background-color - {Color} background color of the file upload dialog box (appears when uploaded files exist).\n * @cssprop --file-upload-dialog-text-color - {Color} text color of the file upload dialog box content.\n * @cssprop --file-upload-dialog-replace-button-background-color - {Color} background color of the replace button in the dialog box.\n * @cssprop --file-upload-dialog-replace-button-background-color-hover - {Color} background color of the replace button in the dialog box when you hover on it.\n * @cssprop --file-upload-dialog-replace-button-text-color - {Color} text color of the replace button in the dialog box.\n * @cssprop --file-upload-dialog-keep-both-button-background-color - {Color} background color of the keep-both button in the dialog box.\n * @cssprop --file-upload-dialog-keep-both-button-background-color-hover - {Color} background color of the keep-both button in the dialog box when you hover on it.\n * @cssprop --file-upload-dialog-keep-both-button-text-color - {Color} text color of the keep-both button in the dialog box.\n * @cssprop --file-upload-border-drag - {String} the border of the file list when you upload files via drag and drop. Default value is 1px dashed #0078d4.\n * @cssprop --file-upload-button-border - {String} the border of the file upload button. Default value is none.\n * @cssprop --file-upload-dialog-replace-button-border - {String} the border of the file upload replace button in the dialog box. Default value is\n * @cssprop --file-upload-dialog-keep-both-button-border - {String} the border of the file upload keep both button in the dialog box. Default value is none.\n * @cssprop --file-upload-dialog-border - {String} the border of the file upload dialog box. Default value is \"1px solid var(--neutral-fill-rest)\".\n * @cssprop --file-upload-dialog-width - {String} the width of the file upload dialog box. Default value is auto.\n * @cssprop --file-upload-dialog-height - {String} the height of the file upload dialog box. Default value is auto.\n * @cssprop --file-upload-dialog-padding - {String} the padding of the file upload dialog box. Default value is 24px;\n */\nexport class MgtFileUpload extends MgtBaseComponent {\n  /**\n   * Array of styles to apply to the element. The styles should be defined\n   * using the `css` tag function.\n   */\n  static get styles() {\n    return styles;\n  }\n\n  protected get strings() {\n    return strings;\n  }\n\n  /**\n   * Allows developer to provide an array of MgtFileUploadItem to upload\n   *\n   * @type {MgtFileUploadItem[]}\n   * @memberof MgtFileUpload\n   */\n  @property({ type: Object })\n  public filesToUpload: MgtFileUploadItem[];\n\n  /**\n   * List of mgt-file-list properties used to upload files.\n   *\n   * @type {MgtFileUploadConfig}\n   * @memberof MgtFileUpload\n   */\n  @property({ type: Object })\n  public fileUploadList: MgtFileUploadConfig;\n\n  /**\n   * Get the scopes required for file upload\n   *\n   * @static\n   * @return {*}  {string[]}\n   * @memberof MgtFileUpload\n   */\n  public static get requiredScopes(): string[] {\n    return [...new Set(['files.readwrite', 'files.readwrite.all', 'sites.readwrite.all'])];\n  }\n\n  // variable manage drag style when mouse over\n  private _dragCounter = 0;\n  // variable avoids removal of files after drag and drop, https://developer.mozilla.org/en-US/docs/Web/API/DataTransfer/dropEffect\n  private get _dropEffect(): DataTransfer['dropEffect'] {\n    return 'copy';\n  }\n  // variable defined max chuck size \"4MB\" for large files .\n  private readonly _maxChunkSize: number = 4 * 1024 * 1024;\n  private _dialogTitle = '';\n  private _dialogContent = '';\n  private _dialogPrimaryButton = '';\n  private _dialogSecondaryButton = '';\n  private _dialogCheckBox = '';\n  private _applyAll = false;\n  private _applyAllConflictBehavior: number = null;\n  private _maximumFileSize = false;\n  private _excludedFileType = false;\n\n  constructor() {\n    super();\n    this.filesToUpload = [];\n  }\n\n  /**\n   * Render the file upload component\n   *\n   * @returns\n   */\n  public render(): TemplateResult {\n    if (this.parentElement !== null) {\n      const root = this.parentElement;\n      root.addEventListener('dragenter', this.handleonDragEnter);\n      root.addEventListener('dragleave', this.handleonDragLeave);\n      root.addEventListener('dragover', this.handleonDragOver);\n      root.addEventListener('drop', this.handleonDrop);\n    }\n\n    return html`\n        <div id=\"file-upload-dialog\" class=\"file-upload-dialog\">\n          <!-- Modal content -->\n          <fluent-dialog modal=\"true\" class=\"file-upload-dialog-content\">\n            <span\n              class=\"file-upload-dialog-close\"\n              id=\"file-upload-dialog-close\">\n                ${getSvg(SvgIcon.Cancel)}\n            </span>\n            <div class=\"file-upload-dialog-content-text\">\n              <h2 class=\"file-upload-dialog-title\">${this._dialogTitle}</h2>\n              <div>${this._dialogContent}</div>\n                <fluent-checkbox\n                  id=\"file-upload-dialog-check\"\n                  class=\"file-upload-dialog-check\">\n                    ${this._dialogCheckBox}\n                </fluent-checkbox>\n            </div>\n            <div class=\"file-upload-dialog-editor\">\n              <fluent-button\n                appearance=\"accent\"\n                class=\"file-upload-dialog-ok\">\n                ${this._dialogPrimaryButton}\n              </fluent-button>\n              <fluent-button\n                appearance=\"outline\"\n                class=\"file-upload-dialog-cancel\">\n                ${this._dialogSecondaryButton}\n              </fluent-button>\n            </div>\n          </fluent-dialog>\n        </div>\n        <div id=\"file-upload-border\"></div>\n        <div class=\"file-upload-area-button\">\n          <input\n            id=\"file-upload-input\"\n            title=\"${this.strings.uploadButtonLabel}\"\n            tabindex=\"-1\"\n            aria-label=\"file upload input\"\n            type=\"file\"\n            multiple\n            @change=\"${this.onFileUploadChange}\"\n          />\n          <fluent-button\n            appearance=\"accent\"\n            class=\"file-upload-button\"\n            @click=${this.onFileUploadClick}\n            label=${this.strings.uploadButtonLabel}>\n              <span slot=\"start\">${getSvg(SvgIcon.Upload)}</span>\n              <span class=\"upload-text\">${this.strings.buttonUploadFile}</span>\n          </fluent-button>\n        </div>\n        <div class=\"file-upload-template\">\n          ${this.renderFolderTemplate(this.filesToUpload)}\n        </div>\n       `;\n  }\n\n  /**\n   * Render Folder structure of files to upload\n   *\n   * @param fileItems\n   * @returns\n   */\n  protected renderFolderTemplate(fileItems: MgtFileUploadItem[]) {\n    const folderStructure: string[] = [];\n    if (fileItems.length > 0) {\n      const templateFileItems = fileItems.map(fileItem => {\n        if (folderStructure.indexOf(fileItem.fullPath.substring(0, fileItem.fullPath.lastIndexOf('/'))) === -1) {\n          if (!fileItem.fullPath.endsWith('/')) {\n            folderStructure.push(fileItem.fullPath.substring(0, fileItem.fullPath.lastIndexOf('/')));\n            return mgtHtml`\n            <div class='file-upload-table'>\n              <div class='file-upload-cell'>\n                <mgt-file\n                  .fileDetails=${{\n                    name: fileItem.fullPath.substring(1, fileItem.fullPath.lastIndexOf('/')),\n                    folder: 'Folder'\n                  }}\n                  view=\"oneline\"\n                  class=\"mgt-file-item\">\n                </mgt-file>\n              </div>\n            </div>\n            ${this.renderFileTemplate(fileItem, 'file-upload-folder-tab')}`;\n          } else {\n            return html`${this.renderFileTemplate(fileItem, '')}`;\n          }\n        } else {\n          return html`${this.renderFileTemplate(fileItem, 'file-upload-folder-tab')}`;\n        }\n      });\n      return html`${templateFileItems}`;\n    }\n    return html``;\n  }\n\n  /**\n   * Render file upload area\n   *\n   * @param fileItem\n   * @returns\n   */\n  protected renderFileTemplate(fileItem: MgtFileUploadItem, folderTabStyle: string) {\n    const completed = classMap({\n      'file-upload-table': true,\n      upload: fileItem.completed\n    });\n    const folder =\n      folderTabStyle + (fileItem.fieldUploadResponse === 'lastModifiedDateTime' ? ' file-upload-dialog-success' : '');\n\n    const description = classMap({\n      description: fileItem.fieldUploadResponse === 'description'\n    });\n\n    const completedTemplate = !fileItem.completed ? this.renderFileUploadTemplate(fileItem) : html``;\n\n    return mgtHtml`\n        <div class=\"${completed}\">\n          <div class=\"${folder}\">\n            <div class='file-upload-cell'>\n              <div class=\"${description}\">\n                <div class=\"file-upload-status\">\n                  ${fileItem.iconStatus}\n                </div>\n                <mgt-file\n                  .fileDetails=${fileItem.driveItem}\n                  .view=${fileItem.view}\n                  .line2Property=${fileItem.fieldUploadResponse}\n                  part=\"upload\"\n                  class=\"mgt-file-item\">\n                </mgt-file>\n              </div>\n            </div>\n              ${completedTemplate}\n            </div>\n          </div>\n        </div>`;\n  }\n\n  /**\n   * Render file upload progress\n   *\n   * @param fileItem\n   * @returns\n   */\n  protected renderFileUploadTemplate(fileItem: MgtFileUploadItem) {\n    const completed = classMap({\n      'file-upload-table': true,\n      upload: fileItem.completed\n    });\n    return html`\n    <div class='file-upload-cell'>\n      <div class='file-upload-table file-upload-name'>\n        <div class='file-upload-cell'>\n          <div\n            title=\"${fileItem.file.name}\"\n            class='file-upload-filename'>\n            ${fileItem.file.name}\n          </div>\n        </div>\n      </div>\n      <div class='file-upload-table'>\n        <div class='file-upload-cell'>\n          <div class=\"${completed}\">\n            <fluent-progress class=\"file-upload-bar\" value=\"${fileItem.percent}\"></fluent-progress>\n            <div class='file-upload-cell percent-indicator'>\n              <span>${fileItem.percent}%</span>\n              <span\n                class=\"file-upload-cancel\"\n                @click=${() => this.deleteFileUploadSession(fileItem)}>\n                ${getSvg(SvgIcon.Cancel)}\n              </span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n    `;\n  }\n\n  /**\n   * Handle the \"Upload Files\" button click event to open dialog and select files.\n   *\n   * @param event\n   * @returns\n   */\n  protected onFileUploadChange = (event: UIEvent) => {\n    const inputElement = event.target as HTMLInputElement;\n    if (!event || inputElement.files.length < 1) {\n      return;\n    } else {\n      void this.readUploadedFiles(inputElement.files, () => (inputElement.value = null));\n    }\n  };\n\n  /**\n   * Handle the click event on upload file button that open select files dialog to upload.\n   *\n   */\n  protected onFileUploadClick = () => {\n    const uploadInput: HTMLElement = this.renderRoot.querySelector('#file-upload-input');\n    uploadInput.click();\n  };\n\n  /**\n   * Function delete existing file upload sessions\n   *\n   * @param fileItem\n   */\n  protected async deleteFileUploadSession(fileItem: MgtFileUploadItem) {\n    try {\n      if (fileItem.uploadUrl !== undefined) {\n        // Responses that confirm cancelation of session.\n        // 404 means (The upload session was not found/The resource could not be found/)\n        // 409 means The resource has changed since the caller last read it; usually an eTag mismatch\n        await deleteSessionFile(this.fileUploadList.graph, fileItem.uploadUrl);\n        fileItem.uploadUrl = undefined;\n        fileItem.completed = true;\n        this.setUploadFail(fileItem, strings.cancelUploadFile);\n      } else {\n        fileItem.uploadUrl = undefined;\n        fileItem.completed = true;\n        this.setUploadFail(fileItem, strings.cancelUploadFile);\n      }\n    } catch {\n      fileItem.uploadUrl = undefined;\n      fileItem.completed = true;\n      this.setUploadFail(fileItem, strings.cancelUploadFile);\n    }\n  }\n\n  /**\n   * Stop listeners from onDragOver event.\n   *\n   * @param event\n   */\n  protected handleonDragOver = (event: DragEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n    if (event.dataTransfer.items && event.dataTransfer.items.length > 0) {\n      event.dataTransfer.dropEffect = event.dataTransfer.dropEffect = this._dropEffect;\n    }\n  };\n\n  /**\n   * Stop listeners from onDragEnter event, enable drag and drop view.\n   *\n   * @param event\n   */\n  protected handleonDragEnter = (event: DragEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n\n    this._dragCounter++;\n    if (event.dataTransfer.items && event.dataTransfer.items.length > 0) {\n      event.dataTransfer.dropEffect = this._dropEffect;\n      const dragFileBorder: HTMLElement = this.renderRoot.querySelector('#file-upload-border');\n      dragFileBorder.classList.add('visible');\n    }\n  };\n\n  /**\n   * Stop listeners from ondragenter event, disable drag and drop view.\n   *\n   * @param event\n   */\n  protected handleonDragLeave = (event: DragEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n\n    this._dragCounter--;\n    if (this._dragCounter === 0) {\n      const dragFileBorder: HTMLElement = this.renderRoot.querySelector('#file-upload-border');\n      dragFileBorder.classList.remove('visible');\n    }\n  };\n\n  /**\n   * Stop listeners from onDrop event and process files.\n   *\n   * @param event\n   */\n  protected handleonDrop = (event: DragEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n    const done = (): void => {\n      event.dataTransfer.clearData();\n    };\n    const dragFileBorder: HTMLElement = this.renderRoot.querySelector('#file-upload-border');\n    dragFileBorder.classList.remove('visible');\n    if (event.dataTransfer?.items) {\n      void this.readUploadedFiles(event.dataTransfer.items, done);\n    }\n    this._dragCounter = 0;\n  };\n\n  private async readUploadedFiles(uploaded: DataTransferItemList | FileList, onCompleteCallback: () => void) {\n    const files = await this.getFilesFromUploadArea(uploaded);\n    await this.getSelectedFiles(files);\n    onCompleteCallback();\n  }\n\n  /**\n   * Get Files and initalize MgtFileUploadItem object life cycle to be uploaded\n   *\n   * @param inputFiles\n   */\n  protected async getSelectedFiles(files: File[]) {\n    let fileItems: MgtFileUploadItem[] = [];\n    const fileItemsCompleted: MgtFileUploadItem[] = [];\n    this._applyAll = false;\n    this._applyAllConflictBehavior = null;\n    this._maximumFileSize = false;\n    this._excludedFileType = false;\n\n    // Collect ongoing upload files\n    this.filesToUpload.forEach(fileItem => {\n      if (!fileItem.completed) {\n        fileItems.push(fileItem);\n      } else {\n        fileItemsCompleted.push(fileItem);\n      }\n    });\n\n    for (const file of files as FileWithPath[]) {\n      const fullPath = file.fullPath === '' ? '/' + file.name : file.fullPath;\n      if (fileItems.filter(item => item.fullPath === fullPath).length === 0) {\n        // Initialize variable for File validation\n        let acceptFile = true;\n\n        // Exclude file based on max file size allowed\n        if (this.fileUploadList.maxFileSize !== undefined && acceptFile) {\n          if (file.size > this.fileUploadList.maxFileSize * 1024) {\n            acceptFile = false;\n            if (this._maximumFileSize === false) {\n              const maximumFileSize: (number | true | string)[] = await this.getFileUploadStatus(\n                file,\n                fullPath,\n                'MaxFileSize',\n                this.fileUploadList\n              );\n              if (maximumFileSize !== null) {\n                if (maximumFileSize[0] === 1) {\n                  this._maximumFileSize = true;\n                }\n              }\n            }\n          }\n        }\n\n        // Exclude file based on File extensions\n        if (this.fileUploadList.excludedFileExtensions !== undefined) {\n          if (this.fileUploadList.excludedFileExtensions.length > 0 && acceptFile) {\n            if (\n              this.fileUploadList.excludedFileExtensions.filter(fileExtension => {\n                return file.name.toLowerCase().indexOf(fileExtension.toLowerCase()) > -1;\n              }).length > 0\n            ) {\n              acceptFile = false;\n              if (this._excludedFileType === false) {\n                const excludedFileType: (number | true | string)[] = await this.getFileUploadStatus(\n                  file,\n                  fullPath,\n                  'ExcludedFileType',\n                  this.fileUploadList\n                );\n                if (excludedFileType !== null) {\n                  if (excludedFileType[0] === 1) {\n                    this._excludedFileType = true;\n                  }\n                }\n              }\n            }\n          }\n        }\n\n        // Collect accepted files\n        if (acceptFile) {\n          const conflictBehavior: (number | true | MgtFileUploadConflictBehavior)[] = await this.getFileUploadStatus(\n            file,\n            fullPath,\n            'Upload',\n            this.fileUploadList\n          );\n          let completed = false;\n          if (conflictBehavior !== null) {\n            if (conflictBehavior[0] === -1) {\n              completed = true;\n            } else {\n              this._applyAll = Boolean(conflictBehavior[0]);\n              this._applyAllConflictBehavior = conflictBehavior[1] ? 1 : 0;\n            }\n          }\n\n          // Initialize MgtFileUploadItem Life cycle\n          fileItems.push({\n            file,\n            driveItem: {\n              name: file.name\n            },\n            fullPath,\n            conflictBehavior: calculateConflictBehavior(conflictBehavior),\n            iconStatus: null,\n            percent: 1,\n            view: 'image',\n            completed,\n            maxSize: this._maxChunkSize,\n            minSize: 0\n          });\n        }\n      }\n    }\n    fileItems = fileItems.sort((firstFile, secondFile) => {\n      return firstFile.fullPath\n        .substring(0, firstFile.fullPath.lastIndexOf('/'))\n        .localeCompare(secondFile.fullPath.substring(0, secondFile.fullPath.lastIndexOf('/')));\n    });\n    // remove completed file report image to be reuploaded.\n    fileItems.forEach(fileItem => {\n      if (fileItemsCompleted.filter(item => item.fullPath === fileItem.fullPath).length !== 0) {\n        const index = fileItemsCompleted.findIndex(item => item.fullPath === fileItem.fullPath);\n        fileItemsCompleted.splice(index, 1);\n      }\n    });\n    fileItems.push(...fileItemsCompleted);\n    this.filesToUpload = fileItems;\n    // Send multiple Files to upload\n    const promises = this.filesToUpload.map(fileItem => this.sendFileItemGraph(fileItem));\n    await Promise.all(promises);\n  }\n\n  /**\n   * Call modal dialog to replace or keep file.\n   *\n   * @param file\n   * @returns\n   */\n  protected async getFileUploadStatus(\n    file: File,\n    fullPath: string,\n    DialogStatus: string,\n    fileUploadList: MgtFileUploadConfig\n  ): Promise<(number | true | MgtFileUploadConflictBehavior)[]> {\n    const fileUploadDialog: HTMLElement = this.renderRoot.querySelector('#file-upload-dialog');\n\n    switch (DialogStatus) {\n      case 'Upload': {\n        const driveItem = await getGraphfile(this.fileUploadList.graph, `${this.getGrapQuery(fullPath)}?$select=id`);\n        if (driveItem !== null) {\n          if (this._applyAll === true) {\n            return [this._applyAll, this._applyAllConflictBehavior];\n          }\n          fileUploadDialog.classList.add('visible');\n          this._dialogTitle = strings.fileReplaceTitle;\n          this._dialogContent = strings.fileReplace.replace('{FileName}', file.name);\n          this._dialogCheckBox = strings.checkApplyAll;\n          this._dialogPrimaryButton = strings.buttonReplace;\n          this._dialogSecondaryButton = strings.buttonKeep;\n          await super.requestStateUpdate(true);\n\n          return new Promise<(number | MgtFileUploadConflictBehavior)[]>(resolve => {\n            const fileUploadDialogClose: HTMLElement = this.renderRoot.querySelector('.file-upload-dialog-close');\n            const fileUploadDialogOk: HTMLElement = this.renderRoot.querySelector('.file-upload-dialog-ok');\n            const fileUploadDialogCancel: HTMLElement = this.renderRoot.querySelector('.file-upload-dialog-cancel');\n            const fileUploadDialogCheck: HTMLInputElement = this.renderRoot.querySelector('#file-upload-dialog-check');\n            fileUploadDialogCheck.checked = false;\n            fileUploadDialogCheck.classList.remove('hide');\n\n            // Replace File\n            const onOkDialogClick = () => {\n              fileUploadDialog.classList.remove('visible');\n              resolve([fileUploadDialogCheck.checked ? 1 : 0, 'replace']);\n            };\n\n            // Rename File\n            const onCancelDialogClick = () => {\n              fileUploadDialog.classList.remove('visible');\n              resolve([fileUploadDialogCheck.checked ? 1 : 0, 'rename']);\n            };\n\n            // Cancel File\n            const onCloseDialogClick = () => {\n              fileUploadDialog.classList.remove('visible');\n              resolve([-1]);\n            };\n\n            // Remove and include event listener to validate options.\n            fileUploadDialogOk.removeEventListener('click', onOkDialogClick);\n            fileUploadDialogCancel.removeEventListener('click', onCancelDialogClick);\n            fileUploadDialogClose.removeEventListener('click', onCloseDialogClick);\n            fileUploadDialogOk.addEventListener('click', onOkDialogClick);\n            fileUploadDialogCancel.addEventListener('click', onCancelDialogClick);\n            fileUploadDialogClose.addEventListener('click', onCloseDialogClick);\n          });\n        } else {\n          return null;\n        }\n        break;\n      }\n      case 'ExcludedFileType':\n        fileUploadDialog.classList.add('visible');\n        this._dialogTitle = strings.fileTypeTitle;\n        this._dialogContent =\n          strings.fileType.replace('{FileName}', file.name) +\n          ' (' +\n          fileUploadList.excludedFileExtensions.join(',') +\n          ')';\n        this._dialogCheckBox = strings.checkAgain;\n        this._dialogPrimaryButton = strings.buttonOk;\n        this._dialogSecondaryButton = strings.buttonCancel;\n        await super.requestStateUpdate(true);\n\n        return new Promise<number[]>(resolve => {\n          const fileUploadDialogOk: HTMLElement = this.renderRoot.querySelector('.file-upload-dialog-ok');\n          const fileUploadDialogCancel: HTMLElement = this.renderRoot.querySelector('.file-upload-dialog-cancel');\n          const fileUploadDialogClose: HTMLElement = this.renderRoot.querySelector('.file-upload-dialog-close');\n          const fileUploadDialogCheck: HTMLInputElement = this.renderRoot.querySelector('#file-upload-dialog-check');\n          fileUploadDialogCheck.checked = false;\n          fileUploadDialogCheck.classList.remove('hide');\n\n          const onOkDialogClick = () => {\n            fileUploadDialog.classList.remove('visible');\n            // Confirm info\n            resolve([fileUploadDialogCheck.checked ? 1 : 0]);\n          };\n\n          const onCancelDialogClick = () => {\n            fileUploadDialog.classList.remove('visible');\n            // Cancel all\n            resolve([0]);\n          };\n\n          // Remove and include event listener to validate options.\n          fileUploadDialogOk.removeEventListener('click', onOkDialogClick);\n          fileUploadDialogCancel.removeEventListener('click', onCancelDialogClick);\n          fileUploadDialogClose.removeEventListener('click', onCancelDialogClick);\n          fileUploadDialogOk.addEventListener('click', onOkDialogClick);\n          fileUploadDialogCancel.addEventListener('click', onCancelDialogClick);\n          fileUploadDialogClose.addEventListener('click', onCancelDialogClick);\n        });\n      case 'MaxFileSize':\n        fileUploadDialog.classList.add('visible');\n        this._dialogTitle = strings.maximumFileSizeTitle;\n        this._dialogContent =\n          strings.maximumFileSize\n            .replace('{FileSize}', formatBytes(fileUploadList.maxFileSize * 1024))\n            .replace('{FileName}', file.name) +\n          formatBytes(file.size) +\n          '.';\n        this._dialogCheckBox = strings.checkAgain;\n        this._dialogPrimaryButton = strings.buttonOk;\n        this._dialogSecondaryButton = strings.buttonCancel;\n        await super.requestStateUpdate(true);\n\n        return new Promise<number[]>(resolve => {\n          const fileUploadDialogOk: HTMLElement = this.renderRoot.querySelector('.file-upload-dialog-ok');\n          const fileUploadDialogCancel: HTMLElement = this.renderRoot.querySelector('.file-upload-dialog-cancel');\n          const fileUploadDialogClose: HTMLElement = this.renderRoot.querySelector('.file-upload-dialog-close');\n          const fileUploadDialogCheck: HTMLInputElement = this.renderRoot.querySelector('#file-upload-dialog-check');\n          fileUploadDialogCheck.checked = false;\n          fileUploadDialogCheck.classList.remove('hide');\n\n          const onOkDialogClick = () => {\n            fileUploadDialog.classList.remove('visible');\n            // Confirm info\n            resolve([fileUploadDialogCheck.checked ? 1 : 0]);\n          };\n\n          const onCancelDialogClick = () => {\n            fileUploadDialog.classList.remove('visible');\n            // Cancel all\n            resolve([0]);\n          };\n          // Remove and include event listener to validate options.\n          fileUploadDialogOk.removeEventListener('click', onOkDialogClick);\n          fileUploadDialogCancel.removeEventListener('click', onCancelDialogClick);\n          fileUploadDialogClose.removeEventListener('click', onCancelDialogClick);\n          fileUploadDialogOk.addEventListener('click', onOkDialogClick);\n          fileUploadDialogCancel.addEventListener('click', onCancelDialogClick);\n          fileUploadDialogClose.addEventListener('click', onCancelDialogClick);\n        });\n\n      default:\n        break;\n    }\n  }\n\n  /**\n   * Get GraphQuery based on pre defined parameters.\n   *\n   * @param fileItem\n   * @returns\n   */\n  protected getGrapQuery(fullPath: string) {\n    let itemPath = '';\n    if (this.fileUploadList.itemPath) {\n      if (this.fileUploadList.itemPath.length > 0) {\n        itemPath = this.fileUploadList.itemPath.startsWith('/')\n          ? this.fileUploadList.itemPath\n          : '/' + this.fileUploadList.itemPath;\n      }\n    }\n\n    // {userId} {itemId}\n    if (this.fileUploadList.userId && this.fileUploadList.itemId) {\n      return `/users/${this.fileUploadList.userId}/drive/items/${this.fileUploadList.itemId}:${fullPath}`;\n    }\n    // {userId} {itemPath}\n    if (this.fileUploadList.userId && this.fileUploadList.itemPath) {\n      return `/users/${this.fileUploadList.userId}/drive/root:${itemPath}${fullPath}`;\n    }\n    // {groupId} {itemId}\n    if (this.fileUploadList.groupId && this.fileUploadList.itemId) {\n      return `/groups/${this.fileUploadList.groupId}/drive/items/${this.fileUploadList.itemId}:${fullPath}`;\n    }\n    // {groupId} {itemPath}\n    if (this.fileUploadList.groupId && this.fileUploadList.itemPath) {\n      return `/groups/${this.fileUploadList.groupId}/drive/root:${itemPath}${fullPath}`;\n    }\n    // {driveId} {itemId}\n    if (this.fileUploadList.driveId && this.fileUploadList.itemId) {\n      return `/drives/${this.fileUploadList.driveId}/items/${this.fileUploadList.itemId}:${fullPath}`;\n    }\n    // {driveId} {itemPath}\n    if (this.fileUploadList.driveId && this.fileUploadList.itemPath) {\n      return `/drives/${this.fileUploadList.driveId}/root:${itemPath}${fullPath}`;\n    }\n    // {siteId} {itemId}\n    if (this.fileUploadList.siteId && this.fileUploadList.itemId) {\n      return `/sites/${this.fileUploadList.siteId}/drive/items/${this.fileUploadList.itemId}:${fullPath}`;\n    }\n    // {siteId} {itemPath}\n    if (this.fileUploadList.siteId && this.fileUploadList.itemPath) {\n      return `/sites/${this.fileUploadList.siteId}/drive/root:${itemPath}${fullPath}`;\n    }\n    // default OneDrive {itemId}\n    if (this.fileUploadList.itemId) {\n      return `/me/drive/items/${this.fileUploadList.itemId}:${fullPath}`;\n    }\n    // default OneDrive {itemPath}\n    if (this.fileUploadList.itemPath) {\n      return `/me/drive/root:${itemPath}${fullPath}`;\n    }\n    // default OneDrive root\n    return `/me/drive/root:${fullPath}`;\n  }\n\n  /**\n   * Send file using Upload using Graph based on length\n   *\n   * @param fileUpload\n   * @returns\n   */\n  protected async sendFileItemGraph(fileItem: MgtFileUploadItem) {\n    const graph: IGraph = this.fileUploadList.graph;\n    let graphQuery = '';\n    if (fileItem.file.size < this._maxChunkSize) {\n      try {\n        if (!fileItem.completed) {\n          if (fileItem.conflictBehavior === null || fileItem.conflictBehavior === 'replace') {\n            graphQuery = `${this.getGrapQuery(fileItem.fullPath)}:/content`;\n          }\n          if (fileItem.conflictBehavior === 'rename') {\n            graphQuery = `${this.getGrapQuery(fileItem.fullPath)}:/content?@microsoft.graph.conflictBehavior=rename`;\n          }\n          fileItem.driveItem = await sendFileContent(graph, graphQuery, fileItem.file);\n          if (fileItem.driveItem !== null) {\n            this.setUploadSuccess(fileItem);\n          } else {\n            fileItem.driveItem = {\n              name: fileItem.file.name\n            };\n            this.setUploadFail(fileItem, strings.failUploadFile);\n          }\n        }\n      } catch (error) {\n        this.setUploadFail(fileItem, strings.failUploadFile);\n      }\n    } else {\n      if (!fileItem.completed) {\n        if (fileItem.uploadUrl === undefined) {\n          const response = await getUploadSession(\n            graph,\n            `${this.getGrapQuery(fileItem.fullPath)}:/createUploadSession`,\n            fileItem.conflictBehavior\n          );\n          try {\n            if (response !== null) {\n              // uploadSession url used to send chunks of file\n              fileItem.uploadUrl = response.uploadUrl;\n              const driveItem = await this.sendSessionUrlGraph(graph, fileItem);\n              if (driveItem !== null) {\n                fileItem.driveItem = driveItem;\n                this.setUploadSuccess(fileItem);\n              } else {\n                this.setUploadFail(fileItem, strings.failUploadFile);\n              }\n            } else {\n              this.setUploadFail(fileItem, strings.failUploadFile);\n            }\n            // eslint-disable-next-line no-empty\n          } catch {}\n        }\n      }\n    }\n  }\n\n  /**\n   * Manage slices of File to upload file by chunks using Graph and Session Url\n   *\n   * @param Graph\n   * @param fileItem\n   * @returns\n   */\n  protected async sendSessionUrlGraph(graph: IGraph, fileItem: MgtFileUploadItem) {\n    while (fileItem.file.size > fileItem.minSize) {\n      if (fileItem.mimeStreamString === undefined) {\n        fileItem.mimeStreamString = (await this.readFileContent(fileItem.file)) as ArrayBuffer;\n      }\n      // Graph client API uses Buffer package to manage ArrayBuffer, change to Blob avoids external package dependency\n      const fileSlice: Blob = new Blob([fileItem.mimeStreamString.slice(fileItem.minSize, fileItem.maxSize)]);\n      fileItem.percent = Math.round((fileItem.maxSize / fileItem.file.size) * 100);\n      await super.requestStateUpdate(true);\n\n      if (fileItem.uploadUrl !== undefined) {\n        const response = await sendFileChunk(\n          graph,\n          fileItem.uploadUrl,\n          `${fileItem.maxSize - fileItem.minSize}`,\n          `bytes ${fileItem.minSize}-${fileItem.maxSize - 1}/${fileItem.file.size}`,\n          fileSlice\n        );\n        if (response === null) {\n          return null;\n        } else if (isUploadSession(response)) {\n          // Define next Chunk\n          fileItem.minSize = parseInt(response.nextExpectedRanges[0].split('-')[0], 10);\n          fileItem.maxSize = fileItem.minSize + this._maxChunkSize;\n          if (fileItem.maxSize > fileItem.file.size) {\n            fileItem.maxSize = fileItem.file.size;\n          }\n        } else if (response.id !== undefined) {\n          return response;\n        }\n      } else {\n        return null;\n      }\n    }\n  }\n\n  /**\n   * Change the state of Mgt-File icon upload to Success\n   *\n   * @param fileUpload\n   */\n  protected setUploadSuccess(fileUpload: MgtFileUploadItem) {\n    fileUpload.percent = 100;\n    void super.requestStateUpdate(true);\n    setTimeout(() => {\n      fileUpload.iconStatus = getSvg(SvgIcon.Success);\n      fileUpload.view = 'twolines';\n      fileUpload.fieldUploadResponse = 'lastModifiedDateTime';\n      fileUpload.completed = true;\n      void super.requestStateUpdate(true);\n      void clearFilesCache();\n    }, 500);\n  }\n\n  /**\n   * Change the state of Mgt-File icon upload to Fail\n   *\n   * @param fileUpload\n   */\n  protected setUploadFail(fileUpload: MgtFileUploadItem, errorMessage: string) {\n    setTimeout(() => {\n      fileUpload.iconStatus = getSvg(SvgIcon.Fail);\n      fileUpload.view = 'twolines';\n      fileUpload.driveItem.description = errorMessage;\n      fileUpload.fieldUploadResponse = 'description';\n      fileUpload.completed = true;\n      void super.requestStateUpdate(true);\n    }, 500);\n  }\n\n  /**\n   * Retrieve File content as ArrayBuffer\n   *\n   * @param file\n   * @returns\n   */\n  protected readFileContent(file: File): Promise<string | ArrayBuffer> {\n    return new Promise<string | ArrayBuffer>((resolve, reject) => {\n      const myReader: FileReader = new FileReader();\n\n      myReader.onloadend = () => {\n        resolve(myReader.result);\n      };\n\n      myReader.onerror = e => {\n        reject(e);\n      };\n\n      myReader.readAsArrayBuffer(file);\n    });\n  }\n\n  /**\n   * Collect Files from Upload Area based on maxUploadFile\n   *\n   * @param uploadFilesItems\n   * @returns\n   */\n  protected async getFilesFromUploadArea(filesItems: DataTransferItemList | FileList): Promise<File[]> {\n    const folders: FileSystemDirectoryEntry[] = [];\n    let entry: FileSystemEntry;\n    const collectFilesItems: File[] = [];\n\n    for (const uploadFileItem of filesItems) {\n      if (isDataTransferItem(uploadFileItem)) {\n        if (isFutureDataTransferItem(uploadFileItem)) {\n          entry = uploadFileItem.getAsEntry();\n          if (isFileSystemDirectoryEntry(entry)) {\n            folders.push(entry);\n          } else {\n            const file = uploadFileItem.getAsFile();\n            if (file) {\n              this.writeFilePath(file, '');\n              collectFilesItems.push(file);\n            }\n          }\n        } else if (uploadFileItem.webkitGetAsEntry) {\n          entry = uploadFileItem.webkitGetAsEntry();\n          if (isFileSystemDirectoryEntry(entry)) {\n            folders.push(entry);\n          } else {\n            const file = uploadFileItem.getAsFile();\n            if (file) {\n              this.writeFilePath(file, '');\n              collectFilesItems.push(file);\n            }\n          }\n        } else {\n          const file = uploadFileItem.getAsFile();\n          if (file) {\n            this.writeFilePath(file, '');\n            collectFilesItems.push(file);\n          }\n        }\n      } else {\n        this.writeFilePath(uploadFileItem, '');\n        collectFilesItems.push(uploadFileItem);\n      }\n    }\n\n    // Collect Files from folder\n    if (folders.length > 0) {\n      const folderFiles = await this.getFolderFiles(folders);\n      collectFilesItems.push(...folderFiles);\n    }\n    return collectFilesItems;\n  }\n\n  /**\n   * Retrieve files from folder and subfolders to array.\n   *\n   * @param folders\n   * @returns\n   */\n  protected getFolderFiles(folders: FileSystemDirectoryEntry[]) {\n    return new Promise<File[]>(resolve => {\n      let reading = 0;\n      const contents: File[] = [];\n      folders.forEach(entry => {\n        readEntry(entry, '');\n      });\n\n      const readEntry = (entry: FileEntry, path: string) => {\n        if (isFileSystemDirectoryEntry(entry)) {\n          readReaderContent(entry.createReader());\n        } else if (isFileSystemFileEntry(entry)) {\n          reading++;\n          entry.file(file => {\n            reading--;\n            // Include Folder path where File is located\n            this.writeFilePath(file, path);\n            contents.push(file);\n\n            if (reading === 0) {\n              resolve(contents);\n            }\n          });\n        }\n      };\n\n      const readReaderContent = (reader: FileSystemDirectoryReader) => {\n        reading++;\n\n        reader.readEntries(entries => {\n          reading--;\n          for (const entry of entries) {\n            readEntry(entry, entry.fullPath);\n          }\n\n          if (reading === 0) {\n            resolve(contents);\n          }\n        });\n      };\n    });\n  }\n  private writeFilePath(file: File | FileSystemEntry, path: string) {\n    (file as unknown as FileEntry).fullPath = path;\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport {\n  GraphPageIterator,\n  Providers,\n  ProviderState,\n  mgtHtml,\n  MgtTemplatedTaskComponent\n} from '@microsoft/mgt-element';\nimport { DriveItem } from '@microsoft/microsoft-graph-types';\nimport { html, TemplateResult } from 'lit';\nimport { property, state } from 'lit/decorators.js';\nimport { repeat } from 'lit/directives/repeat.js';\nimport {\n  clearFilesCache,\n  fetchNextAndCacheForFilesPageIterator,\n  getDriveFilesByIdIterator,\n  getDriveFilesByPathIterator,\n  getFilesByIdIterator,\n  getFilesByListQueryIterator,\n  getFilesByPathIterator,\n  getFilesByQueries,\n  getFilesIterator,\n  getGroupFilesByIdIterator,\n  getGroupFilesByPathIterator,\n  getMyInsightsFiles,\n  getSiteFilesByIdIterator,\n  getSiteFilesByPathIterator,\n  getUserFilesByIdIterator,\n  getUserFilesByPathIterator,\n  getUserInsightsFiles\n} from '../../graph/graph.files';\nimport './mgt-file-upload/mgt-file-upload';\nimport { getSvg, SvgIcon } from '../../utils/SvgHelper';\nimport { OfficeGraphInsightString, ViewType, viewTypeConverter } from '../../graph/types';\nimport { styles } from './mgt-file-list-css';\nimport { strings } from './strings';\nimport { MgtFile, registerMgtFileComponent } from '../mgt-file/mgt-file';\nimport { MgtFileUploadConfig, registerMgtFileUploadComponent } from './mgt-file-upload/mgt-file-upload';\n\nimport { fluentProgressRing } from '@fluentui/web-components';\nimport { registerFluentComponents } from '../../utils/FluentComponents';\nimport { CardSection } from '../BasePersonCardSection';\nimport { registerComponent } from '@microsoft/mgt-element';\n\nexport const registerMgtFileListComponent = () => {\n  registerFluentComponents(fluentProgressRing);\n\n  registerMgtFileComponent();\n  registerMgtFileUploadComponent();\n  registerComponent('file-list', MgtFileList);\n};\n\n/**\n * The File List component displays a list of multiple folders and files by\n * using the file/folder name, an icon, and other properties specified by the developer.\n * This component uses the mgt-file component.\n *\n * @export\n * @class MgtFileList\n *\n * @fires {CustomEvent<MicrosoftGraph.DriveItem>} itemClick - Fired when a user clicks on a file.\n * it returns the file (DriveItem) details.\n *\n * NOTE: This component also allows customizing the tokens from mgt-file and mgt-file-upload components.\n * @cssprop --file-list-background-color - {Color} the background color of the component.\n * @cssprop --file-list-box-shadow - {String} the box-shadow syle of the component. Default value is --elevation-shadow-card-rest.\n * @cssprop --file-list-border-radius - {Length} the file list box border radius. Default value is 8px.\n * @cssprop --file-list-border - {String} the file list border style. Default value is none.\n * @cssprop --file-list-padding -{String} the file list padding.  Default value is 0px.\n * @cssprop --file-list-margin -{String} the file list margin. Default value is 0px.\n * @cssprop --show-more-button-background-color - {Color} the \"show more\" button background color.\n * @cssprop --show-more-button-background-color--hover - {Color} the \"show more\" button background color on hover.\n * @cssprop --show-more-button-font-size - {String} the \"show more\" text font size. Default value is 12px.\n * @cssprop --show-more-button-padding - {String} the \"show more\" button padding. Default value is 0px.\n * @cssprop --show-more-button-border-bottom-right-radius - {String} the \"show more\" button bottom right border radius. Default value is 8px.\n * @cssprop --show-more-button-border-bottom-left-radius - {String} the \"show more\" button bottom left border radius. Default value is 8px;\n * @cssprop --progress-ring-size -{String} Progress ring height and width. Default value is 24px.\n */\nexport class MgtFileList extends MgtTemplatedTaskComponent implements CardSection {\n  @state() private _isCompact = false;\n  /**\n   * Array of styles to apply to the element. The styles should be defined\n   * using the `css` tag function.\n   */\n  static get styles() {\n    return styles;\n  }\n\n  protected get strings(): Record<string, string> {\n    return strings;\n  }\n\n  /**\n   * allows developer to provide query for a file list\n   *\n   * @type {string}\n   * @memberof MgtFileList\n   */\n  @property({\n    attribute: 'file-list-query'\n  })\n  public fileListQuery: string;\n\n  /**\n   * The name for display in the overview section.\n   *\n   * @readonly\n   * @type {string}\n   * @memberof MgtFileList\n   */\n  public get displayName(): string {\n    return this.strings.filesSectionTitle;\n  }\n\n  /**\n   * The title for the card when rendered as a card full.\n   *\n   * @readonly\n   * @type {string}\n   * @memberof MgtFileList\n   */\n  public get cardTitle(): string {\n    return this.strings.filesSectionTitle;\n  }\n\n  /**\n   * Render the icon for display in the navigation ribbon.\n   *\n   * @returns {TemplateResult}\n   * @memberof MgtFileList\n   */\n  public renderIcon(): TemplateResult {\n    return getSvg(SvgIcon.Files);\n  }\n\n  /**\n   * allows developer to provide an array of file queries\n   *\n   * @type {string[]}\n   * @memberof MgtFileList\n   */\n  @property({\n    attribute: 'file-queries',\n    converter: (value, _type) => {\n      if (value) {\n        return value.split(',').map(v => v.trim());\n      } else {\n        return null;\n      }\n    }\n  })\n  public fileQueries: string[] | null = null;\n\n  /**\n   * allows developer to provide an array of files\n   *\n   * @type {MicrosoftGraph.DriveItem[]}\n   * @memberof MgtFileList\n   */\n  @property({ type: Object })\n  public files: DriveItem[] | null = null;\n\n  /**\n   * allows developer to provide site id for a file\n   *\n   * @type {string}\n   * @memberof MgtFileList\n   */\n  @property({\n    attribute: 'site-id'\n  })\n  public siteId: string;\n\n  /**\n   * allows developer to provide drive id for a file\n   *\n   * @type {string}\n   * @memberof MgtFileList\n   */\n  @property({\n    attribute: 'drive-id'\n  })\n  public driveId: string;\n\n  /**\n   * allows developer to provide group id for a file\n   *\n   * @type {string}\n   * @memberof MgtFileList\n   */\n  @property({\n    attribute: 'group-id'\n  })\n  public groupId: string;\n\n  /**\n   * allows developer to provide item id for a file\n   *\n   * @type {string}\n   * @memberof MgtFileList\n   */\n  @property({\n    attribute: 'item-id'\n  })\n  public itemId: string;\n\n  /**\n   * allows developer to provide item path for a file\n   *\n   * @type {string}\n   * @memberof MgtFileList\n   */\n  @property({\n    attribute: 'item-path'\n  })\n  public itemPath: string;\n\n  /**\n   * allows developer to provide user id for a file\n   *\n   * @type {string}\n   * @memberof MgtFile\n   */\n  @property({\n    attribute: 'user-id'\n  })\n  public userId: string;\n\n  /**\n   * allows developer to provide insight type for a file\n   * can be trending, used, or shared\n   *\n   * @type {OfficeGraphInsightString}\n   * @memberof MgtFileList\n   */\n  @property({\n    attribute: 'insight-type'\n  })\n  public insightType: OfficeGraphInsightString;\n\n  /**\n   * Sets what data to be rendered (file icon only, oneline, twolines threelines).\n   * Default is 'threelines'.\n   *\n   * @type {ViewType}\n   * @memberof MgtFileList\n   */\n  @property({\n    attribute: 'item-view',\n    converter: value => viewTypeConverter(value, 'threelines')\n  })\n  public itemView: ViewType = 'threelines';\n\n  /**\n   * allows developer to provide file type to filter the list\n   * can be docx\n   *\n   * @type {string[]}\n   * @memberof MgtFileList\n   */\n  @property({\n    attribute: 'file-extensions',\n    converter: (value, _type) => {\n      return value.split(',').map(v => v.trim());\n    }\n  })\n  public fileExtensions: string[] = [];\n\n  /**\n   * A number value to indicate the number of more files to load when show more button is clicked\n   *\n   * @type {number}\n   * @memberof MgtFileList\n   */\n  @property({\n    attribute: 'page-size',\n    type: Number\n  })\n  public pageSize = 10;\n\n  @property({\n    attribute: 'disable-open-on-click',\n    type: Boolean\n  })\n  public disableOpenOnClick = false;\n  /**\n   * A boolean value indication if 'show-more' button should be disabled\n   *\n   * @type {boolean}\n   * @memberof MgtFileList\n   */\n  @property({\n    attribute: 'hide-more-files-button',\n    type: Boolean\n  })\n  public hideMoreFilesButton = false;\n\n  /**\n   * A number value indication for file size upload (KB)\n   *\n   * @type {number}\n   * @memberof MgtFileList\n   */\n  @property({\n    attribute: 'max-file-size',\n    type: Number\n  })\n  public maxFileSize: number;\n\n  /**\n   * A boolean value indication if file upload extension should be enable or disabled\n   *\n   * @type {boolean}\n   * @memberof MgtFileList\n   */\n  @property({\n    attribute: 'enable-file-upload',\n    type: Boolean\n  })\n  public enableFileUpload = false;\n\n  /**\n   * A number value to indicate the max number allowed of files to upload.\n   *\n   * @type {number}\n   * @memberof MgtFileList\n   */\n  @property({\n    attribute: 'max-upload-file',\n    type: Number\n  })\n  public maxUploadFile = 10;\n\n  /**\n   * A Array of file extensions to be excluded from file upload.\n   *\n   * @type {string[]}\n   * @memberof MgtFileList\n   */\n  @property({\n    attribute: 'excluded-file-extensions',\n    converter: (value, _type) => {\n      return value.split(',').map(v => v.trim());\n    }\n  })\n  public excludedFileExtensions: string[] = [];\n\n  /**\n   * Get the scopes required for file list\n   *\n   * @static\n   * @return {*}  {string[]}\n   * @memberof MgtFileList\n   */\n  public static get requiredScopes(): string[] {\n    return [...new Set([...MgtFile.requiredScopes])];\n  }\n\n  private _preloadedFiles: DriveItem[] = [];\n  private pageIterator: GraphPageIterator<DriveItem>;\n  // tracking user arrow key input of selection for accessibility purpose\n  private _focusedItemIndex = -1;\n\n  @state() private _isLoadingMore: boolean;\n\n  constructor() {\n    super();\n  }\n\n  /**\n   * Reset state\n   *\n   * @memberof MgtFileList\n   */\n  protected clearState(): void {\n    super.clearState();\n    this.files = null;\n  }\n\n  /**\n   * Set the section to compact view mode\n   *\n   * @returns\n   * @memberof BasePersonCardSection\n   */\n  public asCompactView() {\n    this._isCompact = true;\n    return this;\n  }\n\n  /**\n   * Set the section to full view mode\n   *\n   * @returns\n   * @memberof BasePersonCardSection\n   */\n  public asFullView() {\n    this._isCompact = false;\n    return this;\n  }\n\n  protected args(): unknown[] {\n    return [\n      this.providerState,\n      this.fileListQuery,\n      this.fileQueries,\n      this.siteId,\n      this.driveId,\n      this.groupId,\n      this.itemId,\n      this.itemPath,\n      this.userId,\n      this.insightType,\n      this.fileExtensions,\n      this.pageSize,\n      this.maxFileSize\n    ];\n  }\n\n  protected renderLoading = () => {\n    if (!this.files) {\n      return this.renderTemplate('loading', null) || html``;\n    }\n    return this.renderContent();\n  };\n\n  /**\n   * Render the file list\n   *\n   * @return {*}\n   * @memberof MgtFileList\n   */\n  protected renderContent = () => {\n    if (!this.files || this.files.length === 0) {\n      return this.renderNoData();\n    }\n    return this._isCompact ? this.renderCompactView() : this.renderFullView();\n  };\n\n  /**\n   * Render the compact view\n   *\n   * @returns {TemplateResult}\n   * @memberof MgtFileList\n   */\n  public renderCompactView(): TemplateResult {\n    const files = this.files.slice(0, 3);\n\n    return this.renderFiles(files);\n  }\n\n  /**\n   * Render the full view\n   *\n   * @returns {TemplateResult}\n   * @memberof MgtFileList\n   */\n  public renderFullView(): TemplateResult {\n    return this.renderTemplate('default', { files: this.files }) || this.renderFiles(this.files);\n  }\n\n  /**\n   * Render the state when no data is available\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtFileList\n   */\n  protected renderNoData(): TemplateResult {\n    return (\n      this.renderTemplate('no-data', null) ||\n      (this.enableFileUpload === true && Providers.globalProvider !== undefined\n        ? html`\n            <div class=\"file-list-wrapper\" dir=${this.direction}>\n              ${this.renderFileUpload()}\n            </div>`\n        : html``)\n    );\n  }\n\n  /**\n   * Render the list of files.\n   *\n   * @protected\n   * @param {*} files\n   * @returns {TemplateResult}\n   * @memberof mgtFileList\n   */\n  protected renderFiles(files: DriveItem[]): TemplateResult {\n    return html`\n      <div id=\"file-list-wrapper\" class=\"file-list-wrapper\" dir=${this.direction}>\n        ${this.enableFileUpload ? this.renderFileUpload() : null}\n        <ul\n          id=\"file-list\"\n          class=\"file-list\"\n        >\n          <li\n            tabindex=\"0\"\n            class=\"file-item\"\n            @keydown=\"${this.onFileListKeyDown}\"\n            @focus=\"${this.onFocusFirstItem}\"\n            @click=${(e: UIEvent) => this.handleItemSelect(files[0], e)}>\n            ${this.renderFile(files[0])}\n          </li>\n          ${repeat(\n            files.slice(1),\n            f => f.id,\n            f => html`\n              <li\n                class=\"file-item\"\n                @keydown=\"${this.onFileListKeyDown}\"\n                @click=${(e: UIEvent) => this.handleItemSelect(f, e)}>\n                ${this.renderFile(f)}\n              </li>\n            `\n          )}\n        </ul>\n        ${\n          !this.hideMoreFilesButton &&\n          this.pageIterator &&\n          (this.pageIterator.hasNext || this._preloadedFiles.length) &&\n          !this._isCompact\n            ? this.renderMoreFileButton()\n            : null\n        }\n      </div>\n    `;\n  }\n\n  /**\n   * Render an individual file.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof mgtFileList\n   */\n  protected renderFile(file: DriveItem): TemplateResult {\n    const view = this.itemView;\n    return (\n      this.renderTemplate('file', { file }, file.id) ||\n      mgtHtml`\n        <mgt-file class=\"mgt-file-item\" .fileDetails=${file} .view=${view}></mgt-file>\n      `\n    );\n  }\n\n  /**\n   * Render the button when clicked will show more files.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtFileList\n   */\n  protected renderMoreFileButton(): TemplateResult {\n    if (this._isLoadingMore) {\n      return html`\n        <fluent-progress-ring role=\"progressbar\" viewBox=\"0 0 8 8\" class=\"progress-ring\"></fluent-progress-ring>\n      `;\n    } else {\n      return html`\n        <fluent-button\n          appearance=\"stealth\"\n          id=\"show-more\"\n          class=\"show-more\"\n          @click=${() => this.renderNextPage()}\n        >\n          <span class=\"show-more-text\">${this.strings.showMoreSubtitle}</span>\n        </fluent-button>`;\n    }\n  }\n\n  /**\n   * Render MgtFileUpload sub component\n   *\n   * @returns\n   */\n  protected renderFileUpload(): TemplateResult {\n    const fileUploadConfig: MgtFileUploadConfig = {\n      graph: Providers.globalProvider.graph.forComponent(this),\n      driveId: this.driveId,\n      excludedFileExtensions: this.excludedFileExtensions,\n      groupId: this.groupId,\n      itemId: this.itemId,\n      itemPath: this.itemPath,\n      userId: this.userId,\n      siteId: this.siteId,\n      maxFileSize: this.maxFileSize,\n      maxUploadFile: this.maxUploadFile\n    };\n    return mgtHtml`\n        <mgt-file-upload .fileUploadList=${fileUploadConfig} ></mgt-file-upload>\n      `;\n  }\n\n  /**\n   * Handles setting the focusedItemIndex to 0 when you focus on the first item\n   * in the file list.\n   *\n   * @returns void\n   */\n  private readonly onFocusFirstItem = () => (this._focusedItemIndex = 0);\n\n  /**\n   * Handle accessibility keyboard keydown events (arrow up, arrow down, enter, tab) on file list\n   *\n   * @param event\n   */\n  private readonly onFileListKeyDown = (event: KeyboardEvent): void => {\n    const fileList = this.renderRoot.querySelector('.file-list');\n    let focusedItem: HTMLElement;\n\n    if (!fileList?.children.length) {\n      return;\n    }\n\n    if (event.code === 'ArrowUp' || event.code === 'ArrowDown') {\n      if (event.code === 'ArrowUp') {\n        if (this._focusedItemIndex === -1) {\n          this._focusedItemIndex = fileList.children.length;\n        }\n        this._focusedItemIndex = (this._focusedItemIndex - 1 + fileList.children.length) % fileList.children.length;\n      }\n      if (event.code === 'ArrowDown') {\n        this._focusedItemIndex = (this._focusedItemIndex + 1) % fileList.children.length;\n      }\n\n      focusedItem = fileList.children[this._focusedItemIndex] as HTMLElement;\n      this.updateItemBackgroundColor(fileList, focusedItem, 'focused');\n    }\n\n    if (event.code === 'Enter' || event.code === 'Space') {\n      focusedItem = fileList.children[this._focusedItemIndex] as HTMLElement;\n\n      const file = focusedItem.children[0] as MgtFile;\n      event.preventDefault();\n      this.fireCustomEvent('itemClick', file.fileDetails);\n      this.handleFileClick(file.fileDetails);\n\n      this.updateItemBackgroundColor(fileList, focusedItem, 'selected');\n    }\n\n    if (event.code === 'Tab') {\n      focusedItem = fileList.children[this._focusedItemIndex] as HTMLElement;\n    }\n  };\n\n  /**\n   * load state into the component.\n   *\n   * @protected\n   * @returns\n   * @memberof MgtFileList\n   */\n  protected async loadState() {\n    const provider = Providers.globalProvider;\n    if (!provider || provider.state === ProviderState.Loading) {\n      return;\n    }\n\n    if (provider.state === ProviderState.SignedOut) {\n      this.files = null;\n      return;\n    }\n    const graph = provider.graph.forComponent(this);\n    let files: DriveItem[];\n    let pageIterator: GraphPageIterator<DriveItem>;\n\n    const getFromMyDrive = !this.driveId && !this.siteId && !this.groupId && !this.userId;\n\n    // combinations of these attributes must be provided in order for the component to know which endpoint to call to request files\n    // not supplying enough for these combinations will get a null file result\n    if (\n      (this.driveId && !this.itemId && !this.itemPath) ||\n      (this.groupId && !this.itemId && !this.itemPath) ||\n      (this.siteId && !this.itemId && !this.itemPath) ||\n      (this.userId && !this.insightType && !this.itemId && !this.itemPath)\n    ) {\n      this.files = null;\n    }\n\n    if (!this.files) {\n      if (this.fileListQuery) {\n        pageIterator = await getFilesByListQueryIterator(graph, this.fileListQuery, this.pageSize);\n      } else if (this.fileQueries) {\n        files = await getFilesByQueries(graph, this.fileQueries);\n      } else if (getFromMyDrive) {\n        if (this.itemId) {\n          pageIterator = await getFilesByIdIterator(graph, this.itemId, this.pageSize);\n        } else if (this.itemPath) {\n          pageIterator = await getFilesByPathIterator(graph, this.itemPath, this.pageSize);\n        } else if (this.insightType) {\n          files = await getMyInsightsFiles(graph, this.insightType);\n        } else {\n          pageIterator = await getFilesIterator(graph, this.pageSize);\n        }\n      } else if (this.driveId) {\n        if (this.itemId) {\n          pageIterator = await getDriveFilesByIdIterator(graph, this.driveId, this.itemId, this.pageSize);\n        } else if (this.itemPath) {\n          pageIterator = await getDriveFilesByPathIterator(graph, this.driveId, this.itemPath, this.pageSize);\n        }\n      } else if (this.groupId) {\n        if (this.itemId) {\n          pageIterator = await getGroupFilesByIdIterator(graph, this.groupId, this.itemId, this.pageSize);\n        } else if (this.itemPath) {\n          pageIterator = await getGroupFilesByPathIterator(graph, this.groupId, this.itemPath, this.pageSize);\n        }\n      } else if (this.siteId) {\n        if (this.itemId) {\n          pageIterator = await getSiteFilesByIdIterator(graph, this.siteId, this.itemId, this.pageSize);\n        } else if (this.itemPath) {\n          pageIterator = await getSiteFilesByPathIterator(graph, this.siteId, this.itemPath, this.pageSize);\n        }\n      } else if (this.userId) {\n        if (this.itemId) {\n          pageIterator = await getUserFilesByIdIterator(graph, this.userId, this.itemId, this.pageSize);\n        } else if (this.itemPath) {\n          pageIterator = await getUserFilesByPathIterator(graph, this.userId, this.itemPath, this.pageSize);\n        } else if (this.insightType) {\n          files = await getUserInsightsFiles(graph, this.userId, this.insightType);\n        }\n      }\n\n      if (pageIterator) {\n        this.pageIterator = pageIterator;\n        this._preloadedFiles = [...this.pageIterator.value];\n\n        // handle when cached file length is greater than page size\n        if (this._preloadedFiles.length >= this.pageSize) {\n          files = this._preloadedFiles.splice(0, this.pageSize);\n        } else {\n          files = this._preloadedFiles.splice(0, this._preloadedFiles.length);\n        }\n      }\n\n      // filter files when extensions are provided\n      let filteredByFileExtension: DriveItem[];\n      if (this.fileExtensions?.length > 0) {\n        // retrive all pages before filtering\n        if (this.pageIterator?.value) {\n          while (this.pageIterator.hasNext) {\n            await fetchNextAndCacheForFilesPageIterator(this.pageIterator);\n          }\n          files = this.pageIterator.value;\n          this._preloadedFiles = [];\n        }\n        filteredByFileExtension = files.filter(file => {\n          for (const e of this.fileExtensions) {\n            if (e === this.getFileExtension(file.name)) {\n              return file;\n            }\n          }\n        });\n      }\n\n      if (filteredByFileExtension?.length >= 0) {\n        this.files = filteredByFileExtension;\n        if (this.pageSize) {\n          files = this.files.splice(0, this.pageSize);\n          this.files = files;\n        }\n      } else {\n        this.files = files;\n      }\n    }\n  }\n\n  /**\n   * Handle the click event on an item.\n   *\n   * @protected\n   * @memberof MgtFileList\n   */\n  protected handleItemSelect(item: DriveItem, event: UIEvent): void {\n    this.handleFileClick(item);\n    this.fireCustomEvent('itemClick', item);\n\n    // handle accessibility updates when item clicked\n    if (event) {\n      const fileList = this.renderRoot.querySelector('.file-list');\n\n      // get index of the focused item\n      const nodes = Array.from(fileList.children);\n      const li = (event.target as HTMLElement).closest('li');\n      const index = nodes.indexOf(li);\n      this._focusedItemIndex = index;\n      const clickedItem = fileList.children[this._focusedItemIndex] as HTMLElement;\n      this.updateItemBackgroundColor(fileList, clickedItem, 'selected');\n    }\n  }\n\n  /**\n   * Handle the click event on button to show next page.\n   *\n   * @protected\n   * @memberof MgtFileList\n   */\n  protected async renderNextPage() {\n    // render next page from cache if exists, or else use iterator\n    if (this._preloadedFiles.length > 0) {\n      this.files = [\n        ...this.files,\n        ...this._preloadedFiles.splice(0, Math.min(this.pageSize, this._preloadedFiles.length))\n      ];\n    } else {\n      if (this.pageIterator.hasNext) {\n        this._isLoadingMore = true;\n        const root = this.renderRoot.querySelector('#file-list-wrapper');\n        if (root?.animate) {\n          // play back\n          root.animate(\n            [\n              {\n                height: 'auto',\n                transformOrigin: 'top left'\n              },\n              {\n                height: 'auto',\n                transformOrigin: 'top left'\n              }\n            ],\n            {\n              duration: 1000,\n              easing: 'ease-in-out',\n              fill: 'both'\n            }\n          );\n        }\n        await fetchNextAndCacheForFilesPageIterator(this.pageIterator);\n        this._isLoadingMore = false;\n        this.files = this.pageIterator.value;\n      }\n    }\n\n    this.requestUpdate();\n  }\n\n  private handleFileClick(file: DriveItem) {\n    if (file?.webUrl && !this.disableOpenOnClick) {\n      window.open(file.webUrl, '_blank', 'noreferrer');\n    }\n  }\n\n  /**\n   * Get file extension string from file name\n   *\n   * @param name file name\n   * @returns {string} file extension\n   */\n  private getFileExtension(name: string) {\n    const re = /(?:\\.([^.]+))?$/;\n    const fileExtension = re.exec(name)[1] || '';\n\n    return fileExtension;\n  }\n\n  /**\n   * Handle remove and add css class on accessibility keyboard select and focus\n   *\n   * @param fileList HTML element\n   * @param focusedItem HTML element\n   * @param className background class to be applied\n   */\n  private updateItemBackgroundColor(fileList: Element, focusedItem: HTMLElement, className: string) {\n    // reset background color and remove tabindex\n    for (const node of fileList.children) {\n      node.classList.remove(className);\n      node.removeAttribute('tabindex');\n    }\n\n    // set focused item background color\n    if (focusedItem) {\n      focusedItem.classList.add(className);\n      focusedItem.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'start' });\n      focusedItem.setAttribute('tabindex', '0');\n      focusedItem.focus();\n    }\n\n    // remove selected classes\n    for (const node of fileList.children) {\n      node.classList.remove('selected');\n    }\n  }\n\n  /**\n   * Handle reload of File List and condition to clear cache\n   *\n   * @param clearCache boolean, if true clear cache\n   */\n  public reload(clearCache = false) {\n    if (clearCache) {\n      // clear cache File List\n      void clearFilesCache();\n    }\n    // explicitly run the task to reload data\n    void this._task.run();\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { DriveItem } from '@microsoft/microsoft-graph-types';\nimport { html, TemplateResult } from 'lit';\nimport { property } from 'lit/decorators.js';\nimport { styles } from './mgt-file-css';\nimport { MgtTemplatedTaskComponent, Providers, ProviderState } from '@microsoft/mgt-element';\nimport {\n  getDriveItemById,\n  getDriveItemByPath,\n  getDriveItemByQuery,\n  getGroupDriveItemById,\n  getGroupDriveItemByPath,\n  getListDriveItemById,\n  getMyDriveItemById,\n  getMyDriveItemByPath,\n  getMyInsightsDriveItemById,\n  getSiteDriveItemById,\n  getSiteDriveItemByPath,\n  getUserDriveItemById,\n  getUserDriveItemByPath,\n  getUserInsightsDriveItemById\n} from '../../graph/graph.files';\nimport { formatBytes, getRelativeDisplayDate } from '../../utils/Utils';\nimport { OfficeGraphInsightString, ViewType, viewTypeConverter } from '../../graph/types';\nimport { getFileTypeIconUriByExtension } from '../../styles/fluent-icons';\nimport { getSvg, SvgIcon } from '../../utils/SvgHelper';\nimport { strings } from './strings';\nimport { registerComponent } from '@microsoft/mgt-element';\n\nexport const registerMgtFileComponent = () => registerComponent('file', MgtFile);\n\n/**\n * The File component is used to represent an individual file/folder from OneDrive or SharePoint by displaying information such as the file/folder name, an icon indicating the file type, and other properties such as the author, last modified date, or other details selected by the developer.\n *\n * @export\n * @class MgtFile\n * @extends {MgtTemplatedComponent}\n *\n * @cssprop --file-type-icon-height - {Length} file type icon height. Default value is 28px.\n * @cssprop --file-border - {String} file item border style. Default value is \"1px solid transparent\".\n * @cssprop --file-border-radius - {String} the border radius of the file component. Default value is 4px.\n * @cssprop --file-box-shadow - {String} the box-shadow of the component. Default value is none.\n * @cssprop --file-background-color - {Color} the background-color of the component.\n * @cssprop --file-background-color-focus - {Color} the background-color of the component on focus.\n * @cssprop --file-background-color-hover - {Color} the background-color of the component on hover.\n * @cssprop --file-padding - {String} the padding around the file component. Default value is 0px.\n * @cssprop --file-padding-inline-start - {Length} the padding between file icon and file details. Default value is 14px.\n * @cssprop --file-margin - {String} the margin around the file component. Default value is 0px.\n * @cssprop --file-line1-font-size - {Length} the first line text font size. Default value is 12px.\n * @cssprop --file-line1-font-weight - {Length} the first line text font weight. Default value is 400.\n * @cssprop --file-line1-color - {Color} the first line text color.\n * @cssprop --file-line1-text-transform - {String} the first line text text transform. Default value is initial.\n * @cssprop --file-line2-font-size - {Length} the second line text font size. Default value is 12px.\n * @cssprop --file-line2-font-weight - {Length} the second line text font weight. Default value is 400.\n * @cssprop --file-line2-color - {Color} the second line text color.\n * @cssprop --file-line2-text-transform - {String} the second line text text transform. Default value is initial.\n * @cssprop --file-line3-font-size - {Length} the third line text font size. Default value is 12px.\n * @cssprop --file-line3-font-weight - {Length} the third line text font weight. Default value is 400.\n * @cssprop --file-line3-color - {Color} the third line text color.\n * @cssprop --file-line3-text-transform - {String} the third line text text transform. Default value is 400.\n */\nexport class MgtFile extends MgtTemplatedTaskComponent {\n  /**\n   * Array of styles to apply to the element. The styles should be defined\n   * using the `css` tag function.\n   */\n  static get styles() {\n    return styles;\n  }\n  protected get strings() {\n    return strings;\n  }\n\n  /**\n   * allows developer to provide query for a file\n   *\n   * @type {string}\n   * @memberof MgtFile\n   */\n  @property({\n    attribute: 'file-query'\n  })\n  public fileQuery: string;\n\n  /**\n   * allows developer to provide site id for a file\n   *\n   * @type {string}\n   * @memberof MgtFile\n   */\n  @property({\n    attribute: 'site-id'\n  })\n  public siteId: string;\n\n  /**\n   * allows developer to provide drive id for a file\n   *\n   * @type {string}\n   * @memberof MgtFile\n   */\n  @property({\n    attribute: 'drive-id'\n  })\n  public driveId: string;\n\n  /**\n   * allows developer to provide group id for a file\n   *\n   * @type {string}\n   * @memberof MgtFile\n   */\n  @property({\n    attribute: 'group-id'\n  })\n  public groupId: string;\n\n  /**\n   * allows developer to provide list id for a file\n   *\n   * @type {string}\n   * @memberof MgtFile\n   */\n  @property({\n    attribute: 'list-id'\n  })\n  public listId: string;\n\n  /**\n   * allows developer to provide user id for a file\n   *\n   * @type {string}\n   * @memberof MgtFile\n   */\n  @property({\n    attribute: 'user-id'\n  })\n  public userId: string;\n  /**\n   * allows developer to provide item id for a file\n   *\n   * @type {string}\n   * @memberof MgtFile\n   */\n  @property({\n    attribute: 'item-id'\n  })\n  public itemId: string;\n\n  /**\n   * allows developer to provide item path for a file\n   *\n   * @type {string}\n   * @memberof MgtFile\n   */\n  @property({\n    attribute: 'item-path'\n  })\n  public itemPath: string;\n\n  /**\n   * allows developer to provide insight type for a file\n   * can be trending, used, or shared\n   *\n   * @type {OfficeGraphInsightString}\n   * @memberof MgtFile\n   */\n  @property({\n    attribute: 'insight-type'\n  })\n  public insightType: OfficeGraphInsightString;\n\n  /**\n   * allows developer to provide insight id for a file\n   *\n   * @type {string}\n   * @memberof MgtFile\n   */\n  @property({\n    attribute: 'insight-id'\n  })\n  public insightId: string;\n\n  /**\n   * allows developer to provide DriveItem object\n   *\n   * @type {MicrosoftGraph.DriveItem}\n   * @memberof MgtFile\n   */\n  @property({\n    type: Object\n  })\n  public fileDetails: DriveItem;\n\n  /**\n   * allows developer to provide file type icon url\n   *\n   * @type {string}\n   * @memberof MgtFile\n   */\n  @property({\n    attribute: 'file-icon'\n  })\n  public fileIcon: string;\n\n  /**\n   * object containing Graph details on item\n   *\n   * @type {MicrosoftGraph.DriveItem}\n   * @memberof MgtFile\n   */\n  @property({ type: Object })\n  public driveItem: DriveItem;\n\n  /**\n   * Sets the property of the file to use for the first line of text.\n   * Default is file name\n   *\n   * @type {string}\n   * @memberof MgtFile\n   */\n  @property({ attribute: 'line1-property' }) public line1Property: string;\n\n  /**\n   * Sets the property of the file to use for the second line of text.\n   * Default is last modified date time\n   *\n   * @type {string}\n   * @memberof MgtFile\n   */\n  @property({ attribute: 'line2-property' }) public line2Property: string;\n\n  /**\n   * Sets the property of the file to use for the second line of text.\n   * Default is file size\n   *\n   * @type {string}\n   * @memberof MgtFile\n   */\n  @property({ attribute: 'line3-property' }) public line3Property: string;\n\n  /**\n   * Sets what data will be rendered.\n   * Valid options are 'image', 'oneline', 'twolines', 'threelines', or 'fourlines'\n   * Default is 'threelines'.\n   *\n   * @type {ViewType}\n   * @memberof MgtFile\n   */\n  @property({\n    attribute: 'view',\n    converter: value => viewTypeConverter(value, 'threelines')\n  })\n  public view: ViewType;\n\n  /**\n   * Get the scopes required for file\n   *\n   * @static\n   * @return {*}  {string[]}\n   * @memberof MgtFile\n   */\n  public static get requiredScopes(): string[] {\n    return [...new Set(['files.read', 'files.read.all', 'sites.read.all'])];\n  }\n\n  protected args(): unknown[] {\n    return [\n      this.providerState,\n      this.fileQuery,\n      this.siteId,\n      this.itemId,\n      this.driveId,\n      this.itemPath,\n      this.listId,\n      this.groupId,\n      this.userId,\n      this.insightType,\n      this.insightId,\n      this.fileDetails,\n      this.fileIcon\n    ];\n  }\n\n  constructor() {\n    super();\n    this.line1Property = 'name';\n    this.line2Property = 'lastModifiedDateTime';\n    this.line3Property = 'size';\n    this.view = 'threelines';\n  }\n\n  public renderContent = () => {\n    if (!this.driveItem) {\n      return this.renderNoData();\n    }\n\n    const file = this.driveItem;\n    let fileTemplate: TemplateResult;\n\n    fileTemplate = this.renderTemplate('default', { file });\n    if (!fileTemplate) {\n      const fileDetailsTemplate: TemplateResult = this.renderDetails(file);\n      const fileTypeIconTemplate: TemplateResult = this.renderFileTypeIcon();\n\n      fileTemplate = html`\n        <div class=\"item\">\n          ${fileTypeIconTemplate} ${fileDetailsTemplate}\n        </div>`;\n    }\n\n    return fileTemplate;\n  };\n\n  /**\n   * Render the state when no data is available\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtFile\n   */\n  protected renderNoData(): TemplateResult {\n    return this.renderTemplate('no-data', null) || html``;\n  }\n\n  /**\n   * Render the file type icon\n   *\n   * @protected\n   * @param {string} [iconSrc]\n   * @memberof MgtFile\n   */\n  protected renderFileTypeIcon(): TemplateResult {\n    if (!this.fileIcon && !this.driveItem.name) {\n      return html``;\n    }\n\n    let fileIconSrc;\n\n    if (this.fileIcon) {\n      fileIconSrc = this.fileIcon;\n    } else {\n      // get file type extension from file name\n      const re = /(?:\\.([^.]+))?$/;\n      const fileType =\n        this.driveItem.package === undefined && this.driveItem.folder === undefined\n          ? re.exec(this.driveItem.name)[1]\n            ? re.exec(this.driveItem.name)[1].toLowerCase()\n            : this.driveItem.size\n            ? 'null'\n            : 'folder'\n          : this.driveItem.package !== undefined\n          ? this.driveItem.package.type === 'oneNote'\n            ? 'onetoc'\n            : 'folder'\n          : 'folder';\n      fileIconSrc = getFileTypeIconUriByExtension(fileType, 48, 'svg');\n    }\n\n    return html`\n      <div class=\"item__file-type-icon\">\n        ${\n          fileIconSrc\n            ? html`\n              <img src=${fileIconSrc} alt=\"File icon\" />\n            `\n            : html`\n              ${getSvg(SvgIcon.File)}\n            `\n        }\n      </div>\n    `;\n  }\n\n  /**\n   * Render the file details\n   *\n   * @protected\n   * @param {MicrosoftGraph.DriveItem} [driveItem]\n   * @memberof MgtFile\n   */\n  protected renderDetails(driveItem: DriveItem): TemplateResult {\n    if (!driveItem || this.view === 'image') {\n      return html``;\n    }\n\n    const details: TemplateResult[] = [];\n\n    if (this.view > 'image') {\n      const text = this.getTextFromProperty(driveItem, this.line1Property);\n      if (text) {\n        details.push(html`\n          <div class=\"line1\" aria-label=\"${text}\">${text}</div>\n        `);\n      }\n    }\n\n    if (this.view > 'oneline') {\n      const text = this.getTextFromProperty(driveItem, this.line2Property);\n      if (text) {\n        details.push(html`\n          <div class=\"line2\" aria-label=\"${text}\">${text}</div>\n        `);\n      }\n    }\n\n    if (this.view > 'twolines') {\n      const text = this.getTextFromProperty(driveItem, this.line3Property);\n      if (text) {\n        details.push(html`\n          <div class=\"line3\" aria-label=\"${text}\">${text}</div>\n        `);\n      }\n    }\n\n    return html`\n      <div class=\"item__details\">\n        ${details}\n      </div>\n    `;\n  }\n\n  /**\n   * load state into the component.\n   *\n   * @protected\n   * @returns\n   * @memberof MgtFile\n   */\n  protected async loadState() {\n    if (this.fileDetails) {\n      this.driveItem = this.fileDetails;\n      return;\n    }\n\n    const provider = Providers.globalProvider;\n    if (!provider || provider.state === ProviderState.Loading) {\n      return;\n    }\n\n    if (provider.state === ProviderState.SignedOut) {\n      this.driveItem = null;\n      return;\n    }\n\n    const graph = provider.graph.forComponent(this);\n    let driveItem: DriveItem;\n\n    // evaluate to true when only item-id or item-path is provided\n    const getFromMyDrive = !this.driveId && !this.siteId && !this.groupId && !this.listId && !this.userId;\n\n    if (\n      // return null when a combination of provided properties are required\n      (this.driveId && !this.itemId && !this.itemPath) ||\n      (this.siteId && !this.itemId && !this.itemPath) ||\n      (this.groupId && !this.itemId && !this.itemPath) ||\n      (this.listId && !this.siteId && !this.itemId) ||\n      (this.insightType && !this.insightId) ||\n      (this.userId && !this.itemId && !this.itemPath && !this.insightType && !this.insightId)\n    ) {\n      driveItem = null;\n    } else if (this.fileQuery) {\n      driveItem = await getDriveItemByQuery(graph, this.fileQuery);\n    } else if (this.itemId && getFromMyDrive) {\n      driveItem = await getMyDriveItemById(graph, this.itemId);\n    } else if (this.itemPath && getFromMyDrive) {\n      driveItem = await getMyDriveItemByPath(graph, this.itemPath);\n    } else if (this.userId) {\n      if (this.itemId) {\n        driveItem = await getUserDriveItemById(graph, this.userId, this.itemId);\n      } else if (this.itemPath) {\n        driveItem = await getUserDriveItemByPath(graph, this.userId, this.itemPath);\n      } else if (this.insightType && this.insightId) {\n        driveItem = await getUserInsightsDriveItemById(graph, this.userId, this.insightType, this.insightId);\n      }\n    } else if (this.driveId) {\n      if (this.itemId) {\n        driveItem = await getDriveItemById(graph, this.driveId, this.itemId);\n      } else if (this.itemPath) {\n        driveItem = await getDriveItemByPath(graph, this.driveId, this.itemPath);\n      }\n    } else if (this.siteId && !this.listId) {\n      if (this.itemId) {\n        driveItem = await getSiteDriveItemById(graph, this.siteId, this.itemId);\n      } else if (this.itemPath) {\n        driveItem = await getSiteDriveItemByPath(graph, this.siteId, this.itemPath);\n      }\n    } else if (this.listId) {\n      driveItem = await getListDriveItemById(graph, this.siteId, this.listId, this.itemId);\n    } else if (this.groupId) {\n      if (this.itemId) {\n        driveItem = await getGroupDriveItemById(graph, this.groupId, this.itemId);\n      } else if (this.itemPath) {\n        driveItem = await getGroupDriveItemByPath(graph, this.groupId, this.itemPath);\n      }\n    } else if (this.insightType && !this.userId) {\n      driveItem = await getMyInsightsDriveItemById(graph, this.insightType, this.insightId);\n    }\n\n    this.driveItem = driveItem;\n  }\n\n  private getTextFromProperty(driveItem: DriveItem, properties: string): string {\n    if (!properties || properties.length === 0) {\n      return null;\n    }\n\n    const propertyList = properties.trim().split(',');\n    let text: string;\n    let i = 0;\n\n    while (!text && i < propertyList.length) {\n      const current = propertyList[i].trim();\n      switch (current) {\n        case 'size': {\n          // convert size to kb, mb, gb\n          let size = '0';\n          if (driveItem.size) {\n            size = formatBytes(driveItem.size);\n          }\n          text = `${this.strings.sizeSubtitle}: ${size}`;\n          break;\n        }\n        case 'lastModifiedDateTime': {\n          // convert date time\n          let relativeDateString: string;\n          let lastModifiedString: string;\n          if (driveItem.lastModifiedDateTime) {\n            const lastModifiedDateTime = new Date(driveItem.lastModifiedDateTime);\n            relativeDateString = getRelativeDisplayDate(lastModifiedDateTime);\n            lastModifiedString = `${this.strings.modifiedSubtitle} ${relativeDateString}`;\n          } else {\n            lastModifiedString = '';\n          }\n          text = lastModifiedString;\n          break;\n        }\n        default:\n          text = driveItem[current] as string;\n      }\n      i++;\n    }\n\n    return text;\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { MgtTemplatedTaskComponent, customElementHelper, mgtHtml } from '@microsoft/mgt-element';\nimport { html, TemplateResult } from 'lit';\nimport { property, state } from 'lit/decorators.js';\n\nimport { IDynamicPerson } from '../graph/types';\nimport { MgtPersonCard } from './mgt-person-card/mgt-person-card';\n\nimport './sub-components/mgt-spinner/mgt-spinner';\n\n/**\n * Defines the interface for a person card section.\n * This allows us to avoid forced inheritance and allow for more flexibility in the future.\n */\nexport interface CardSection {\n  readonly cardTitle: string;\n  tagName: string;\n  asCompactView(): CardSection;\n  asFullView(): CardSection;\n  renderIcon(): TemplateResult;\n}\n\n/**\n * A base class for building person card subsections.\n *\n * @export\n * @class BasePersonCardSection\n * @extends {MgtTemplatedComponent}\n */\nexport abstract class BasePersonCardSection extends MgtTemplatedTaskComponent implements CardSection {\n  /**\n   * Set the person details to render\n   *\n   * @type {IDynamicPerson}\n   * @memberof BasePersonCardSection\n   */\n  @property({\n    attribute: 'person-details',\n    type: Object\n  })\n  public personDetails: IDynamicPerson | null = null;\n\n  /**\n   * The name for display in the overview section.\n   *\n   * @abstract\n   * @type {string}\n   * @memberof BasePersonCardSection\n   */\n  public abstract get displayName(): string;\n\n  /**\n   * The title for using when rendering the full card.\n   *\n   * @readonly\n   * @abstract\n   * @memberof BasePersonCardSection\n   */\n  public abstract get cardTitle(): string;\n\n  /**\n   * Determines the appropriate view state: full or compact\n   *\n   * @protected\n   * @type {boolean}\n   * @memberof BasePersonCardSection\n   */\n  protected get isCompact(): boolean {\n    return this._isCompact;\n  }\n\n  @state()\n  private _isCompact: boolean;\n\n  constructor() {\n    super();\n    this._isCompact = false;\n  }\n\n  /**\n   * Render the icon for display in the navigation ribbon.\n   *\n   * @protected\n   * @abstract\n   * @returns {TemplateResult}\n   * @memberof BasePersonCardSection\n   */\n  public abstract renderIcon(): TemplateResult;\n\n  /**\n   * Set the section to compact view mode\n   *\n   * @returns\n   * @memberof BasePersonCardSection\n   */\n  public asCompactView() {\n    this._isCompact = true;\n    return this;\n  }\n\n  /**\n   * Set the section to full view mode\n   *\n   * @returns\n   * @memberof BasePersonCardSection\n   */\n  public asFullView() {\n    this._isCompact = false;\n    return this;\n  }\n\n  /**\n   * Reset any state in the section\n   *\n   * @protected\n   * @memberof BasePersonCardSection\n   */\n  protected clearState(): void {\n    this._isCompact = false;\n    this.personDetails = null;\n  }\n\n  /**\n   * Invoked on each update to perform rendering tasks. This method must return\n   * a lit-html TemplateResult. Setting properties inside this method will *not*\n   * trigger the element to update.\n   */\n  protected render() {\n    return this.isCompact ? this.renderCompactView() : this.renderFullView();\n  }\n\n  /**\n   * Render a spinner while the component loads state\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof BasePersonCardSection\n   */\n  protected renderLoading = (): TemplateResult => {\n    return mgtHtml`\n      <div class=\"loading\">\n        <mgt-spinner></mgt-spinner>\n      </div>\n    `;\n  };\n\n  /**\n   * Render the section in a empty data state\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtPersonCardContact\n   */\n  protected renderNoData(): TemplateResult {\n    return html`\n      <div class=\"no-data\">No data</div>\n    `;\n  }\n\n  /**\n   * Render the compact view\n   *\n   * @protected\n   * @abstract\n   * @returns {TemplateResult}\n   * @memberof BasePersonCardSection\n   */\n  protected abstract renderCompactView(): TemplateResult;\n\n  /**\n   * Render the full view\n   *\n   * @protected\n   * @abstract\n   * @returns {TemplateResult}\n   * @memberof BasePersonCardSection\n   */\n  protected abstract renderFullView(): TemplateResult;\n\n  /**\n   * Navigate the card to a different user.\n   *\n   * @protected\n   * @memberof BasePersonCardSection\n   */\n  protected navigateCard(person: IDynamicPerson): void {\n    // Search for card parent and update it's personDetails object\n    let parent: ParentNode = this.parentNode;\n    while (parent) {\n      parent = parent.parentNode;\n\n      const shadowRoot = parent as ShadowRoot;\n      if (shadowRoot?.host?.tagName === `${customElementHelper.prefix}-PERSON-CARD`.toUpperCase()) {\n        parent = shadowRoot.host;\n        break;\n      }\n    }\n\n    const personCard = parent as MgtPersonCard;\n    personCard.navigate(person);\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nexport const strings = {\n  contactSectionTitle: 'Contact',\n  emailTitle: 'Email',\n  chatTitle: 'Teams',\n  businessPhoneTitle: 'Business Phone',\n  cellPhoneTitle: 'Mobile Phone',\n  departmentTitle: 'Department',\n  personTitle: 'Title',\n  officeLocationTitle: 'Office Location',\n  copyToClipboardButton: 'Copy to clipboard'\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { User } from '@microsoft/microsoft-graph-types';\nimport { html, TemplateResult } from 'lit';\nimport { TeamsHelper } from '@microsoft/mgt-element';\nimport { classMap } from 'lit/directives/class-map.js';\n\nimport { getEmailFromGraphEntity } from '../../graph/graph.people';\nimport { BasePersonCardSection } from '../BasePersonCardSection';\nimport { styles } from './mgt-contact-css';\nimport { getSvg, SvgIcon } from '../../utils/SvgHelper';\nimport { strings } from './strings';\nimport { registerComponent } from '@microsoft/mgt-element';\n\n/**\n * Represents a contact part and its metadata\n *\n * @interface IContactPart\n */\ninterface IContactPart {\n  icon: TemplateResult;\n  title: string;\n  value?: string;\n  onClick?: (e: Event) => void;\n  showCompact: boolean;\n}\n\ntype Protocol = 'mailto:' | 'tel:';\n\nexport const registerMgtContactComponent = () => {\n  registerComponent('contact', MgtContact);\n};\n\n/**\n * The contact details subsection of the person card\n *\n * @export\n * @class MgtContact\n * @extends {MgtTemplatedComponent}\n */\nexport class MgtContact extends BasePersonCardSection {\n  /**\n   * Array of styles to apply to the element. The styles should be defined\n   * using the `css` tag function.\n   */\n  static get styles() {\n    return styles;\n  }\n\n  protected get strings() {\n    return strings;\n  }\n\n  /**\n   * Returns true if the component has data it can render\n   *\n   * @readonly\n   * @abstract\n   * @type {boolean}\n   * @memberof BasePersonCardSection\n   */\n  public get hasData(): boolean {\n    if (!this._contactParts) {\n      return false;\n    }\n\n    const availableParts: IContactPart[] = Object.values(this._contactParts).filter((p: IContactPart) => !!p.value);\n\n    return !!availableParts.length;\n  }\n\n  private readonly _person?: User;\n\n  private readonly _contactParts: Record<string, IContactPart> = {\n    email: {\n      icon: getSvg(SvgIcon.Email),\n      onClick: () => this.sendEmail(getEmailFromGraphEntity(this._person)),\n      showCompact: true,\n      title: this.strings.emailTitle\n    },\n    chat: {\n      icon: getSvg(SvgIcon.Chat),\n      onClick: () => this.sendChat(this._person?.userPrincipalName),\n      showCompact: false,\n      title: this.strings.chatTitle\n    },\n    businessPhone: {\n      icon: getSvg(SvgIcon.Phone),\n      onClick: () => this.sendCall(this._person?.businessPhones?.length > 0 ? this._person.businessPhones[0] : null),\n      showCompact: true,\n      title: this.strings.businessPhoneTitle\n    },\n    cellPhone: {\n      icon: getSvg(SvgIcon.CellPhone),\n      onClick: () => this.sendCall(this._person?.mobilePhone),\n      showCompact: true,\n      title: this.strings.cellPhoneTitle\n    },\n    department: {\n      icon: getSvg(SvgIcon.Department),\n      showCompact: false,\n      title: this.strings.departmentTitle\n    },\n    title: {\n      icon: getSvg(SvgIcon.Person),\n      showCompact: false,\n      title: this.strings.personTitle\n    },\n    officeLocation: {\n      icon: getSvg(SvgIcon.OfficeLocation),\n      showCompact: true,\n      title: this.strings.officeLocationTitle\n    }\n  };\n\n  public constructor(person: User) {\n    super();\n    this._person = person;\n\n    this._contactParts.email.value = getEmailFromGraphEntity(this._person);\n    this._contactParts.chat.value = this._person.userPrincipalName;\n    this._contactParts.cellPhone.value = this._person.mobilePhone;\n    this._contactParts.department.value = this._person.department;\n    this._contactParts.title.value = this._person.jobTitle;\n    this._contactParts.officeLocation.value = this._person.officeLocation;\n\n    if (this._person.businessPhones?.length) {\n      this._contactParts.businessPhone.value = this._person.businessPhones[0];\n    }\n  }\n\n  /**\n   * The name for display in the overview section.\n   *\n   * @readonly\n   * @type {string}\n   * @memberof MgtContact\n   */\n  public get displayName(): string {\n    return this.strings.contactSectionTitle;\n  }\n\n  /**\n   * The title for display when rendered as a full card.\n   *\n   * @readonly\n   * @type {string}\n   * @memberof MgtContact\n   */\n  public get cardTitle(): string {\n    return this.strings.contactSectionTitle;\n  }\n\n  // Defines the skeleton for what contact fields are available and what they do.\n\n  /**\n   * Render the icon for display in the navigation ribbon.\n   *\n   * @returns {TemplateResult}\n   * @memberof MgtContact\n   */\n  public renderIcon(): TemplateResult {\n    return getSvg(SvgIcon.Contact);\n  }\n\n  /**\n   * Reset any state in the section\n   *\n   * @protected\n   * @memberof MgtContact\n   */\n  public clearState() {\n    super.clearState();\n    for (const key of Object.keys(this._contactParts)) {\n      this._contactParts[key].value = null;\n    }\n  }\n\n  /**\n   * Render the compact view\n   *\n   * @returns {TemplateResult}\n   * @memberof MgtContact\n   */\n  protected renderCompactView(): TemplateResult {\n    if (!this.hasData) {\n      return null;\n    }\n\n    const availableParts: IContactPart[] = Object.values(this._contactParts).filter((p: IContactPart) => !!p.value);\n\n    // Filter for compact mode parts with values\n    let compactParts: IContactPart[] = Object.values(availableParts).filter(\n      (p: IContactPart) => !!p.value && p.showCompact\n    );\n\n    if (!compactParts?.length) {\n      compactParts = Object.values(availableParts).slice(0, 2);\n    }\n\n    const contentTemplate = html`\n      ${compactParts.map(p => this.renderContactPart(p))}\n    `;\n\n    return html`\n      <div class=\"root compact\" dir=${this.direction}>\n        ${contentTemplate}\n      </div>\n    `;\n  }\n\n  /**\n   * Render the full view\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtContact\n   */\n  protected renderFullView(): TemplateResult {\n    let contentTemplate: TemplateResult;\n\n    if (this.hasData) {\n      // Filter for parts with values only\n      const availableParts: IContactPart[] = Object.values(this._contactParts).filter((p: IContactPart) => !!p.value);\n      contentTemplate = html`\n        ${availableParts.map(part => this.renderContactPart(part))}\n      `;\n    }\n\n    return html`\n      <div class=\"root\" dir=${this.direction}>\n        ${contentTemplate}\n      </div>\n    `;\n  }\n\n  /**\n   * Render a specific contact part\n   *\n   * @protected\n   * @param {IContactPart} part\n   * @returns {TemplateResult}\n   * @memberof MgtContact\n   */\n  protected renderContactPart(part: IContactPart): TemplateResult {\n    let isPhone = false;\n\n    if (part.title === 'Mobile Phone' || part.title === 'Business Phone') {\n      isPhone = true;\n    }\n\n    const partLinkClasses = {\n      part__link: true,\n      phone: isPhone\n    };\n\n    const valueTemplate = part.onClick\n      ? html`\n          <span class=${classMap(partLinkClasses)} @click=${(e: Event) => part.onClick(e)}>${part.value}</span>\n        `\n      : html`\n          ${part.value}\n        `;\n\n    return html`\n      <div class=\"part\" role=\"button\" @click=${(e: MouseEvent) => this.handlePartClick(e, part.value)} tabindex=\"0\">\n        <div class=\"part__icon\" aria-label=${part.title} title=${part.title}>${part.icon}</div>\n        <div class=\"part__details\">\n          <div class=\"part__title\">${part.title}</div>\n          <div class=\"part__value\" title=${part.title}>${valueTemplate}</div>\n        </div>\n        <div\n          class=\"part__copy\"\n          aria-label=${this.strings.copyToClipboardButton}\n          title=${this.strings.copyToClipboardButton}\n        >\n          ${getSvg(SvgIcon.Copy)}\n        </div>\n      </div>\n    `;\n  }\n\n  /**\n   * Handle the click event for contact parts\n   *\n   * @protected\n   * @memberof MgtContact\n   */\n  protected handlePartClick(e: MouseEvent, value: string): void {\n    if (value) {\n      void navigator.clipboard.writeText(value);\n    }\n  }\n\n  private sendLink(protocol: Protocol, resource: string): void {\n    if (resource) {\n      window.open(`${protocol}${resource}`, '_blank', 'noreferrer');\n    } else {\n      // eslint-disable-next-line no-console\n      console.error(`: Target resource for ${protocol} link was not provided: resource: ${resource}`);\n    }\n  }\n\n  /**\n   * Send a chat message to the user\n   *\n   * @protected\n   * @memberof MgtContact\n   */\n  protected sendChat(upn: string): void {\n    if (!upn) {\n      // eslint-disable-next-line no-console\n      console.error(\": Can't send chat when upn is not provided\");\n      return;\n    }\n\n    const url = `https://teams.microsoft.com/l/chat/0/0?users=${upn}`;\n    const openWindow = () => window.open(url, '_blank', 'noreferrer');\n\n    if (TeamsHelper.isAvailable) {\n      TeamsHelper.executeDeepLink(url, (status: boolean) => {\n        if (!status) {\n          openWindow();\n        }\n      });\n    } else {\n      openWindow();\n    }\n  }\n\n  /**\n   * Send an email to the user\n   *\n   * @protected\n   * @memberof MgtContact\n   */\n  protected sendEmail(email: string): void {\n    this.sendLink('mailto:', email);\n  }\n\n  /**\n   * Send a call to the user\n   *\n   * @protected\n   * @memberof MgtContact\n   */\n  protected sendCall = (phone: string): void => {\n    this.sendLink('tel:', phone);\n  };\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nexport const strings = {\n  emailsSectionTitle: 'Emails'\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { Message } from '@microsoft/microsoft-graph-types';\nimport { html, TemplateResult } from 'lit';\n\nimport { BasePersonCardSection } from '../BasePersonCardSection';\nimport { getSvg, SvgIcon } from '../../utils/SvgHelper';\nimport { getRelativeDisplayDate } from '../../utils/Utils';\nimport { styles } from './mgt-messages-css';\nimport { strings } from './strings';\nimport { registerComponent } from '@microsoft/mgt-element';\nimport { state } from 'lit/decorators.js';\n\nexport const registerMgtMessagesComponent = () => registerComponent('messages', MgtMessages);\n\n/**\n * The email messages subsection of the person card\n *\n * @export\n * @class MgtMessages\n * @extends {MgtTemplatedComponent}\n */\nexport class MgtMessages extends BasePersonCardSection {\n  /**\n   * Array of styles to apply to the element. The styles should be defined\n   * using the `css` tag function.\n   */\n  static get styles() {\n    return styles;\n  }\n\n  protected get strings() {\n    return strings;\n  }\n\n  @state()\n  private _messages: Message[];\n\n  public constructor(messages: Message[]) {\n    super();\n    this._messages = messages;\n  }\n\n  /**\n   * The name for display in the overview section.\n   *\n   * @readonly\n   * @type {string}\n   * @memberof MgtMessages\n   */\n  public get displayName(): string {\n    return this.strings.emailsSectionTitle;\n  }\n\n  /**\n   * The title for display when rendered as a full card.\n   *\n   * @readonly\n   * @type {string}\n   * @memberof MgtOrganization\n   */\n  public get cardTitle(): string {\n    return this.strings.emailsSectionTitle;\n  }\n\n  /**\n   * Reset any state in the section\n   *\n   * @protected\n   * @memberof MgtMessages\n   */\n  public clearState(): void {\n    super.clearState();\n    this._messages = [];\n  }\n\n  /**\n   * Render the icon for display in the navigation ribbon.\n   *\n   * @returns {TemplateResult}\n   * @memberof MgtMessages\n   */\n  public renderIcon(): TemplateResult {\n    return getSvg(SvgIcon.Messages);\n  }\n\n  /**\n   * Render the compact view\n   *\n   * @returns {TemplateResult}\n   * @memberof MgtMessages\n   */\n  public renderCompactView(): TemplateResult {\n    let contentTemplate: TemplateResult;\n\n    if (!this._messages?.length) {\n      contentTemplate = this.renderNoData();\n    } else {\n      const messageTemplates = this._messages\n        ? this._messages.slice(0, 3).map(message => this.renderMessage(message))\n        : [];\n      contentTemplate = html`\n         ${messageTemplates}\n       `;\n    }\n\n    return html`\n       <div class=\"root compact\">\n         ${contentTemplate}\n       </div>\n     `;\n  }\n\n  /**\n   * Render the full view\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtMessages\n   */\n  protected renderFullView(): TemplateResult {\n    let contentTemplate: TemplateResult;\n\n    if (!this._messages?.length) {\n      contentTemplate = this.renderNoData();\n    } else {\n      contentTemplate = html`\n         ${this._messages.slice(0, 5).map(message => this.renderMessage(message))}\n       `;\n    }\n\n    return html`\n       <div class=\"root\">\n         ${contentTemplate}\n       </div>\n     `;\n  }\n\n  /**\n   * Render a message item\n   *\n   * @protected\n   * @param {IMessage} message\n   * @returns {TemplateResult}\n   * @memberof MgtMessages\n   */\n  protected renderMessage(message: Message): TemplateResult {\n    return html`\n       <div class=\"message\" @click=${() => this.handleMessageClick(message)}>\n         <div class=\"message__detail\">\n           <div class=\"message__subject\">${message.subject}</div>\n           <div class=\"message__from\">${message.from.emailAddress.name}</div>\n           <div class=\"message__message\">${message.bodyPreview}</div>\n         </div>\n         <div class=\"message__date\">${getRelativeDisplayDate(new Date(message.receivedDateTime))}</div>\n       </div>\n     `;\n  }\n\n  private handleMessageClick(message: Message): void {\n    window.open(message.webLink, '_blank', 'noreferrer');\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nexport const strings = {\n  reportsToSectionTitle: 'Reports to',\n  directReportsSectionTitle: 'Direct reports',\n  organizationSectionTitle: 'Organization',\n  youWorkWithSubSectionTitle: 'You work with',\n  userWorksWithSubSectionTitle: 'works with'\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { User } from '@microsoft/microsoft-graph-types';\nimport { html, TemplateResult } from 'lit';\n\nimport { BasePersonCardSection } from '../BasePersonCardSection';\nimport { getSvg, SvgIcon } from '../../utils/SvgHelper';\nimport { MgtPersonCardState, UserWithManager } from '../mgt-person-card/mgt-person-card.types';\nimport { styles } from './mgt-organization-css';\nimport { strings } from './strings';\nimport { mgtHtml } from '@microsoft/mgt-element';\nimport { registerComponent } from '@microsoft/mgt-element';\nimport { registerMgtPersonComponent } from '../mgt-person/mgt-person';\nimport { state } from 'lit/decorators.js';\n\nexport const registerMgtOrganizationComponent = () => {\n  registerMgtPersonComponent();\n  registerComponent('organization', MgtOrganization);\n};\n\n/**\n * The member organization subsection of the person card\n *\n * @export\n * @class MgtOrganization\n * @extends {MgtTemplatedComponent}\n */\nexport class MgtOrganization extends BasePersonCardSection {\n  /**\n   * Array of styles to apply to the element. The styles should be defined\n   * using the `css` tag function.\n   */\n  static get styles() {\n    return styles;\n  }\n\n  /**\n   * returns component strings\n   *\n   * @readonly\n   * @protected\n   * @memberof MgtBaseComponent\n   */\n  protected get strings() {\n    return strings;\n  }\n\n  @state()\n  private _state?: MgtPersonCardState;\n  @state()\n  private _me?: User;\n\n  constructor(cardState: MgtPersonCardState, me: User) {\n    super();\n    this._state = cardState;\n    this._me = me;\n  }\n\n  /**\n   * Reset any state in the section\n   *\n   * @protected\n   * @memberof MgtPersonCardMessages\n   */\n  public clearState(): void {\n    super.clearState();\n    this._state = undefined;\n    this._me = undefined;\n  }\n\n  /**\n   * The name for display in the overview section.\n   *\n   * @readonly\n   * @type {string}\n   * @memberof MgtOrganization\n   */\n  public get displayName(): string {\n    const { person, directReports } = this._state;\n\n    if (!person.manager && directReports?.length) {\n      return `${this.strings.directReportsSectionTitle} (${directReports.length})`;\n    }\n\n    return this.strings.reportsToSectionTitle;\n  }\n\n  /**\n   * The title for display when rendered as a full card.\n   *\n   * @readonly\n   * @type {string}\n   * @memberof MgtOrganization\n   */\n  public get cardTitle(): string {\n    return this.strings.organizationSectionTitle;\n  }\n\n  /**\n   * Render the icon for display in the navigation ribbon.\n   *\n   * @returns {TemplateResult}\n   * @memberof MgtOrganization\n   */\n  public renderIcon(): TemplateResult {\n    return getSvg(SvgIcon.Organization);\n  }\n\n  /**\n   * Render the compact view\n   *\n   * @returns {TemplateResult}\n   * @memberof MgtOrganization\n   */\n  protected renderCompactView(): TemplateResult {\n    let contentTemplate: TemplateResult;\n\n    if (!this._state?.person) {\n      return null;\n    }\n\n    const { person, directReports } = this._state;\n\n    if (!person) {\n      return null;\n    } else if (person.manager) {\n      contentTemplate = this.renderCoworker(person.manager);\n    } else if (directReports?.length) {\n      contentTemplate = this.renderCompactDirectReports();\n    }\n\n    return html`\n        <div class=\"root compact\">\n          ${contentTemplate}\n        </div>\n      `;\n  }\n\n  /**\n   * Render the full view\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtOrganization\n   */\n  protected renderFullView(): TemplateResult {\n    let contentTemplate: TemplateResult;\n\n    if (!this._state?.person) {\n      return null;\n    }\n\n    const { person, directReports, people } = this._state;\n\n    if (!person && !directReports && !people) {\n      return null;\n    } else {\n      const managerTemplates = this.renderManagers();\n      const currentUserTemplate = this.renderCurrentUser();\n      const directReportsTemplate = this.renderDirectReports();\n      const coworkersTemplate = this.renderCoworkers();\n\n      contentTemplate = html`\n          ${managerTemplates} ${currentUserTemplate} ${directReportsTemplate} ${coworkersTemplate}\n        `;\n    }\n\n    return html`\n       <div class=\"root\" dir=${this.direction}>\n         ${contentTemplate}\n       </div>\n     `;\n  }\n\n  /**\n   * Render a manager org member\n   *\n   * @protected\n   * @param {User} person\n   * @returns {TemplateResult}\n   * @memberof MgtOrganization\n   */\n  protected renderManager(person: User): TemplateResult {\n    return mgtHtml`\n      <div\n        class=\"org-member\"\n        @keydown=${(e: KeyboardEvent) => {\n          if (e.code === 'Enter' || e.code === ' ') this.navigateCard(person);\n        }}\n        @click=${() => this.navigateCard(person)}\n      >\n        <div class=\"org-member__person\">\n          <mgt-person\n            class=\"org-member__person-image\"\n            .personDetails=${person}\n            .fetchImage=${true}\n            view=\"twolines\"\n            .showPresence=${true}\n          ></mgt-person>\n        </div>\n        <div tabindex=\"0\" class=\"org-member__more\">\n          ${getSvg(SvgIcon.ExpandRight)}\n        </div>\n      </div>\n      <div class=\"org-member__separator\"></div>\n     `;\n  }\n\n  /**\n   * Render a manager org member\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtOrganization\n   */\n  protected renderManagers(): TemplateResult[] {\n    const { person } = this._state;\n    if (!person?.manager) {\n      return null;\n    }\n\n    const managers: UserWithManager[] = [];\n    let currentManager = person;\n    while (currentManager.manager) {\n      managers.push(currentManager.manager);\n      currentManager = currentManager.manager;\n    }\n\n    if (!managers.length) {\n      return null;\n    }\n\n    return managers.reverse().map(manager => this.renderManager(manager));\n  }\n\n  /**\n   * Render a direct report\n   *\n   * @protected\n   * @param {User} person\n   * @returns {TemplateResult}\n   * @memberof MgtOrganization\n   */\n  protected renderDirectReports(): TemplateResult {\n    const { directReports } = this._state;\n    if (!directReports?.length) {\n      return null;\n    }\n\n    return html`\n      <div class=\"org-member__separator\"></div>\n      <div class=\"direct-report-list\">\n        ${directReports.map(\n          person => mgtHtml`\n            <div\n              class=\"org-member org-member--direct-report\"\n              @keydown=${(e: KeyboardEvent) => {\n                if (e.code === 'Enter' || e.code === ' ') this.navigateCard(person);\n              }}\n              @click=${() => this.navigateCard(person)}\n            >\n              <div class=\"org-member__person\">\n                <mgt-person\n                  class=\"org-member__person-image\"\n                  .personDetails=${person}\n                  .fetchImage=${true}\n                  .showPresence=${true}\n                  view=\"twolines\"\n                ></mgt-person>\n              </div>\n              <div tabindex=\"0\" class=\"org-member__more\">\n                ${getSvg(SvgIcon.ExpandRight)}\n              </div>\n            </div>\n          `\n        )}\n      </div>\n     `;\n  }\n\n  /**\n   * Render direct reports in compact view\n   *\n   * @protected\n   * @param {User} person\n   * @returns {TemplateResult}\n   * @memberof MgtOrganization\n   */\n  protected renderCompactDirectReports(): TemplateResult {\n    const { directReports } = this._state;\n\n    return html`\n      <div class=\"direct-report__compact\">\n        ${directReports.slice(0, 6).map(\n          person => mgtHtml`\n            <div\n              class=\"direct-report\"\n              @keydown=${(e: KeyboardEvent) => {\n                if (e.code === 'Enter' || e.code === ' ') this.navigateCard(person);\n              }}\n              @click=${() => this.navigateCard(person)}\n            >\n              <mgt-person\n                class=\"direct-report__person-image\"\n                .personDetails=${person}\n                .fetchImage=${true}\n                .showPresence=${true}\n                view=\"twolines\"\n              ></mgt-person>\n            </div>\n          `\n        )}\n      </div>\n    `;\n  }\n\n  /**\n   * Render the user/self member\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtOrganization\n   */\n  protected renderCurrentUser(): TemplateResult {\n    const { person } = this._state;\n    return mgtHtml`\n       <div class=\"org-member org-member--target\">\n         <div class=\"org-member__person\">\n           <mgt-person\n              class=\"org-member__person-image\"\n             .personDetails=${person}\n             .fetchImage=${true}\n             .showPresence=${true}\n             view=\"twolines\"\n           ></mgt-person>\n         </div>\n       </div>\n     `;\n  }\n\n  /**\n   * Render a coworker org member\n   *\n   * @protected\n   * @param {User} person\n   * @returns {TemplateResult}\n   * @memberof MgtOrganization\n   */\n  protected renderCoworker(person: User): TemplateResult {\n    return mgtHtml`\n      <div\n        class=\"coworker\"\n        @keydown=${(e: KeyboardEvent) => {\n          if (e.code === 'Enter' || e.code === ' ') this.navigateCard(person);\n        }}\n        @click=${() => this.navigateCard(person)}\n      >\n        <div class=\"coworker__person\">\n          <mgt-person\n            class=\"coworker__person-image\"\n            .personDetails=${person}\n            .fetchImage=${true}\n            .showPresence=${true}\n            view=\"twolines\"\n          ></mgt-person>\n        </div>\n      </div>\n    `;\n  }\n\n  /**\n   * Render a coworker org member\n   *\n   * @protected\n   * @param {User} person\n   * @returns {TemplateResult}\n   * @memberof MgtOrganization\n   */\n  protected renderCoworkers(): TemplateResult {\n    const { people } = this._state;\n    if (!people?.length) {\n      return null;\n    }\n\n    const subtitle =\n      this._me.id === this._state.person.id\n        ? this.strings.youWorkWithSubSectionTitle\n        : `${this._state.person.givenName} ${this.strings.userWorksWithSubSectionTitle}`;\n\n    return html`\n       <div class=\"divider\"></div>\n       <div class=\"subtitle\" tabindex=\"0\">${subtitle}</div>\n       <div>\n         ${people.slice(0, 6).map(person => this.renderCoworker(person))}\n       </div>\n     `;\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nexport const strings = {\n  SkillsAndExperienceSectionTitle: 'Skills & Experience',\n  AboutCompactSectionTitle: 'About',\n  SkillsSubSectionTitle: 'Skills',\n  LanguagesSubSectionTitle: 'Languages',\n  WorkExperienceSubSectionTitle: 'Work Experience',\n  EducationSubSectionTitle: 'Education',\n  professionalInterestsSubSectionTitle: 'Professional Interests',\n  personalInterestsSubSectionTitle: 'Personal Interests',\n  birthdaySubSectionTitle: 'Birthday',\n  currentYearSubtitle: 'Current',\n  socialMediaSubSectionTitle: 'Social Media'\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport {\n  EducationalActivity,\n  PersonAnnualEvent,\n  PersonInterest,\n  PhysicalAddress,\n  Profile\n} from '@microsoft/microsoft-graph-types-beta';\nimport { html, TemplateResult, nothing } from 'lit';\nimport { BasePersonCardSection } from '../BasePersonCardSection';\nimport { getSvg, SvgIcon } from '../../utils/SvgHelper';\nimport { styles } from './mgt-profile-css';\nimport { strings } from './strings';\nimport { registerComponent } from '@microsoft/mgt-element';\nimport { property } from 'lit/decorators.js';\n\nexport const registerMgtProfileComponent = () => registerComponent('profile', MgtProfile);\n\n/**\n * The user profile subsection of the person card\n *\n * @export\n * @class MgtProfile\n * @extends {MgtTemplatedComponent}\n *\n * @cssprop --token-overflow-color - {Color} Color of the text showing more undisplayed values i.e. +3 more\n */\nexport class MgtProfile extends BasePersonCardSection {\n  /**\n   * Array of styles to apply to the element. The styles should be defined\n   * using the `css` tag function.\n   */\n  static get styles() {\n    return styles;\n  }\n\n  protected get strings() {\n    return strings;\n  }\n\n  /**\n   * The name for display in the overview section.\n   *\n   * @readonly\n   * @type {string}\n   * @memberof MgtProfile\n   */\n  public get displayName(): string {\n    return this.strings.SkillsAndExperienceSectionTitle;\n  }\n\n  /**\n   * The title for display when rendered as a full card.\n   *\n   * @readonly\n   * @type {string}\n   * @memberof MgtOrganization\n   */\n  public get cardTitle(): string {\n    return this.strings.AboutCompactSectionTitle;\n  }\n\n  /**\n   * Returns true if the profile contains data\n   * that can be rendered\n   *\n   * @readonly\n   * @type {boolean}\n   * @memberof MgtProfile\n   */\n  public get hasData(): boolean {\n    if (!this.profile) {\n      return false;\n    }\n\n    const { languages, skills, positions, educationalActivities } = this.profile;\n\n    return (\n      [\n        this._birthdayAnniversary,\n        this._personalInterests?.length,\n        this._professionalInterests?.length,\n        languages?.length,\n        skills?.length,\n        positions?.length,\n        educationalActivities?.length\n      ].filter(v => !!v).length > 0\n    );\n  }\n\n  /**\n   * The user's profile metadata\n   *\n   * @protected\n   * @type {IProfile}\n   * @memberof MgtProfile\n   */\n  protected get profile(): Profile {\n    return this._profile;\n  }\n  @property({ attribute: false })\n  protected set profile(value: Profile) {\n    if (value === this._profile) {\n      return;\n    }\n\n    this._profile = value;\n    this._birthdayAnniversary = value?.anniversaries ? value.anniversaries.find(this.isBirthdayAnniversary) : null;\n    this._personalInterests = value?.interests ? value.interests.filter(this.isPersonalInterest) : null;\n    this._professionalInterests = value?.interests ? value.interests.filter(this.isProfessionalInterest) : null;\n  }\n\n  private _profile: Profile;\n  private _personalInterests: PersonInterest[];\n  private _professionalInterests: PersonInterest[];\n  private _birthdayAnniversary: PersonAnnualEvent;\n\n  constructor(profile: Profile) {\n    super();\n\n    this.profile = profile;\n  }\n\n  /**\n   * Render the icon for display in the navigation ribbon.\n   *\n   * @returns {TemplateResult}\n   * @memberof MgtProfile\n   */\n  public renderIcon(): TemplateResult {\n    return getSvg(SvgIcon.Profile);\n  }\n\n  /**\n   * Reset any state in the section\n   *\n   * @protected\n   * @memberof MgtProfile\n   */\n  public clearState(): void {\n    super.clearState();\n    this.profile = null;\n  }\n\n  /**\n   * Render the compact view\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtProfile\n   */\n  protected renderCompactView(): TemplateResult {\n    return html`\n       <div class=\"root compact\" dir=${this.direction}>\n         ${this.renderSubSections().slice(0, 2)}\n       </div>\n     `;\n  }\n\n  /**\n   * Render the full view\n   *\n   * @protected\n   * @returns\n   * @memberof MgtProfile\n   */\n  protected renderFullView() {\n    this.initPostRenderOperations();\n\n    return html`\n       <div class=\"root\" dir=${this.direction}>\n         ${this.renderSubSections()}\n       </div>\n     `;\n  }\n\n  /**\n   * Renders all subSections of the profile\n   * Defines order of how they render\n   *\n   * @protected\n   * @return {*}\n   * @memberof MgtProfile\n   */\n  protected renderSubSections() {\n    const subSections = [\n      this.renderSkills(),\n      this.renderBirthday(),\n      this.renderLanguages(),\n      this.renderWorkExperience(),\n      this.renderEducation(),\n      this.renderProfessionalInterests(),\n      this.renderPersonalInterests()\n    ];\n\n    return subSections.filter(s => !!s);\n  }\n\n  /**\n   * Render the user's known languages\n   *\n   * @protected\n   * @returns\n   * @memberof MgtProfile\n   */\n  protected renderLanguages(): TemplateResult {\n    const { languages } = this._profile;\n    if (!languages?.length) {\n      return null;\n    }\n\n    const languageItems: TemplateResult[] = [];\n    for (const language of languages) {\n      let proficiency = null;\n      if (language.proficiency?.length) {\n        proficiency = html`\n           <span class=\"language__proficiency\" tabindex=\"0\">\n             &nbsp;(${language.proficiency})\n           </span>\n         `;\n      }\n\n      languageItems.push(html`\n         <div class=\"token-list__item language\">\n           <span class=\"language__title\" tabindex=\"0\">${language.displayName}</span>\n           ${proficiency}\n         </div>\n       `);\n    }\n\n    const languageTitle = languageItems.length ? this.strings.LanguagesSubSectionTitle : '';\n\n    return html`\n       <section>\n         <div class=\"section__title\" tabindex=\"0\">${languageTitle}</div>\n         <div class=\"section__content\">\n           <div class=\"token-list\">\n             ${languageItems}\n           </div>\n         </div>\n       </section>\n     `;\n  }\n\n  /**\n   * Render the user's skills\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtProfile\n   */\n  protected renderSkills(): TemplateResult {\n    const { skills } = this._profile;\n\n    if (!skills?.length) {\n      return null;\n    }\n\n    const skillItems: TemplateResult[] = [];\n    for (const skill of skills) {\n      skillItems.push(html`\n         <div class=\"token-list__item skill\" tabindex=\"0\">\n           ${skill.displayName}\n         </div>\n       `);\n    }\n\n    const skillsTitle = skillItems.length ? this.strings.SkillsSubSectionTitle : '';\n\n    return html`\n       <section>\n         <div class=\"section__title\" tabindex=\"0\">${skillsTitle}</div>\n         <div class=\"section__content\">\n           <div class=\"token-list\">\n             ${skillItems}\n           </div>\n         </div>\n       </section>\n     `;\n  }\n\n  /**\n   * Render the user's work experience timeline\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtProfile\n   */\n  protected renderWorkExperience(): TemplateResult {\n    const { positions } = this._profile;\n\n    if (!positions?.length) {\n      return null;\n    }\n\n    const positionItems: TemplateResult[] = [];\n    for (const position of this._profile.positions) {\n      if (position.detail.description || position.detail.jobTitle !== '') {\n        positionItems.push(html`\n           <div class=\"data-list__item work-position\">\n             <div class=\"data-list__item__header\">\n               <div class=\"data-list__item__title\" tabindex=\"0\">${position.detail?.jobTitle}</div>\n               <div class=\"data-list__item__date-range\" tabindex=\"0\">\n                 ${this.getDisplayDateRange(position.detail)}\n               </div>\n             </div>\n             <div class=\"data-list__item__content\">\n               <div class=\"work-position__company\" tabindex=\"0\">\n                 ${position?.detail?.company?.displayName}\n               </div>\n               <div class=\"work-position__location\" tabindex=\"0\">\n                 ${this.displayLocation(position?.detail?.company?.address)}\n               </div>\n             </div>\n           </div>\n         `);\n      }\n    }\n    const workExperienceTitle = positionItems.length ? this.strings.WorkExperienceSubSectionTitle : '';\n\n    return html`\n       <section>\n         <div class=\"section__title\" tabindex=\"0\">${workExperienceTitle}</div>\n         <div class=\"section__content\">\n           <div class=\"data-list\">\n             ${positionItems}\n           </div>\n         </div>\n       </section>\n     `;\n  }\n\n  /**\n   * Render the user's education timeline\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtProfile\n   */\n  protected renderEducation(): TemplateResult {\n    const { educationalActivities } = this._profile;\n\n    if (!educationalActivities?.length) {\n      return null;\n    }\n\n    const positionItems: TemplateResult[] = [];\n    for (const educationalActivity of educationalActivities) {\n      positionItems.push(html`\n         <div class=\"data-list__item educational-activity\">\n           <div class=\"data-list__item__header\">\n             <div class=\"data-list__item__title\" tabindex=\"0\">${educationalActivity.institution.displayName}</div>\n             <div class=\"data-list__item__date-range\" tabindex=\"0\">\n               ${this.getDisplayDateRange(educationalActivity)}\n             </div>\n           </div>\n           ${\n             educationalActivity.program.displayName\n               ? html`<div class=\"data-list__item__content\">\n                  <div class=\"educational-activity__degree\" tabindex=\"0\">\n                  ${educationalActivity.program.displayName}\n                </div>`\n               : nothing\n           }\n         </div>\n       `);\n    }\n\n    const educationTitle = positionItems.length ? this.strings.EducationSubSectionTitle : '';\n\n    return html`\n       <section>\n         <div class=\"section__title\" tabindex=\"0\">${educationTitle}</div>\n         <div class=\"section__content\">\n           <div class=\"data-list\">\n             ${positionItems}\n           </div>\n         </div>\n       </section>\n     `;\n  }\n\n  /**\n   * Render the user's professional interests\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtProfile\n   */\n  protected renderProfessionalInterests(): TemplateResult {\n    if (!this._professionalInterests?.length) {\n      return null;\n    }\n\n    const interestItems: TemplateResult[] = [];\n    for (const interest of this._professionalInterests) {\n      interestItems.push(html`\n         <div class=\"token-list__item interest interest--professional\" tabindex=\"0\">\n           ${interest.displayName}\n         </div>\n       `);\n    }\n\n    const professionalInterests = interestItems.length ? this.strings.professionalInterestsSubSectionTitle : '';\n\n    return html`\n       <section>\n         <div class=\"section__title\" tabindex=\"0\">${professionalInterests}</div>\n         <div class=\"section__content\">\n           <div class=\"token-list\">\n             ${interestItems}\n           </div>\n         </div>\n       </section>\n     `;\n  }\n\n  /**\n   * Render the user's personal interests\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtProfile\n   */\n  protected renderPersonalInterests(): TemplateResult {\n    if (!this._personalInterests?.length) {\n      return null;\n    }\n\n    const interestItems: TemplateResult[] = [];\n    for (const interest of this._personalInterests) {\n      interestItems.push(html`\n         <div class=\"token-list__item interest interest--personal\" tabindex=\"0\">\n           ${interest.displayName}\n         </div>\n       `);\n    }\n\n    const personalInterests = interestItems.length ? this.strings.personalInterestsSubSectionTitle : '';\n\n    return html`\n       <section>\n         <div class=\"section__title\" tabindex=\"0\">${personalInterests}</div>\n         <div class=\"section__content\">\n           <div class=\"token-list\">\n             ${interestItems}\n           </div>\n         </div>\n       </section>\n     `;\n  }\n\n  /**\n   * Render the user's birthday\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtProfile\n   */\n  protected renderBirthday(): TemplateResult {\n    if (!this._birthdayAnniversary?.date) {\n      return null;\n    }\n\n    return html`\n       <section>\n         <div class=\"section__title\" tabindex=\"0\">Birthday</div>\n         <div class=\"section__content\">\n           <div class=\"birthday\">\n             <div class=\"birthday__icon\">\n               ${getSvg(SvgIcon.Birthday)}\n             </div>\n             <div class=\"birthday__date\" tabindex=\"0\">\n               ${this.getDisplayDate(new Date(this._birthdayAnniversary.date))}\n             </div>\n           </div>\n         </div>\n       </section>\n     `;\n  }\n\n  private readonly isPersonalInterest = (interest: PersonInterest): boolean => {\n    return interest.categories?.includes('personal');\n  };\n\n  private readonly isProfessionalInterest = (interest: PersonInterest): boolean => {\n    return interest.categories?.includes('professional');\n  };\n\n  private readonly isBirthdayAnniversary = (anniversary: PersonAnnualEvent): boolean => {\n    return anniversary.type === 'birthday';\n  };\n\n  private getDisplayDate(date: Date): string {\n    return date.toLocaleString('default', {\n      day: 'numeric',\n      month: 'long'\n    });\n  }\n\n  private getDisplayDateRange(event: EducationalActivity): string | symbol {\n    // if startMonthYear is not defined, we do not show the date range (otherwise it will always start with 1970)\n    if (!event.startMonthYear) {\n      return nothing;\n    }\n\n    const start = new Date(event.startMonthYear).getFullYear();\n    // if the start year is 0 or 1 - it's probably an error or a strange \"undefined\"-value\n    if (start === 0 || start === 1) {\n      return nothing;\n    }\n\n    const end = event.endMonthYear ? new Date(event.endMonthYear).getFullYear() : this.strings.currentYearSubtitle;\n    return `${start}  ${end}`;\n  }\n\n  private displayLocation(address: PhysicalAddress | undefined): string | symbol {\n    if (address?.city) {\n      if (address.state) {\n        return `${address.city}, ${address.state}`;\n      }\n      return address.city;\n    }\n    return nothing;\n  }\n\n  private initPostRenderOperations(): void {\n    setTimeout(() => {\n      try {\n        const sections = this.shadowRoot.querySelectorAll('section');\n        sections.forEach(section => {\n          // Perform post render operations per section\n          this.handleTokenOverflow(section);\n        });\n      } catch {\n        // An exception may occur if the component is suddenly removed during post render operations.\n      }\n    }, 0);\n  }\n\n  private handleTokenOverflow(section: HTMLElement): void {\n    const tokenLists = section.querySelectorAll('.token-list');\n    if (!tokenLists?.length) {\n      return;\n    }\n\n    for (const tokenList of Array.from(tokenLists)) {\n      const items = tokenList.querySelectorAll('.token-list__item');\n      if (!items?.length) {\n        continue;\n      }\n\n      let overflowItems: Element[] = null;\n      let itemRect = items[0].getBoundingClientRect();\n      const tokenListRect = tokenList.getBoundingClientRect();\n      const maxtop = itemRect.height * 2 + tokenListRect.top;\n\n      // Use (items.length - 1) to prevent [+1 more] from appearing.\n      for (let i = 0; i < items.length - 1; i++) {\n        itemRect = items[i].getBoundingClientRect();\n        if (itemRect.top > maxtop) {\n          overflowItems = Array.from(items).slice(i, items.length);\n          break;\n        }\n      }\n\n      if (overflowItems) {\n        overflowItems.forEach(i => i.classList.add('overflow'));\n\n        const overflowToken = document.createElement('div');\n        overflowToken.classList.add('token-list__item');\n        overflowToken.classList.add('token-list__item--show-overflow');\n        overflowToken.tabIndex = 0;\n        overflowToken.innerText = `+ ${overflowItems.length} more`;\n\n        // On click or enter(accessibility), remove [+n more] token and reveal the hidden overflow tokens.\n        const revealOverflow = () => {\n          overflowToken.remove();\n          overflowItems.forEach(i => i.classList.remove('overflow'));\n        };\n        overflowToken.addEventListener('click', () => {\n          revealOverflow();\n        });\n        overflowToken.addEventListener('keydown', (e: KeyboardEvent) => {\n          if (e.code === 'Enter') {\n            revealOverflow();\n          }\n        });\n        tokenList.appendChild(overflowToken);\n      }\n    }\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { html, nothing, TemplateResult } from 'lit';\nimport { property, state } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport {\n  MgtTemplatedTaskComponent,\n  Providers,\n  ProviderState,\n  TeamsHelper,\n  mgtHtml,\n  customElementHelper\n} from '@microsoft/mgt-element';\nimport { IGraph } from '@microsoft/mgt-element';\nimport { Presence, User, Person } from '@microsoft/microsoft-graph-types';\n\nimport { findPeople, getEmailFromGraphEntity } from '../../graph/graph.people';\nimport { IDynamicPerson } from '../../graph/types';\nimport { getPersonImage } from '../../graph/graph.photos';\nimport { getUserWithPhoto } from '../../graph/graph.userWithPhoto';\nimport { getSvg, SvgIcon } from '../../utils/SvgHelper';\nimport { getUserPresence } from '../../graph/graph.presence';\nimport { getPersonCardGraphData, createChat, sendMessage } from './mgt-person-card.graph';\nimport { MgtPerson, registerMgtPersonComponent } from '../mgt-person/mgt-person';\nimport { styles } from './mgt-person-card-css';\nimport { MgtContact, registerMgtContactComponent } from '../mgt-contact/mgt-contact';\nimport { MgtFileList, registerMgtFileListComponent } from '../mgt-file-list/mgt-file-list';\nimport { MgtMessages, registerMgtMessagesComponent } from '../mgt-messages/mgt-messages';\nimport { MgtOrganization, registerMgtOrganizationComponent } from '../mgt-organization/mgt-organization';\nimport { MgtProfile, registerMgtProfileComponent } from '../mgt-profile/mgt-profile';\nimport { MgtPersonCardState } from './mgt-person-card.types';\nimport { MgtPersonCardConfig } from './MgtPersonCardConfig';\nimport { getMgtPersonCardScopes } from './getMgtPersonCardScopes';\nimport { strings } from './strings';\nimport { isUser } from '../../graph/entityType';\n\nimport '../sub-components/mgt-spinner/mgt-spinner';\n\nexport * from './mgt-person-card.types';\n\nimport {\n  fluentTabs,\n  fluentTab,\n  fluentTabPanel,\n  fluentButton,\n  fluentTextField,\n  fluentCard\n} from '@fluentui/web-components';\nimport { registerFluentComponents } from '../../utils/FluentComponents';\nimport { BasePersonCardSection, CardSection } from '../BasePersonCardSection';\nimport { buildComponentName, registerComponent } from '@microsoft/mgt-element';\nimport { registerMgtSpinnerComponent } from '../sub-components/mgt-spinner/mgt-spinner';\nimport { IHistoryClearer, IExpandable } from './types';\n\ninterface MgtPersonCardStateHistory {\n  state: MgtPersonCardState;\n  personDetails: IDynamicPerson;\n  personImage: string;\n}\n\nexport const registerMgtPersonCardComponent = () => {\n  registerFluentComponents(fluentCard, fluentTabs, fluentTab, fluentTabPanel, fluentButton, fluentTextField);\n  // register self first to avoid infinite loop due to circular ref between person and person card and organization\n  registerComponent('person-card', MgtPersonCard);\n\n  registerMgtSpinnerComponent();\n  // these components newed up rather than created declaratively\n  registerMgtContactComponent();\n  registerMgtOrganizationComponent();\n  registerMgtMessagesComponent();\n  registerMgtFileListComponent();\n  registerMgtProfileComponent();\n  // only register person if not already registered\n  if (!customElements.get(buildComponentName('person'))) registerMgtPersonComponent();\n};\n\n/**\n * Web Component used to show detailed data for a person in the Microsoft Graph\n *\n * @export\n * @class MgtPersonCard\n * @extends {MgtTemplatedComponent}\n *\n * @fires {CustomEvent<null>} expanded - Fired when expanded details section is opened\n *\n * @cssprop --person-card-line1-font-size - {Length} Font size of line 1\n * @cssprop --person-card-line1-font-weight - {FontWeight} Font weight of line 1\n * @cssprop --person-card-line1-line-height - {Length} Line height of line 1\n * @cssprop --person-card-line2-font-size - {Length} Font size of line 2\n * @cssprop --person-card-line2-font-weight - {FontWeight} Font weight of line 2\n * @cssprop --person-card-line2-line-height - {Length} Line height of line 2\n * @cssprop --person-card-line3-font-size - {Length} Font size of line 3\n * @cssprop --person-card-line3-font-weight - {FontWeight} Font weight of line 3\n * @cssprop --person-card-line3-line-height - {Length} Line height of line 3\n * @cssprop --person-card-avatar-size - {Length} Width and height of the avatar. Default is 75px\n * @cssprop --person-card-details-left-spacing - {Length} The space between the avatar and the person details. Default is 15px\n * @cssprop --person-card-avatar-top-spacing - {Length} The margin top of the avatar in person-card component\n * @cssprop --person-card-details-bottom-spacing - {Length} The margin bottom of the person details in person-card component\n * @cssprop --person-card-base-icons-left-spacing - {Length} The margin-inline-start of the base-icons in person-card component\n * @cssprop --person-card-background-color - {Color} The color of the person-card-component\n * @cssprop --person-card-expanded-background-color-hover - {Color} The hover color of the expanded details button of the person card component\n * @cssprop --person-card-nav-back-arrow-hover-color - {Color} The hover color of the back arrow of the person card component\n * @cssprop --person-card-icon-color - {Color} The color of the icons in the person card component\n * @cssprop --person-card-icon-hover-color - {Color} The hover color of the icons in the person card component\n * @cssprop --person-card-show-more-color - {Color} The color of the show more text in the person card component\n * @cssprop --person-card-show-more-hover-color - {Color} The hover color of the show more text in person card component\n * @cssprop --person-card-fluent-background-color - {Color} The background color of the fluent buttons in person card component\n * @cssprop --person-card-line1-text-color - {Color} The color of line 1 in person card\n * @cssprop --person-card-line2-text-color - {Color} The color of line 2 in person card\n * @cssprop --person-card-line3-text-color - {Color} The color of line 3 in person card\n * @cssprop --person-card-fluent-background-color-hover - {Color} The hover background color of the fluent buttons in person card component\n * @cssprop --person-card-chat-input-hover-color - {Color} The chat input hover color\n * @cssprop --person-card-chat-input-focus-color - {Color} The chat input focus color\n * @cssprop --contact-title-color - {Color} The color of the contact title in the contact section of the person card component\n * @cssprop --contact-value-color - {Color} The color of the contact value in the contact section of the person card component\n * @cssprop --contact-link-color - {Color} The color of the contact link in the contact section of the person card component\n * @cssprop --contact-link-hover-color - {Color} The hover color of the contact link in the contact section of the person card component\n * @cssprop --contact-background-color - {Color} The background color of the contact section in person card component\n * @cssprop --contact-copy-icon-color - {Color} The color of the copy icon in the contact section of the person card component\n * @cssprop --message-subject-font-size - {Length} The font size of the message subject in the message section of the person card component\n * @cssprop --message-subject-font-weight - {FontWeight} The font weight of the message subject in the message section of the person card component\n * @cssprop --message-subject-line-height - {Length} The line height of the message subject in the message section of the person card component\n * @cssprop --message-from-font-size - {Length} The font size of the message sender in the message section of the person card component\n * @cssprop --message-from-font-weight - {FontWeight} The font weight of the message sender in the message section of the person card component\n * @cssprop --message-subject-color - {Color} The color of the message subject in the message section of the person card component\n * @cssprop --message-from-color - {Color} The color of the message sender in the message section of the person card component\n * @cssprop --message-color - {Color} The color of the message in the message section of the person card component\n * @cssprop --message-hover-color - {Color} The hover color of the message section of the person card component\n * @cssprop --message-date-color - {Color} The color of the message date in the message section of the person card component\n * @cssprop --message-from-line-height - {Length} The line height of the message sender in the message section of the person card component\n * @cssprop --profile-background-color - {Color} The background color of the profile section in the person card component\n * @cssprop --profile-title-color - {Color} The color of the profile title in the profile section of the person card component\n * @cssprop --profile-section-title-color - {Color} The color of the profile section title in the profile section of the person card component\n * @cssprop --profile-token-item-color - {Color} The color of the profile token item in the profile section of the person card component\n * @cssprop --profile-token-item-background-color - {Color} The background color of the profile token item in the profile section of the person card component\n * @cssprop --profile-token-overflow-color - {Color} The color of the profile token overflow in the profile section of the person card component\n * @cssprop --organization-active-org-member-border-color - {Color} The border color of the active organization member in the organization section of the person card component\n * @cssprop --organization-active-org-member-target-background-color - {Color} The background color of the active organization member target in the organization section of the person card component\n * @cssprop --organization-coworker-hover-color - {Color} The hover color of the coworker in the organization section of the person card component\n * @cssprop --organization-coworker-border-color - {Color} The border color of the coworker in the organization section of the person card component\n * @cssprop --organization-coworker-person-avatar-size - {Length} The avatar size of the coworker in the organization section of the person card component\n * @cssprop --organization-member-person-avatar-size - {Length} The avatar size of the member in the organization section of the person card component\n * @cssprop --organization-direct-report-person-avatar-size - {Length} The avatar size of the direct report in the organization section of the person card component\n * @cssprop --organization-title-color - {Color} The color of the organization title in the organization section of the person card component\n * @cssprop --organization-sub-title-color - {Color} The color of the organization sub-title in the organization section of the person card component\n * @cssprop --organization-hover-color - {Color} The hover color of the organization section of the person card component\n * @cssprop --profile-background-color - {Color} The background color of the profile section in the person card component\n * @cssprop --profile-title-color - {Color} The color of the profile title in the profile section of the person card component\n * @cssprop --profile-section-title-color - {Color} The color of the profile section title of the person card component\n * @cssprop --profile-token-item-color - {Color} The color of the token item in the profile section of the person card component\n * @cssprop --profile-token-item-background-color - {Color} The background color of the token item in the profile section of the person card component\n * @cssprop --profile-token-overflow-color - {Color} The color of the token overflow in the profile section of the person card component\n *\n */\nexport class MgtPersonCard extends MgtTemplatedTaskComponent implements IHistoryClearer, IExpandable {\n  /**\n   * Array of styles to apply to the element. The styles should be defined\n   * using the `css` tag function.\n   */\n  static get styles() {\n    return styles;\n  }\n\n  /**\n   * Strings to use for localization\n   *\n   * @readonly\n   * @protected\n   * @memberof MgtPersonCard\n   */\n  protected get strings() {\n    return strings;\n  }\n\n  /**\n   * Get the scopes required for the person card\n   * The scopes depend on what sections are shown\n   *\n   * Use the `MgtPersonCard.config` object to configure\n   * what sections are shown\n   *\n   * @static\n   * @return {*}  {string[]}\n   * @memberof MgtPersonCard\n   */\n  public static get requiredScopes(): string[] {\n    return getMgtPersonCardScopes();\n  }\n\n  /**\n   * Set the person details to render\n   *\n   * @type {IDynamicPerson}\n   * @memberof MgtPersonCard\n   */\n  public get personDetails(): IDynamicPerson {\n    return this._personDetails;\n  }\n  @property({\n    attribute: 'person-details',\n    type: Object\n  })\n  public set personDetails(value: IDynamicPerson) {\n    if (this._personDetails === value) {\n      return;\n    }\n\n    this._personDetails = value;\n    this.personImage = this.getImage();\n  }\n\n  private _personQuery: string;\n  /**\n   * allows developer to define name of person for component\n   *\n   * @type {string}\n   */\n  public get personQuery(): string {\n    return this._personQuery;\n  }\n  @property({\n    attribute: 'person-query'\n  })\n  public set personQuery(value: string) {\n    if (this._personQuery === value) {\n      return;\n    }\n    this._personQuery = value;\n    this.personDetails = null;\n    this._cardState = null;\n  }\n\n  /**\n   * allows the locking of navigation using tabs to not flow out of the card section\n   *\n   * @type {boolean}\n   */\n  @property({\n    attribute: 'lock-tab-navigation',\n    type: Boolean\n  })\n  public lockTabNavigation: boolean;\n\n  /**\n   * user-id property allows developer to use id value for component\n   *\n   * @type {string}\n   */\n  public get userId(): string {\n    return this._userId;\n  }\n  @property({\n    attribute: 'user-id'\n  })\n  public set userId(value: string) {\n    if (value === this._userId) {\n      return;\n    }\n    this._userId = value;\n    this.personDetails = null;\n    this._cardState = null;\n  }\n\n  /**\n   * Set the image of the person\n   * Set to '@' to look up image from the graph\n   *\n   * @type {string}\n   * @memberof MgtPersonCard\n   */\n  @property({\n    attribute: 'person-image',\n    type: String\n  })\n  public personImage: string;\n\n  /**\n   * Sets whether the person image should be fetched\n   * from the Microsoft Graph based on the personDetails\n   * provided by the user\n   *\n   * @type {boolean}\n   * @memberof MgtPerson\n   */\n  @property({\n    attribute: 'fetch-image',\n    type: Boolean\n  })\n  public fetchImage: boolean;\n\n  /**\n   * Gets or sets whether expanded details section is rendered\n   *\n   * @type {boolean}\n   * @memberof MgtPersonCard\n   */\n  @property({\n    attribute: 'is-expanded',\n    type: Boolean\n  })\n  public isExpanded: boolean;\n\n  /**\n   * Gets or sets whether person details should be inherited from an mgt-person parent\n   * Useful when used as template in an mgt-person component\n   *\n   * @type {boolean}\n   * @memberof MgtPersonCard\n   */\n  @property({\n    attribute: 'inherit-details',\n    type: Boolean\n  })\n  public inheritDetails: boolean;\n\n  /**\n   * determines if person card component renders presence\n   *\n   * @type {boolean}\n   */\n  @property({\n    attribute: 'show-presence',\n    type: Boolean\n  })\n  public showPresence: boolean;\n\n  /**\n   * Gets or sets presence of person\n   *\n   * @type {MicrosoftGraph.Presence}\n   * @memberof MgtPerson\n   */\n  @property({\n    attribute: 'person-presence',\n    type: Object\n  })\n  public personPresence: Presence;\n\n  @state()\n  private isSendingMessage = false;\n\n  /**\n   * The subsections for display in the lower part of the card\n   *\n   * @protected\n   * @type {any[]}\n   * @memberof MgtPersonCard\n   */\n  protected sections: CardSection[];\n\n  @state() private _cardState: MgtPersonCardState;\n  @state() private _isStateLoading: boolean;\n\n  private _history: MgtPersonCardStateHistory[];\n  private _chatInput: string;\n  @state()\n  private _currentSection: CardSection;\n  private _personDetails: IDynamicPerson;\n  private _me: User;\n  private _smallView: boolean;\n  private _windowHeight;\n\n  private _userId: string;\n  private _graph: IGraph;\n\n  private get internalPersonDetails(): IDynamicPerson {\n    return this._cardState?.person || this.personDetails;\n  }\n\n  constructor() {\n    super();\n    this._chatInput = '';\n    this._currentSection = null;\n    this._history = [];\n    this.sections = [];\n    this._graph = null;\n  }\n\n  /**\n   * Navigate the card to a different person.\n   *\n   * @protected\n   * @memberof MgtPersonCard\n   */\n  public navigate(person: IDynamicPerson): void {\n    this._history.push({\n      personDetails: this.personDetails,\n      personImage: this.getImage(),\n      state: this._cardState\n    });\n\n    this.personDetails = person;\n    this._cardState = null;\n    this.personImage = null;\n    this._currentSection = null;\n    this.sections = [];\n    this._chatInput = '';\n  }\n\n  /**\n   * Navigate the card back to the previous person\n   *\n   * @returns {void}\n   * @memberof MgtPersonCard\n   */\n  public goBack = (): void => {\n    if (!this._history?.length) {\n      return;\n    }\n\n    const historyState = this._history.pop();\n    this._currentSection = null;\n\n    // resets to first tab being selected\n    const firstTab: HTMLElement = this.renderRoot.querySelector('fluent-tab');\n    if (firstTab) {\n      firstTab.click();\n    }\n    this._cardState = historyState.state;\n    this._personDetails = historyState.state.person;\n    this.personImage = historyState.personImage;\n    this.loadSections();\n  };\n\n  /**\n   * Navigate the card back to first person and clear history\n   *\n   * @returns {void}\n   * @memberof MgtPersonCard\n   */\n  public clearHistory(): void {\n    this._currentSection = null;\n\n    if (!this._history?.length) {\n      return;\n    }\n\n    const historyState = this._history[0];\n    this._history = [];\n\n    this._cardState = historyState.state;\n    this._personDetails = historyState.personDetails;\n    this.personImage = historyState.personImage;\n    this.loadSections();\n  }\n\n  protected args(): unknown[] {\n    return [this.providerState, this.personDetails, this.personQuery, this.personImage, this.userId];\n  }\n\n  /**\n   * Invoked from the base class when the loadState promise has completed.\n   */\n  protected readonly renderContent = () => {\n    // Handle no data\n    if (!this.internalPersonDetails) {\n      return this.renderNoData();\n    }\n\n    const person = this.internalPersonDetails;\n    const image = this.getImage();\n\n    // Check for a default template.\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/dot-notation\n    if (this.hasTemplate('default')) {\n      return this.renderTemplate('default', {\n        person: this.internalPersonDetails,\n        personImage: image\n      });\n    }\n\n    let ariaLabel: string;\n\n    ariaLabel = this.strings.closeCardLabel;\n\n    const closeCardTemplate = this.isExpanded\n      ? html`\n           <div class=\"close-card-container\">\n             <fluent-button \n              appearance=\"lightweight\" \n              class=\"close-button\" \n              aria-label=${ariaLabel}\n              @click=${this.closeCard} >\n               ${getSvg(SvgIcon.Close)}\n             </fluent-button>\n           </div>\n         `\n      : null;\n\n    ariaLabel = this.strings.goBackLabel;\n    const navigationTemplate = this._history?.length\n      ? html`\n            <div class=\"nav\">\n              <fluent-button \n                appearance=\"lightweight\"\n                class=\"nav__back\" \n                aria-label=${ariaLabel} \n                @keydown=${this.handleGoBack}\n                @click=${this.goBack}>${getSvg(SvgIcon.Back)}\n               </fluent-button>\n            </div>\n          `\n      : null;\n\n    // Check for a person-details template\n    let personDetailsTemplate = this.renderTemplate('person-details', {\n      person: this.internalPersonDetails,\n      personImage: image\n    });\n    if (!personDetailsTemplate) {\n      const personTemplate = this.renderPerson();\n      const contactIconsTemplate = this.renderContactIcons(person);\n\n      personDetailsTemplate = html`\n         ${personTemplate} ${contactIconsTemplate}\n       `;\n    }\n\n    const expandedDetailsTemplate = this.isExpanded ? this.renderExpandedDetails() : this.renderExpandedDetailsButton();\n    this._windowHeight =\n      window.innerHeight && document.documentElement.clientHeight\n        ? Math.min(window.innerHeight, document.documentElement.clientHeight)\n        : window.innerHeight || document.documentElement.clientHeight;\n\n    if (this._windowHeight < 250) {\n      this._smallView = true;\n    }\n    const tabLocker = this.lockTabNavigation\n      ? html`<div @keydown=${this.handleEndOfCard} aria-label=${this.strings.endOfCard} tabindex=\"0\" id=\"end-of-container\"></div>`\n      : html``;\n    return html`\n      <div class=\"root\" dir=${this.direction}>\n        <div class=${classMap({ small: this._smallView })}>\n          ${navigationTemplate}\n          ${closeCardTemplate}\n          <div class=\"person-details-container\">${personDetailsTemplate}</div>\n          <div class=\"expanded-details-container\">${expandedDetailsTemplate}</div>\n          ${tabLocker}\n        </div>\n      </div>\n     `;\n  };\n\n  private readonly handleEndOfCard = (e: KeyboardEvent) => {\n    if (e && e.code === 'Tab') {\n      const endOfCardEl = this.renderRoot.querySelector<HTMLElement>('#end-of-container');\n      if (endOfCardEl) {\n        endOfCardEl.blur();\n        const imageCardEl = this.renderRoot.querySelector<HTMLElement>('mgt-person');\n        if (imageCardEl) {\n          imageCardEl.focus();\n        }\n      }\n    }\n  };\n\n  /**\n   * Render the state when no data is available.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtPersonCard\n   */\n  protected closeCard = () => {\n    // reset tabs\n    this.updateCurrentSection(null);\n    this.isExpanded = false;\n  };\n\n  /**\n   * Render the state when no data is available.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtPersonCard\n   */\n  protected renderNoData(): TemplateResult {\n    return this.renderTemplate('no-data', null) || html``;\n  }\n\n  /**\n   * Render a display image for the person.\n   *\n   * @protected\n   * @param {*} image\n   * @memberof MgtPersonCard\n   */\n  protected renderPerson(): TemplateResult {\n    return mgtHtml`\n      <mgt-person\n        tabindex=\"0\"\n        class=\"person-image\"\n        .personDetails=${this.internalPersonDetails}\n        .personImage=${this.getImage()}\n        .personPresence=${this.personPresence}\n        .showPresence=${this.showPresence}\n        view=\"threelines\"\n      ></mgt-person>\n    `;\n  }\n\n  /**\n   * Render person subtitle.\n   *\n   * @protected\n   * @param {IDynamicPerson} person\n   * @returns {TemplateResult}\n   * @memberof MgtPersonCard\n   */\n  protected renderPersonSubtitle(person?: IDynamicPerson): TemplateResult {\n    person = person || this.internalPersonDetails;\n    if (!isUser(person) || !person.department) {\n      return;\n    }\n    return html`\n       <div class=\"department\">${person.department}</div>\n     `;\n  }\n\n  /**\n   * Render the various icons for contacting the person.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtPersonCard\n   */\n  protected renderContactIcons(person?: IDynamicPerson): TemplateResult {\n    person = person || this.internalPersonDetails;\n    const userPerson = person as User;\n\n    let ariaLabel: string;\n\n    // Email\n    let email: TemplateResult;\n    if (getEmailFromGraphEntity(person)) {\n      ariaLabel = `${this.strings.emailButtonLabel} ${person.displayName}`;\n      email = html`\n        <fluent-button class=\"icon\"\n          aria-label=${ariaLabel}\n          @click=${this.emailUser}>\n          ${getSvg(SvgIcon.SmallEmail)}\n        </fluent-button>\n      `;\n    }\n\n    // Chat\n    let chat: TemplateResult;\n    if (userPerson?.userPrincipalName) {\n      ariaLabel = `${this.strings.chatButtonLabel} ${person.displayName}`;\n      chat = html`\n        <fluent-button class=\"icon\"\n          aria-label=${ariaLabel}\n          @click=${this.chatUser}>\n          ${getSvg(SvgIcon.SmallChat)}\n        </fluent-button>\n       `;\n    }\n\n    // Video\n\n    ariaLabel = `${this.strings.videoButtonLabel} ${person.displayName}`;\n    const video: TemplateResult = html`\n      <fluent-button class=\"icon\"\n        aria-label=${ariaLabel}\n        @click=${this.videoCallUser}>\n        ${getSvg(SvgIcon.Video)}\n      </fluent-button>\n    `;\n\n    // Call\n    let call: TemplateResult;\n    if (userPerson.userPrincipalName) {\n      ariaLabel = `${this.strings.callButtonLabel} ${person.displayName}`;\n      call = html`\n         <fluent-button class=\"icon\"\n          aria-label=${ariaLabel}\n          @click=${this.callUser}>\n          ${getSvg(SvgIcon.Call)}\n        </fluent-button>\n       `;\n    }\n\n    return html`\n       <div class=\"base-icons\">\n         ${email} ${chat} ${video} ${call}\n       </div>\n     `;\n  }\n\n  /**\n   * Render the button used to expand the expanded details.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtPersonCard\n   */\n  protected renderExpandedDetailsButton(): TemplateResult {\n    return html`\n      <fluent-button\n        aria-label=${this.strings.expandDetailsLabel}\n        class=\"expanded-details-button\"\n        @click=${this.showExpandedDetails}\n      >\n        ${getSvg(SvgIcon.ExpandDown)}\n      </fluent-button>\n     `;\n  }\n\n  /**\n   * Render expanded details.\n   *\n   * @protected\n   * @param {IDynamicPerson} [person]\n   * @returns {TemplateResult}\n   * @memberof MgtPersonCard\n   */\n  protected renderExpandedDetails(): TemplateResult {\n    if (!this._cardState && this._isStateLoading) {\n      return mgtHtml`\n         <div class=\"loading\">\n           <mgt-spinner></mgt-spinner>\n         </div>\n       `;\n    }\n    // load sections when details are expanded\n    // when not singed in\n    const provider = Providers.globalProvider;\n    if (provider.state === ProviderState.SignedOut) {\n      this.loadSections();\n    }\n\n    const sectionNavTemplate = this.renderSectionNavigation();\n\n    return html`\n      <div class=\"section-nav\">\n        ${sectionNavTemplate}\n      </div>\n      <hr class=\"divider\"/>\n      <div\n        class=\"section-host ${this._smallView ? 'small' : ''} ${this._smallView ? 'small' : ''}\"\n        @wheel=${(e: WheelEvent) => this.handleSectionScroll(e)}\n        tabindex=0\n      ></div>\n    `;\n  }\n\n  /**\n   * Render the navigation ribbon for subsections\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtPersonCard\n   */\n  protected renderSectionNavigation(): TemplateResult {\n    if (!this.sections || (this.sections.length < 2 && !this.hasTemplate('additional-details'))) {\n      return;\n    }\n\n    const currentSectionIndex = this._currentSection ? this.sections.indexOf(this._currentSection) : -1;\n\n    const additionalSectionTemplates = this.sections.map((section, i) => {\n      const name = section.tagName.toLowerCase();\n      const classes = classMap({\n        active: i === currentSectionIndex,\n        'section-nav__icon': true\n      });\n\n      return html`\n        <fluent-tab\n          id=\"${name}-Tab\"\n          class=${classes}\n          slot=\"tab\"\n          @keyup=\"${() => this.updateCurrentSection(section)}\"\n          @click=${() => this.updateCurrentSection(section)}\n        >\n          ${section.renderIcon()}\n        </fluent-tab>\n      `;\n    });\n\n    const additionalPanelTemplates = this.sections.map(section => {\n      return html`\n        <fluent-tab-panel slot=\"tabpanel\">\n          <div class=\"inserted\">\n            <div class=\"title\">${section.cardTitle}</div>\n            ${this._currentSection ? section.asFullView() : null}\n          </div>\n        </fluent-tab-panel>\n      `;\n    });\n\n    const overviewClasses = classMap({\n      active: currentSectionIndex === -1,\n      'section-nav__icon': true,\n      overviewTab: true\n    });\n\n    return html`\n      <fluent-tabs\n        orientation=\"horizontal\"\n        activeindicator\n        @wheel=${(e: WheelEvent) => this.handleSectionScroll(e)}\n      >\n        <fluent-tab\n          class=\"${overviewClasses}\"\n          slot=\"tab\"\n          @keyup=\"${() => this.updateCurrentSection(null)}\"\n          @click=${() => this.updateCurrentSection(null)}\n        >\n          <div>${getSvg(SvgIcon.Overview)}</div>\n        </fluent-tab>\n        ${additionalSectionTemplates}\n        <fluent-tab-panel slot=\"tabpanel\" >\n          <div class=\"overview-panel\">${!this._currentSection ? this.renderOverviewSection() : null}</div>\n        </fluent-tab-panel>\n        ${additionalPanelTemplates}\n      </fluent-tabs>\n    `;\n  }\n\n  /**\n   * Render the default section with compact views for each subsection.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtPersonCard\n   */\n  protected renderOverviewSection(): TemplateResult {\n    const compactTemplates = this.sections.map(\n      (section: BasePersonCardSection) => html`\n        <div class=\"section\">\n          <div class=\"section__header\">\n            <div class=\"section__title\" tabindex=0>${section.displayName}</div>\n              <fluent-button\n                appearance=\"lightweight\"\n                class=\"section__show-more\"\n                @click=${() => this.updateCurrentSection(section)}\n              >\n                ${this.strings.showMoreSectionButton}\n              </fluent-button>\n          </div>\n          <div class=\"section__content\">${section.asCompactView()}</div>\n        </div>\n      `\n    );\n\n    const additionalDetails = this.renderTemplate('additional-details', {\n      person: this.internalPersonDetails,\n      personImage: this.getImage(),\n      state: this._cardState\n    });\n    if (additionalDetails) {\n      compactTemplates.splice(\n        1,\n        0,\n        html`\n           <div class=\"section\">\n             <div class=\"additional-details\">${additionalDetails}</div>\n           </div>\n         `\n      );\n    }\n\n    return html`\n       <div class=\"sections\">\n          ${this.renderMessagingSection()}\n          ${compactTemplates}\n       </div>\n     `;\n  }\n\n  /**\n   * Render the actively selected section.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtPersonCard\n   */\n  protected renderCurrentSection(): TemplateResult {\n    if (!this.sections?.length && !this.hasTemplate('additional-details')) {\n      return;\n    }\n\n    if (this.sections.length === 1 && !this.hasTemplate('additional-details')) {\n      return html`\n         ${this.sections[0].asFullView()}\n       `;\n    }\n\n    if (!this._currentSection) {\n      return this.renderOverviewSection();\n    }\n\n    return html`\n       ${this._currentSection.asFullView()}\n     `;\n  }\n\n  /**\n   * Render the messaging section.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtPersonCard\n   */\n  protected renderMessagingSection() {\n    const person = this.personDetails as User;\n    const user = this._me.userPrincipalName;\n    const chatInput = this._chatInput;\n    if (person?.userPrincipalName === user) {\n      return;\n    } else {\n      return MgtPersonCardConfig.isSendMessageVisible\n        ? html`\n      <div class=\"message-section\">\n        <fluent-text-field\n          autocomplete=\"off\"\n          appearance=\"outline\"\n          placeholder=\"${this.strings.quickMessage}\"\n          .value=${chatInput}\n          @input=${(e: Event) => {\n            this._chatInput = (e.target as HTMLInputElement).value;\n            this.requestUpdate();\n          }}\n          @keydown=\"${(e: KeyboardEvent) => this.sendQuickMessageOnEnter(e)}\">\n        </fluent-text-field>\n        <fluent-button class=\"send-message-icon\"\n          aria-label=${this.strings.sendMessageLabel}\n          @click=${this.sendQuickMessage}\n          ?disabled=${this.isSendingMessage}>\n          ${!this.isSendingMessage ? getSvg(SvgIcon.Send) : getSvg(SvgIcon.Confirmation)}\n        </fluent-button>\n      </div>\n      `\n        : nothing;\n    }\n  }\n\n  /**\n   * load state into the component\n   *\n   * @protected\n   * @returns\n   * @memberof MgtPersonCard\n   */\n  protected async loadState() {\n    if (this._cardState) {\n      return;\n    }\n\n    if (!this.personDetails && this.inheritDetails) {\n      // User person details inherited from parent tree\n      let parent = this.parentElement;\n      while (parent && parent.tagName !== `${customElementHelper.prefix}-PERSON`.toUpperCase()) {\n        parent = parent.parentElement;\n      }\n\n      const parentPerson: IDynamicPerson =\n        // eslint-disable-next-line @typescript-eslint/dot-notation\n        (parent as MgtPerson).personDetails || (parent as MgtPerson)['personDetailsInternal'];\n\n      if (parent && parentPerson) {\n        this.personDetails = parentPerson;\n        this.personImage = (parent as MgtPerson).personImage;\n      }\n    }\n\n    const provider = Providers.globalProvider;\n\n    // check if user is signed in\n    if (!provider || provider.state !== ProviderState.SignedIn) {\n      return;\n    }\n\n    const graph = provider.graph.forComponent(this);\n    this._graph = graph;\n\n    this._isStateLoading = true;\n\n    if (!this._me) {\n      this._me = await Providers.me();\n    }\n\n    // check if personDetail already populated\n    if (this.personDetails) {\n      const user = this.personDetails;\n      let id: string;\n      if (isUser(user)) {\n        id = user.userPrincipalName || user.id;\n      }\n\n      // if we have an id but no email, we should get data from the graph\n      // in some graph calls, the user object does not contain the email\n      if (id && !getEmailFromGraphEntity(user)) {\n        const person = await getUserWithPhoto(graph, id);\n        this.personDetails = person;\n        this.personImage = this.getImage();\n      }\n    } else if (this.userId || this.personQuery === 'me') {\n      // Use userId or 'me' query to get the person and image\n      const person = await getUserWithPhoto(graph, this.userId);\n      this.personDetails = person;\n      this.personImage = this.getImage();\n    } else if (this.personQuery) {\n      // Use the personQuery to find our person.\n      const people = await findPeople(graph, this.personQuery, 1);\n\n      if (people?.length) {\n        this.personDetails = people[0];\n        await getPersonImage(graph, this.personDetails, MgtPersonCardConfig.useContactApis).then(image => {\n          if (image) {\n            this.personDetails.personImage = image;\n            this.personImage = image;\n          }\n        });\n      }\n    }\n\n    // populate presence\n    const defaultPresence = {\n      activity: 'Offline',\n      availability: 'Offline',\n      id: null\n    };\n    if (!this.personPresence && this.showPresence) {\n      try {\n        if (this.personDetails?.id) {\n          this.personPresence = await getUserPresence(graph, this.personDetails.id);\n        } else {\n          this.personPresence = defaultPresence;\n        }\n      } catch (_) {\n        // set up a default Presence in case beta api changes or getting error code\n        this.personPresence = defaultPresence;\n      }\n    }\n\n    // populate state\n    if (this.personDetails?.id) {\n      this._cardState = await getPersonCardGraphData(graph, this.personDetails, this._me === this.personDetails.id);\n    }\n\n    this.loadSections();\n\n    this._isStateLoading = false;\n  }\n\n  /**\n   * Send a chat message to the user from the quick message input.\n   *\n   * @protected\n   * @returns {void}\n   * @memberof MgtPersonCard\n   */\n  protected sendQuickMessage = async (): Promise<void> => {\n    const message = this._chatInput.trim();\n    if (!message?.length) {\n      return;\n    }\n    const person = this.personDetails as User;\n    const user = this._me.userPrincipalName;\n    this.isSendingMessage = true;\n\n    const chat = await createChat(this._graph, person.userPrincipalName, user);\n\n    const messageData = {\n      body: {\n        content: message\n      }\n    };\n    await sendMessage(this._graph, chat.id, messageData);\n    this.isSendingMessage = false;\n    this.clearInputData();\n  };\n\n  /**\n   * Use the mailto: protocol to initiate a new email to the user.\n   *\n   * @protected\n   * @memberof MgtPersonCard\n   */\n  protected emailUser = () => {\n    const user = this.internalPersonDetails;\n    if (user) {\n      const email = getEmailFromGraphEntity(user);\n      if (email) {\n        window.open('mailto:' + email, '_blank', 'noreferrer');\n      }\n    }\n  };\n\n  private get hasPhone(): boolean {\n    const user = this.personDetails as User;\n    const person = this.personDetails as microsoftgraph.Person;\n    return Boolean(user?.businessPhones?.length) || Boolean(person?.phones?.length);\n  }\n\n  /**\n   * Use the tel: protocol to initiate a new call to the user.\n   *\n   * @protected\n   * @memberof MgtPersonCard\n   */\n  protected callUser = () => {\n    const user = this.personDetails as User;\n    const person = this.personDetails as microsoftgraph.Person;\n\n    if (user?.businessPhones?.length) {\n      const phone = user.businessPhones[0];\n      if (phone) {\n        window.open('tel:' + phone, '_blank', 'noreferrer');\n      }\n    } else if (person?.phones?.length) {\n      const businessPhones = this.getPersonBusinessPhones(person);\n      const phone = businessPhones[0];\n      if (phone) {\n        window.open('tel:' + phone, '_blank', 'noreferrer');\n      }\n    }\n  };\n\n  /**\n   * Initiate a chat message to the user via deeplink.\n   *\n   * @protected\n   * @memberof MgtPersonCard\n   */\n  protected chatUser = (message: string = null) => {\n    const user = this.personDetails as User;\n    if (user?.userPrincipalName) {\n      const users: string = user.userPrincipalName;\n\n      let url = `https://teams.microsoft.com/l/chat/0/0?users=${users}`;\n      if (message?.length) {\n        url += `&message=${message}`;\n      }\n\n      const openWindow = () => window.open(url, '_blank', 'noreferrer');\n\n      if (TeamsHelper.isAvailable) {\n        TeamsHelper.executeDeepLink(url, (status: boolean) => {\n          if (!status) {\n            openWindow();\n          }\n        });\n      } else {\n        openWindow();\n      }\n    }\n  };\n\n  /**\n   * Initiate a teams call with video with a user via deeplink.\n   *\n   * @protected\n   * @memberof MgtPersonCard\n   */\n  protected videoCallUser = () => {\n    const user = this.personDetails as User;\n    if (user?.userPrincipalName) {\n      const users: string = user.userPrincipalName;\n\n      const url = `https://teams.microsoft.com/l/call/0/0?users=${users}&withVideo=true`;\n\n      const openWindow = () => window.open(url, '_blank');\n\n      if (TeamsHelper.isAvailable) {\n        TeamsHelper.executeDeepLink(url, (status: boolean) => {\n          if (!status) {\n            openWindow();\n          }\n        });\n      } else {\n        openWindow();\n      }\n    }\n  };\n\n  /**\n   * Display the expanded details panel.\n   *\n   * @protected\n   * @memberof MgtPersonCard\n   */\n  protected showExpandedDetails = () => {\n    const root = this.renderRoot.querySelector('.root');\n    if (root?.animate) {\n      // play back\n      root.animate(\n        [\n          {\n            height: 'auto',\n            transformOrigin: 'top left'\n          },\n          {\n            height: 'auto',\n            transformOrigin: 'top left'\n          }\n        ],\n        {\n          duration: 1000,\n          easing: 'ease-in-out',\n          fill: 'both'\n        }\n      );\n    }\n    this.isExpanded = true;\n\n    this.fireCustomEvent('expanded', null, true);\n  };\n\n  private loadSections() {\n    this.sections = [];\n\n    if (!this.internalPersonDetails) {\n      return;\n    }\n\n    const contactSections = new MgtContact(this.internalPersonDetails as User);\n    if (contactSections.hasData) {\n      this.sections.push(contactSections);\n    }\n\n    if (!this._cardState) {\n      return;\n    }\n\n    const { person, directReports, messages, files, profile } = this._cardState;\n\n    if (MgtPersonCardConfig.sections.organization && (person?.manager || directReports?.length)) {\n      this.sections.push(new MgtOrganization(this._cardState, this._me));\n    }\n\n    if (MgtPersonCardConfig.sections.mailMessages && messages?.length) {\n      this.sections.push(new MgtMessages(messages));\n    }\n\n    if (MgtPersonCardConfig.sections.files && files?.length) {\n      this.sections.push(new MgtFileList());\n    }\n\n    if (MgtPersonCardConfig.sections.profile && profile) {\n      const profileSection = new MgtProfile(profile);\n      if (profileSection.hasData) {\n        this.sections.push(profileSection);\n      }\n    }\n  }\n\n  private getImage(): string {\n    if (this.personImage) {\n      return this.personImage;\n    }\n\n    const person = this.personDetails;\n    return person?.personImage ? person.personImage : null;\n  }\n\n  private clearInputData() {\n    this._chatInput = '';\n    this.requestUpdate();\n  }\n\n  private getPersonBusinessPhones(person: Person): string[] {\n    const phones = person.phones;\n    const businessPhones: string[] = [];\n    for (const p of phones) {\n      if (p.type === 'business') {\n        businessPhones.push(p.number);\n      }\n    }\n    return businessPhones;\n  }\n\n  private updateCurrentSection(section: CardSection) {\n    if (section) {\n      const sectionName = section.tagName.toLowerCase();\n      const tabs: HTMLElement = this.renderRoot.querySelector(`#${sectionName}-Tab`);\n      tabs.click();\n    }\n    const panels = this.renderRoot.querySelectorAll('fluent-tab-panel');\n    for (const target of panels) {\n      target.scrollTop = 0;\n    }\n    this._currentSection = section;\n    this.requestUpdate();\n  }\n\n  private handleSectionScroll(e: WheelEvent) {\n    const panels = this.renderRoot.querySelectorAll('fluent-tab-panel');\n    for (const target of panels) {\n      if (target) {\n        if (\n          !(e.deltaY < 0 && target.scrollTop === 0) &&\n          !(e.deltaY > 0 && target.clientHeight + target.scrollTop >= target.scrollHeight - 1)\n        ) {\n          e.stopPropagation();\n        }\n      }\n    }\n  }\n\n  private readonly sendQuickMessageOnEnter = (e: KeyboardEvent) => {\n    if (e.code === 'Enter') {\n      void this.sendQuickMessage();\n    }\n  };\n\n  private readonly handleGoBack = (e: KeyboardEvent) => {\n    if (e.code === 'Enter') {\n      void this.goBack();\n    }\n  };\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nconst avatarTypes = ['photo', 'initials'] as const;\n\nexport type AvatarType = (typeof avatarTypes)[number];\nexport const isAvatarType = (value: unknown): value is AvatarType =>\n  typeof value === 'string' && avatarTypes.includes(value as AvatarType);\nexport const avatarTypeConverter = (value: string, defaultValue: AvatarType = 'photo'): AvatarType =>\n  isAvatarType(value) ? value : defaultValue;\n\n/**\n * Configuration object for the Person component\n *\n * @export\n * @interface MgtPersonConfig\n */\nexport interface MgtPersonConfig {\n  /**\n   * Sets or gets whether the person component can use Contacts APIs to\n   * find contacts and their images\n   *\n   * @type {boolean}\n   */\n  useContactApis: boolean;\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport {\n  MgtTemplatedTaskComponent,\n  ProviderState,\n  Providers,\n  customElementHelper,\n  mgtHtml\n} from '@microsoft/mgt-element';\nimport { Presence } from '@microsoft/microsoft-graph-types';\nimport { html, TemplateResult, nothing } from 'lit';\nimport { property, state } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { findPeople, getEmailFromGraphEntity } from '../../graph/graph.people';\nimport { getGroupImage, getPersonImage } from '../../graph/graph.photos';\nimport { getUserPresence } from '../../graph/graph.presence';\nimport { findUsers, getMe, getUser } from '../../graph/graph.user';\nimport { getUserWithPhoto } from '../../graph/graph.userWithPhoto';\nimport { AvatarSize, IDynamicPerson, ViewType, viewTypeConverter } from '../../graph/types';\nimport '../../styles/style-helper';\nimport { SvgIcon, getSvg } from '../../utils/SvgHelper';\nimport '../sub-components/mgt-flyout/mgt-flyout';\nimport { MgtFlyout, registerMgtFlyoutComponent } from '../sub-components/mgt-flyout/mgt-flyout';\nimport { type PersonCardInteraction, personCardConverter } from './../PersonCardInteraction';\nimport { styles } from './mgt-person-css';\nimport { MgtPersonConfig, AvatarType, avatarTypeConverter } from './mgt-person-types';\nimport { strings } from './strings';\nimport { isUser, isContact } from '../../graph/entityType';\nimport { ifDefined } from 'lit/directives/if-defined.js';\nimport { buildComponentName, registerComponent } from '@microsoft/mgt-element';\nimport { IExpandable, IHistoryClearer } from '../mgt-person-card/types';\n\n/**\n * Person properties part of original set provided by graph by default\n */\nexport const defaultPersonProperties = [\n  'businessPhones',\n  'displayName',\n  'givenName',\n  'jobTitle',\n  'department',\n  'mail',\n  'mobilePhone',\n  'officeLocation',\n  'preferredLanguage',\n  'surname',\n  'userPrincipalName',\n  'id',\n  'userType'\n];\n\nexport const registerMgtPersonComponent = () => {\n  // register self first to avoid infinte loop due to circular ref between person and person card\n  registerComponent('person', MgtPerson);\n\n  registerMgtFlyoutComponent();\n};\n\n/**\n * The person component is used to display a person or contact by using their photo, name, and/or email address.\n *\n * @export\n * @class MgtPerson\n * @extends {MgtTemplatedComponent}\n *\n * @fires {CustomEvent<IDynamicPerson>} line1clicked - Fired when line1 is clicked\n * @fires {CustomEvent<IDynamicPerson>} line2clicked - Fired when line2 is clicked\n * @fires {CustomEvent<IDynamicPerson>} line3clicked - Fired when line3 is clicked\n * @fires {CustomEvent<IDynamicPerson>} line4clicked - Fired when line4 is clicked\n *\n * @cssprop --person-background-color - {Color} the color of the person component background.\n *\n * @cssprop --person-avatar-size - {Length} the width and height of the avatar. Default is 24px.\n * @cssprop --person-avatar-border - {String} the border around an avatar. Default is none.\n * @cssprop --person-avatar-border-radius - {String} the radius around the border of an avatar. Default is 50%.\n *\n * @cssprop --person-initials-text-color - {Color} the color of initials in an avatar.\n * @cssprop --person-initials-background-color - {Color} the color of the background in an avatar with initials.\n *\n * @cssprop --person-details-left-spacing - {Length} the space between the avatar and the person details. Default is 12px.\n * @cssprop --person-details-bottom-spacing - {Length} the space between the bottom of the detail block and the bottom on the component. Default is 0.\n *\n * @cssprop --person-line1-font-size - {String} the font-size of the line 1 text. Default is 14px.\n * @cssprop --person-line1-font-weight - {Length} the font weight of the line 1 text. Default is 600.\n * @cssprop --person-line1-text-color - {Color} the color of the line 1 text.\n * @cssprop --person-line1-text-transform - {String} the tex transform of the line 1 text. Default is inherit.\n * @cssprop --person-line1-text-line-height - {Length} the line height of the line 1 text. Default is 20px.\n *\n * @cssprop --person-line2-font-size - {Length} the font-size of the line 2 text. Default is 12px.\n * @cssprop --person-line2-font-weight - {Length} the font weight of the line 2 text. Default is 400.\n * @cssprop --person-line2-text-color - {Color} the color of the line 2 text.\n * @cssprop --person-line2-text-transform - {String} the tex transform of the line 2 text. Default is inherit.\n * @cssprop --person-line2-text-line-height - {Length} the line height of the line 2 text. Default is 16px.\n *\n * @cssprop --person-line3-font-size - {Length} the font-size of the line 3 text. Default is 12px.\n * @cssprop --person-line3-font-weight - {Length} the font weight of the line 3 text. Default is 400.\n * @cssprop --person-line3-text-color - {Color} the color of the line 3 text.\n * @cssprop --person-line3-text-transform - {String} the tex transform of the line 3 text. Default is inherit.\n * @cssprop --person-line3-text-line-height - {Length} the line height of the line 3 text. Default is 16px.\n *\n * @cssprop --person-line4-font-size - {Length} the font-size of the line 4 text. Default is 12px.\n * @cssprop --person-line4-font-weight - {Length} the font weight of the line 4 text. Default is 400.\n * @cssprop --person-line4-text-color - {Color} the color of the line 4 text.\n * @cssprop --person-line4-text-transform - {String} the tex transform of the line 4 text. Default is inherit.\n * @cssprop --person-line4-text-line-height - {Length} the line height of the line 4 text. Default is 16px.\n *\n * @cssprop --person-details-wrapper-width - {Length} the minimum width of the details section. Default is 168px.\n */\nexport class MgtPerson extends MgtTemplatedTaskComponent {\n  /**\n   * Array of styles to apply to the element. The styles should be defined\n   * using the `css` tag function.\n   */\n  static get styles() {\n    return styles;\n  }\n\n  /**\n   * Strings to use for localization\n   *\n   * @readonly\n   * @protected\n   * @memberof MgtPerson\n   */\n  protected get strings() {\n    return strings;\n  }\n\n  /**\n   * Global Configuration object for all\n   * person components\n   *\n   * @static\n   * @type {MgtPersonConfig}\n   * @memberof MgtPerson\n   */\n  public static config: MgtPersonConfig = {\n    useContactApis: true\n  };\n\n  /**\n   * allows developer to define name of person for component\n   *\n   * @type {string}\n   */\n  public get personQuery(): string {\n    return this._personQuery;\n  }\n  @property({\n    attribute: 'person-query'\n  })\n  public set personQuery(value: string) {\n    if (value === this._personQuery) {\n      return;\n    }\n\n    this._personQuery = value;\n    this._personDetails = null;\n    this.personDetailsInternal = null;\n  }\n\n  /**\n   * Fallback when no user is found\n   *\n   * @type {IDynamicPerson}\n   */\n  public get fallbackDetails(): IDynamicPerson {\n    return this._fallbackDetails;\n  }\n  @property({\n    attribute: 'fallback-details',\n    type: Object\n  })\n  public set fallbackDetails(value: IDynamicPerson) {\n    if (value === this._fallbackDetails) {\n      return;\n    }\n\n    this._fallbackDetails = value;\n\n    if (this.personDetailsInternal) {\n      return;\n    }\n  }\n\n  /**\n   * user-id property allows developer to use id value to determine person\n   *\n   * @type {string}\n   */\n  public get userId(): string {\n    return this._userId;\n  }\n  @property({\n    attribute: 'user-id'\n  })\n  public set userId(value: string) {\n    if (value === this._userId) {\n      return;\n    }\n\n    this._userId = value;\n    this.personDetailsInternal = null;\n    this._personDetails = null;\n  }\n\n  /**\n   * usage property allows you to specify where the component is being used to add\n   * customized personalization for it. Currently only supports \"people\" and \"people-picker\" as used in\n   * the people component.\n   *\n   * @type {string}\n   */\n  public get usage(): string {\n    return this._usage;\n  }\n  @property({\n    attribute: 'usage'\n  })\n  public set usage(value: string) {\n    if (value === this._usage) {\n      return;\n    }\n\n    this._usage = value;\n  }\n\n  /**\n   * determines if person component renders presence\n   *\n   * @type {boolean}\n   */\n  @property({\n    attribute: 'show-presence',\n    type: Boolean\n  })\n  public showPresence = false;\n\n  /**\n   * determines person component avatar size and apply presence badge accordingly.\n   * Valid options are 'small', 'large', and 'auto'\n   * Default is \"auto\". When you set the view more than oneline, it will default to \"auto\".\n   *\n   * @type {AvatarSize}\n   */\n  @property({\n    attribute: 'avatar-size',\n    type: String\n  })\n  public avatarSize: AvatarSize = 'auto';\n\n  /**\n   * object containing Graph details on person\n   * a copy of person-details attribute\n   *\n   * @type {IDynamicPerson}\n   */\n  private get personDetailsInternal(): IDynamicPerson {\n    return this._personDetailsInternal;\n  }\n\n  @state()\n  private set personDetailsInternal(value: IDynamicPerson) {\n    if (this._personDetailsInternal === value) {\n      return;\n    }\n\n    this._personDetailsInternal = value;\n    this._fetchedImage = null;\n    this._fetchedPresence = null;\n  }\n\n  /**\n   * object containing Graph details on person\n   *\n   * @type {IDynamicPerson}\n   */\n  public get personDetails(): IDynamicPerson {\n    return this._personDetails;\n  }\n\n  @property({\n    attribute: 'person-details',\n    type: Object\n  })\n  public set personDetails(value: IDynamicPerson) {\n    if (this._personDetails === value) {\n      return;\n    }\n\n    this._personDetails = value;\n    this._fetchedImage = null;\n    this._fetchedPresence = null;\n  }\n\n  /**\n   * Set the image of the person\n   *\n   * @type {string}\n   * @memberof MgtPersonCard\n   */\n  public get personImage(): string {\n    return this._personImage || this._fetchedImage;\n  }\n  @property({\n    attribute: 'person-image',\n    type: String\n  })\n  public set personImage(value: string) {\n    if (value === this._personImage) {\n      return;\n    }\n\n    this._isInvalidImageSrc = !value;\n    this._personImage = value;\n  }\n\n  /**\n   * Sets whether the person image should be fetched\n   * from the Microsoft Graph based on the personDetailsInternal\n   * provided by the user\n   *\n   * @type {boolean}\n   * @memberof MgtPerson\n   */\n  @property({\n    attribute: 'fetch-image',\n    type: Boolean\n  })\n  public fetchImage = false;\n\n  /**\n   * Sets whether to disable the person image fetch from the Microsoft Graph\n   *\n   * @type {boolean}\n   * @memberof MgtPerson\n   */\n  @property({\n    attribute: 'disable-image-fetch',\n    type: Boolean\n  })\n  public disableImageFetch = false;\n\n  /**\n   * Sets the vertical layout of\n   * the Person Card\n   *\n   * @type {boolean}\n   * @memberof MgtPerson\n   */\n  @property({\n    attribute: 'vertical-layout',\n    type: Boolean\n  })\n  public verticalLayout: boolean;\n\n  /**\n   * Determines and sets person avatar view\n   * Valid options are 'photo' or 'initials'\n   *\n   * @type {AvatarType}\n   * @memberof MgtPerson\n   */\n  @property({\n    attribute: 'avatar-type',\n    converter: (value): AvatarType => avatarTypeConverter(value, 'photo')\n  })\n  public avatarType: AvatarType = 'photo';\n\n  /**\n   * Gets or sets presence of person\n   *\n   * @type {MicrosoftGraph.Presence}\n   * @memberof MgtPerson\n   */\n  public get personPresence(): Presence {\n    return this._personPresence || this._fetchedPresence;\n  }\n  @property({\n    attribute: 'person-presence',\n    type: Object\n  })\n  public set personPresence(value: Presence) {\n    if (value === this._personPresence) {\n      return;\n    }\n    this._personPresence = value;\n  }\n\n  /**\n   * Sets how the person-card is invoked\n   * Valid options are: 'none', 'hover', or 'click'\n   * Set to 'none' to not show the card\n   *\n   * @default PersonCardInteraction.none\n   * @type {PersonCardInteraction}\n   * @memberof MgtPerson\n   */\n  @property({\n    attribute: 'person-card',\n    converter: value => personCardConverter(value)\n  })\n  public personCardInteraction: PersonCardInteraction = 'none';\n\n  /**\n   * Get the scopes required for person\n   *\n   * @static\n   * @return {*}  {string[]}\n   * @memberof MgtPerson\n   */\n  public static get requiredScopes(): string[] {\n    const scopes = ['user.readbasic.all', 'user.read', 'people.read', 'presence.read.all', 'presence.read'];\n\n    if (MgtPerson.config.useContactApis) {\n      scopes.push('contacts.read');\n    }\n\n    return scopes;\n  }\n\n  /**\n   * Gets the flyout element\n   *\n   * @protected\n   * @type {MgtFlyout}\n   * @memberof MgtPerson\n   */\n  protected get flyout(): MgtFlyout {\n    return this.renderRoot.querySelector('.flyout');\n  }\n\n  /**\n   * Sets the property of the personDetailsInternal to use for the first line of text.\n   * Default is displayName.\n   *\n   * @type {string}\n   * @memberof MgtPerson\n   */\n  @property({ attribute: 'line1-property' }) public line1Property: string;\n\n  /**\n   * Sets the property of the personDetailsInternal to use for the second line of text.\n   * Default is mail.\n   *\n   * @type {string}\n   * @memberof MgtPerson\n   */\n  @property({ attribute: 'line2-property' }) public line2Property: string;\n\n  /**\n   * Sets the property of the personDetailsInternal to use for the third line of text.\n   * Default is mail.\n   *\n   * @type {string}\n   * @memberof MgtPerson\n   */\n  @property({ attribute: 'line3-property' }) public line3Property: string;\n\n  /**\n   * Sets the property of the personDetailsInternal to use for the fourth line of text.\n   * Default is mail.\n   *\n   * @type {string}\n   * @memberof MgtPerson\n   */\n  @property({ attribute: 'line4-property' }) public line4Property: string;\n\n  /**\n   * Sets what data to be rendered.\n   * Valid options are 'image', 'oneline', 'twolines', 'threelines', or 'fourlines'\n   * Default is 'image'.\n   *\n   * @type {ViewType}\n   * @memberof MgtPerson\n   */\n  @property({\n    converter: value => viewTypeConverter(value, 'image')\n  })\n  public view: ViewType = 'image';\n\n  @state() private _fetchedImage: string;\n  @state() private _fetchedPresence: Presence;\n  @state() private _isInvalidImageSrc: boolean;\n  @state() private _personCardShouldRender: boolean;\n  @state() private _hasLoadedPersonCard = false;\n\n  private _personDetailsInternal: IDynamicPerson;\n  private _personDetails: IDynamicPerson;\n  private _fallbackDetails: IDynamicPerson;\n  private _personImage: string;\n  private _personPresence: Presence;\n  private _personQuery: string;\n  private _userId: string;\n  private _usage: string;\n\n  private _mouseLeaveTimeout = -1;\n  private _mouseEnterTimeout = -1;\n\n  constructor() {\n    super();\n\n    // defaults\n    this.personCardInteraction = 'none';\n    this.line1Property = 'displayName';\n    this.line2Property = 'jobTitle';\n    this.line3Property = 'department';\n    this.line4Property = 'email';\n    this.view = 'image';\n    this.avatarSize = 'auto';\n    this.disableImageFetch = false;\n    this._isInvalidImageSrc = false;\n    this.avatarType = 'photo';\n    this.verticalLayout = false;\n  }\n\n  protected readonly renderContent = () => {\n    // Prep data\n    const person = this.personDetails || this.personDetailsInternal || this.fallbackDetails;\n    const image = this.getImage();\n    const presence = this.personPresence || this._fetchedPresence;\n\n    if (!person && !image) {\n      return this.renderNoData();\n    }\n    if (!person?.personImage && image) {\n      person.personImage = image;\n    }\n\n    // Default template\n    let personTemplate = this.renderTemplate('default', { person, personImage: image, personPresence: presence });\n\n    if (!personTemplate) {\n      const detailsTemplate: TemplateResult = this.renderDetails(person, presence);\n      const imageWithPresenceTemplate: TemplateResult = this.renderAvatar(person, image, presence);\n\n      personTemplate = html`\n        ${imageWithPresenceTemplate}\n        ${detailsTemplate}\n      `;\n    }\n\n    const showPersonCard = this.personCardInteraction !== 'none';\n    if (showPersonCard) {\n      personTemplate = this.renderFlyout(personTemplate, person, image, presence);\n    }\n\n    const rootClasses = classMap({\n      'person-root': true,\n      small: !this.isThreeLines() && !this.isFourLines() && !this.isLargeAvatar(),\n      large: this.avatarSize !== 'auto' && this.isLargeAvatar(),\n      noline: this.isNoLine(),\n      oneline: this.isOneLine(),\n      twolines: this.isTwoLines(),\n      threelines: this.isThreeLines(),\n      fourlines: this.isFourLines(),\n      vertical: this.isVertical()\n    });\n\n    return html`\n      <div\n        class=\"${rootClasses}\"\n        dir=${this.direction}\n        @click=${this.handleMouseClick}\n        @mouseenter=${this.handleMouseEnter}\n        @mouseleave=${this.handleMouseLeave}\n        @keydown=${this.handleKeyDown}\n        tabindex=\"${ifDefined(this.personCardInteraction !== 'none' ? '0' : undefined)}\"\n      >\n        ${personTemplate}\n      </div>\n    `;\n  };\n\n  /**\n   * Render the loading state\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtPerson\n   */\n  protected renderLoading = (): TemplateResult => {\n    return this.renderTemplate('loading', null) || html``;\n  };\n\n  /**\n   * Clears state of the component\n   *\n   * @protected\n   * @memberof MgtPerson\n   */\n  protected clearState(): void {\n    this._personImage = '';\n    this._personDetailsInternal = null;\n    this._fetchedImage = null;\n    this._fetchedPresence = null;\n  }\n\n  /**\n   * Render the state when no data is available\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtPerson\n   */\n  protected renderNoData(): TemplateResult {\n    const noDataTemplate = this.renderTemplate('no-data', null);\n    if (noDataTemplate) {\n      return noDataTemplate;\n    }\n\n    const avatarClasses = {\n      'avatar-icon': true,\n      vertical: this.isVertical(),\n      small: !this.isLargeAvatar(),\n      noline: this.isNoLine(),\n      oneline: this.isOneLine(),\n      twolines: this.isTwoLines(),\n      threelines: this.isThreeLines(),\n      fourlines: this.isFourLines()\n    };\n\n    return html`\n       <i class=${classMap(avatarClasses)}></i>\n     `;\n  }\n\n  /**\n   * Render a person icon.\n   *\n   * @protected\n   * @returns\n   * @memberof MgtPerson\n   */\n  protected renderPersonIcon() {\n    return getSvg(SvgIcon.Person);\n  }\n\n  /**\n   * Render the image part of the person template.\n   * If the image is unavailable, the person's initials will be used instead.\n   *\n   * @protected\n   * @param {string} [imageSrc]\n   * @param {IDynamicPerson} [personDetailsInternal]\n   * @returns\n   * @memberof MgtPerson\n   */\n  protected renderImage(personDetailsInternal: IDynamicPerson, imageSrc: string) {\n    const altText = `${this.strings.photoFor} ${personDetailsInternal.displayName}`;\n    const hasImage = imageSrc && !this._isInvalidImageSrc && this.avatarType === 'photo';\n    const imageOnly = this.avatarType === 'photo' && this.view === 'image';\n    const titleText =\n      (personDetailsInternal?.displayName ||\n        `${this.strings.emailAddress} ${getEmailFromGraphEntity(personDetailsInternal)}`) ??\n      undefined;\n    const imageTemplate = html`<img\n      title=\"${ifDefined(imageOnly ? titleText : undefined)}\"\n      alt=${altText}\n      src=${imageSrc}\n      @error=${() => (this._isInvalidImageSrc = true)} />`;\n\n    const initials = personDetailsInternal ? this.getInitials(personDetailsInternal) : '';\n    const hasInitials = initials?.length;\n    const textClasses = classMap({\n      initials: hasInitials && !hasImage,\n      'contact-icon': !hasInitials\n    });\n    const contactIconTemplate = html`<i>${this.renderPersonIcon()}</i>`;\n    // consider the image to presentational if the view is anything other than image.\n    // this reduces the redundant announcement of the user's name.\n    const textTemplate = html`\n      <span \n        title=\"${ifDefined(this.view === 'image' ? titleText : undefined)}\"\n        role=\"${ifDefined(this.view === 'image' ? undefined : 'presentation')}\"\n        class=\"${textClasses}\"\n      >\n        ${hasInitials ? initials : contactIconTemplate}\n      </span>\n`;\n    if (hasImage) {\n      this.fireCustomEvent('person-image-rendered');\n    } else {\n      this.fireCustomEvent('person-icon-rendered');\n    }\n\n    return hasImage ? imageTemplate : textTemplate;\n  }\n\n  /**\n   * Render presence for the person.\n   *\n   * @param presence\n   * @memberof MgtPerson\n   * @returns\n   */\n  protected renderPresence(presence: Presence): TemplateResult {\n    if (!this.showPresence || !presence) {\n      return html``;\n    }\n    let presenceIcon: TemplateResult;\n\n    const { activity, availability } = presence;\n    switch (availability) {\n      case 'Available':\n      case 'AvailableIdle':\n        switch (activity) {\n          case 'OutOfOffice':\n            presenceIcon = getSvg(SvgIcon.PresenceOofAvailable);\n            break;\n          // OutOfOffice and Uknowns\n          case 'Available':\n          default:\n            presenceIcon = getSvg(SvgIcon.PresenceAvailable);\n            break;\n        }\n        break;\n      case 'Busy':\n      case 'BusyIdle':\n        switch (activity) {\n          case 'OutOfOffice':\n          case 'OnACall':\n            presenceIcon = getSvg(SvgIcon.PresenceOofBusy);\n            break;\n          // Busy,InACall,InAConferenceCall,InAMeeting, Unknown\n          case 'Busy':\n          case 'InACall':\n          case 'InAMeeting':\n          case 'InAConferenceCall':\n          default:\n            presenceIcon = getSvg(SvgIcon.PresenceBusy);\n            break;\n        }\n        break;\n      case 'DoNotDisturb':\n        switch (activity) {\n          case 'OutOfOffice':\n            presenceIcon = getSvg(SvgIcon.PresenceOofDnd);\n            break;\n          case 'Presenting':\n          case 'Focusing':\n          case 'UrgentInterruptionsOnly':\n          default:\n            presenceIcon = getSvg(SvgIcon.PresenceDnd);\n            break;\n        }\n        break;\n\n      case 'Away':\n        switch (activity) {\n          case 'OutOfOffice':\n            presenceIcon = getSvg(SvgIcon.PresenceOofAway);\n            break;\n          case 'AwayLastSeenTime':\n          default:\n            presenceIcon = getSvg(SvgIcon.PresenceAway);\n            break;\n        }\n        break;\n      case 'BeRightBack':\n        switch (activity) {\n          default:\n            presenceIcon = getSvg(SvgIcon.PresenceAway);\n            break;\n        }\n        break;\n      case 'Offline':\n        switch (activity) {\n          case 'Offline':\n            presenceIcon = getSvg(SvgIcon.PresenceOffline);\n            break;\n          case 'OutOfOffice':\n          case 'OffWork':\n            presenceIcon = getSvg(SvgIcon.PresenceOofAway);\n            break;\n          default:\n            presenceIcon = getSvg(SvgIcon.PresenceStatusUnknown);\n            break;\n        }\n        break;\n      default:\n        presenceIcon = getSvg(SvgIcon.PresenceStatusUnknown);\n        break;\n    }\n\n    const presenceWrapperClasses = classMap({\n      'presence-wrapper': true,\n      noline: this.isNoLine(),\n      oneline: this.isOneLine()\n    });\n\n    const formattedActivity = (this.strings[activity] as string) ?? nothing;\n\n    return html`\n      <span\n        class=\"${presenceWrapperClasses}\"\n        title=\"${formattedActivity}\"\n        aria-label=\"${formattedActivity}\"\n        role=\"img\">\n          ${presenceIcon}\n      </span>\n    `;\n  }\n\n  /**\n   * Render image with presence for the person.\n   *\n   * @protected\n   * @param\n   * @memberof MgtPersonCard\n   */\n  protected renderAvatar(personDetailsInternal: IDynamicPerson, image: string, presence: Presence): TemplateResult {\n    const imageTemplate: TemplateResult = this.renderImage(personDetailsInternal, image);\n    const presenceTemplate: TemplateResult = this.renderPresence(presence);\n\n    return html`\n      <div class=\"avatar-wrapper\">\n        ${imageTemplate}\n        ${presenceTemplate}\n      </div>\n    `;\n  }\n\n  private handleLine1Clicked() {\n    this.fireCustomEvent('line1clicked', this.personDetailsInternal);\n  }\n\n  private handleLine2Clicked() {\n    this.fireCustomEvent('line2clicked', this.personDetailsInternal);\n  }\n\n  private handleLine3Clicked() {\n    this.fireCustomEvent('line3clicked', this.personDetailsInternal);\n  }\n\n  private handleLine4Clicked() {\n    this.fireCustomEvent('line4clicked', this.personDetailsInternal);\n  }\n\n  /**\n   * Render the details part of the person template.\n   *\n   * @param personProps\n   * @param presence\n   * @memberof MgtPerson\n   * @returns\n   */\n  protected renderDetails(personProps: IDynamicPerson, presence?: Presence): TemplateResult {\n    if (!personProps || this.view === 'image') {\n      return html``;\n    }\n\n    const person: IDynamicPerson & { presenceActivity?: string; presenceAvailability?: string } = personProps;\n    if (presence) {\n      person.presenceActivity = presence?.activity;\n      person.presenceAvailability = presence?.availability;\n    }\n\n    const details: TemplateResult[] = [];\n\n    // we already returned on image, so we must have a first line\n    const line1text = this.getTextFromProperty(person, this.line1Property);\n    if (this.hasTemplate('line1')) {\n      // Render the line1 template\n      const template = this.renderTemplate('line1', { person });\n      details.push(html`\n        <div class=\"line1\" part=\"detail-line\" @click=${() =>\n          this.handleLine1Clicked()} role=\"presentation\" aria-label=\"${line1text}\">${template}</div>\n`);\n    } else {\n      // Render the line1 property value\n      if (line1text) {\n        details.push(html`\n          <div class=\"line1\" part=\"detail-line\" @click=${() =>\n            this.handleLine1Clicked()} role=\"presentation\" aria-label=\"${line1text}\">${line1text}</div>\n`);\n      }\n    }\n\n    // if we have more than one line we add the second line\n    if (this.view !== 'oneline') {\n      const text = this.getTextFromProperty(person, this.line2Property);\n      if (this.hasTemplate('line2')) {\n        // Render the line2 template\n        const template = this.renderTemplate('line2', { person });\n        details.push(html`\n          <div class=\"line2\" part=\"detail-line\" @click=${() =>\n            this.handleLine2Clicked()} role=\"presentation\" aria-label=\"${text}\">${template}</div>\n`);\n      } else {\n        // Render the line2 property value\n        if (text) {\n          details.push(html`\n            <div class=\"line2\" part=\"detail-line\" @click=${() =>\n              this.handleLine2Clicked()} role=\"presentation\" aria-label=\"${text}\">${text}</div>\n`);\n        }\n      }\n    }\n\n    // if we have a third or fourth line we add the third line\n    if (this.view === 'threelines' || this.view === 'fourlines') {\n      const text = this.getTextFromProperty(person, this.line3Property);\n      if (this.hasTemplate('line3')) {\n        // Render the line3 template\n        const template = this.renderTemplate('line3', { person });\n        details.push(html`\n          <div class=\"line3\" part=\"detail-line\" @click=${() =>\n            this.handleLine3Clicked()} role=\"presentation\" aria-label=\"${text}\">${template}</div>\n         `);\n      } else {\n        // Render the line3 property value\n        if (text) {\n          details.push(html`\n            <div class=\"line3\" part=\"detail-line\" @click=${() =>\n              this.handleLine3Clicked()} role=\"presentation\" aria-label=\"${text}\">${text}</div>\n`);\n        }\n      }\n    }\n\n    // add the fourth line if necessary\n    if (this.view === 'fourlines') {\n      const text = this.getTextFromProperty(person, this.line4Property);\n      if (this.hasTemplate('line4')) {\n        // Render the line4 template\n        const template = this.renderTemplate('line4', { person });\n        details.push(html`\n          <div class=\"line4\" part=\"detail-line\" @click=${() =>\n            this.handleLine4Clicked()} role=\"presentation\" aria-label=\"${text}\">${template}</div>\n        `);\n      } else {\n        // Render the line4 property value\n        if (text) {\n          details.push(html`\n            <div class=\"line4\" part=\"detail-line\" @click=${() =>\n              this.handleLine4Clicked()} role=\"presentation\" aria-label=\"${text}\">${text}</div>\n          `);\n        }\n      }\n    }\n\n    const detailsClasses = classMap({\n      'details-wrapper': true,\n      vertical: this.isVertical()\n    });\n\n    return html`\n      <div class=\"${detailsClasses}\">\n        ${details}\n      </div>\n    `;\n  }\n\n  /**\n   * Render the details flyout.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtPerson\n   */\n  protected renderFlyout(\n    anchor: TemplateResult,\n    personDetails: IDynamicPerson,\n    image: string,\n    presence: Presence\n  ): TemplateResult {\n    const flyoutContent =\n      this._personCardShouldRender && this._hasLoadedPersonCard\n        ? html`\n           <div slot=\"flyout\" data-testid=\"flyout-slot\">\n             ${this.renderFlyoutContent(personDetails, image, presence)}\n           </div>`\n        : html``;\n\n    const slotClasses = classMap({\n      small: !this.isThreeLines() && !this.isFourLines() && !this.isLargeAvatar(),\n      large: this.avatarSize !== 'auto' && this.isLargeAvatar(),\n      noline: this.isNoLine(),\n      oneline: this.isOneLine(),\n      twolines: this.isTwoLines(),\n      threelines: this.isThreeLines(),\n      fourlines: this.isFourLines(),\n      vertical: this.isVertical()\n    });\n\n    return mgtHtml`\n      <mgt-flyout light-dismiss class=\"flyout\" .avoidHidingAnchor=${false}>\n        <div slot=\"anchor\" class=\"${slotClasses}\">${anchor}</div>\n        ${flyoutContent}\n      </mgt-flyout>`;\n  }\n\n  /**\n   * Render the flyout menu content.\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtPerson\n   */\n  protected renderFlyoutContent(personDetails: IDynamicPerson, image: string, presence: Presence): TemplateResult {\n    this.fireCustomEvent('flyout-content-rendered');\n    return (\n      this.renderTemplate('person-card', { person: personDetails, personImage: image }) ||\n      mgtHtml`\n        <mgt-person-card\n          class=\"mgt-person-card\"\n          lock-tab-navigation\n          .personDetails=${personDetails}\n          .personImage=${image}\n          .personPresence=${presence}\n          .showPresence=${this.showPresence}>\n        </mgt-person-card>`\n    );\n  }\n\n  protected args() {\n    return [\n      this.providerState,\n      this.verticalLayout,\n      this.view,\n      this.fallbackDetails,\n      this.line1Property,\n      this.line2Property,\n      this.line3Property,\n      this.line4Property,\n      this.fetchImage,\n      this.avatarType,\n      this.userId,\n      this.personQuery,\n      this.disableImageFetch,\n      this.showPresence,\n      this.personPresence,\n      this.personDetails\n    ];\n  }\n\n  /**\n   * load state into the component.\n   *\n   * @protected\n   * @returns\n   * @memberof MgtPerson\n   */\n  protected async loadState() {\n    const provider = Providers.globalProvider;\n    if (!provider || provider.state === ProviderState.Loading) {\n      return;\n    }\n\n    if (provider && provider.state === ProviderState.SignedOut) {\n      this.personDetailsInternal = null;\n      return;\n    }\n\n    const graph = provider.graph.forComponent(this);\n\n    if ((this.verticalLayout && this.view !== 'fourlines') || this.fallbackDetails) {\n      this.line2Property = 'email';\n    }\n\n    // Prepare person props\n    let personProps = [\n      ...defaultPersonProperties,\n      this.line1Property,\n      this.line2Property,\n      this.line3Property,\n      this.line4Property\n    ];\n    personProps = personProps.filter(email => email !== 'email');\n\n    let details = this.personDetailsInternal || this.personDetails;\n    if (details) {\n      if (\n        !details.personImage &&\n        this.fetchImage &&\n        this.avatarType === 'photo' &&\n        !this.personImage &&\n        !this._fetchedImage\n      ) {\n        let image: string;\n        if ('groupTypes' in details) {\n          image = await getGroupImage(graph, details);\n        } else {\n          image = await getPersonImage(graph, details, MgtPerson.config.useContactApis);\n        }\n        if (image) {\n          details.personImage = image;\n          this._fetchedImage = image;\n        }\n      }\n    } else if (this.userId || this.personQuery === 'me') {\n      // Use userId or 'me' query to get the person and image\n      let person: IDynamicPerson;\n      if (this.avatarType === 'photo' && !this.disableImageFetch) {\n        person = await getUserWithPhoto(graph, this.userId, personProps);\n      } else {\n        if (this.personQuery === 'me') {\n          person = await getMe(graph, personProps);\n        } else {\n          person = await getUser(graph, this.userId, personProps);\n        }\n      }\n      this.personDetailsInternal = person;\n      this.personDetails = person;\n      this._fetchedImage = this.getImage();\n    } else if (this.personQuery) {\n      // Use the personQuery to find our person.\n      let people = await findPeople(graph, this.personQuery, 1);\n\n      if (!people || people.length === 0) {\n        people = (await findUsers(graph, this.personQuery, 1)) || [];\n      }\n\n      if (people?.length) {\n        this.personDetailsInternal = people[0];\n        this.personDetails = people[0];\n        if (this.avatarType === 'photo' && !this.disableImageFetch) {\n          const image = await getPersonImage(graph, people[0], MgtPerson.config.useContactApis);\n\n          if (image) {\n            this.personDetailsInternal.personImage = image;\n            this.personDetails.personImage = image;\n            this._fetchedImage = image;\n          }\n        }\n      }\n    }\n\n    details = this.personDetailsInternal || this.personDetails || this.fallbackDetails;\n\n    // populate presence\n    const defaultPresence: Presence = {\n      activity: 'Offline',\n      availability: 'Offline',\n      id: null\n    };\n\n    if (this.showPresence && !this.personPresence && !this._fetchedPresence) {\n      try {\n        if (details) {\n          // setting userId to 'me' ensures only the presence.read permission is required\n          const userId = this.personQuery !== 'me' ? details?.id : null;\n          this._fetchedPresence = await getUserPresence(graph, userId);\n        } else {\n          this._fetchedPresence = defaultPresence;\n        }\n      } catch (_) {\n        // set up a default Presence in case beta api changes or getting error code\n        this._fetchedPresence = defaultPresence;\n      }\n    }\n  }\n\n  /**\n   * Gets the user initials\n   *\n   * @protected\n   * @returns {string}\n   * @memberof MgtPerson\n   */\n  protected getInitials(person?: IDynamicPerson): string {\n    if (!person) {\n      person = this.personDetailsInternal;\n    }\n\n    if (isContact(person)) {\n      return person.initials;\n    }\n\n    let initials = '';\n    if (isUser(person)) {\n      initials += person.givenName?.[0]?.toUpperCase() ?? '';\n      initials += person.surname?.[0]?.toUpperCase() ?? '';\n    }\n\n    if (!initials && person.displayName) {\n      const name = person.displayName.split(/\\s+/);\n      for (let i = 0; i < 2 && i < name.length; i++) {\n        if (name[i][0] && this.isLetter(name[i][0])) {\n          initials += name[i][0].toUpperCase();\n        }\n      }\n    }\n\n    return initials;\n  }\n\n  private getImage(): string {\n    if (this.personImage) {\n      return this.personImage;\n    }\n\n    if (this._fetchedImage) {\n      return this._fetchedImage;\n    }\n\n    const person = this.personDetailsInternal || this.personDetails;\n    return person?.personImage ? person.personImage : null;\n  }\n\n  private isLetter(char: string) {\n    try {\n      return char.match(new RegExp('\\\\p{L}', 'u'));\n    } catch (e) {\n      return char.toLowerCase() !== char.toUpperCase();\n    }\n  }\n\n  private getTextFromProperty(personDetailsInternal: IDynamicPerson, prop: string): string {\n    if (!prop || prop.length === 0) {\n      return null;\n    }\n\n    const properties = prop.trim().split(',');\n    let text: string;\n    let i = 0;\n\n    while (!text && i < properties.length) {\n      const currentProp = properties[i].trim();\n      switch (currentProp) {\n        case 'mail':\n        case 'email':\n          text = getEmailFromGraphEntity(personDetailsInternal);\n          break;\n        default:\n          text = personDetailsInternal[currentProp] as string;\n      }\n      i++;\n    }\n\n    return text;\n  }\n\n  private isLargeAvatar() {\n    return (\n      this.avatarSize === 'large' || (this.avatarSize === 'auto' && this.view !== 'image' && this.view !== 'oneline')\n    );\n  }\n\n  private isNoLine() {\n    return this.view === 'image';\n  }\n\n  private isOneLine() {\n    return this.view === 'oneline';\n  }\n\n  private isTwoLines() {\n    return this.view === 'twolines';\n  }\n\n  private isThreeLines() {\n    return this.view === 'threelines';\n  }\n\n  private isFourLines() {\n    return this.view === 'fourlines';\n  }\n\n  private isVertical() {\n    return this.verticalLayout;\n  }\n\n  private readonly handleMouseClick = (e: MouseEvent) => {\n    const element = e.target as HTMLElement;\n    // todo: fix for disambiguation\n    if (\n      this.personCardInteraction === 'click' &&\n      element.tagName !== `${customElementHelper.prefix}-PERSON-CARD`.toUpperCase()\n    ) {\n      this.showPersonCard();\n    }\n  };\n\n  private readonly handleKeyDown = (e: KeyboardEvent) => {\n    // enter activates person-card\n    if (e) {\n      if (e.key === 'Enter') {\n        this.showPersonCard();\n      }\n    }\n  };\n\n  private readonly handleMouseEnter = () => {\n    clearTimeout(this._mouseEnterTimeout);\n    clearTimeout(this._mouseLeaveTimeout);\n    if (this.personCardInteraction !== 'hover') {\n      return;\n    }\n    this._mouseEnterTimeout = window.setTimeout(this.showPersonCard, 500);\n  };\n\n  private readonly handleMouseLeave = () => {\n    clearTimeout(this._mouseEnterTimeout);\n    clearTimeout(this._mouseLeaveTimeout);\n    this._mouseLeaveTimeout = window.setTimeout(this.hidePersonCard, 500);\n  };\n\n  /**\n   * hides the person card\n   *\n   * @memberof MgtPerson\n   */\n  public hidePersonCard = () => {\n    const flyout = this.flyout;\n    if (flyout) {\n      flyout.close();\n    }\n    const personCard =\n      this.querySelector<Element & IExpandable & IHistoryClearer>('.mgt-person-card') ||\n      this.renderRoot.querySelector('.mgt-person-card');\n    if (personCard) {\n      personCard.isExpanded = false;\n      personCard.clearHistory();\n    }\n  };\n\n  private readonly loadPersonCardResources = async () => {\n    // if there could be a person-card then we should load those resources using a dynamic import\n    if (this.personCardInteraction !== 'none' && !this._hasLoadedPersonCard) {\n      const { registerMgtPersonCardComponent } = await import('../mgt-person-card/mgt-person-card');\n\n      // only register person card if it hasn't been registered yet\n      if (!customElements.get(buildComponentName('person-card'))) registerMgtPersonCardComponent();\n\n      this._hasLoadedPersonCard = true;\n    }\n  };\n\n  public showPersonCard = () => {\n    if (!this._personCardShouldRender) {\n      this._personCardShouldRender = true;\n      void this.loadPersonCardResources();\n    }\n\n    const flyout = this.flyout;\n    if (flyout) {\n      flyout.open();\n    }\n  };\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { html, PropertyValues, TemplateResult } from 'lit';\nimport { property } from 'lit/decorators.js';\nimport { classMap } from 'lit/directives/class-map.js';\nimport { getSegmentAwareWindow, isWindowSegmentAware, IWindowSegment } from '../../../utils/WindowSegmentHelpers';\nimport { styles } from './mgt-flyout-css';\nimport { MgtBaseTaskComponent } from '@microsoft/mgt-element/';\nimport { registerComponent } from '@microsoft/mgt-element';\n\nexport const registerMgtFlyoutComponent = () => registerComponent('flyout', MgtFlyout);\n\n/**\n * A component to create flyout anchored to an element\n *\n * @export\n * @class MgtFlyout\n * @extends {LitElement}\n */\nexport class MgtFlyout extends MgtBaseTaskComponent {\n  /**\n   * Array of styles to apply to the element. The styles should be defined\n   * using the `css` tag function.\n   */\n  static get styles() {\n    return styles;\n  }\n\n  /**\n   * Gets or sets whether the flyout is light dismissible.\n   *\n   * @type {boolean}\n   * @memberof MgtFlyout\n   */\n  @property({\n    attribute: 'light-dismiss',\n    type: Boolean\n  })\n  public isLightDismiss: boolean;\n\n  /**\n   * Gets or sets whether the flyout should avoid rendering the flyout\n   * on top of the anchor\n   *\n   * @type {boolean}\n   * @memberof MgtFlyout\n   */\n  @property({\n    attribute: null,\n    type: Boolean\n  })\n  public avoidHidingAnchor: boolean;\n\n  /**\n   * Gets or sets whether the flyout is visible\n   *\n   * @type {string}\n   * @memberof MgtFlyout\n   */\n  @property({\n    attribute: 'isOpen',\n    type: Boolean\n  })\n  public get isOpen(): boolean {\n    return this._isOpen;\n  }\n  public set isOpen(value: boolean) {\n    const oldValue = this._isOpen;\n    if (oldValue === value) {\n      return;\n    }\n\n    this._isOpen = value;\n\n    window.requestAnimationFrame(() => {\n      this.setupWindowEvents(this.isOpen);\n      const flyout = this._flyout;\n      if (!this.isOpen && flyout) {\n        // reset style for next update\n        flyout.style.width = null;\n        flyout.style.setProperty('--mgt-flyout-set-width', null);\n        flyout.style.setProperty('--mgt-flyout-set-height', null);\n        flyout.style.maxHeight = null;\n        flyout.style.top = null;\n        flyout.style.left = null;\n        flyout.style.bottom = null;\n      }\n    });\n\n    this.requestUpdate('isOpen', oldValue);\n    this.dispatchEvent(new Event(value ? 'opened' : 'closed'));\n  }\n\n  // Minimum distance to render from window edge\n  private get _edgePadding() {\n    return 24;\n  }\n\n  // if the flyout is opened once, this will keep the flyout in the dom\n  private _renderedOnce = false;\n\n  private get _flyout(): HTMLElement {\n    return this.renderRoot.querySelector('.flyout');\n  }\n\n  private get _anchor(): HTMLElement {\n    return this.renderRoot.querySelector('.anchor');\n  }\n\n  private get _topScout(): HTMLElement {\n    return this.renderRoot.querySelector('.scout-top');\n  }\n\n  private get _bottomScout(): HTMLElement {\n    return this.renderRoot.querySelector('.scout-bottom');\n  }\n\n  private _isOpen = false;\n  private _smallView = false;\n  private _windowHeight: number;\n\n  constructor() {\n    super();\n\n    this.avoidHidingAnchor = true;\n\n    // handling when person-card is expanded and size changes\n    this.addEventListener('expanded', () => {\n      window.requestAnimationFrame(() => {\n        this.updateFlyout();\n      });\n    });\n  }\n\n  /**\n   * Show the flyout.\n   */\n  public open(): void {\n    this.isOpen = true;\n  }\n\n  /**\n   * Close the flyout.\n   */\n  public close(): void {\n    this.isOpen = false;\n  }\n\n  /**\n   * Invoked each time the custom element is disconnected from the document's DOM\n   *\n   * @memberof MgtFlyout\n   */\n  public disconnectedCallback() {\n    this.setupWindowEvents(false);\n    super.disconnectedCallback();\n  }\n\n  /**\n   * Invoked whenever the element is updated. Implement to perform\n   * post-updating tasks via DOM APIs, for example, focusing an element.\n   *\n   * Setting properties inside this method will trigger the element to update\n   * again after this update cycle completes.\n   *\n   * @param changedProperties Map of changed properties with old values\n   */\n  protected updated(changedProps: PropertyValues) {\n    super.updated(changedProps);\n\n    window.requestAnimationFrame(() => {\n      this.updateFlyout();\n    });\n  }\n\n  /**\n   * Invoked on each update to perform rendering tasks. This method must return\n   * a lit-html TemplateResult. Setting properties inside this method will *not*\n   * trigger the element to update.\n   */\n  protected render() {\n    const flyoutClasses = {\n      root: true,\n      visible: this.isOpen\n    };\n\n    const anchorTemplate = this.renderAnchor();\n    let flyoutTemplate = null;\n    this._windowHeight =\n      window.innerHeight && document.documentElement.clientHeight\n        ? Math.min(window.innerHeight, document.documentElement.clientHeight)\n        : window.innerHeight || document.documentElement.clientHeight;\n\n    if (this._windowHeight < 250) {\n      this._smallView = true;\n    }\n\n    if (this.isOpen || this._renderedOnce) {\n      this._renderedOnce = true;\n      const smallFlyoutClasses = classMap({\n        flyout: true,\n        small: this._smallView\n      });\n      flyoutTemplate = html`\n        <div class=${smallFlyoutClasses} @wheel=${this.handleFlyoutWheel}>\n          ${this.renderFlyout()}\n        </div>\n      `;\n    }\n\n    return html`\n      <div class=${classMap(flyoutClasses)}>\n        <div class=\"anchor\">\n          ${anchorTemplate}\n        </div>\n        <div class=\"scout-top\"></div>\n        <div class=\"scout-bottom\"></div>\n        ${flyoutTemplate}\n      </div>\n    `;\n  }\n\n  /**\n   * Renders the anchor content.\n   *\n   * @protected\n   * @returns\n   * @memberof MgtFlyout\n   */\n  protected renderAnchor(): TemplateResult {\n    return html`\n      <slot name=\"anchor\"></slot>\n    `;\n  }\n\n  /**\n   * Renders the flyout.\n   */\n  protected renderFlyout(): TemplateResult {\n    return html`\n      <slot name=\"flyout\"></slot>\n    `;\n  }\n\n  /**\n   * Updates the position of the flyout.\n   * Makes a second recursive call to ensure the flyout is positioned correctly.\n   * This is needed as the width of the flyout is not settled until after the first render.\n   *\n   * @private\n   * @param {boolean} [firstPass=true]\n   * @return {*}\n   * @memberof MgtFlyout\n   */\n  private updateFlyout(firstPass = true) {\n    if (!this.isOpen) {\n      return;\n    }\n\n    const anchor = this._anchor;\n    const flyout = this._flyout;\n\n    if (flyout && anchor) {\n      const windowWidth =\n        window.innerWidth && document.documentElement.clientWidth\n          ? Math.min(window.innerWidth, document.documentElement.clientWidth)\n          : window.innerWidth || document.documentElement.clientWidth;\n\n      this._windowHeight =\n        window.innerHeight && document.documentElement.clientHeight\n          ? Math.min(window.innerHeight, document.documentElement.clientHeight)\n          : window.innerHeight || document.documentElement.clientHeight;\n\n      let left = 0;\n      let bottom: number;\n      let top = 0;\n      let height: number;\n      let width: number;\n\n      const flyoutRect = flyout.getBoundingClientRect();\n      const anchorRect = anchor.getBoundingClientRect();\n      const topScoutRect = this._topScout.getBoundingClientRect();\n      const bottomScoutRect = this._bottomScout.getBoundingClientRect();\n\n      const windowRect: IWindowSegment = {\n        height: this._windowHeight,\n        left: 0,\n        top: 0,\n        width: windowWidth\n      };\n\n      if (isWindowSegmentAware()) {\n        const segmentAwareWindow = getSegmentAwareWindow();\n        const screenSegments = segmentAwareWindow.getWindowSegments();\n\n        let anchorSegment: IWindowSegment;\n\n        const anchorCenterX = anchorRect.left + anchorRect.width / 2;\n        const anchorCenterY = anchorRect.top + anchorRect.height / 2;\n\n        for (const segment of screenSegments) {\n          if (anchorCenterX >= segment.left && anchorCenterY >= segment.top) {\n            anchorSegment = segment;\n            break;\n          }\n        }\n\n        if (anchorSegment) {\n          windowRect.left = anchorSegment.left;\n          windowRect.top = anchorSegment.top;\n          windowRect.width = anchorSegment.width;\n          windowRect.height = anchorSegment.height;\n        }\n      }\n\n      if (flyoutRect.width + 2 * this._edgePadding > windowRect.width) {\n        if (flyoutRect.width > windowRect.width) {\n          // flyout is wider than the window\n          width = windowRect.width;\n          left = 0;\n        } else {\n          // center in between\n          left = (windowRect.width - flyoutRect.width) / 2;\n        }\n      } else if (anchorRect.left + flyoutRect.width + this._edgePadding > windowRect.width) {\n        // it will render off screen to the right, move to the left\n        left = anchorRect.left - (anchorRect.left + flyoutRect.width + this._edgePadding - windowRect.width);\n      } else if (anchorRect.left < this._edgePadding) {\n        // it will render off screen to the left, move to the right\n        left = this._edgePadding;\n      } else {\n        left = anchorRect.left;\n      }\n\n      const anchorRectBottomToWindowBottom = windowRect.height - (anchorRect.top + anchorRect.height);\n      const anchorRectTopToWindowTop = anchorRect.top;\n\n      if (this.avoidHidingAnchor) {\n        if (anchorRectBottomToWindowBottom <= flyoutRect.height) {\n          if (anchorRectTopToWindowTop < flyoutRect.height) {\n            if (anchorRectTopToWindowTop > anchorRectBottomToWindowBottom) {\n              // more room top than bottom - render above\n              bottom = windowRect.height - anchorRect.top;\n              height = anchorRectTopToWindowTop;\n            } else {\n              // more room bottom than top\n              top = anchorRect.bottom;\n              height = anchorRectBottomToWindowBottom;\n            }\n          } else {\n            // render above anchor\n            bottom = windowRect.height - anchorRect.top;\n            height = anchorRectTopToWindowTop;\n          }\n        } else {\n          top = anchorRect.bottom;\n          height = anchorRectBottomToWindowBottom;\n        }\n      } else {\n        if (flyoutRect.height + 2 * this._edgePadding > windowRect.height) {\n          // flyout wants to be higher than the window hight, and we don't need to avoid hiding the anchor\n          // make the flyout height the height of the window\n          if (flyoutRect.height >= windowRect.height) {\n            height = windowRect.height;\n            top = 0;\n          } else {\n            top = (windowRect.height - flyoutRect.height) / 2;\n          }\n        } else {\n          if (anchorRect.top + anchorRect.height + flyoutRect.height + this._edgePadding > windowRect.height) {\n            // it will render offscreen bellow, move it up a bit\n            top = windowRect.height - flyoutRect.height - this._edgePadding;\n          } else {\n            top = Math.max(anchorRect.top + anchorRect.height, this._edgePadding);\n          }\n        }\n      }\n\n      // check the scout is positioned where it is supposed to be\n      // if it's not, then we are no longer fixed position and should assume\n      // absolute positioning\n      // this is a workaround when a transform is applied to a parent\n      // https://stackoverflow.com/questions/42660332/css-transform-parent-and-fixed-child\n      if (topScoutRect.top !== 0 || topScoutRect.left !== 0) {\n        left -= topScoutRect.left;\n\n        if (typeof bottom !== 'undefined') {\n          bottom += bottomScoutRect.top - this._windowHeight;\n        } else {\n          top -= topScoutRect.top;\n        }\n      }\n\n      if (this.direction === 'rtl') {\n        if (left > 100 && this.offsetLeft > 100) {\n          // potentially anchored to right side (for non people-picker flyout)\n          flyout.style.left = `${windowRect.width - left + flyoutRect.left - flyoutRect.width - 30}px`;\n        }\n      } else {\n        flyout.style.left = `${left + windowRect.left}px`;\n      }\n\n      if (typeof bottom !== 'undefined') {\n        flyout.style.top = 'unset';\n        flyout.style.bottom = `${bottom}px`;\n      } else {\n        flyout.style.bottom = 'unset';\n        flyout.style.top = `${top + windowRect.top}px`;\n      }\n\n      if (width) {\n        // if we had to set the width, recalculate since the height could have changed\n        flyout.style.width = `${width}px`;\n        flyout.style.setProperty('--mgt-flyout-set-width', `${width}px`);\n        window.requestAnimationFrame(() => this.updateFlyout());\n      }\n\n      // don't use the calculated height on the first pass as the contents of the flyout may not have rendered yet\n      // this gives them a change to contribute height and not get forced to a smaller than intended height\n      if (height && !firstPass) {\n        flyout.style.maxHeight = `${height}px`;\n        flyout.style.setProperty('--mgt-flyout-set-height', `${height}px`);\n      } else {\n        flyout.style.maxHeight = null;\n        flyout.style.setProperty('--mgt-flyout-set-height', 'unset');\n      }\n      if (firstPass) {\n        window.requestAnimationFrame(() => this.updateFlyout(false));\n      }\n    }\n  }\n\n  private setupWindowEvents(isOpen: boolean) {\n    if (isOpen && this.isLightDismiss) {\n      window.addEventListener('wheel', this.handleWindowEvent);\n      window.addEventListener('pointerdown', this.handleWindowEvent);\n      window.addEventListener('resize', this.handleResize);\n      window.addEventListener('keyup', this.handleKeyUp);\n    } else {\n      window.removeEventListener('wheel', this.handleWindowEvent);\n      window.removeEventListener('pointerdown', this.handleWindowEvent);\n      window.removeEventListener('resize', this.handleResize);\n      window.removeEventListener('keyup', this.handleKeyUp);\n    }\n  }\n\n  private readonly handleWindowEvent = (e: Event) => {\n    const flyout = this._flyout;\n\n    if (flyout) {\n      // IE\n      if (!e.composedPath) {\n        let currentElem = e.target as HTMLElement;\n        while (currentElem) {\n          currentElem = currentElem.parentElement;\n          if (currentElem === flyout || (e.type === 'pointerdown' && currentElem === this)) {\n            return;\n          }\n        }\n      } else {\n        const path = e.composedPath();\n        if (path.includes(flyout) || (e.type === 'pointerdown' && path.includes(this))) {\n          return;\n        }\n      }\n    }\n\n    this.close();\n  };\n\n  private readonly handleResize = () => {\n    this.close();\n  };\n\n  private readonly handleKeyUp = (e: KeyboardEvent) => {\n    if (e.key === 'Escape') {\n      this.close();\n    }\n  };\n\n  private readonly handleFlyoutWheel = (e: Event) => {\n    e.preventDefault();\n  };\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\n/**\n * Defines icon used by svgHelper\n *\n * @export\n * @enum {number}\n */\nexport enum SvgIcon {\n  /**\n   * Arrow Icon pointing down\n   */\n  ArrowDown,\n\n  /**\n   * Icon separates team from channel in selection\n   */\n  TeamSeparator,\n\n  /**\n   * Search icon\n   */\n  Search,\n\n  /**\n   * Skype Arrow icon (out of office status)\n   */\n  SkypeArrow,\n\n  /**\n   * Smaller email icon used in top of person card\n   */\n  SmallEmail,\n\n  /**\n   * Smaller email, hovered version, icon used in top of person card\n   */\n  SmallEmailHovered,\n\n  /**\n   * Smaller chat icon used in top of person card\n   */\n  SmallChat,\n\n  /**\n   * Small chat icon, hover version, used in top of person card\n   */\n  SmallChatHovered,\n\n  /**\n   * Video icon used in top of person card\n   */\n  Video,\n\n  /**\n   * Videoicon, hovered version used in top of person card\n   */\n  VideoHovered,\n\n  /**\n   * Downward chevron\n   */\n  ExpandDown,\n\n  /**\n   * Overview icon\n   */\n  Overview,\n\n  /**\n   * Paper plane\n   */\n  Send,\n\n  /**\n   * Phone/Mail icon\n   */\n  Contact,\n\n  /**\n   * Copy to clipboard\n   */\n  Copy,\n\n  /**\n   * A phone handset\n   */\n  Phone,\n\n  /**\n   * A cellphone\n   */\n  CellPhone,\n\n  /**\n   * Chat message\n   */\n  Chat,\n\n  /**\n   * Call icon\n   */\n  Call,\n\n  /**\n   * Call icon, hovered version\n   */\n  CallHovered,\n\n  /**\n   * Confirmation icon\n   */\n  Confirmation,\n  /**\n   * Company department\n   */\n  Department,\n\n  /**\n   *\n   * Dot Icon\n   */\n  Dot,\n\n  /**\n   * Email message\n   */\n  Email,\n\n  /**\n   * Location indicator\n   */\n  OfficeLocation,\n\n  /**\n   * A person\n   */\n  Person,\n\n  /**\n   * Messages\n   */\n  Messages,\n\n  /**\n   * Organization tree\n   */\n  Organization,\n\n  /**\n   * Right facing chevron\n   */\n  ExpandRight,\n\n  /**\n   * Person profile\n   */\n  Profile,\n\n  /**\n   * Balloon\n   */\n  Birthday,\n\n  /**\n   * File icon\n   */\n  File,\n\n  /**\n   * Files icon\n   */\n  Files,\n\n  /**\n   * Back arrow\n   */\n  Back,\n\n  /**\n   * Close icon\n   */\n  Close,\n\n  /**\n   * Upload icon\n   */\n  Upload,\n\n  /**\n   * File Cloud icon\n   */\n  FileCloud,\n\n  /**\n   * Drag File Mouse Icon\n   */\n  DragFile,\n\n  /**\n   *\n   * Cancel icon\n   */\n  Cancel,\n\n  /**\n   *\n   * Checkmark icon\n   *\n   */\n  CheckMark,\n\n  /**\n   *\n   * Radio icon\n   *\n   */\n  Radio,\n\n  /**\n   *\n   * Success icon\n   */\n  Success,\n\n  /**\n   *\n   * Fail icon\n   */\n  Fail,\n\n  /**\n   *\n   * account selection\n   */\n  SelectAccount,\n\n  /**\n   * News\n   */\n  News,\n\n  /**\n   * Bookmark\n   */\n  DoubleBookmark,\n\n  /**\n   * Left chevron\n   */\n  ChevronLeft,\n\n  /**\n   * Right chevron\n   */\n  ChevronRight,\n\n  /**\n   * Event\n   */\n  Event,\n\n  /**\n   * Q&A\n   */\n  BookOpen,\n\n  /**\n   * File outer icon\n   */\n  FileOuter,\n\n  /**\n   * Book question icon\n   */\n  BookQuestion,\n\n  /**\n   * Globe icon\n   */\n  Globe,\n  /**\n   * Delete icon\n   */\n  Delete,\n\n  /**\n   *\n   * Add icon\n   */\n  Add,\n\n  /**\n   *\n   * Calendar icon\n   */\n  Calendar,\n  Planner,\n  Milestone,\n  PersonAdd,\n  PresenceAvailable,\n  PresenceOofAvailable,\n  PresenceBusy,\n  PresenceOofBusy,\n  PresenceDnd,\n  PresenceOofDnd,\n  PresenceAway,\n  PresenceOofAway,\n  PresenceOffline,\n  PresenceStatusUnknown\n}\n\nimport { html } from 'lit';\n\n/**\n * returns an svg\n *\n * @param svgIcon defined by name\n * @param color hex value\n */\nexport const getSvg = (svgIcon: SvgIcon, color?: string) => {\n  switch (svgIcon) {\n    case SvgIcon.ArrowDown:\n      return html`\n        <svg width=\"12\" height=\"12\" viewBox=\"0 0 12 12\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M6 9L2.46447 5.46447H6H9.53553L6 9Z\" />\n        </svg>\n      `;\n\n    case SvgIcon.TeamSeparator:\n      return html`\n        <svg width=\"6\" height=\"10\" viewBox=\"0 0 6 10\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path\n            fill-rule=\"evenodd\"\n            clip-rule=\"evenodd\"\n            d=\"M5.70711 5L1.49999 9.20711L0.792886 8.50001L4.29289 5L0.792887 1.49999L1.49999 0.792885L5.70711 5Z\"\n            fill=${color}\n          />\n        </svg>\n      `;\n\n    case SvgIcon.Search:\n      return html`\n        <svg width=\"12\" height=\"12\" viewBox=\"0 0 12 12\" fill=\"currentColor\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M7.30887 8.01596C6.53903 8.63179 5.56252 9.00004 4.5 9.00004C2.01472 9.00004 0 6.98531 0 4.50002C0 2.01473 2.01472 0 4.5 0C6.98528 0 9 2.01473 9 4.50002C9 5.56252 8.63177 6.53901 8.01597 7.30885L11.8536 11.1464C12.0488 11.3417 12.0488 11.6583 11.8536 11.8536C11.6583 12.0488 11.3417 12.0488 11.1464 11.8536L7.30887 8.01596ZM8 4.50002C8 2.56701 6.433 1 4.5 1C2.567 1 1 2.56701 1 4.50002C1 6.43302 2.567 8.00003 4.5 8.00003C6.433 8.00003 8 6.43302 8 4.50002Z\" fill=\"currentColor\"/>\n        </svg>`;\n\n    case SvgIcon.SkypeArrow:\n      return html`\n        <svg viewBox=\"0 0 12 10\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path\n            d=\"M3.95184 0.480534C4.23385 0.10452 4.70926 -0.0724722 5.1685 0.0275755C5.62775 0.127623 5.98645 0.486329 6.0865 0.945575C6.18655 1.40482 6.00956 1.88023 5.63354 2.16224L4.07196 3.72623H10.7988C11.4622 3.72623 12 4.26403 12 4.92744C12 5.59086 11.4622 6.12866 10.7988 6.12866H4.07196L5.63114 7.68784C6.0955 8.15225 6.0955 8.90515 5.63114 9.36955C5.51655 9.48381 5.38119 9.57514 5.23234 9.63862C5.09341 9.69857 4.94399 9.73042 4.79269 9.73232C4.63498 9.73233 4.4789 9.70046 4.33382 9.63862C4.18765 9.57669 4.05593 9.48507 3.94703 9.36955L0.343377 5.7659C-0.114459 5.29881 -0.114459 4.55128 0.343377 4.08419L3.95184 0.480534Z\"\n            fill=\"#B4009E\"\n          />\n        </svg>\n      `;\n\n    case SvgIcon.SmallEmail:\n      return html`\n        <svg width=\"17\" height=\"14\" viewBox=\"0 0 17 14\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path class=\"filled\" d=\"M16 3.373V10.5C16 11.8807 14.8807 13 13.5 13H2.5C1.11929 13 -7.62939e-05 11.8807 -7.62939e-05 10.5V3.373L7.74649 7.93097C7.90297 8.02301 8.09704 8.02301 8.25351 7.93097L16 3.373ZM13.5 0C14.7871 0 15.847 0.972604 15.9848 2.22293L8 6.91991L0.0151832 2.22293C0.15304 0.972604 1.21294 0 2.5 0H13.5Z\" fill=\"currentColor\"/>\n          <path class=\"regular\" d=\"M13.608 0.833496C14.9887 0.833496 16.108 1.95278 16.108 3.3335V11.3335C16.108 12.7142 14.9887 13.8335 13.608 13.8335H2.60803C1.22732 13.8335 0.108032 12.7142 0.108032 11.3335V3.3335C0.108032 1.95278 1.22732 0.833496 2.60803 0.833496H13.608ZM15.108 4.7945L8.36154 8.76446C8.23115 8.84117 8.07464 8.85395 7.93554 8.80281L7.85452 8.76446L1.10803 4.7965V11.3335C1.10803 12.1619 1.77961 12.8335 2.60803 12.8335H13.608C14.4365 12.8335 15.108 12.1619 15.108 11.3335V4.7945ZM13.608 1.8335H2.60803C1.77961 1.8335 1.10803 2.50507 1.10803 3.3335V3.6355L8.10803 7.75341L15.108 3.6345V3.3335C15.108 2.50507 14.4365 1.8335 13.608 1.8335Z\" fill=\"currentColor\"/>\n        </svg>\n      `;\n\n    case SvgIcon.SmallChat:\n      return html`\n        <svg width=\"17\" height=\"17\" viewBox=\"0 0 17 17\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path class=\"filled\" d=\"M8 0C12.4183 0 16 3.58172 16 8C16 12.4183 12.4183 16 8 16C6.72679 16 5.49591 15.7018 4.38669 15.1393L4.266 15.075L0.621091 15.9851C0.311269 16.0625 0.0262241 15.8369 0.00130987 15.5438L0.00114131 15.4624L0.0149329 15.3787L0.925 11.735L0.86169 11.6153C0.406602 10.7186 0.124331 9.74223 0.0327466 8.72826L0.00737596 8.34634L0 8C0 3.58172 3.58172 0 8 0ZM8.5 9H5.5L5.41012 9.00806C5.17688 9.05039 5 9.25454 5 9.5C5 9.74546 5.17688 9.94961 5.41012 9.99194L5.5 10H8.5L8.58988 9.99194C8.82312 9.94961 9 9.74546 9 9.5C9 9.25454 8.82312 9.05039 8.58988 9.00806L8.5 9ZM10.5 6H5.5L5.41012 6.00806C5.17688 6.05039 5 6.25454 5 6.5C5 6.74546 5.17688 6.94961 5.41012 6.99194L5.5 7H10.5L10.5899 6.99194C10.8231 6.94961 11 6.74546 11 6.5C11 6.25454 10.8231 6.05039 10.5899 6.00806L10.5 6Z\" fill=\"currentColor\"/>\n          <path class=\"regular\" d=\"M8.38599 0.833496C12.8043 0.833496 16.386 4.41522 16.386 8.8335C16.386 13.2518 12.8043 16.8335 8.38599 16.8335C7.11277 16.8335 5.8819 16.5353 4.77267 15.9728L4.65199 15.9085L1.00708 16.8186C0.697255 16.8959 0.41221 16.6704 0.387296 16.3773L0.387128 16.2959L0.400919 16.2122L1.31099 12.5685L1.24768 12.4488C0.792589 11.5521 0.510317 10.5757 0.418733 9.56176L0.393362 9.17984L0.385986 8.8335C0.385986 4.41522 3.96771 0.833496 8.38599 0.833496ZM8.38599 1.8335C4.51999 1.8335 1.38599 4.9675 1.38599 8.8335C1.38599 10.0505 1.69653 11.2213 2.27951 12.2584C2.32645 12.3419 2.34809 12.4365 2.34291 12.5308L2.32873 12.6247L1.57299 15.6455L4.59703 14.8918C4.65892 14.8764 4.72261 14.8731 4.78472 14.8814L4.87629 14.9026L4.963 14.941C5.9996 15.5233 7.16969 15.8335 8.38599 15.8335C12.252 15.8335 15.386 12.6995 15.386 8.8335C15.386 4.9675 12.252 1.8335 8.38599 1.8335ZM8.88599 9.8335C9.16213 9.8335 9.38599 10.0574 9.38599 10.3335C9.38599 10.579 9.20911 10.7831 8.97586 10.8254L8.88599 10.8335H5.88599C5.60984 10.8335 5.38599 10.6096 5.38599 10.3335C5.38599 10.088 5.56286 9.88389 5.79611 9.84155L5.88599 9.8335H8.88599ZM10.886 6.8335C11.1621 6.8335 11.386 7.05735 11.386 7.3335C11.386 7.57896 11.2091 7.7831 10.9759 7.82544L10.886 7.8335L5.88599 7.8335C5.60984 7.8335 5.38599 7.60964 5.38599 7.3335C5.38599 7.08804 5.56286 6.88389 5.79611 6.84155L5.88599 6.8335L10.886 6.8335Z\" fill=\"currentColor\"/>\n        </svg>\n      `;\n\n    case SvgIcon.Video:\n      return html`\n        <svg width=\"17\" height=\"13\" viewBox=\"0 0 17 13\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n        <path class=\"filled\" d=\"M11 2.5C11 1.11929 9.88071 0 8.5 0H2.5C1.11929 0 0 1.11929 0 2.5V9.5C0 10.8807 1.11929 12 2.5 12H8.5C9.88071 12 11 10.8807 11 9.5V2.5ZM12 3.93082V8.08149L14.7642 10.4319C15.2512 10.8461 16 10.4999 16 9.86055V2.19315C16 1.55685 15.2575 1.20962 14.7692 1.61756L12 3.93082Z\" fill=\"currentColor\"/>\n          <path class=\"regular\" d=\"M2.72095 0.833496C1.34024 0.833496 0.220947 1.95278 0.220947 3.3335V10.3335C0.220947 11.7142 1.34024 12.8335 2.72095 12.8335H9.72095C11.1017 12.8335 12.2209 11.7142 12.2209 10.3335V9.33348L14.6209 11.1335C15.2802 11.6279 16.2209 11.1575 16.2209 10.3335V3.33348C16.2209 2.50944 15.2802 2.03905 14.6209 2.53348L12.2209 4.33348V3.3335C12.2209 1.95278 11.1017 0.833496 9.72095 0.833496H2.72095ZM12.2209 5.58348L15.2209 3.33348V10.3335L12.2209 8.08348V5.58348ZM11.2209 3.3335V10.3335C11.2209 11.1619 10.5494 11.8335 9.72095 11.8335H2.72095C1.89252 11.8335 1.22095 11.1619 1.22095 10.3335V3.3335C1.22095 2.50507 1.89252 1.8335 2.72095 1.8335H9.72095C10.5494 1.8335 11.2209 2.50507 11.2209 3.3335Z\" fill=\"currentColor\"/>\n        </svg>\n      `;\n\n    case SvgIcon.ExpandDown: {\n      return html`\n        <svg width=\"15\" height=\"8\" viewBox=\"0 0 15 8\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M14 1L7.5 7L1 1\" stroke=\"currentColor\" />\n        </svg>\n      `;\n    }\n\n    case SvgIcon.Overview:\n      return html`\n        <svg width=\"16\" height=\"13\" viewBox=\"0 0 16 13\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M3.5 10.5C2.67157 10.5 2 9.82843 2 9V4C2 3.17157 2.67157 2.5 3.5 2.5H12.5C13.3284 2.5 14 3.17157 14 4V9C14 9.82843 13.3284 10.5 12.5 10.5H3.5ZM3.5 3.5C3.22386 3.5 3 3.72386 3 4V5.5H13V4C13 3.72386 12.7761 3.5 12.5 3.5H3.5ZM5 6.5H3V9C3 9.27614 3.22386 9.5 3.5 9.5H5V6.5ZM6 9.5H12.5C12.7761 9.5 13 9.27614 13 9V6.5H6V9.5ZM0 3C0 1.61929 1.11929 0.5 2.5 0.5H13.5C14.8807 0.5 16 1.61929 16 3V10C16 11.3807 14.8807 12.5 13.5 12.5H2.5C1.11929 12.5 0 11.3807 0 10V3ZM2.5 1.5C1.67157 1.5 1 2.17157 1 3V10C1 10.8284 1.67157 11.5 2.5 11.5H13.5C14.3284 11.5 15 10.8284 15 10V3C15 2.17157 14.3284 1.5 13.5 1.5H2.5Z\" fill=\"#717171\"/>\n        </svg>\n      `;\n\n    case SvgIcon.Send:\n      return html`\n        <svg xmlns=\"http://www.w3.org/2000/svg\">\n          <path\n            d=\"M4.27144 8.99999L1.72572 2.45387C1.54854 1.99826 1.9928 1.56256 2.43227 1.71743L2.50153 1.74688L16.0015 8.49688C16.3902 8.69122 16.4145 9.22336 16.0744 9.45992L16.0015 9.50311L2.50153 16.2531C2.0643 16.4717 1.58932 16.0697 1.70282 15.6178L1.72572 15.5461L4.27144 8.99999L1.72572 2.45387L4.27144 8.99999ZM3.3028 3.4053L5.25954 8.43705L10.2302 8.43749C10.515 8.43749 10.7503 8.64911 10.7876 8.92367L10.7927 8.99999C10.7927 9.28476 10.5811 9.52011 10.3065 9.55736L10.2302 9.56249L5.25954 9.56205L3.3028 14.5947L14.4922 8.99999L3.3028 3.4053Z\"\n          />\n        </svg>\n      `;\n\n    case SvgIcon.Contact:\n      return html`\n        <svg width=\"16\" height=\"12\" viewBox=\"0 0 16 12\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M6 4.5C6 5.32843 5.32843 6 4.5 6C3.67157 6 3 5.32843 3 4.5C3 3.67157 3.67157 3 4.5 3C5.32843 3 6 3.67157 6 4.5ZM2 7.69879C2 7.17479 2.42479 6.75 2.94879 6.75H6.05121C6.57521 6.75 7 7.17479 7 7.69879C7 8.54603 6.42338 9.28454 5.60144 9.49003L5.54243 9.50478C4.85801 9.67589 4.14199 9.67589 3.45757 9.50478L3.39856 9.49003C2.57661 9.28454 2 8.54603 2 7.69879ZM9.5 4C9.22386 4 9 4.22386 9 4.5C9 4.77614 9.22386 5 9.5 5H12.5C12.7761 5 13 4.77614 13 4.5C13 4.22386 12.7761 4 12.5 4H9.5ZM9.5 7C9.22386 7 9 7.22386 9 7.5C9 7.77614 9.22386 8 9.5 8H12.5C12.7761 8 13 7.77614 13 7.5C13 7.22386 12.7761 7 12.5 7H9.5ZM0 1.75C0 0.783502 0.783502 0 1.75 0H14.25C15.2165 0 16 0.783502 16 1.75V10.25C16 11.2165 15.2165 12 14.25 12H1.75C0.783501 12 0 11.2165 0 10.25V1.75ZM1.75 1C1.33579 1 1 1.33579 1 1.75V10.25C1 10.6642 1.33579 11 1.75 11H14.25C14.6642 11 15 10.6642 15 10.25V1.75C15 1.33579 14.6642 1 14.25 1H1.75Z\" fill=\"#717171\"/>\n        </svg>\n      `;\n\n    case SvgIcon.Call:\n      return html`\n        <svg width=\"13\" height=\"17\" viewBox=\"0 0 13 17\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path class=\"filled\" d=\"M3.98706 1.06589C4.89545 0.792081 5.86254 1.19479 6.31418 2.01224L6.38841 2.16075L7.04987 3.63213C7.46246 4.54992 7.28209 5.61908 6.60754 6.3496L6.47529 6.48248L5.43194 7.45541C5.24417 7.63298 5.38512 8.32181 6.06527 9.49986C6.67716 10.5597 7.17487 11.0552 7.41986 11.0823L7.4628 11.082L7.5158 11.0716L9.56651 10.4446C10.1332 10.2713 10.7438 10.4487 11.1298 10.8865L11.2215 11.0014L12.5781 12.8815C13.1299 13.6462 13.0689 14.6842 12.4533 15.378L12.3314 15.5039L11.7886 16.018C10.7948 16.9592 9.34348 17.2346 8.07389 16.7231C6.13867 15.9433 4.38077 14.1607 2.78368 11.3945C1.18323 8.62242 0.519004 6.20438 0.815977 4.13565C0.99977 2.85539 1.87301 1.78674 3.07748 1.3462L3.27036 1.28192L3.98706 1.06589Z\" fill=\"currentColor\"/>\n          <path class=\"regular\" d=\"M3.9292 0.399388L3.2125 0.615419C1.90898 1.00834 0.951582 2.1215 0.758116 3.46915C0.461142 5.53787 1.12537 7.95591 2.72582 10.728C4.32291 13.4942 6.0808 15.2768 8.01603 16.0565C9.28562 16.5681 10.7369 16.2927 11.7308 15.3515L12.2736 14.8374C13.0011 14.1485 13.1065 13.0275 12.5202 12.215L11.1636 10.3349C10.788 9.81423 10.1226 9.59039 9.50865 9.7781L7.45794 10.4051L7.40494 10.4154C7.17877 10.4485 6.65754 9.95942 6.00741 8.83335C5.32726 7.65531 5.1863 6.96648 5.37408 6.7889L6.41743 5.81598C7.19937 5.08681 7.43039 3.94078 6.99201 2.96562L6.33055 1.49424C5.91866 0.578005 4.89102 0.109471 3.9292 0.399388ZM5.41847 1.90427L6.07993 3.37564C6.34277 3.96031 6.20426 4.64744 5.73543 5.08463L4.68953 6.05994C4.02044 6.69268 4.24206 7.77567 5.14138 9.33335C5.98759 10.799 6.75958 11.5233 7.58908 11.3977L7.71341 11.3711L9.80102 10.7344C10.0057 10.6718 10.2275 10.7464 10.3527 10.92L11.7093 12.8001C12.0024 13.2064 11.9497 13.7669 11.586 14.1113L11.0432 14.6254C10.3333 15.2977 9.29663 15.4944 8.38977 15.129C6.6917 14.4448 5.08689 12.8175 3.59185 10.228C2.09375 7.63319 1.48745 5.42604 1.74797 3.61125C1.88616 2.64864 2.57001 1.85352 3.5011 1.57287L4.2178 1.35684C4.69871 1.21188 5.21253 1.44615 5.41847 1.90427Z\" fill=\"currentColor\"/>\n        </svg>\n      `;\n\n    case SvgIcon.Confirmation:\n      return html`\n      <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n        <path d=\"M7.03212 13.9072L3.56056 10.0017C3.28538 9.69214 2.81132 9.66425 2.50174 9.93944C2.19215 10.2146 2.16426 10.6887 2.43945 10.9983L6.43945 15.4983C6.72614 15.8208 7.2252 15.8355 7.53034 15.5303L18.0303 5.03033C18.3232 4.73744 18.3232 4.26256 18.0303 3.96967C17.7374 3.67678 17.2626 3.67678 16.9697 3.96967L7.03212 13.9072Z\" fill=\"#009E00\"/>\n      </svg>\n      `;\n\n    case SvgIcon.Copy:\n      return html`\n        <svg width=\"13\" height=\"14\" viewBox=\"0 0 13 14\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path\n            d=\"M12.625 5.50293V14H3.875V11.375H0.375V0H6.24707L8.87207 2.625H9.74707L12.625 5.50293ZM10 5.25H11.1279L10 4.12207V5.25ZM3.875 2.625H7.62793L5.87793 0.875H1.25V10.5H3.875V2.625ZM11.75 6.125H9.125V3.5H4.75V13.125H11.75V6.125Z\"\n          />\n        </svg>\n      `;\n\n    case SvgIcon.Phone:\n      return html`\n        <svg width=\"15\" height=\"15\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 2048 2048\" fill=\"none\">\n            <path d=\"M1607 1213q44 0 84 16t72 48l220 220q31 31 47 71t17 85q0 44-16 84t-48 72l-14 14q-54 54-99 96t-94 70-109 44-143 15q-125 0-257-39t-262-108-256-164-237-207-206-238-162-256T38 775 0 523q0-83 14-142t43-108 70-93 96-99l16-16q31-31 71-48t85-17q44 0 84 17t72 48l220 220q31 31 47 71t17 85q0 44-15 78t-37 63-48 51-49 45-37 44-15 49q0 38 27 65l551 551q27 27 65 27 26 0 48-15t45-37 45-48 51-49 62-37 79-15zm-83 707q72 0 120-13t88-39 76-64 85-86q27-27 27-65 0-18-14-42t-38-52-51-55-56-54-51-47-37-35q-27-27-66-27-26 0-48 15t-44 37-45 48-52 49-62 37-79 15q-44 0-84-16t-72-48L570 927q-31-31-47-71t-17-85q0-44 15-78t37-63 48-51 49-46 37-44 15-48q0-39-27-66-13-13-34-36t-47-51-54-56-56-52-51-37-43-15q-38 0-65 27l-85 85q-37 37-64 76t-40 87-14 120q0 112 36 231t101 238 153 234 192 219 219 190 234 150 236 99 226 36z\" fill=\"${color}\"></path>\n        </svg>\n      `;\n\n    case SvgIcon.CellPhone:\n      return html`\n        <svg width=\"10\" height=\"16\" viewBox=\"0 0 10 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M4 12C3.72386 12 3.5 12.2239 3.5 12.5C3.5 12.7761 3.72386 13 4 13H6C6.27614 13 6.5 12.7761 6.5 12.5C6.5 12.2239 6.27614 12 6 12H4ZM2 0C0.89543 0 0 0.895431 0 2V14C0 15.1046 0.895431 16 2 16H8C9.10457 16 10 15.1046 10 14V2C10 0.89543 9.10457 0 8 0H2ZM1 2C1 1.44772 1.44772 1 2 1H8C8.55228 1 9 1.44772 9 2V14C9 14.5523 8.55228 15 8 15H2C1.44772 15 1 14.5523 1 14V2Z\" fill=\"#717171\"/>\n        </svg>\n      `;\n\n    case SvgIcon.Chat:\n      return html`\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M8 0C12.4183 0 16 3.58172 16 8C16 12.4183 12.4183 16 8 16C6.72679 16 5.49591 15.7018 4.38669 15.1393L4.266 15.075L0.621091 15.9851C0.311269 16.0625 0.0262241 15.8369 0.00130987 15.5438L0.00114131 15.4624L0.0149329 15.3787L0.925 11.735L0.86169 11.6153C0.406602 10.7186 0.124331 9.74223 0.0327466 8.72826L0.00737596 8.34634L0 8C0 3.58172 3.58172 0 8 0ZM8 1C4.13401 1 1 4.13401 1 8C1 9.21704 1.31054 10.3878 1.89352 11.4249C1.94046 11.5084 1.9621 11.603 1.95692 11.6973L1.94274 11.7912L1.187 14.812L4.21104 14.0583C4.27294 14.0429 4.33662 14.0396 4.39873 14.0479L4.4903 14.0691L4.57701 14.1075C5.61362 14.6898 6.7837 15 8 15C11.866 15 15 11.866 15 8C15 4.13401 11.866 1 8 1ZM8.5 9C8.77614 9 9 9.22386 9 9.5C9 9.74546 8.82312 9.94961 8.58988 9.99194L8.5 10H5.5C5.22386 10 5 9.77614 5 9.5C5 9.25454 5.17688 9.05039 5.41012 9.00806L5.5 9H8.5ZM10.5 6C10.7761 6 11 6.22386 11 6.5C11 6.74546 10.8231 6.94961 10.5899 6.99194L10.5 7L5.5 7C5.22386 7 5 6.77614 5 6.5C5 6.25454 5.17688 6.05039 5.41012 6.00806L5.5 6L10.5 6Z\" fill=\"#717171\"/>\n        </svg>\n      `;\n\n    case SvgIcon.Department:\n      return html`\n        <svg width=\"17\" height=\"14\" viewBox=\"0 0 17 14\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M4 1.5V3H2C0.895431 3 0 3.89543 0 5V12C0 13.1046 0.895432 14 2 14H14.0026C15.1071 14 16.0026 13.1046 16.0026 12V5C16.0026 3.89543 15.1071 3 14.0026 3H12V1.5C12 0.671573 11.3284 0 10.5 0H5.5C4.67157 0 4 0.671573 4 1.5ZM5.5 1H10.5C10.7761 1 11 1.22386 11 1.5V3H5V1.5C5 1.22386 5.22386 1 5.5 1ZM2 4H14.0026C14.5549 4 15.0026 4.44772 15.0026 5V7H12L12 6.50073C12 6.22459 11.7761 6.00073 11.5 6.00073C11.2239 6.00073 11 6.22459 11 6.50074L11 7H5V6.50073C5 6.22459 4.77614 6.00073 4.5 6.00073C4.22386 6.00073 4 6.22459 4 6.50073V7H1V5C1 4.44772 1.44772 4 2 4ZM11 8L11 8.5C11 8.77615 11.2239 9 11.5 9C11.7762 9 12 8.77614 12 8.5L12 8H15.0026V12C15.0026 12.5523 14.5549 13 14.0026 13H2C1.44772 13 1 12.5523 1 12V8H4V8.5C4 8.77614 4.22386 9 4.5 9C4.77614 9 5 8.77614 5 8.5V8H11Z\" fill=\"#717171\"/>\n        </svg>\n      `;\n\n    case SvgIcon.Dot:\n      return html`\n        <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M6.25 10C6.25 10.6904 5.69036 11.25 5 11.25C4.30964 11.25 3.75 10.6904 3.75 10C3.75 9.30964 4.30964 8.75 5 8.75C5.69036 8.75 6.25 9.30964 6.25 10ZM11.25 10C11.25 10.6904 10.6904 11.25 10 11.25C9.30964 11.25 8.75 10.6904 8.75 10C8.75 9.30964 9.30964 8.75 10 8.75C10.6904 8.75 11.25 9.30964 11.25 10ZM15 11.25C15.6904 11.25 16.25 10.6904 16.25 10C16.25 9.30964 15.6904 8.75 15 8.75C14.3096 8.75 13.75 9.30964 13.75 10C13.75 10.6904 14.3096 11.25 15 11.25Z\" fill=\"#242424\"/>\n        </svg>\n        `;\n\n    case SvgIcon.Email:\n      return html`\n        <svg width=\"16\" height=\"13\" viewBox=\"0 0 16 13\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M13.5 0C14.8807 0 16 1.11929 16 2.5V10.5C16 11.8807 14.8807 13 13.5 13H2.5C1.11929 13 0 11.8807 0 10.5V2.5C0 1.11929 1.11929 0 2.5 0H13.5ZM15 3.961L8.25351 7.93097C8.12311 8.00767 7.96661 8.02045 7.82751 7.96932L7.74649 7.93097L1 3.963V10.5C1 11.3284 1.67157 12 2.5 12H13.5C14.3284 12 15 11.3284 15 10.5V3.961ZM13.5 1H2.5C1.67157 1 1 1.67157 1 2.5V2.802L8 6.91991L15 2.801V2.5C15 1.67157 14.3284 1 13.5 1Z\" fill=\"#717171\"/>\n        </svg>\n      `;\n\n    case SvgIcon.OfficeLocation:\n      return html`\n        <svg width=\"14\" height=\"16\" viewBox=\"0 0 14 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <title>Location icon</title>\n          <path d=\"M10 7C10 8.65685 8.65685 10 7 10C5.34315 10 4 8.65685 4 7C4 5.34315 5.34315 4 7 4C8.65685 4 10 5.34315 10 7ZM9 7C9 5.89543 8.10457 5 7 5C5.89543 5 5 5.89543 5 7C5 8.10457 5.89543 9 7 9C8.10457 9 9 8.10457 9 7ZM11.9497 11.955C14.6834 9.2201 14.6834 4.78601 11.9497 2.05115C9.21608 -0.683716 4.78392 -0.683716 2.05025 2.05115C-0.683418 4.78601 -0.683418 9.2201 2.05025 11.955L3.57128 13.4538L5.61408 15.4389L5.74691 15.5567C6.52168 16.1847 7.65623 16.1455 8.38611 15.4391L10.8223 13.0691L11.9497 11.955ZM2.75499 2.75619C5.09944 0.410715 8.90055 0.410715 11.245 2.75619C13.5294 5.04153 13.5879 8.71039 11.4207 11.0667L11.245 11.2499L9.92371 12.5539L7.69315 14.7225L7.60016 14.8021C7.24594 15.0699 6.7543 15.0698 6.40012 14.802L6.30713 14.7224L3.3263 11.817L2.75499 11.2499L2.57927 11.0667C0.412077 8.71039 0.47065 5.04153 2.75499 2.75619Z\" fill=\"#717171\"/>\n        </svg>\n      `;\n\n    case SvgIcon.Birthday:\n      return html`\n        <svg width=\"14\" height=\"13\" viewBox=\"0 0 14 13\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M5.81357 0.667333C6.07581 0.320242 6.48151 0 7 0C7.51849 0 7.92419 0.320242 8.18643 0.667333C8.45471 1.0224 8.63508 1.47991 8.69561 1.93392C8.75552 2.3832 8.70532 2.89341 8.42852 3.3086C8.134 3.75039 7.63965 4 7 4C6.36035 4 5.866 3.75039 5.57148 3.3086C5.29468 2.89341 5.24448 2.3832 5.30439 1.93392C5.36492 1.47991 5.54529 1.0224 5.81357 0.667333ZM6.40353 2.7539C6.484 2.87461 6.63965 3 7 3C7.36035 3 7.516 2.87461 7.59647 2.7539C7.69468 2.60659 7.74448 2.3668 7.70439 2.06608C7.66492 1.77009 7.54529 1.4776 7.38857 1.27017C7.22581 1.05476 7.08151 1 7 1C6.91849 1 6.77419 1.05476 6.61143 1.27017C6.45471 1.4776 6.33508 1.77009 6.29561 2.06608C6.25552 2.3668 6.30532 2.60659 6.40353 2.7539ZM1 7C1 5.89543 1.89543 5 3 5H11C12.1046 5 13 5.89543 13 7V12H13.5C13.7761 12 14 12.2239 14 12.5C14 12.7761 13.7761 13 13.5 13H0.5C0.223858 13 0 12.7761 0 12.5C0 12.2239 0.223858 12 0.5 12H1V7ZM2 12H12V9.01931C11.9109 9.10285 11.8174 9.18842 11.7208 9.27412C11.4006 9.55804 11.0346 9.85319 10.6715 10.0802C10.3274 10.2953 9.90815 10.5 9.5 10.5C8.77182 10.5 8.30806 9.98986 8.00471 9.65617C7.9834 9.63273 7.96289 9.61016 7.94312 9.58869C7.5876 9.20261 7.35769 9 7 9C6.64231 9 6.4124 9.20261 6.05688 9.58869C6.03711 9.61016 6.0166 9.63273 5.99529 9.65617C5.69194 9.98986 5.22818 10.5 4.5 10.5C4.10587 10.5 3.69263 10.2897 3.35907 10.0789C3.00198 9.85313 2.63516 9.55951 2.31117 9.27666C2.20329 9.18247 2.09896 9.08844 2 8.9971V12ZM2 7.59993C2.05039 7.65198 2.11363 7.71652 2.1873 7.7902C2.38843 7.99132 2.6649 8.25801 2.96883 8.52334C3.27484 8.79049 3.59802 9.04687 3.89343 9.23362C4.21237 9.43525 4.41413 9.5 4.5 9.5C4.75817 9.5 4.93171 9.33433 5.32125 8.91131L5.32447 8.90781C5.65956 8.5439 6.16039 8 7 8C7.83961 8 8.34044 8.5439 8.67553 8.90781L8.67875 8.91131C9.06828 9.33433 9.24183 9.5 9.5 9.5C9.6106 9.5 9.82569 9.42967 10.1414 9.23229C10.4381 9.04681 10.7573 8.79196 11.0573 8.52588C11.3554 8.26163 11.6238 7.99594 11.8184 7.7955C11.89 7.72165 11.9513 7.65703 12 7.60506V7C12 6.44772 11.5523 6 11 6H3C2.44772 6 2 6.44772 2 7V7.59993Z\" fill=\"#717171\"/>\n        </svg>\n      `;\n\n    case SvgIcon.Person:\n      return html`\n        <svg width=\"14\" height=\"16\" viewBox=\"0 0 14 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M7 0C4.79086 0 3 1.79086 3 4C3 6.20914 4.79086 8 7 8C9.20914 8 11 6.20914 11 4C11 1.79086 9.20914 0 7 0ZM4 4C4 2.34315 5.34315 1 7 1C8.65685 1 10 2.34315 10 4C10 5.65685 8.65685 7 7 7C5.34315 7 4 5.65685 4 4ZM2.00873 9C0.903151 9 0 9.88687 0 11C0 12.6912 0.83281 13.9663 2.13499 14.7966C3.41697 15.614 5.14526 16 7 16C8.85474 16 10.583 15.614 11.865 14.7966C13.1672 13.9663 14 12.6912 14 11C14 9.89557 13.1045 9.00001 12 9.00001L2.00873 9ZM1 11C1 10.4467 1.44786 10 2.00873 10L12 10C12.5522 10 13 10.4478 13 11C13 12.3088 12.3777 13.2837 11.3274 13.9534C10.2568 14.636 8.73511 15 7 15C5.26489 15 3.74318 14.636 2.67262 13.9534C1.62226 13.2837 1 12.3088 1 11Z\" fill=\"#717171\"/>\n        </svg>\n      `;\n\n    case SvgIcon.Messages:\n      return html`\n        <svg width=\"16\" height=\"13\" viewBox=\"0 0 16 13\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M13.5 0C14.8807 0 16 1.11929 16 2.5V10.5C16 11.8807 14.8807 13 13.5 13H2.5C1.11929 13 0 11.8807 0 10.5V2.5C0 1.11929 1.11929 0 2.5 0H13.5ZM15 3.961L8.25351 7.93097C8.12311 8.00767 7.96661 8.02045 7.82751 7.96932L7.74649 7.93097L1 3.963V10.5C1 11.3284 1.67157 12 2.5 12H13.5C14.3284 12 15 11.3284 15 10.5V3.961ZM13.5 1H2.5C1.67157 1 1 1.67157 1 2.5V2.802L8 6.91991L15 2.801V2.5C15 1.67157 14.3284 1 13.5 1Z\" fill=\"#717171\"/>\n        </svg>\n      `;\n\n    case SvgIcon.Organization:\n      return html`\n        <svg width=\"16\" height=\"17\" viewBox=\"0 0 16 17\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M7.99992 0C6.34271 0 4.99927 1.34344 4.99927 3.00066C4.99927 4.48754 6.08073 5.72183 7.49999 5.95985V7.5H4.5C3.67157 7.5 3 8.17157 3 9V10.0416C1.5811 10.2799 0.5 11.514 0.5 13.0007C0.5 14.6579 1.84344 16.0013 3.50066 16.0013C5.15787 16.0013 6.50131 14.6579 6.50131 13.0007C6.50131 11.5136 5.41954 10.2791 4 10.0414V9C4 8.72386 4.22386 8.5 4.5 8.5H11.5C11.7761 8.5 12 8.72386 12 9V10.0416C10.5811 10.2799 9.5 11.514 9.5 13.0007C9.5 14.6579 10.8434 16.0013 12.5007 16.0013C14.1579 16.0013 15.5013 14.6579 15.5013 13.0007C15.5013 11.5136 14.4195 10.2791 13 10.0414V9C13 8.17157 12.3284 7.5 11.5 7.5H8.49999V5.95983C9.91918 5.72176 11.0006 4.48749 11.0006 3.00066C11.0006 1.34344 9.65714 0 7.99992 0ZM5.99927 3.00066C5.99927 1.89572 6.89499 1 7.99992 1C9.10485 1 10.0006 1.89572 10.0006 3.00066C10.0006 4.10559 9.10485 5.00131 7.99992 5.00131C6.89499 5.00131 5.99927 4.10559 5.99927 3.00066ZM1.5 13.0007C1.5 11.8957 2.39572 11 3.50066 11C4.60559 11 5.50131 11.8957 5.50131 13.0007C5.50131 14.1056 4.60559 15.0013 3.50066 15.0013C2.39572 15.0013 1.5 14.1056 1.5 13.0007ZM12.5007 11C13.6056 11 14.5013 11.8957 14.5013 13.0007C14.5013 14.1056 13.6056 15.0013 12.5007 15.0013C11.3957 15.0013 10.5 14.1056 10.5 13.0007C10.5 11.8957 11.3957 11 12.5007 11Z\" fill=\"#717171\"/>\n        </svg>\n      `;\n\n    case SvgIcon.ExpandRight:\n      return html`\n        <svg width=\"8\" height=\"13\" viewBox=\"0 0 8 13\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M1 12L6.5 6.5L1 1\" stroke=\"#B8B8B8\" stroke-width=\"2\" />\n        </svg>\n      `;\n\n    case SvgIcon.Profile:\n      return html`\n        <svg width=\"14\" height=\"16\" viewBox=\"0 0 14 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M7 0C4.79086 0 3 1.79086 3 4C3 6.20914 4.79086 8 7 8C9.20914 8 11 6.20914 11 4C11 1.79086 9.20914 0 7 0ZM4 4C4 2.34315 5.34315 1 7 1C8.65685 1 10 2.34315 10 4C10 5.65685 8.65685 7 7 7C5.34315 7 4 5.65685 4 4ZM2.00873 9C0.903151 9 0 9.88687 0 11C0 12.6912 0.83281 13.9663 2.13499 14.7966C3.41697 15.614 5.14526 16 7 16C8.85474 16 10.583 15.614 11.865 14.7966C13.1672 13.9663 14 12.6912 14 11C14 9.89557 13.1045 9.00001 12 9.00001L2.00873 9ZM1 11C1 10.4467 1.44786 10 2.00873 10L12 10C12.5522 10 13 10.4478 13 11C13 12.3088 12.3777 13.2837 11.3274 13.9534C10.2568 14.636 8.73511 15 7 15C5.26489 15 3.74318 14.636 2.67262 13.9534C1.62226 13.2837 1 12.3088 1 11Z\" fill=\"#717171\"/>\n        </svg>\n      `;\n\n    case SvgIcon.File:\n      return html`\n        <svg width=\"28\" height=\"28\" viewBox=\"0 0 20 28\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path\n            opacity=\"0.64\"\n            d=\"M19.613 6.993L13.018 0.421C12.7473 0.15221 12.3815 0.000947397 12 0H1.4C0.628 0 0 0.615 0 1.372V24.642C0 25.391 0.622 26 1.386 26H18.6C19.372 26 20 25.385 20 24.628V7.923C20 7.577 19.86 7.237 19.613 6.993Z\"\n            fill=\"#605E5C\"\n          />\n          <path\n            d=\"M19 24.628C19 24.83 18.816 25 18.6 25H1.386C1.173 25 1 24.84 1 24.642V1.372C1 1.17 1.184 1 1.4 1H12V6.6C12 7.372 12.628 8 13.4 8H19V24.628Z\"\n            fill=\"white\"\n          />\n          <path d=\"M18.204 6.99994L13 1.81494V6.59994C13 6.81994 13.18 6.99994 13.4 6.99994H18.204Z\" fill=\"white\" />\n        </svg>\n      `;\n\n    case SvgIcon.Files:\n      return html`\n        <svg width=\"17\" height=\"15\" viewBox=\"0 0 17 15\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M14.9956 4.07309V4C14.9956 2.61929 13.8763 1.5 12.4956 1.5H7.66418L6.06391 0.299946C5.80428 0.105247 5.48851 0 5.16399 0H2.5C1.11916 0 -0.000181445 1.11949 2.20615e-08 2.50033L0.0011832 11.4978C0.00135142 12.7772 0.962583 13.8321 2.2023 13.9798C2.2867 13.9945 2.37375 14.0021 2.46289 14.0021H13.1798C13.8981 14.0021 14.5156 13.4929 14.6524 12.7877L16.0097 5.78769C16.1587 5.01967 15.696 4.29703 14.9956 4.07309ZM2.5 1H5.16399C5.27216 1 5.37742 1.03508 5.46396 1.09998L7.19756 2.40002C7.2841 2.46492 7.38936 2.5 7.49753 2.5H12.4956C13.324 2.5 13.9956 3.17157 13.9956 4V4.00214H3.824C3.10596 4.00214 2.48863 4.511 2.35158 5.21583L1.05351 11.8916C1.01941 11.7661 1.0012 11.634 1.00118 11.4976L1 2.5002C0.999891 1.67169 1.6715 1 2.5 1ZM3.33319 5.4067C3.37888 5.17176 3.58465 5.00214 3.824 5.00214H14.5372C14.8515 5.00214 15.0879 5.28874 15.028 5.59732L13.6706 12.5973C13.6251 12.8324 13.4192 13.0021 13.1798 13.0021H2.46289C2.14845 13.0021 1.91206 12.7154 1.97208 12.4067L3.33319 5.4067Z\" fill=\"#717171\"/>\n        </svg>\n      `;\n\n    case SvgIcon.Back:\n      return html`\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path\n            d=\"M16 8.5H1.95312L8.10156 14.6484L7.39844 15.3516L0.046875 8L7.39844 0.648438L8.10156 1.35156L1.95312 7.5H16V8.5Z\"\n          />\n        </svg>\n      `;\n\n    case SvgIcon.Close:\n      return html`\n        <svg width=\"10\" height=\"10\" viewBox=\"0 0 10 10\" fill=\"currentColor\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M5.73838 5.032L9.70337 1.067L8.99638 0.360001L5.03137 4.325L1.06637 0.360001L0.359375 1.067L4.32438 5.032L0.359375 8.997L1.06637 9.704L5.03137 5.739L8.99638 9.704L9.70337 8.997L5.73838 5.032Z\" fill=\"currentColor\"/>\n        </svg>\n     `;\n    case SvgIcon.Upload:\n      return html`\n        <svg class=\"upload-icon\" width=\"21\" height=\"12\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M4.5 2C4.08579 2 3.75 2.33579 3.75 2.75C3.75 3.16421 4.08579 3.5 4.5 3.5H15C15.4142 3.5 15.75 3.16421 15.75 2.75C15.75 2.33579 15.4142 2 15 2H4.5ZM10.4963 17.3493C10.4466 17.7154 10.1328 17.9976 9.75311 17.9976C9.3389 17.9976 9.00311 17.6618 9.00311 17.2476L9.00249 7.05856L6.02995 10.026L5.94578 10.0986C5.65202 10.3162 5.23537 10.2917 4.96929 10.0253C4.67661 9.73215 4.67695 9.25728 4.97005 8.96459L9.25962 4.67989C9.33377 4.61512 9.42089 4.56485 9.5169 4.53385L9.59777 4.51072C9.64749 4.50019 9.69837 4.4947 9.74849 4.4947L9.80855 4.49661L9.87781 4.50451L9.99828 4.53462L10.0895 4.57254L10.1259 4.59371L10.2169 4.6523L10.2875 4.71481L14.5303 8.96546L14.6029 9.04964C14.8205 9.34345 14.7959 9.7601 14.5294 10.0261L14.4452 10.0987C14.1514 10.3162 13.7347 10.2917 13.4687 10.0251L10.5025 7.05456L10.5031 17.2476L10.4963 17.3493Z\" fill=\"#ffffff\"/>\n        </svg>\n      `;\n\n    case SvgIcon.FileCloud:\n      return html`\n        <svg width=\"16\" height=\"16\"  xmlns=\"http://www.w3.org/2000/svg\">\n          <path\n            d=\"m8,0c2.8166,0 4.4145,1.9233 4.6469,4.246l0.071,0c1.8127,0 3.2821,1.5119 3.2821,3.377c0,0.0953 -0.0038,0.1897 -0.0114,0.283c-0.322,-0.4017 -0.6967,-0.7591 -1.1138,-1.062c-0.3104,-0.9329 -1.1627,-1.598 -2.1568,-1.598l-0.0711,0c-0.5137,0 -0.9439,-0.3893 -0.9951,-0.9005c-0.2021,-2.0206 -1.5433,-3.3455 -3.6518,-3.3455c-2.1139,0 -3.4489,1.3159 -3.6518,3.3455c-0.0511,0.5112 -0.4813,0.9005 -0.9951,0.9005l-0.071,0c-1.2539,0 -2.2821,1.0579 -2.2821,2.377c0,1.3191 1.0282,2.377 2.2821,2.377l2.6655,0c-0.087,0.323 -0.1466,0.6572 -0.1762,1l-2.4893,0c-1.8127,0 -3.2821,-1.5119 -3.2821,-3.377c0,-1.8029 1.3731,-3.2758 3.102,-3.372l0.2511,-0.005c0.2338,-2.338 1.8303,-4.246 4.6469,-4.246zm3.5,16c2.4853,0 4.5,-2.0147 4.5,-4.5c0,-2.4853 -2.0147,-4.5 -4.5,-4.5c-2.4853,0 -4.5,2.0147 -4.5,4.5c0,2.4853 2.0147,4.5 4.5,4.5zm0,-7c0.2761,0 0.5,0.2239 0.5,0.5l0,1.5l1.5,0c0.2761,0 0.5,0.2239 0.5,0.5c0,0.2761 -0.2239,0.5 -0.5,0.5l-1.5,0l0,1.5c0,0.2761 -0.2239,0.5 -0.5,0.5c-0.2761,0 -0.5,-0.2239 -0.5,-0.5l0,-1.5l-1.5,0c-0.2761,0 -0.5,-0.2239 -0.5,-0.5c0,-0.2761 0.2239,-0.5 0.5,-0.5l1.5,0l0,-1.5c0,-0.2761 0.2239,-0.5 0.5,-0.5z\" fill=\"#0078D4\"\n          />\n        </svg>\n      `;\n\n    case SvgIcon.DragFile:\n      return html`\n        <svg width=\"13\" height=\"16\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path\n            d=\"m0,1.00189c0,-0.8451 0.983,-1.3091 1.636,-0.772l11.006,9.0622c0.724,0.5964 0.302,1.772 -0.636,1.772l-5.592,0c-0.435,0 -0.849,0.1892 -1.134,0.5185l-3.524,4.0725c-0.606,0.7003 -1.756,0.2717 -1.756,-0.6544l0,-13.9988zm12.006,9.0622l-11.006,-9.0622l0,13.9988l3.524,-4.0724c0.475,-0.5488 1.164,-0.8642 1.89,-0.8642l5.592,0z\"\n          />\n        </svg>\n      `;\n\n    case SvgIcon.Cancel:\n      return html`\n        <svg width=\"11\" height=\"11\" viewBox=\"0 0 11 11\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M0.588591 0.715694L0.646447 0.646447C0.820013 0.47288 1.08944 0.453595 1.28431 0.588591L1.35355 0.646447L6 5.293L10.6464 0.646447C10.8417 0.451185 11.1583 0.451185 11.3536 0.646447C11.5488 0.841709 11.5488 1.15829 11.3536 1.35355L6.707 6L11.3536 10.6464C11.5271 10.82 11.5464 11.0894 11.4114 11.2843L11.3536 11.3536C11.18 11.5271 10.9106 11.5464 10.7157 11.4114L10.6464 11.3536L6 6.707L1.35355 11.3536C1.15829 11.5488 0.841709 11.5488 0.646447 11.3536C0.451185 11.1583 0.451185 10.8417 0.646447 10.6464L5.293 6L0.646447 1.35355C0.47288 1.17999 0.453595 0.910563 0.588591 0.715694L0.646447 0.646447L0.588591 0.715694Z\" fill=\"currentColor\"/>\n        </svg>\n     `;\n\n    case SvgIcon.Success:\n      return html`\n        <svg width=\"12\" height=\"12\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path fill=\"#009E00\" d=\"m6.322,12c3.492,0 6.323,-2.6863 6.323,-6c0,-3.3137 -2.831,-6 -6.323,-6c-3.491,0 -6.322,2.6863 -6.322,6c0,3.3137 2.831,6 6.322,6z\"/>\n          <path fill=\"white\" d=\"m9.629,3.7509c-0.131,-0.125 -0.31,-0.1952 -0.496,-0.1952c-0.187,0 -0.365,0.0702 -0.497,0.1952l-3.267,3.1l-1.393,-1.3222c-0.177,-0.1695 -0.436,-0.2361 -0.68,-0.1746c-0.243,0.0615 -0.433,0.2418 -0.497,0.4725c-0.065,0.2307 0.005,0.4767 0.184,0.6449l1.807,1.7154c0.019,0.0331 0.041,0.0646 0.066,0.094c0.289,0.2562 0.738,0.2562 1.027,0c0.024,-0.0294 0.047,-0.0609 0.065,-0.0941l3.681,-3.4931c0.275,-0.2603 0.275,-0.6824 0,-0.9428z\"/>\n        </svg>\n      `;\n\n    case SvgIcon.CheckMark:\n      return html`\n      <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n        <path class=\"filled\" d=\"M10 0C15.5228 0 20 4.47715 20 10C20 15.5228 15.5228 20 10 20C4.47715 20 0 15.5228 0 10C0 4.47715 4.47715 0 10 0ZM13.2197 6.96967L8.75 11.4393L6.78033 9.46967C6.48744 9.17678 6.01256 9.17678 5.71967 9.46967C5.42678 9.76256 5.42678 10.2374 5.71967 10.5303L8.21967 13.0303C8.51256 13.3232 8.98744 13.3232 9.28033 13.0303L14.2803 8.03033C14.5732 7.73744 14.5732 7.26256 14.2803 6.96967C13.9874 6.67678 13.5126 6.67678 13.2197 6.96967Z\" fill=\"currentColor\"/>\n        <path class=\"regular\" d=\"M10 1.5C5.30558 1.5 1.5 5.30558 1.5 10C1.5 14.6944 5.30558 18.5 10 18.5C14.6944 18.5 18.5 14.6944 18.5 10C18.5 5.30558 14.6944 1.5 10 1.5ZM0 10C0 4.47715 4.47715 0 10 0C15.5228 0 20 4.47715 20 10C20 15.5228 15.5228 20 10 20C4.47715 20 0 15.5228 0 10Z\" fill=\"currentColor\"/>\n      </svg>\n      `;\n\n    case SvgIcon.Radio:\n      return html`\n      <svg width=\"66\" height=\"20\" viewBox=\"0 0 66 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n        <rect x=\"0.5\" y=\"0.5\" width=\"19\" height=\"19\" rx=\"9.5\" fill=\"#F3F3F3\"/>\n        <rect x=\"0.5\" y=\"0.5\" width=\"19\" height=\"19\" rx=\"9.5\" stroke=\"#636363\"/>\n        <path d=\"M36.5596 16H35.1924L33.5107 13.2178C33.1963 12.6982 32.9274 12.3656 32.7041 12.2197C32.4808 12.0693 32.2096 11.9941 31.8906 11.9941H30.7627V16H29.6143V6.19727H32.54C33.3923 6.19727 34.1009 6.42285 34.666 6.87402C35.2357 7.3252 35.5205 7.99056 35.5205 8.87012C35.5205 9.56283 35.3405 10.1439 34.9805 10.6133C34.6204 11.0827 34.126 11.4222 33.4971 11.6318V11.6592C33.7021 11.7822 33.8822 11.9167 34.0371 12.0625C34.1921 12.2083 34.3561 12.4225 34.5293 12.7051L36.5596 16ZM30.7627 7.23633V10.9551H32.3213C32.891 10.9551 33.3649 10.7705 33.7432 10.4014C34.126 10.0322 34.3174 9.55371 34.3174 8.96582C34.3174 8.44173 34.1465 8.02246 33.8047 7.70801C33.4674 7.39355 32.9775 7.23633 32.335 7.23633H30.7627ZM42.8008 16H41.6797V14.9062H41.6523C41.4108 15.3255 41.1123 15.64 40.7568 15.8496C40.4059 16.0592 39.9958 16.1641 39.5264 16.1641C38.8701 16.1641 38.3392 15.9727 37.9336 15.5898C37.528 15.207 37.3252 14.6989 37.3252 14.0654C37.3252 13.4684 37.5303 12.974 37.9404 12.582C38.3506 12.1901 38.9316 11.9395 39.6836 11.8301L41.6797 11.5635V11.4062C41.6797 10.8184 41.543 10.4014 41.2695 10.1553C40.9961 9.90462 40.6315 9.7793 40.1758 9.7793C39.8112 9.7793 39.4603 9.84766 39.123 9.98438C38.7858 10.1211 38.4691 10.3307 38.1729 10.6133L37.5166 9.93652C37.9085 9.55827 38.3255 9.28027 38.7676 9.10254C39.2096 8.9248 39.7018 8.83594 40.2441 8.83594C41.0918 8.83594 41.7298 9.05469 42.1582 9.49219C42.5866 9.92513 42.8008 10.5768 42.8008 11.4473V16ZM41.6797 13.1562V12.459L39.9912 12.6914C39.4762 12.7643 39.0889 12.8942 38.8291 13.0811C38.5693 13.2679 38.4395 13.5618 38.4395 13.9629C38.4395 14.3822 38.5602 14.7035 38.8018 14.9268C39.0479 15.1455 39.3464 15.2549 39.6973 15.2549C40.3034 15.2549 40.7842 15.0566 41.1396 14.6602C41.4997 14.2637 41.6797 13.7624 41.6797 13.1562ZM49.7939 14.8105C49.5342 15.2617 49.2038 15.6012 48.8027 15.8291C48.4062 16.0524 47.9346 16.1641 47.3877 16.1641C46.5081 16.1641 45.804 15.8519 45.2754 15.2275C44.7513 14.5986 44.4893 13.7441 44.4893 12.6641C44.4893 11.5065 44.7809 10.5791 45.3643 9.88184C45.9476 9.18457 46.7246 8.83594 47.6953 8.83594C48.1784 8.83594 48.5931 8.93164 48.9395 9.12305C49.2904 9.3099 49.5752 9.59245 49.7939 9.9707H49.8213V5.63672H50.9424V16H49.8213V14.8105H49.7939ZM45.6377 12.6094C45.6377 13.416 45.8245 14.054 46.1982 14.5234C46.5765 14.9883 47.0824 15.2207 47.7158 15.2207C48.3447 15.2207 48.8529 14.9951 49.2402 14.5439C49.6276 14.0928 49.8213 13.5231 49.8213 12.835V11.8027C49.8213 11.2376 49.6322 10.7591 49.2539 10.3672C48.8802 9.97526 48.4085 9.7793 47.8389 9.7793C47.1553 9.7793 46.6175 10.0299 46.2256 10.5312C45.8337 11.0326 45.6377 11.7253 45.6377 12.6094ZM53.7861 7.3252C53.5583 7.3252 53.3669 7.25 53.2119 7.09961C53.057 6.94466 52.9795 6.75553 52.9795 6.53223C52.9795 6.30892 53.057 6.12207 53.2119 5.97168C53.3669 5.81673 53.5583 5.73926 53.7861 5.73926C54.014 5.73926 54.2054 5.81673 54.3604 5.97168C54.5153 6.12207 54.5928 6.30892 54.5928 6.53223C54.5928 6.75553 54.5153 6.94466 54.3604 7.09961C54.2054 7.25 54.014 7.3252 53.7861 7.3252ZM54.333 16H53.2119V9H54.333V16ZM59.5283 16.1641C58.4938 16.1641 57.6667 15.8382 57.0469 15.1865C56.4316 14.5303 56.124 13.6621 56.124 12.582C56.124 11.4108 56.443 10.4948 57.0811 9.83398C57.7191 9.17318 58.5895 8.84049 59.6924 8.83594C60.736 8.83138 61.5495 9.15267 62.1328 9.7998C62.7207 10.4469 63.0146 11.3379 63.0146 12.4727C63.0146 13.5938 62.6979 14.4893 62.0645 15.1592C61.4355 15.8291 60.5902 16.1641 59.5283 16.1641ZM59.6104 15.2207C60.335 15.2207 60.891 14.986 61.2783 14.5166C61.6702 14.0426 61.8662 13.375 61.8662 12.5137C61.8662 11.6341 61.6702 10.9596 61.2783 10.4902C60.8864 10.0163 60.3304 9.7793 59.6104 9.7793C58.8903 9.7793 58.3206 10.0254 57.9014 10.5176C57.4821 11.0098 57.2725 11.6842 57.2725 12.541C57.2725 13.3704 57.4844 14.0244 57.9082 14.5029C58.332 14.9814 58.8994 15.2207 59.6104 15.2207Z\" fill=\"#1A1A1A\"/>\n      </svg>\n      `;\n\n    case SvgIcon.Fail:\n      return html`\n        <svg width=\"12\" height=\"12\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path fill=\"#EF355D\" d=\"m6,12c3.314,0 6,-2.6863 6,-6c0,-3.3137 -2.686,-6 -6,-6c-3.314,0 -6,2.6863 -6,6c0,3.3137 2.686,6 6,6z\"/>\n          <path fill=\"white\" d=\"m6.943,6.0004l1.544,-1.5444c0.169,-0.1683 0.236,-0.4142 0.174,-0.6448c-0.061,-0.2306 -0.241,-0.4107 -0.472,-0.4722c-0.231,-0.0616 -0.477,0.0049 -0.645,0.1742l-1.544,1.5443l-1.545,-1.5443c-0.26,-0.259 -0.681,-0.2583 -0.941,0.0014c-0.26,0.2598 -0.26,0.6808 -0.001,0.9414l1.544,1.5444l-1.544,1.5444c-0.259,0.2606 -0.259,0.6815 0.001,0.9413c0.26,0.2598 0.681,0.2604 0.941,0.0015l1.545,-1.5444l1.544,1.5444c0.261,0.2589 0.682,0.2583 0.942,-0.0015c0.259,-0.2598 0.26,-0.6807 0.001,-0.9413l-1.544,-1.5444z\" />\n        </svg>\n      `;\n\n    case SvgIcon.SelectAccount:\n      return html`\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"17\" height=\"17\" viewBox=\"0 0 17 17\" fill=\"none\">\n      <path fill=${color} d=\"M6.22176 13.9567C3.55468 13.653 2 11.8026 2 10V9.5C2 8.67157 2.67157 8 3.5 8H5.59971C5.43777 8.31679 5.30564 8.65136 5.20703 9H3.5C3.22386 9 3 9.22386 3 9.5V10C3 11.1281 3.88187 12.333 5.50235 12.7996C5.69426 13.216 5.93668 13.6043 6.22176 13.9567ZM9.62596 5.06907C9.70657 4.81036 9.75 4.53525 9.75 4.25C9.75 2.73122 8.51878 1.5 7 1.5C5.48122 1.5 4.25 2.73122 4.25 4.25C4.25 5.53662 5.13357 6.61687 6.32704 6.91706C6.64202 6.55055 7.00446 6.226 7.40482 5.95294C7.27488 5.98371 7.13934 6 7 6C6.0335 6 5.25 5.2165 5.25 4.25C5.25 3.2835 6.0335 2.5 7 2.5C7.9665 2.5 8.75 3.2835 8.75 4.25C8.75 4.73141 8.55561 5.16743 8.24104 5.48382C8.67558 5.28783 9.14016 5.14664 9.62596 5.06907ZM10.5 15C12.9853 15 15 12.9853 15 10.5C15 8.01472 12.9853 6 10.5 6C8.01472 6 6 8.01472 6 10.5C6 12.9853 8.01472 15 10.5 15ZM10.5 8C10.7761 8 11 8.22386 11 8.5V10H12.5C12.7761 10 13 10.2239 13 10.5C13 10.7761 12.7761 11 12.5 11H11V12.5C11 12.7761 10.7761 13 10.5 13C10.2239 13 10 12.7761 10 12.5V11H8.5C8.22386 11 8 10.7761 8 10.5C8 10.2239 8.22386 10 8.5 10H10V8.5C10 8.22386 10.2239 8 10.5 8Z\"/>\n    </svg>\n  `;\n\n    case SvgIcon.News:\n      return html`\n        <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\">\n        <path d=\"M18.75 20H5.25C3.51697 20 2.10075 18.6435 2.00514 16.9344L2 16.75V6.25C2 5.05914 2.92516 4.08436 4.09595 4.00519L4.25 4H16.75C17.9409 4 18.9156 4.92516 18.9948 6.09595L19 6.25V7H19.75C20.9409 7 21.9156 7.92516 21.9948 9.09595L22 9.25V16.75C22 18.483 20.6435 19.8992 18.9344 19.9949L18.75 20H5.25H18.75ZM5.25 18.5H18.75C19.6682 18.5 20.4212 17.7929 20.4942 16.8935L20.5 16.75V9.25C20.5 8.8703 20.2178 8.55651 19.8518 8.50685L19.75 8.5H19V16.25C19 16.6297 18.7178 16.9435 18.3518 16.9932L18.25 17C17.8703 17 17.5565 16.7178 17.5068 16.3518L17.5 16.25V6.25C17.5 5.8703 17.2178 5.55651 16.8518 5.50685L16.75 5.5H4.25C3.8703 5.5 3.55651 5.78215 3.50685 6.14823L3.5 6.25V16.75C3.5 17.6682 4.20711 18.4212 5.10647 18.4942L5.25 18.5H18.75H5.25ZM12.246 14.5H15.2522C15.6665 14.5 16.0022 14.8358 16.0022 15.25C16.0022 15.6297 15.7201 15.9435 15.354 15.9932L15.2522 16H12.246C11.8318 16 11.496 15.6642 11.496 15.25C11.496 14.8703 11.7782 14.5565 12.1442 14.5068L12.246 14.5H15.2522H12.246ZM9.24328 11.0045C9.6575 11.0045 9.99328 11.3403 9.99328 11.7545V15.25C9.99328 15.6642 9.6575 16 9.24328 16H5.74776C5.33355 16 4.99776 15.6642 4.99776 15.25V11.7545C4.99776 11.3403 5.33355 11.0045 5.74776 11.0045H9.24328ZM8.49328 12.5045H6.49776V14.5H8.49328V12.5045ZM12.246 11.0045H15.2522C15.6665 11.0045 16.0022 11.3403 16.0022 11.7545C16.0022 12.1342 15.7201 12.448 15.354 12.4976L15.2522 12.5045H12.246C11.8318 12.5045 11.496 12.1687 11.496 11.7545C11.496 11.3748 11.7782 11.061 12.1442 11.0113L12.246 11.0045H15.2522H12.246ZM5.74776 7.50247H15.2522C15.6665 7.50247 16.0022 7.83826 16.0022 8.25247C16.0022 8.63217 15.7201 8.94596 15.354 8.99563L15.2522 9.00247H5.74776C5.33355 9.00247 4.99776 8.66669 4.99776 8.25247C4.99776 7.87278 5.27991 7.55898 5.64599 7.50932L5.74776 7.50247H15.2522H5.74776Z\" fill=\"none\" />\n      </svg>\n      `;\n\n    case SvgIcon.DoubleBookmark:\n      return html`\n        <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M4 6.74814C4 5.50535 5.00742 4.49786 6.25013 4.49786H15.2506C16.4933 4.49786 17.5008 5.50535 17.5008 6.74814V21.2499C17.5008 21.5185 17.3572 21.7666 17.1243 21.9003C16.8914 22.0341 16.6048 22.0332 16.3728 21.8978L10.7504 18.6179L5.12797 21.8978C4.89599 22.0332 4.60936 22.0341 4.37648 21.9003C4.14359 21.7666 4 21.5185 4 21.2499V6.74814ZM6.25013 5.99805C5.83589 5.99805 5.50008 6.33387 5.50008 6.74814V19.944L10.3725 17.1016C10.606 16.9653 10.8948 16.9653 11.1283 17.1016L16.0007 19.944V6.74814C16.0007 6.33387 15.6649 5.99805 15.2506 5.99805H6.25013ZM15.2497 2C17.8732 2 20 4.12691 20 6.75058V18.6232C20 19.0374 19.6642 19.3733 19.25 19.3733C18.8357 19.3733 18.4999 19.0374 18.4999 18.6232V6.75058C18.4999 4.95543 17.0448 3.50018 15.2497 3.50018H6.63687C6.63687 3.50018 6.75016 2.94339 7.43379 2.41948C8.00023 2 8.60182 2 8.60182 2H15.2497Z\" fill=\"none\" />\n        </svg>\n      `;\n\n    case SvgIcon.ChevronLeft:\n      return html`\n        <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M15.5303 4.21967C15.8232 4.51256 15.8232 4.98744 15.5303 5.28033L8.81066 12L15.5303 18.7197C15.8232 19.0126 15.8232 19.4874 15.5303 19.7803C15.2374 20.0732 14.7626 20.0732 14.4697 19.7803L7.21967 12.5303C6.92678 12.2374 6.92678 11.7626 7.21967 11.4697L14.4697 4.21967C14.7626 3.92678 15.2374 3.92678 15.5303 4.21967Z\" fill=\"none\" />\n        </svg>`;\n\n    case SvgIcon.ChevronRight:\n      return html`\n        <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"currentColor\" aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M8.46967 4.21967C8.17678 4.51256 8.17678 4.98744 8.46967 5.28033L15.1893 12L8.46967 18.7197C8.17678 19.0126 8.17678 19.4874 8.46967 19.7803C8.76256 20.0732 9.23744 20.0732 9.53033 19.7803L16.7803 12.5303C17.0732 12.2374 17.0732 11.7626 16.7803 11.4697L9.53033 4.21967C9.23744 3.92678 8.76256 3.92678 8.46967 4.21967Z\" fill=\"currentColor\" />\n        </svg>`;\n\n    case SvgIcon.Delete:\n      return html`\n        <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M8.5 4H11.5C11.5 3.17157 10.8284 2.5 10 2.5C9.17157 2.5 8.5 3.17157 8.5 4ZM7.5 4C7.5 2.61929 8.61929 1.5 10 1.5C11.3807 1.5 12.5 2.61929 12.5 4H17.5C17.7761 4 18 4.22386 18 4.5C18 4.77614 17.7761 5 17.5 5H16.4456L15.2521 15.3439C15.0774 16.8576 13.7957 18 12.2719 18H7.72813C6.20431 18 4.92256 16.8576 4.7479 15.3439L3.55437 5H2.5C2.22386 5 2 4.77614 2 4.5C2 4.22386 2.22386 4 2.5 4H7.5ZM5.74131 15.2292C5.85775 16.2384 6.71225 17 7.72813 17H12.2719C13.2878 17 14.1422 16.2384 14.2587 15.2292L15.439 5H4.56101L5.74131 15.2292ZM8.5 7.5C8.77614 7.5 9 7.72386 9 8V14C9 14.2761 8.77614 14.5 8.5 14.5C8.22386 14.5 8 14.2761 8 14V8C8 7.72386 8.22386 7.5 8.5 7.5ZM12 8C12 7.72386 11.7761 7.5 11.5 7.5C11.2239 7.5 11 7.72386 11 8V14C11 14.2761 11.2239 14.5 11.5 14.5C11.7761 14.5 12 14.2761 12 14V8Z\" fill=\"currentColor\"/>\n        </svg>\n    `;\n\n    case SvgIcon.Add:\n      return html`\n        <svg width=\"16\" height=\"15\" viewBox=\"0 0 16 15\" fill=\"currentColor\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M8.39563 0.5C8.39563 0.223858 8.17177 0 7.89563 0C7.61949 0 7.39563 0.223858 7.39563 0.5V7H0.89563C0.619487 7 0.39563 7.22386 0.39563 7.5C0.39563 7.77614 0.619487 8 0.89563 8H7.39563V14.5C7.39563 14.7761 7.61949 15 7.89563 15C8.17177 15 8.39563 14.7761 8.39563 14.5V8H14.8956C15.1718 8 15.3956 7.77614 15.3956 7.5C15.3956 7.22386 15.1718 7 14.8956 7H8.39563V0.5Z\" fill=\"${color}\"/>\n        </svg>`;\n\n    case SvgIcon.Calendar:\n      return html`\n        <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M7 11C7.55228 11 8 10.5523 8 10C8 9.44771 7.55228 9 7 9C6.44772 9 6 9.44771 6 10C6 10.5523 6.44772 11 7 11ZM8 13C8 13.5523 7.55228 14 7 14C6.44772 14 6 13.5523 6 13C6 12.4477 6.44772 12 7 12C7.55228 12 8 12.4477 8 13ZM10 11C10.5523 11 11 10.5523 11 10C11 9.44771 10.5523 9 10 9C9.44771 9 9 9.44771 9 10C9 10.5523 9.44771 11 10 11ZM11 13C11 13.5523 10.5523 14 10 14C9.44771 14 9 13.5523 9 13C9 12.4477 9.44771 12 10 12C10.5523 12 11 12.4477 11 13ZM13 11C13.5523 11 14 10.5523 14 10C14 9.44771 13.5523 9 13 9C12.4477 9 12 9.44771 12 10C12 10.5523 12.4477 11 13 11ZM17 5.5C17 4.11929 15.8807 3 14.5 3H5.5C4.11929 3 3 4.11929 3 5.5V14.5C3 15.8807 4.11929 17 5.5 17H14.5C15.8807 17 17 15.8807 17 14.5V5.5ZM4 7H16V14.5C16 15.3284 15.3284 16 14.5 16H5.5C4.67157 16 4 15.3284 4 14.5V7ZM5.5 4H14.5C15.3284 4 16 4.67157 16 5.5V6H4V5.5C4 4.67157 4.67157 4 5.5 4Z\" fill=${color}/>\n        </svg>\n    `;\n\n    case SvgIcon.Planner:\n      return html`\n        <svg width=\"24\" height=\"24\" fill=\"none\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M17.75 3A3.25 3.25 0 0 1 21 6.25v11.5A3.25 3.25 0 0 1 17.75 21H6.25A3.25 3.25 0 0 1 3 17.75V6.25A3.25 3.25 0 0 1 6.25 3h11.5Zm1.75 5.5h-15v9.25c0 .966.784 1.75 1.75 1.75h11.5a1.75 1.75 0 0 0 1.75-1.75V8.5Zm-11.75 6a1.25 1.25 0 1 1 0 2.5 1.25 1.25 0 0 1 0-2.5Zm4.25 0a1.25 1.25 0 1 1 0 2.5 1.25 1.25 0 0 1 0-2.5Zm-4.25-4a1.25 1.25 0 1 1 0 2.5 1.25 1.25 0 0 1 0-2.5Zm4.25 0a1.25 1.25 0 1 1 0 2.5 1.25 1.25 0 0 1 0-2.5Zm4.25 0a1.25 1.25 0 1 1 0 2.5 1.25 1.25 0 0 1 0-2.5Zm1.5-6H6.25A1.75 1.75 0 0 0 4.5 6.25V7h15v-.75a1.75 1.75 0 0 0-1.75-1.75Z\" fill=\"${color}\"/>\n        </svg>`;\n\n    case SvgIcon.Milestone:\n      return html`\n        <svg width=\"24\" height=\"24\" fill=\"${color}\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M15.25 13c.966 0 1.75.784 1.75 1.75v4.5A1.75 1.75 0 0 1 15.25 21H3.75A1.75 1.75 0 0 1 2 19.25v-4.5c0-.966.783-1.75 1.75-1.75h11.5ZM21 14.899v5.351a.75.75 0 0 1-1.494.102l-.006-.102v-5.338a3.006 3.006 0 0 0 1.5-.013Zm-5.75-.399H3.75a.25.25 0 0 0-.25.25v4.5c0 .138.111.25.25.25h11.5a.25.25 0 0 0 .25-.25v-4.5a.25.25 0 0 0-.25-.25Zm5-4.408a1.908 1.908 0 1 1 0 3.816 1.908 1.908 0 0 1 0-3.816ZM15.244 3c.967 0 1.75.784 1.75 1.75v4.5a1.75 1.75 0 0 1-1.75 1.75h-11.5a1.75 1.75 0 0 1-1.75-1.75v-4.5a1.75 1.75 0 0 1 1.607-1.744L3.745 3h11.5Zm0 1.5h-11.5l-.057.007a.25.25 0 0 0-.193.243v4.5c0 .138.112.25.25.25h11.5a.25.25 0 0 0 .25-.25v-4.5a.25.25 0 0 0-.25-.25ZM20.25 3a.75.75 0 0 1 .743.648L21 3.75v5.351a3.004 3.004 0 0 0-1.5-.013V3.75a.75.75 0 0 1 .75-.75Z\" fill=\"${color}\"/>\n        </svg>`;\n\n    case SvgIcon.PersonAdd:\n      return html`\n        <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" xmlns=\"http://www.w3.org/2000/svg\" class=\"svg\" fill=\"currentColor\">\n          <path d=\"M9 2a4 4 0 100 8 4 4 0 000-8zM6 6a3 3 0 116 0 3 3 0 01-6 0z\"></path>\n          <path d=\"M4 11a2 2 0 00-2 2c0 1.7.83 2.97 2.13 3.8A9.14 9.14 0 009 18c.41 0 .82-.02 1.21-.06A5.5 5.5 0 019.6 17 12 12 0 019 17a8.16 8.16 0 01-4.33-1.05A3.36 3.36 0 013 13a1 1 0 011-1h5.6c.18-.36.4-.7.66-1H4z\"></path>\n          <path d=\"M14.5 19a4.5 4.5 0 100-9 4.5 4.5 0 000 9zm0-7c.28 0 .5.22.5.5V14h1.5a.5.5 0 010 1H15v1.5a.5.5 0 01-1 0V15h-1.5a.5.5 0 010-1H14v-1.5c0-.28.22-.5.5-.5z\"></path>\n        </svg>`;\n    case SvgIcon.Event:\n      return html`\n        <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M17.75 3C19.5449 3 21 4.45507 21 6.25V17.75C21 19.5449 19.5449 21 17.75 21H6.25C4.45507 21 3 19.5449 3 17.75V6.25C3 4.45507 4.45507 3 6.25 3H17.75ZM19.5 8.5H4.5V17.75C4.5 18.7165 5.2835 19.5 6.25 19.5H17.75C18.7165 19.5 19.5 18.7165 19.5 17.75V8.5ZM7.75 14.5C8.44036 14.5 9 15.0596 9 15.75C9 16.4404 8.44036 17 7.75 17C7.05964 17 6.5 16.4404 6.5 15.75C6.5 15.0596 7.05964 14.5 7.75 14.5ZM12 14.5C12.6904 14.5 13.25 15.0596 13.25 15.75C13.25 16.4404 12.6904 17 12 17C11.3096 17 10.75 16.4404 10.75 15.75C10.75 15.0596 11.3096 14.5 12 14.5ZM7.75 10.5C8.44036 10.5 9 11.0596 9 11.75C9 12.4404 8.44036 13 7.75 13C7.05964 13 6.5 12.4404 6.5 11.75C6.5 11.0596 7.05964 10.5 7.75 10.5ZM12 10.5C12.6904 10.5 13.25 11.0596 13.25 11.75C13.25 12.4404 12.6904 13 12 13C11.3096 13 10.75 12.4404 10.75 11.75C10.75 11.0596 11.3096 10.5 12 10.5ZM16.25 10.5C16.9404 10.5 17.5 11.0596 17.5 11.75C17.5 12.4404 16.9404 13 16.25 13C15.5596 13 15 12.4404 15 11.75C15 11.0596 15.5596 10.5 16.25 10.5ZM17.75 4.5H6.25C5.2835 4.5 4.5 5.2835 4.5 6.25V7H19.5V6.25C19.5 5.2835 18.7165 4.5 17.75 4.5Z\" fill=\"none\" />\n        </svg>\n      `;\n\n    case SvgIcon.BookOpen:\n      return html`\n        <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M12 19.1375C11.4986 19.6686 10.788 20 10 20H3.75C2.7835 20 2 19.2165 2 18.25V5.75C2 4.7835 2.7835 4 3.75 4H10C10.788 4 11.4986 4.33145 12 4.86253C12.5014 4.33145 13.212 4 14 4H20.25C21.2165 4 22 4.7835 22 5.75V18.25C22 19.2165 21.2165 20 20.25 20H14C13.212 20 12.5014 19.6686 12 19.1375ZM3.5 5.75V18.25C3.5 18.3881 3.61193 18.5 3.75 18.5H10C10.6904 18.5 11.25 17.9404 11.25 17.25V6.75C11.25 6.05964 10.6904 5.5 10 5.5H3.75C3.61193 5.5 3.5 5.61193 3.5 5.75ZM12.75 17.25C12.75 17.9404 13.3096 18.5 14 18.5H20.25C20.3881 18.5 20.5 18.3881 20.5 18.25V5.75C20.5 5.61193 20.3881 5.5 20.25 5.5H14C13.3096 5.5 12.75 6.05964 12.75 6.75V17.25Z\" fill=\"none\" />\n        </svg>\n      `;\n\n    case SvgIcon.FileOuter:\n      return html`\n        <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M6 2C4.89543 2 4 2.89543 4 4V20C4 21.1046 4.89543 22 6 22H18C19.1046 22 20 21.1046 20 20V9.82777C20 9.29733 19.7893 8.78863 19.4142 8.41355L13.5864 2.58579C13.2114 2.21071 12.7027 2 12.1722 2H6ZM5.5 4C5.5 3.72386 5.72386 3.5 6 3.5H12V8C12 9.10457 12.8954 10 14 10H18.5V20C18.5 20.2761 18.2761 20.5 18 20.5H6C5.72386 20.5 5.5 20.2761 5.5 20V4ZM17.3793 8.5H14C13.7239 8.5 13.5 8.27614 13.5 8V4.62066L17.3793 8.5Z\" fill=\"none\" />\n        </svg>\n      `;\n\n    case SvgIcon.BookQuestion:\n      return html`\n        <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M10.9998 8.01752C10.9905 8.42363 10.6584 8.74999 10.25 8.74999C9.5 8.74999 9.5 7.9989 9.5 7.9989L9.5 7.99777L9.50001 7.99539L9.50006 7.99017C9.50032 7.9755 9.50072 7.96084 9.50144 7.94618C9.50262 7.92198 9.50473 7.89159 9.50846 7.8559C9.51591 7.78477 9.52996 7.69092 9.55665 7.58186C9.60973 7.36492 9.71565 7.07652 9.92848 6.78906C10.3825 6.17582 11.1982 5.72727 12.513 5.7501C13.4627 5.76659 14.3059 6.16497 14.834 6.82047C15.371 7.48704 15.5517 8.3902 15.1964 9.27853C14.8342 10.1839 14.0149 10.5437 13.5442 10.7503L13.4932 10.7728C13.2147 10.8957 13.0813 10.9599 13.0013 11.024L13 11.0251L13 11.7492C13.0001 12.1634 12.6643 12.4999 12.2501 12.5C11.8359 12.5 11.5001 12.1643 11.5 11.7501L11.5 11C11.5 10.4769 11.752 10.1029 12.0633 9.85345C12.3134 9.65303 12.6276 9.51483 12.8491 9.4174L12.8875 9.40049C13.4292 9.16137 13.6868 9.01346 13.8036 8.72145C13.9483 8.35977 13.8789 8.02596 13.6659 7.76153C13.4439 7.48604 13.0371 7.25943 12.487 7.24988C11.5518 7.23364 11.2425 7.53509 11.134 7.68162C11.0656 7.77404 11.0309 7.86797 11.0137 7.93838C11.0052 7.973 11.0017 7.99908 11.0003 8.01197L10.9998 8.01752ZM12.25 15.5C12.8023 15.5 13.25 15.0523 13.25 14.5C13.25 13.9477 12.8023 13.5 12.25 13.5C11.6977 13.5 11.25 13.9477 11.25 14.5C11.25 15.0523 11.6977 15.5 12.25 15.5ZM4 4.5C4 3.11929 5.11929 2 6.5 2H18C19.3807 2 20.5 3.11929 20.5 4.5V18.75C20.5 19.1642 20.1642 19.5 19.75 19.5H5.5C5.5 20.0523 5.94772 20.5 6.5 20.5H19.75C20.1642 20.5 20.5 20.8358 20.5 21.25C20.5 21.6642 20.1642 22 19.75 22H6.5C5.11929 22 4 20.8807 4 19.5V4.5ZM5.5 4.5V18H19V4.5C19 3.94772 18.5523 3.5 18 3.5H6.5C5.94772 3.5 5.5 3.94772 5.5 4.5Z\" fill=\"none\" />\n        </svg>\n      `;\n\n    case SvgIcon.Globe:\n      return html`\n        <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M12.0001 1.99805C17.5238 1.99805 22.0016 6.47589 22.0016 11.9996C22.0016 17.5233 17.5238 22.0011 12.0001 22.0011C6.47638 22.0011 1.99854 17.5233 1.99854 11.9996C1.99854 6.47589 6.47638 1.99805 12.0001 1.99805ZM14.939 16.4993H9.06118C9.71322 18.9135 10.8466 20.5011 12.0001 20.5011C13.1536 20.5011 14.2869 18.9135 14.939 16.4993ZM7.5084 16.4999L4.78591 16.4998C5.74425 18.0328 7.1777 19.2384 8.88008 19.9104C8.3578 19.0906 7.92681 18.0643 7.60981 16.8949L7.5084 16.4999ZM19.2143 16.4998L16.4918 16.4999C16.168 17.8337 15.7004 18.9995 15.119 19.9104C16.716 19.2804 18.0757 18.1814 19.0291 16.7833L19.2143 16.4998ZM7.09351 9.99895H3.7359L3.73115 10.0162C3.57906 10.6525 3.49854 11.3166 3.49854 11.9996C3.49854 13.0558 3.69112 14.0669 4.0431 14.9999L7.21626 14.9995C7.07396 14.0504 6.99854 13.0422 6.99854 11.9996C6.99854 11.3156 7.031 10.6464 7.09351 9.99895ZM15.397 9.99901H8.60316C8.53514 10.6393 8.49853 11.309 8.49853 11.9996C8.49853 13.0591 8.58468 14.0694 8.73827 14.9997H15.2619C15.4155 14.0694 15.5016 13.0591 15.5016 11.9996C15.5016 11.309 15.465 10.6393 15.397 9.99901ZM20.2647 9.99811L16.9067 9.99897C16.9692 10.6464 17.0016 11.3156 17.0016 11.9996C17.0016 13.0422 16.9262 14.0504 16.7839 14.9995L19.9571 14.9999C20.309 14.0669 20.5016 13.0558 20.5016 11.9996C20.5016 11.3102 20.4196 10.64 20.2647 9.99811ZM8.88114 4.08875L8.85823 4.09747C6.81092 4.91218 5.1549 6.49949 4.25023 8.49935L7.29835 8.49972C7.61171 6.74693 8.15855 5.221 8.88114 4.08875ZM12.0001 3.49805L11.8844 3.50335C10.619 3.6191 9.39651 5.62107 8.8288 8.4993H15.1714C14.6052 5.62914 13.388 3.63033 12.1264 3.50436L12.0001 3.49805ZM15.1201 4.08881L15.2269 4.2629C15.8961 5.37537 16.4043 6.83525 16.7018 8.49972L19.7499 8.49935C18.8853 6.58795 17.3343 5.05341 15.4113 4.21008L15.1201 4.08881Z\" />\n        </svg>\n      `;\n\n    case SvgIcon.PresenceAvailable:\n      return html`\n        <svg fill=\"#13a10e\" aria-hidden=\"true\" width=\"10\" height=\"10\" viewBox=\"0 0 10 10\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M5 10A5 5 0 1 0 5 0a5 5 0 0 0 0 10Zm2.1-5.9L4.85 6.35a.5.5 0 0 1-.7 0l-1-1a.5.5 0 0 1 .7-.7l.65.64 1.9-1.9a.5.5 0 0 1 .7.71Z\" fill=\"#13a10e\"></path>\n        </svg>`;\n\n    case SvgIcon.PresenceOofAvailable:\n      return html`\n        <svg fill=\"#13a10e\" aria-hidden=\"true\" width=\"10\" height=\"10\" viewBox=\"0 0 10 10\" xmlns=\"http://www.w3.org/2000/svg\">\n            <path d=\"M5 0a5 5 0 1 0 0 10A5 5 0 0 0 5 0ZM1 5a4 4 0 1 1 8 0 4 4 0 0 1-8 0Zm6.1-1.6c.2.2.2.5 0 .7L4.85 6.35a.5.5 0 0 1-.7 0l-1-1a.5.5 0 1 1 .7-.7l.65.64 1.9-1.9c.2-.19.5-.19.7 0Z\" fill=\"#13a10e\"></path>\n        </svg>`;\n\n    case SvgIcon.PresenceBusy:\n      return html`\n        <svg fill=\"#d13438\" aria-hidden=\"true\" width=\"10\" height=\"10\" viewBox=\"0 0 10 10\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M10 5A5 5 0 1 1 0 5a5 5 0 0 1 10 0Z\" fill=\"#d13438\"></path>\n        </svg>`;\n\n    case SvgIcon.PresenceOofBusy:\n      return html`\n        <svg fill=\"#d13438\" aria-hidden=\"true\" width=\"10\" height=\"10\" viewBox=\"0 0 10 10\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M5 1a4 4 0 1 0 0 8 4 4 0 0 0 0-8ZM0 5a5 5 0 1 1 10 0A5 5 0 0 1 0 5Z\" fill=\"#d13438\"></path>\n        </svg>\n      `;\n\n    case SvgIcon.PresenceDnd:\n      return html`\n        <svg fill=\"#d13438\" aria-hidden=\"true\" width=\"10\" height=\"10\" viewBox=\"0 0 10 10\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M5 10A5 5 0 1 0 5 0a5 5 0 0 0 0 10ZM3.5 4.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1Z\" fill=\"#d13438\"></path>\n        </svg>`;\n\n    case SvgIcon.PresenceOofDnd:\n      return html`\n        <svg fill=\"#d13438\" aria-hidden=\"true\" width=\"10\" height=\"10\" viewBox=\"0 0 10 10\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M5 0a5 5 0 1 0 0 10A5 5 0 0 0 5 0ZM1 5a4 4 0 1 1 8 0 4 4 0 0 1-8 0Zm2 0c0-.28.22-.5.5-.5h3a.5.5 0 0 1 0 1h-3A.5.5 0 0 1 3 5Z\" fill=\"#d13438\"></path>\n        </svg>`;\n\n    case SvgIcon.PresenceAway:\n      return html`\n        <svg fill=\"#eaa300\" aria-hidden=\"true\" width=\"10\" height=\"10\" viewBox=\"0 0 10 10\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M5 10A5 5 0 1 0 5 0a5 5 0 0 0 0 10Zm0-7v1.8l1.35 1.35a.5.5 0 1 1-.7.7l-1.5-1.5A.5.5 0 0 1 4 5V3a.5.5 0 0 1 1 0Z\" fill=\"#eaa300\"></path>\n        </svg>`;\n\n    case SvgIcon.PresenceOofAway:\n      return html`\n        <svg fill=\"#c239b3\" aria-hidden=\"true\" width=\"10\" height=\"10\" viewBox=\"0 0 10 10\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M5.35 3.85a.5.5 0 1 0-.7-.7l-1.5 1.5a.5.5 0 0 0 0 .7l1.5 1.5a.5.5 0 1 0 .7-.7L4.7 5.5h1.8a.5.5 0 1 0 0-1H4.7l.65-.65ZM5 0a5 5 0 1 0 0 10A5 5 0 0 0 5 0ZM1 5a4 4 0 1 1 8 0 4 4 0 0 1-8 0Z\" fill=\"#c239b3\"></path>\n        </svg>`;\n\n    case SvgIcon.PresenceOffline:\n      return html`\n        <svg fill=\"#929292\" aria-hidden=\"true\" width=\"10\" height=\"10\" viewBox=\"0 0 10 10\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M6.85 3.15c.2.2.2.5 0 .7L5.71 5l1.14 1.15a.5.5 0 1 1-.7.7L5 5.71 3.85 6.85a.5.5 0 1 1-.7-.7L4.29 5 3.15 3.85a.5.5 0 1 1 .7-.7L5 4.29l1.15-1.14c.2-.2.5-.2.7 0ZM0 5a5 5 0 1 1 10 0A5 5 0 0 1 0 5Zm5-4a4 4 0 1 0 0 8 4 4 0 0 0 0-8Z\" fill=\"#929292\"></path>\n        </svg>`;\n\n    case SvgIcon.PresenceStatusUnknown:\n      return html`\n        <svg fill=\"#d13438\" aria-hidden=\"true\" width=\"10\" height=\"10\" viewBox=\"0 0 10 10\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M5 1a4 4 0 1 0 0 8 4 4 0 0 0 0-8ZM0 5a5 5 0 1 1 10 0A5 5 0 0 1 0 5Z\" fill=\"#d13438\"></path>\n        </svg>`;\n  }\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { property, state } from 'lit/decorators.js';\nimport { html, PropertyValueMap, PropertyValues, TemplateResult } from 'lit';\n\nimport { equals } from '../utils/equals';\nimport { TemplateContext } from '../utils/TemplateContext';\nimport { TemplateHelper } from '../utils/TemplateHelper';\nimport { MgtBaseTaskComponent } from './baseTaskComponent';\nimport { OrderedHtmlTemplate, RenderedTemplates, TemplateRenderedData } from './templatedComponent';\n\n/**\n * An abstract class that defines a templatable web component\n *\n * @export\n * @abstract\n * @class MgtTemplatedTaskComponent\n * @extends {MgtBaseTaskComponent}\n *\n * @fires {CustomEvent<MgtElement.TemplateRenderedData>} templateRendered - fires when a template is rendered\n */\nexport abstract class MgtTemplatedTaskComponent extends MgtBaseTaskComponent {\n  /**\n   * Additional data context to be used in template binding\n   * Use this to add event listeners or value converters\n   *\n   * @type {MgtElement.TemplateContext}\n   * @memberof MgtTemplatedTaskComponent\n   */\n  @property({ attribute: false }) public templateContext: TemplateContext;\n\n  /**\n   *\n   * Gets or sets the error (if any) of the request\n   *\n   * @type object\n   * @memberof MgtSearchResults\n   */\n  @state() protected error: object;\n\n  /**\n   * Holds all templates defined by developer\n   *\n   * @protected\n   * @memberof MgtTemplatedTaskComponent\n   */\n  protected templates: Record<string, OrderedHtmlTemplate> = {};\n\n  private _renderedSlots = false;\n  private _renderedTemplates: RenderedTemplates = {};\n  private _slotNamesAddedDuringRender = [];\n\n  constructor() {\n    super();\n\n    this.templateContext = this.templateContext || {};\n  }\n\n  /**\n   * Render the loading state\n   *\n   * @protected\n   * @returns {TemplateResult}\n   * @memberof MgtFile\n   */\n  protected renderLoading = (): TemplateResult => {\n    return this.renderTemplate('loading', null) || html``;\n  };\n\n  /**\n   * Updates the element. This method reflects property values to attributes.\n   * It can be overridden to render and keep updated element DOM.\n   * Setting properties inside this method will *not* trigger\n   * another update.\n   *\n   * * @param _changedProperties Map of changed properties with old values\n   */\n  protected update(changedProperties: PropertyValueMap<unknown> | Map<PropertyKey, unknown>) {\n    this.templates = this.getTemplates();\n    this._slotNamesAddedDuringRender = [];\n    super.update(changedProperties);\n  }\n\n  /**\n   * Invoked whenever the element is updated. Implement to perform\n   * post-updating tasks via DOM APIs, for example, focusing an element.\n   *\n   * Setting properties inside this method will trigger the element to update\n   * again after this update cycle completes.\n   *\n   * * @param changedProperties Map of changed properties with old values\n   */\n  protected updated(changedProperties: PropertyValues) {\n    super.updated(changedProperties);\n    this.removeUnusedSlottedElements();\n  }\n\n  /**\n   * Render a <template> by type and return content to render\n   *\n   * @param templateType type of template (indicated by the data-type attribute)\n   * @param context the data context that should be expanded in template\n   * @param slotName the slot name that will be used to host the new rendered template. set to a unique value if multiple templates of this type will be rendered. default is templateType\n   */\n  protected renderTemplate(templateType: string, context: object, slotName?: string): TemplateResult {\n    if (!this.hasTemplate(templateType)) {\n      return null;\n    }\n\n    slotName = slotName || templateType;\n    this._slotNamesAddedDuringRender.push(slotName);\n    this._renderedSlots = true;\n\n    const template = html`\n      <slot name=${slotName}></slot>\n    `;\n\n    const dataContext = { ...context, ...this.templateContext };\n\n    if (Object.prototype.hasOwnProperty.call(this._renderedTemplates, slotName)) {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n      const { context: existingContext, slot } = this._renderedTemplates[slotName];\n      if (equals(existingContext, dataContext)) {\n        return template;\n      }\n      this.removeChild(slot);\n    }\n\n    const div = document.createElement('div');\n    div.slot = slotName;\n    div.dataset.generated = 'template';\n\n    TemplateHelper.renderTemplate(div, this.templates[templateType], dataContext);\n\n    this.appendChild(div);\n\n    this._renderedTemplates[slotName] = { context: dataContext, slot: div };\n\n    const templateRenderedData: TemplateRenderedData = { templateType, context: dataContext, element: div };\n    this.fireCustomEvent('templateRendered', templateRenderedData);\n\n    return template;\n  }\n\n  /**\n   * Check if a specific template has been provided.\n   *\n   * @protected\n   * @param {string} templateName\n   * @returns {boolean}\n   * @memberof MgtTemplatedTaskComponent\n   */\n  protected hasTemplate(templateName: string): boolean {\n    return Boolean(this.templates?.[templateName]);\n  }\n\n  private getTemplates() {\n    const templates: Record<string, OrderedHtmlTemplate> = {};\n\n    for (let i = 0; i < this.children.length; i++) {\n      const child = this.children[i];\n      if (child.nodeName === 'TEMPLATE') {\n        const template = child as OrderedHtmlTemplate;\n        if (template.dataset.type) {\n          templates[template.dataset.type] = template;\n        } else {\n          templates.default = template;\n        }\n\n        template.templateOrder = i;\n      }\n    }\n\n    return templates;\n  }\n\n  /**\n   * Renders an error\n   *\n   * @returns\n   */\n  protected renderError = (e: unknown): TemplateResult => {\n    if (this.hasTemplate('error')) {\n      return this.renderTemplate('error', e as object);\n    }\n\n    return html`\n      <div class=\"error\">\n        ${e}\n      </div>\n    `;\n  };\n\n  private removeUnusedSlottedElements() {\n    if (this._renderedSlots) {\n      for (let i = 0; i < this.children.length; i++) {\n        const child = this.children[i] as HTMLElement;\n        if (child.dataset?.generated && !this._slotNamesAddedDuringRender.includes(child.slot)) {\n          this.removeChild(child);\n          delete this._renderedTemplates[child.slot];\n          i--;\n        }\n      }\n      this._renderedSlots = false;\n    }\n  }\n}\n"],"names":[],"sourceRoot":""}